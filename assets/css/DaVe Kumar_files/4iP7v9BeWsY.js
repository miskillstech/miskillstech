/*!CK:969344126!*//*1458113354,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["xzxzd"]); }

__d("AdPageMessageTypeEnum",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AD_ADMIN_TEXT:"ad_admin_text",AD_TEXT:"ad_text",AD_BUBBLE:"ad_bubble",NON_AD:"non_ad"};},null);
__d("ChatNotificationConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};},null);
__d("GenderConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null);
__d("IrisProtocolMessageLifetime",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};},null);
__d("MercuryCommands",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ME:"\/me "};},null);
__d("MercuryMessageSourceTags",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercurySendMessageFields",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null);
__d("MercuryTypeaheadConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={COMPOSER_FRIENDS_MAX:4,COMPOSER_FB4C_MAX:4,COMPOSER_NON_FRIENDS_MAX:2,COMPOSER_SHOW_MORE_LIMIT:2,COMPOSER_THREADS_INITIAL_LIMIT:2,COMPOSER_CHATTAB_MAX:5,COMPOSER_PAGES_MAX:4,COMPOSER_WM_MAX:18,USER_TYPE:"user",PAGE_TYPE:"page",THREAD_TYPE:"thread",HEADER_TYPE:"header",FRIEND_TYPE:"friend",NON_FRIEND_TYPE:"non_friend",FB4C_TYPE:"fb4c",MEETING_ROOM_PAGE_TYPE:"meeting_room_page",COMMERCE_PAGE_TYPE:"commerce_page",VALID_EMAIL:"^([A-Z0-9._\u0025+-]+\u0040((?!facebook\\.com))[A-Z0-9.-]+\\.[A-Z]{2,4}|(([A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*)|([A-Z0-9._\u0025+-]+[A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*))\u0040(?:facebook\\.com))$"};},null);
__d("MessagesViewerSetID",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};},null);
__d("MessagingRealtimeConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={VIEWER_FBID:"realtime_viewer_fbid"};},null);
__d("MessengerView",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DETAIL:{COMPOSE:"detail\/compose",THREAD:"detail\/thread"},MASTER:{GROUPS:"master\/groups",PEOPLE:"master\/people",RECENT:"master\/recent"}};},null);
__d("P2PPaymentLoggerEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ACTN_ADD_CREDIT_CARD:"Actn_AddCreditCard",ACTN_UPDATE_CREDIT_CARD:"Actn_UpdateCreditCard",ACTN_REMOVE_CREDIT_CARD:"Actn_RemoveCreditCard",ACTN_UNLOCK_CREDIT_CARD:"Actn_UnlockCreditCard",ACTN_VALIDATE_CARD:"Actn_ValidateCard",ACTN_TRANSFER_MONEY:"Actn_TransferMoney",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN:"Actn_TransferMoneyWithCampaign",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN_PARENT_CALL:"Actn_TransferMoneyWithCampaignParentCall",ACTN_TRANSFER_MONEY_WITH_CAMPAIGN_POST_SUCCESS:"Actn_TransferMoneyWithCampaignPostSuccess",ACTN_TRANSFER_MONEY_CHECK_NEEDS_REVERT:"Actn_TransferMoneyCheckNeedsRevert",ACTN_TRANSFER_MONEY_REVERT:"Actn_TransferMoneyRevert",ACTN_TRANSFER_MONEY_CREATE_CONTEXT:"Actn_TransferMoneyCreateContext",ACTN_TRANSFER_MONEY_CREATE_PLATFORM_ITEM:"Actn_TransferMoneyCreatePlatformItem",ACTN_ACCEPT_MONEY:"Actn_AcceptMoney",ACTN_DECLINE_MONEY:"Actn_DeclineMoney",ACTN_SET_PRIMARY:"Actn_SetPrimary",ACTN_WITHDRAW_MONEY:"Actn_WithdrawMoney",ACTN_CREATE_MSGR_COMMERCE_CART:"Actn_CreateMsgrCommerceCart",ACTN_PLACE_MSGR_COMMERCE_ORDER:"Actn_PlaceMsgrCommerceOrder",ACTN_SEND_TRANSFER_MESSAGE:"Actn_SendTransferMessage",ACTN_POST_TRANSFER_STEPS:"Actn_PostTransferSteps",ACTN_SEND_EXPIRE_NOTIFICATIONS:"Actn_SendExpireNotifications",ACTN_SEND_PUSH_FAIL_NOTIFS:"Actn_SendPushFailNotis",ACTN_UNCATEGORIZED_EXCEPTION:"Actn_Uncategorized_Exception",ACTN_INCREASE_CAMPAIGN_COUNTER:"Actn_Increase_Campaign_Counter",ACTN_CREATE_PAYMENT_REQUEST:"Actn_CreatePaymentRequest",ACTN_REMIND_PAYMENT_REQUEST:"Actn_RemindPaymentRequest",ACTN_PAY_PAYMENT_REQUEST:"Actn_PayPaymentRequest",ACTN_DECLINE_PAYMENT_REQUEST:"Actn_DeclinePaymentRequest",ACTN_CANCEL_PAYMENT_REQUEST:"Actn_CancelPaymentRequest",ACTN_EXPIRE_PAYMENT_REQUEST:"Actn_ExpirePaymentRequest",ACTN_SEND_PAYMENT_REQUEST_MESSAGE:"Actn_SendPaymentRequestMessage",ACTN_AUTH_FOR_SENDER_REVIEW:"Actn_AuthForSenderReview",ACTN_COMPLETE_SENDER_REVIEW:"Actn_CompleteSenderReview",ACTN_COMPLETE_RECEIVER_REVIEW:"Actn_CompleteReceiverReview",ACTN_SUBMIT_VERIFICATION_STEP:"Actn_SubmitVerificationStep",ACTN_COMPLETE_SENDER_VERIFICATION:"Actn_CompleteSenderVerification",ACTN_COMPLETE_RECEIVER_VERIFICATION:"Actn_CancelReceiverVerification",ACTN_CANCEL_SENDER_VERIFICATION:"Actn_CancelSenderVerification",ACTN_CANCEL_RECEIVER_VERIFICATION:"Actn_CancelReceiverVerification",ACTN_CANCEL_SENDER_RISK:"Actn_CancelSenderRisk",ACTN_CANCEL_EXPIRE:"Actn_CancelExpire",ACTN_CANCEL_FOR_SAME_CARD:"Actn_CancelForSameCard",ACTN_CANCEL_BY_CUSTOMER_SERVICE:"Actn_CancelByCustomerService",ACTN_CANCEL_RECEIVER_REVIEW:"Actn_CancelReceiverReview",ACTN_CANCEL_SENDER_REVIEW:"Actn_CancelSenderReview",ACTN_CANCEL_ALL_PENDING_TRANSFERS:"Actn_CancelAllPendingTransfers",ACTN_FILTER_LOGMESSAGE:"Actn_FilterLogMessage",ACTN_FILTER_NOTIFICATION:"Actn_FilterNotification",ACTN_SEND_NOTIFICATION:"Actn_SendNotification",ACTN_ADD_PIN:"Actn_AddPIN",ACTN_UPDATE_PIN:"Actn_UpdatePIN",ACTN_REMOVE_PIN:"Actn_RemovePIN",ACTN_RESET_PIN:"Actn_ResetPIN",ACTN_ENABLE_TOUCH_ID:"Actn_EnableTouchID",ACTN_VERIFY_TOUCH_ID:"Actn_VerifyTouchID",ACTN_DISABLE_TOUCH_ID:"Actn_DisableTouchID",ACTN_CHANNEL_NOTIF_CARD_EVENT:"Actn_ChannelNotifCardEvent",ACTN_CHANNEL_NOTIF_TRANSFER_STATUS_EVENT:"Actn_ChannelNotifTransferStatusEvent",ACTN_CHANNEL_NOTIF_PLATFORM_EVENT:"Actn_ChannelNotifPlatformEvent",ACTN_CHANNEL_NOTIF_PAYMENT_REQUEST_STATUS_EVENT:"Actn_ChannelNotifPaymentRequestStatusEvent",ACTN_PLATFORM_BANNER_DISMISSED:"Actn_PlatformBannerDismissed",ACTN_PLATFORM_BANNER_MARK_AS_SOLD:"Actn_PlatformBannerMarkAsSold",ACTN_ADD_ADDRESS:"Actn_AddAddress",ACTN_GET_ADDRESSES:"Actn_GetAddresses",ACTN_GET_CURRENT_USER_PROFILE_DATA:"Actn_GetCurrentUserProfileData",ACTN_CAMPAIGN_CHECK_USER_HAS_NEW_ACTIVITY:"Actn_CampaignCheckUserHasNewActivity",ACTN_CAMPAIGN_SAVE_PROMO_NOTIFICATION_TIME:"Actn_CampaignSavePromoNotificationTime",UI_ACTN_SEND_MONEY_BUTTON_CLICKED:"UI_Actn_Send_Money_Button_Clicked",UI_ACTN_SEND_MONEY_BUTTON_PLACEHOLDER_CLICKED:"UI_Actn_Send_Money_Button_Placeholder_Clicked",UI_ACTN_INITIATE_SEND:"UI_Actn_Initiate_Send",UI_ACTN_P2P_SENDER_DISABLED_SHOWN:"UI_Actn_P2P_Sender_Disabled_Shown",UI_ACTN_P2P_RECIPIENT_INELIGIBLE_SHOWN:"UI_Actn_P2P_Recipient_Ineligible_Shown",UI_ACTN_CANCEL_SEND:"UI_Actn_Send_Money_Cancelled",UI_ACTN_INITIATE_ADD_CARD:"UI_Actn_Initiate_Add_Card",UI_ACTN_INITIATE_CHOOSE_CARD:"UI_Actn_Initiate_Choose_Card",UI_ACTN_CANCEL_ADD_CARD:"UI_Actn_Cancel_Add_Card",UI_ACTN_CONFIRM_CARD_DETAILS:"UI_Actn_Confirm_Card_Details",UI_ACTN_ACCEPT_MONEY_CANCEL:"UI_Actn_Accept_Money_Cancel",UI_ACTN_ACCEPT_WITH_CARD:"UI_Actn_Accept_With_Card",UI_ACTN_ADD_CARD_SUCCESS:"UI_Actn_Add_Card_Success",UI_ACTN_ADD_CARD_FAIL:"UI_Actn_Add_Card_Fail",UI_ACTN_CONFIRM_SEND:"UI_Actn_Confirm_Send",UI_ACTN_SEND_SUCCESS:"UI_Actn_Send_Success",UI_ACTN_SEND_MONEY_CANCELLED:"UI_Actn_Send_Money_Cancelled",UI_ACTN_SEND_FAIL:"UI_Actn_Send_Fail",UI_ACTN_INITIATE_EDIT_CARD:"UI_Actn_Initiate_Edit_Card",UI_ACTN_CANCEL_EDIT_CARD:"UI_Actn_Cancel_Edit_Card",UI_ACTN_CONFIRM_EDIT_CARD_DETAILS:"UI_Actn_Confirm_Edit_Card_Details",UI_ACTN_EDIT_CARD_SUCCESS:"UI_Actn_Edit_Card_Success",UI_ACTN_EDIT_CARD_FAIL:"UI_Actn_Edit_Card_Fail",UI_ACTN_INITIATE_REMOVE_CARD:"UI_Actn_Initiate_Remove_Card",UI_ACTN_CONFIRM_REMOVE_CARD:"UI_Actn_Confirm_Remove_Card",UI_ACTN_REMOVE_CARD_SUCCESS:"UI_Actn_Remove_Card_Success",UI_ACTN_REMOVE_CARD_FAIL:"UI_Actn_Remove_Card_Fail",UI_ACTN_INITIATE_PASSWORD_PROTECTION_NUX:"UI_Actn_Initiate_Password_Protection_NUX",UI_ACTN_OPT_IN_PASSWORD_PROTECTION_NUX:"UI_Actn_Opt_In_Password_Protection_NUX",UI_ACTN_OPT_OUT_PASSWORD_PROTECTION_NUX:"UI_Actn_Opt_Out_Password_Protection_NUX",UI_ACTN_ENABLED_PASSWORD_PROTECTION_SETTING:"UI_Actn_Enabled_Password_Protection_Setting",UI_ACTN_DISABLED_PASSWORD_PROTECTION_SETTING:"UI_Actn_Disabled_Password_Protection_Setting",UI_ACTN_SEND_CLICKED:"UI_Actn_Send_Clicked",UI_ACTN_VERIFY_CSC:"UI_Actn_Verify_CSC",UI_ACTN_CONFIRM_AMOUNT:"UI_Actn_Confirm_Amount",UI_ACTN_EDIT_CARD:"UI_Actn_Edit_Card",UI_ACTN_CHANGE_CARD:"UI_Actn_Change_Card",UI_ACTN_INITIATE_SEND_TRIGGER:"UI_Actn_Initiate_Send_Trigger",UI_ACTN_INITIATE_GROUP_SEND:"UI_Actn_Initiate_Group_Send",UI_ACTN_GROUP_SEND_CANCELLED:"UI_Actn_Group_Send_Cancelled",UI_ACTN_INITIATE_GROUP_SEND_TRIGGER:"UI_Actn_Initiate_Group_Send_Trigger",UI_ACTN_GROUP_SEND_RECIPIENT_PICKED:"UI_Actn_Group_Send_Recipient_Picked",UI_ACTN_3RD_PARTY_RECEIPT_SHOWN:"UI_Actn_3rd_Party_Receipt_Shown",UI_ACTN_3RD_PARTY_RECEIPT_DISMISSED:"UI_Actn_3rd_Party_Receipt_Dismissed",UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CLICKED:"UI_Actn_3rd_Party_Non_Enabled_Log_Message_Clicked",UI_ACTN_3RD_PARTY_NON_ENABLED_LOG_MESSAGE_CANCELLED:"UI_Actn_3rd_Party_Non_Enabled_Log_Message_Cancelled",UI_ACTN_CHAT_THREAD_BANNER_CLICKED:"UI_Actn_Chat_Thread_Banner_Clicked",UI_ACTN_CHAT_THREAD_BANNER_VIEWED:"UI_Actn_Chat_Thread_Banner_Viewed",UI_ACTN_CHAT_THREAD_BANNER_DISMISSED:"UI_Actn_Chat_Thread_Banner_Dismissed",UI_ACTN_INITIATE_MONEYPENNY_ORDER:"UI_Actn_Initiate_Moneypenny_Order",UI_ACTN_CONFIRM_MONEYPENNY_ORDER:"UI_Actn_Confirm_Moneypenny_Order",UI_ACTN_MONEYPENNY_ORDER_FAIL:"UI_Actn_Moneypenny_Order_Fail",UI_ACTN_MONEYPENNY_ORDER_SUCCESS:"UI_Actn_Moneypenny_Order_Success",UI_ACTN_MONEYPENNY_ORDER_CANCEL:"UI_Actn_Moneypenny_Order_Cancel",UI_ACTN_FRIEND_PICKER_SEARCH:"UI_Actn_Friend_Picker_Search",UI_ACTN_FRIEND_PICKER_SELECT:"UI_Actn_Friend_Picker_Select",UI_ACTN_FRIEND_PICKER_SHOWN:"UI_Actn_Friend_Picker_Shown",UI_ACTN_FI_CANCEL:"UI_Actn_FI_Cancel",UI_ACTN_FI_SUCCESS_DIALOG_NEXT:"UI_Action_Success_Dialog_Next",UI_ACTN_FI_BANNER_DISMISSED:"UI_Actn_FI_Banner_Dismissed",UI_ACTN_FI_BANNER_IMPRESSION:"UI_Actn_FI_Banner_Impression",UI_ACTN_INCENTIVE_TRANSFER_SUCCESS:"UI_Actn_Incentive_Transfer_Success",UI_ACTN_INCENTIVE_TRANSFER_FAILURE:"UI_Actn_Incentive_Transfer_Failure",UI_ACTN_PLATFORM_BANNER_SELLER_HIDE_CLICKED:"UI_Actn_Platform_Banner_Seller_Hide_Clicked",UI_ACTN_PLATFORM_BANNER_BUYER_HIDE_CLICKED:"UI_Actn_Platform_Banner_Buyer_Hide_Clicked",UI_ACTN_PLATFORM_BANNER_SOLD_CLICKED:"UI_Actn_Platform_Banner_Sold_Clicked",UI_ACTN_PLATFORM_BANNER_IMAGE_CLICKED:"UI_Actn_Platform_Banner_Image_Clicked",UI_ACTN_PLATFORM_BANNER_TITLE_CLICKED:"UI_Actn_Platform_Banner_Title_Clicked",UI_ACTN_PLATFORM_BANNER_PAY_CLICKED:"UI_Actn_Platform_Banner_Pay_Clicked",UI_ACTN_PLATFORM_BANNER_REQUEST_CLICKED:"UI_Actn_Platform_Banner_Request_Clicked",UI_ACTN_PLATFORM_BANNER_SELLER_VIEWED:"UI_Actn_Platform_Banner_Seller_Viewed",UI_ACTN_PLATFORM_BANNER_BUYER_VIEWED:"UI_Actn_Platform_Banner_Buyer_Viewed",UI_ACTN_PLATFORM_BANNER_PAY_NUX_SHOWN:"UI_Actn_Platform_Banner_Pay_Nux_Shown",UI_ACTN_INITIATE_REQUEST:"UI_Actn_Initiate_Request",UI_ACTN_REQUEST_CLICKED:"UI_Actn_Request_Clicked",UI_ACTN_CONFIRM_REQUEST:"UI_Actn_Confirm_Request",UI_ACTN_REQUEST_SUCCESS:"UI_Actn_Request_Success",UI_ACTN_REQUEST_FAIL:"UI_Actn_Request_Fail",UI_ACTN_INITIATE_DECLINE_REQUEST:"UI_Actn_Initiate_Decline_Request",UI_ACTN_CONFIRM_DECLINE_REQUEST:"UI_Actn_Confirm_Decline_Request",UI_ACTN_DECLINE_REQUEST_FAIL:"UI_Actn_Decline_Request_Fail",UI_ACTN_DECLINE_REQUEST_SUCCESS:"UI_Actn_Decline_Request_Success",UI_ACTN_INITIATE_CANCEL_REQUEST:"UI_Actn_Initiate_Cancel_Request",UI_ACTN_CONFIRM_CANCEL_REQUEST:"UI_Actn_Confirm_Cancel_Request",UI_ACTN_CANCEL_REQUEST_FAIL:"UI_Actn_Cancel_Request_Fail",UI_ACTN_CANCEL_REQUEST_SUCCESS:"UI_Actn_Cancel_Request_Success",UI_ACTN_INITIATE_CHECKOUT:"UI_Actn_Initiate_Checkout",UI_ACTN_CHECKOUT_CONFIRM:"UI_Actn_Checkout_Confirm",UI_ACTN_INITIATE_ADD_ADDRESS:"UI_Actn_Initiate_Add_Address",UI_ACTN_CANCEL_ADD_ADDRESS:"UI_Actn_Cancel_Add_Address",UI_ACTN_INITIATE_CHOOSE_ADDRESS:"UI_Actn_Initiate_Choose_Address",UI_ACTN_CONFIRM_ADDRESS_DETAILS:"UI_Actn_Confirm_Address_Details",UI_ACTN_ADD_ADDRESS_SUCCESS:"UI_Actn_Add_Address_Success",UI_ACTN_ADD_ADDRESS_FAIL:"UI_Actn_Add_Address_Fail",UI_ACTN_CHECKOUT_FAIL:"UI_Actn_Checkout_Fail",UI_ACTN_CHECKOUT_CART_CREATION_FAIL:"UI_Actn_Checkout_Cart_Creation_Fail",UI_ACTN_CHECKOUT_CANCEL:"UI_Actn_Checkout_Cancel",UI_ACTN_CHECKOUT_SUCCESS:"UI_Actn_Checkout_Success",UI_ACTN_CHECKOUT_CART_CREATION_SUCCESS:"UI_Actn_Checkout_Cart_Creation_Success",UI_ACTN_SEND_MONEY_PAGE_VIEWED:"UI_Actn_Send_Money_Page_Viewed",UI_ACTN_ACCEPT_MONEY_NUX_SHOWN:"UI_Actn_Accept_Money_NUX_Shown",UI_ACTN_ACCEPT_MONEY_NUX_NEXT_CLICK:"UI_Actn_Accept_Money_NUX_Next_Click",UI_ACTN_SEND_MONEY_NUX_SHOWN:"UI_Actn_Send_Money_NUX_Shown",UI_ACTN_SEND_MONEY_NUX_NEXT_CLICK:"UI_Actn_Send_Money_NUX_Next_Click",UI_ACTN_GET_CREDIT_CARDS_EXCEPTION:"UI_ACTN_GET_CREDIT_CARDS_EXCEPTION",UI_ACTN_CREATE_TRANSFER_EXCEPTION:"UI_ACTN_CREATE_TRANSFER_EXCEPTION",UI_ACTN_ADD_CARD_EXCEPTION:"UI_ACTN_ADD_CARD_EXCEPTION",UI_ACTN_GET_TRANSFERS_EXCEPTION:"UI_ACTN_GET_TRANSFERS_EXCEPTION",UI_ACTN_GET_EXTENSIVE_TRANSFERS_EXCEPTION:"UI_ACTN_GET_EXTENSIVE_TRANSFERS_EXCEPTION",UI_ACTN_GET_NUX_TRANSFERS_EXCEPTION:"UI_ACTN_GET_NUX_TRANSFERS_EXCEPTION",UI_ACTN_UPDATE_PRESET_CARD_EXCEPTION:"UI_ACTN_UPDATE_PRESET_CARD_EXCEPTION",UI_ACTN_UPDATE_CARD_EXCEPTION:"UI_ACTN_UPDATE_CARD_EXCEPTION",UI_ACTN_DELETE_CARD_EXCEPTION:"UI_ACTN_DELETE_CARD_EXCEPTION",UI_ACTN_GET_PASSWORD_PROTECTION_EXCEPTION:"UI_ACTN_GET_PASSWORD_PROTECTION_EXCEPTION",UI_ACTN_SET_PASSWORD_PROTECTION_EXCEPTION:"UI_ACTN_SET_PASSWORD_PROTECTION_EXCEPTION",UI_ACTN_DECLINE_TRANSFER_EXCEPTION:"UI_ACTN_DECLINE_TRANSFER_EXCEPTION",UI_ACTN_CANCEL_TRANSFER_EXCEPTION:"UI_ACTN_CANCEL_TRANSFER_EXCEPTION",UI_ACTN_VERIFY_CARD_EXCEPTION:"UI_ACTN_VERIFY_CARD_EXCEPTION",UI_ACTN_VALIDATE_BIN_EXCEPTION:"UI_ACTN_VALIDATE_BIN_EXCEPTION",UI_ACTN_GET_ELIGIBILITY_EXCEPTION:"UI_ACTN_GET_ELIGIBILITY_EXCEPTION",UI_ACTN_GET_FRIEND_LIST_EXCEPTION:"UI_ACTN_GET_FRIEND_LIST_EXCEPTION",UI_ACTN_GET_BANNER_STATES_EXCEPTION:"UI_ACTN_GET_BANNER_STATES_EXCEPTION",UI_ACTN_INCREMENT_BANNER_VIEW_EXCEPTION:"UI_ACTN_INCREMENT_BANNER_VIEW_EXCEPTION",UI_ACTN_INCREMENT_BANNER_DISMISSAL_EXCEPTION:"UI_ACTN_INCREMENT_BANNER_DISMISSAL_EXCEPTION",UI_ACTN_CREATE_M_TRANSFER_EXCEPTION:"UI_ACTN_CREATE_M_TRANSFER_EXCEPTION",UI_ACTN_CREATE_FI_TRANSER_EXCEPTION:"UI_ACTN_CREATE_FI_TRANSER_EXCEPTION",UI_ACTN_GET_PLATFORM_CONTEXT_EXCEPTION:"UI_ACTN_GET_PLATFORM_CONTEXT_EXCEPTION",UI_ACTN_DISMISS_PLATFORM_CONTEXT_EXCEPTION:"UI_ACTN_DISMISS_PLATFORM_CONTEXT_EXCEPTION",UI_ACTN_MARK_SOLD_CONTEXT_EXCEPTION:"UI_ACTN_MARK_SOLD_CONTEXT_EXCEPTION",UI_ACTN_GET_ADDRESSES_EXCEPTION:"UI_ACTN_GET_ADDRESSES_EXCEPTION",UI_ACTN_ADD_ADDRESS_EXCEPTION:"UI_ACTN_ADD_ADDRESS_EXCEPTION",UI_ACTN_CREATE_CART_EXCEPTION:"UI_ACTN_CREATE_CART_EXCEPTION",UI_ACTN_SET_CART_ADDRESS_EXCEPTION:"UI_ACTN_SET_CART_ADDRESS_EXCEPTION",UI_ACTN_GET_PROFILE_EXCEPTION:"UI_ACTN_GET_PROFILE_EXCEPTION",UI_ACTN_CREATE_REQUEST_EXCEPTION:"UI_ACTN_CREATE_REQUEST_EXCEPTION",UI_ACTN_DECLINE_REQUEST_EXCEPTION:"UI_ACTN_DECLINE_REQUEST_EXCEPTION",UI_ACTN_CANCEL_REQUEST_EXCEPTION:"UI_ACTN_CANCEL_REQUEST_EXCEPTION",UI_ACTN_GET_PENDING_REQUESTS_EXCEPTION:"UI_ACTN_GET_PENDING_REQUESTS_EXCEPTION",UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_SHOWN:"UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_SHOWN",UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_NEXT_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_QP_DIALOG_NEXT_CLICK",UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SELLER_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SELLER_CLICK",UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SEND_CLICK:"UI_ACTN_GROUP_SELL_INTEREST_MESSAGE_SEND_CLICK",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_SHOWN",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_CANCEL_CLICK",UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK:"UI_ACTN_MESSAGE_SELLER_CONFIRM_DIALOG_PAY_CLICK",UI_ACTN_PAYMENTS_HISTORY_BLUEBAR_CLICK:"UI_ACTN_PAYMENTS_HISTORY_BLUEBAR_CLICK"};},null);
__d("P2PPaymentLoggerEventFlow",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UI_FLOW_P2P_SEND:"UI_Flow_P2P_Send",UI_FLOW_P2P_REQUEST:"UI_Flow_P2P_Request",UI_FLOW_P2P_RECEIVE:"UI_Flow_P2P_Receive",UI_FLOW_P2P_SETTINGS:"UI_Flow_P2P_Settings",UI_FLOW_P2P_GROUP_SEND:"UI_Flow_P2P_Group_Send",UI_FLOW_P2P_GROUP_REQUEST:"UI_Flow_P2P_Group_Request",UI_FLOW_MONEYPENNY_CHECKOUT:"UI_Flow_Moneypenny_Checkout",UI_FLOW_FINANCIAL_INCENTIVES:"UI_Flow_Financial_Incentives",UI_FLOW_FINANCIAL_INCENTIVES_ZERO_INDEX_JEWEL:"UI_Flow_Financial_Incentives_Zero_Index_Jewel",UI_FLOW_PLATFORM_BANNER:"UI_Flow_Platform_Banner",UI_FLOW_CHECKOUT:"UI_Flow_Checkout",UI_FLOW_SEND_MONEY_PAGE:"UI_Flow_Send_Money_Page",UI_FLOW_REQUEST_SENDER_NUX_CHAT_THREAD_BANNER:"UI_Flow_Request_Sender_NUX_Chat_Thread_Banner",UI_FLOW_SENDER_NUX_CHAT_THREAD_BANNER:"UI_Flow_Sender_NUX_Chat_Thread_Banner",UI_FLOW_GROUP_SELL_INTEREST_DIALOG:"UI_FLOW_GROUP_SELL_INTEREST_DIALOG",UI_FLOW_SEND_MONEY_BLUEBAR:"UI_FLOW_SEND_MONEY_BLUEBAR",UI_FLOW_PAYMENTS_MENU_BLUEBAR:"UI_FLOW_PAYMENTS_MENU_BLUEBAR",UI_FLOW_BOOKMARK:"UI_FLOW_BOOKMARK"};},null);
__d("StickerConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};},null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(l,m,n){this.xhr=c('getSameOriginTransport')();if(!(m instanceof c('URI')))m=new (c('URI'))(m);if(n&&l=='GET'){m.setQueryData(n);}else this._params=n;this.method=l;this.uri=m;this.xhr.open(l,m);}var i=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();h.supportsCORS=function(){return i;};h.ERROR='ar:error';h.TIMEOUT='ar:timeout';h.PROXY_ERROR='ar:proxy error';h.TRANSPORT_ERROR='ar:transport error';h.SERVER_ERROR='ar:http error';h.PARSE_ERROR='ar:parse error';h.SERVICE_UNAVAILABLE='ar:noservice';h._inflight=[];function j(){var l=h._inflight;h._inflight=[];l.forEach(function(m){m.abort();});}function k(l){l.onJSON=l.onError=l.onSuccess=null;clearTimeout(l._timer);if(l.xhr&&l.xhr.readyState<4){l.xhr.abort();l.xhr=null;}h._inflight=h._inflight.filter(function(m){return m&&m!=l&&m.xhr&&m.xhr.readyState<4;});}Object.assign(h.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(l){if(this[l])this[l](this);},_parseStatus:function(){var l;try{this.status=this.xhr.status;l=this.xhr.statusText;}catch(m){if(this.xhr.readyState>=4){this.errorType=h.TRANSPORT_ERROR;this.errorText=m.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=h.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=h.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=h.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=h.SERVER_ERROR;}else if(this.status===503){this.errorType=h.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=h.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=h.TRANSPORT_ERROR;}else{l='unrecognized status code: '+this.status;this.errorType=h.ERROR;}if(!this.errorText)this.errorText=l;},_parseResponse:function(){var l,m=this.xhr.readyState;try{l=this.xhr.responseText||'';}catch(n){if(m>=4){this.errorType=h.ERROR;this.errorText='responseText not available - '+n.message;}return;}while(this.xhr){var o=this._eol+1,p=this.streamMode?l.indexOf('\n',o):l.length;if(p<0&&m==4)p=l.length;if(p<=this._eol)break;var q=l;if(this.streamMode)q=l.substr(o,p-o).replace(/^\s*|\s*$/g,'');if(o===0&&this.prelude)if(this.prelude.test(q))q=q.replace(this.prelude,'');this._eol=p;if(q){try{this.json=JSON.parse(q);}catch(n){var r=/(<body[\S\s]+?<\/body>)/i.test(l)&&RegExp.$1,s={message:n.message,'char':o,excerpt:(o===0&&r||q).substr(512)};this.errorType=h.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(s);return;}c('ErrorUtils').applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var l=this.xhr&&this.xhr.readyState||0;if(this.status==null&&l>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(l==3&&this.streamMode||l==4)this._parseResponse();if(this.errorType||l==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');k(this);}},send:function(l){this.xhr.onreadystatechange=c('TimeSlice').guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var m=this.timeout;if(m)this._timer=c('setTimeoutAcrossTransitions')(function(){this.errorType=h.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');k(this);}.bind(this),m);h._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(l?c('PHPQuerySerializer').serialize(l):'');},abort:function(){k(this);},toString:function(){var l='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)l+=' errorType='+this.errorType+' ('+this.errorText+')';return l+']';},toJSON:function(){var l={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)l.uri=this.uri;for(var m in l)if(l[m]==null)delete l[m];return l;}});if(window.addEventListener&&c('UserAgent_DEPRECATED').firefox())window.addEventListener('keydown',function(event){if(event.keyCode===c('Keys').ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',j);f.exports=h;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','LogHistory','setTimeoutAcrossTransitions','WebStorage'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel'),i=c('WebStorage').getLocalStorage(),j=c('JSLogger').create('channel'),k='channel_sub:',l=7,m=100*1000,n=null,o;function p(){if(o){clearTimeout(o);o=null;}if(i&&n!=null)i.removeItem(k+n);n=null;}function q(r,s,t){var u=(r-1)*l;if(t){if(o)clearTimeout(o);n=o=null;}if(s==null)s=Math.floor(Math.random()*u);if(n==null)if(i){var v=[];for(var w=0;w<i.length;w++){var x=i.key(w);if(x.indexOf(k)===0){var y=parseInt(x.substr(k.length),10);v[y]=parseInt(i.getItem(x),10);}}var z=Date.now()-m;for(w=0;w<u;w++){var aa=(w+s)%u;if(!v[aa]||v[aa]<z){n=aa;break;}}if(n!=null){var ba=function(){try{i.setItem(k+n,Date.now());}catch(ca){h.warn('subdomain set failed',ca.message);}o=c('setTimeoutAcrossTransitions')(ba,m/2);};ba();}else{h.warn('no channel subdomain',v);j.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){c('Event').listen(window,'pagehide',p);}else c('Run').onUnload(p);}else n=s;return n==null?null:n%l;}f.exports={allocate:q,clear:p};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=c('ErrorUtils').applyWithGuard(l[i.method],l,i.args);}if(j===undefined)j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){c('ErrorUtils').reportError(p);return;}if(typeof o=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};f.exports=b.DocRPC=h;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel');function i(){return (1048576*Math.random()|0).toString(36);}function j(t,u){var v=t.subdomain;v=v===null?'':v+'-';var w=t.host;w=w===null||w===undefined?'edge-chat':t.host;var x=new (c('URI'))(u).setDomain(v+w+'.'+t.domain).setPort(t.port).setSecure(new (c('URI'))(window.location.href).isSecure());return x;}function k(t){var u={partition:t.partition,cb:i(),failure:t.pingFailuresOnSubdomain};if(t.sticky_token)u.sticky_token=t.sticky_token;if(t.sticky_pool)u.sticky_pool=t.sticky_pool;var v=j(t,'/p').setQueryData(u);h.log('start_p',{uri:v.toString()});var w=new (c('AjaxRequest'))('GET',v);if(c('AjaxRequest').supportsCORS())w.xhr.withCredentials=true;var x=function(y){h.log('finish_p',{xhr:y.toJSON?y.toJSON():y,subdomain:t.subdomain,fullHost:t.fullHost});};w.onError=function(y){x(y);if(t.subdomain===null)return;t.pingFailuresOnSubdomain++;t.subdomain++;if(t.subdomain>6)t.subdomain=0;};w.timeout=t.P_TIMEOUT;w.onSuccess=x;w.send();}function l(t,u,v){var w=new Image(),x=0,y=function(ba){w.abort();return ba?u():v();};w.onload=c('TimeSlice').guard(function(){h.log('ping_ok',{duration:Date.now()-x});y(true);},'ChannelTransport image.onload');w.onerror=c('TimeSlice').guard(function(){k(t);y(false);},'ChannelTransport image.onerror');var z=c('setTimeoutAcrossTransitions')(w.onerror,10000);w.abort=function(){if(z){clearTimeout(z);z=null;}w.onload=w.onerror=null;};var aa={partition:t.partition,cb:i()};if(t.sticky_token)aa.sticky_token=t.sticky_token;if(t.sticky_pool)aa.sticky_pool=t.sticky_pool;if(t.lastRequestErrorReason){aa.reason=t.lastRequestErrorReason;t.lastRequestErrorReason=null;}if(t.uid&&t.viewerUid){aa.uid=t.uid;aa.viewer_uid=t.viewerUid;}x=Date.now();w.src=j(t,'/ping').setQueryData(aa);return w;}function m(t,u){var v={channel:t.user_channel,partition:t.partition,clientid:t.sessionID,cb:i(),cap:0,uid:t.uid,viewer_uid:t.viewerUid};if(t.sticky_token)v.sticky_token=t.sticky_token;if(t.sticky_pool)v.sticky_pool=t.sticky_pool;if(t.profile)v.profile=t.profile;if(t.capabilities)v.cap=t.capabilities;v.id=u;var w=j(t,'/add_bud').setQueryData(v),x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;x.onError=function(y){h.warn('add_buddy_error');};x.onSuccess=function(y){h.log('add_buddy_ok');};x.timeout=t.P_TIMEOUT;x.send();}function n(t){var u={channel:t.user_channel,partition:t.partition,clientid:t.sessionID,cb:i(),cap:0,uid:t.uid,viewer_uid:t.viewerUid};if(t.sticky_token)u.sticky_token=t.sticky_token;if(t.sticky_pool)u.sticky_pool=t.sticky_pool;if(t.is_offline||t.shouldSuppressPresence){u.state='offline';}else u.state='active';if(u.state===t.lastPresenceState)return;t.lastPresenceState=u.state;if(t.profile)u.profile=t.profile;if(t.capabilities)u.cap=t.capabilities;var v=j(t,'/active_ping').setQueryData(u),w=new (c('AjaxRequest'))('GET',v);if(c('AjaxRequest').supportsCORS())w.xhr.withCredentials=true;w.onError=function(x){h.warn('active_ping_error');};w.onSuccess=function(x){h.log('active_ping_ok');};w.timeout=t.P_TIMEOUT;w.send();}function o(t,u,v,w){var x=new Date(),y=-1;if(t.userActive>0){y=(x-t.userActive)/1000|0;if(y<0)h.warn('idle_regression',{idleTime:y,now:x.getTime(),userActive:t.userActive});}var z={channel:t.user_channel,seq:t.seq,partition:t.partition,clientid:t.sessionID,cb:i(),idle:y,qp:'y',cap:0};if(t.state.aiq)z.aiq=t.state.aiq;if(t.ready)if(t.seqTurSentAt==-1||t.seqTurSentAt==t.seq){z.tur=t.timeUntilReady;z.qpmade=t.queueMade;t.seqTurSentAt=t.seq;}z.pws=t.pws;if(t.sequenceId>0)z.isq=t.sequenceId;z.msgs_recv=t.estimatedReceived;if(t.uid&&t.viewerUid){z.uid=t.uid;z.viewer_uid=t.viewerUid;}if(t.sticky_token){z.sticky_token=t.sticky_token;}else{z.request_batch=1;if(t.msgr_region)z.msgr_region=t.msgr_region;}if(t.sticky_pool)z.sticky_pool=t.sticky_pool;if('trace_id' in t)z.traceid=t.trace_id;if(t.is_offline||t.shouldSuppressPresence){z.state='offline';}else if(t.userActive>0&&y<60)z.state='active';t.lastPresenceState=z.state;if(t.streamingCapable){z.mode='stream';z.format='json';}if(t.profile)z.profile=t.profile;if(t.capabilities)z.cap=t.capabilities;var aa=j(t,'/pull').setQueryData(z),ba='GET',ca=new (c('AjaxRequest'))(ba,aa);if(c('AjaxRequest').supportsCORS())ca.xhr.withCredentials=true;ca.timeout=t.streamingCapable?t.STREAMING_TIMEOUT:t.LONGPOLL_TIMEOUT;ca.onJSON=u;ca.onSuccess=v;ca.onError=function(){var da=this.status==12002&&this._time>=t.MIN_12002_TIMEOUT||this.status==504&&this._time>=t.MIN_504_TIMEOUT,ea=da?v:w;return ea&&ea.apply(this,arguments);};ca.send();t.inStreaming=t.streamingCapable;return ca;}function p(t){this.manager=t;this.init&&this.init();}function q(t){p.apply(this,arguments);}Object.assign(q.prototype,{logName:'CORS',enterState:function(t,u){if(this._request){this._request.abort();this._request=null;}if(t=='init')c('setTimeoutAcrossTransitions')(c('bind')(this.manager,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),0);if(!/pull|ping/.test(t))return;var v=this.manager;if(t=='ping'){this._request=l(u,c('bind')(v,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(v,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}else if(t=='pull')this._request=o(u,c('bind')(v,'_processTransportData',u.stateId),c('bind')(v,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(v,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}});function r(t){h.log('iframe_init_constructor');p.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);c('DocRPC').publish(this,'outerTransport');}Object.assign(r.prototype,{logName:'iframe',_initIframe:function(t){h.log('iframe_init_start');window.onchanneliframeready=function(){h.log('iframe_resources');return t.resources;};window.onchanneliframeloaded=function(){h.log('iframe_loaded');};if(t){this._iframeURI=j(t,t.path);if(t.resources){var u=this._iframeURI.getDomain();t.resources=t.resources.map(function(w){var x=new (c('URI'))(w);if(x.getPath().startsWith('/intern/rsrc.php')&&x.getQueryData().origin!==undefined)return x.addQueryData('origin',u).toString();return w;});}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);h.log('iframe_uri_set');}catch(v){h.error('iframe_uri_set_error',v);this.exitState({status:c('ChannelConstants').ERROR,stateId:t.stateId},v+'');}},enterState:function(t,u){if(t=='init'){this._initIframe(u);}else if(/idle|ping|pull/.test(t)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(t!='idle')this.exitState({status:c('ChannelConstants').ERROR,stateId:u.stateId},'iframe not yet loaded');}else if(t=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(t){if(this.manager.state=='init'&&t.status==c('ChannelConstants').OK)this._iframeProxy=c('DocRPC').proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function s(){this.init=this.init.bind(this);p.apply(this,arguments);}Object.assign(s.prototype,{logName:'iframe(inner)',init:function(){c('DocRPC').publish(this,'innerTransport');try{var u=c('DocRPC').proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,u);this.exitState({status:c('ChannelConstants').OK,stateId:1e+06});}catch(t){h.error('iframe_inner_init_error',t);}},enterState:function(t,u){if(this._request){this._request.abort();this._request=null;}if(t=='ping'){this._request=l(u,c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}else if(t=='pull')this._request=o(u,c('bind')(this,'_processTransportData',u.stateId),c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}});f.exports={getURI:j,Transport:p,CORSTransport:q,IframeTransport:r,IframeInnerTransport:s,sendActivePing:n,sendAdditionalBuddyRequest:m};},null);
__d('ChatProxyConnectionState',['Map'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(){'use strict';this.auxiliaryIrisQueues=new (c('Map'))();this.aiq=null;}h.prototype.subscribeIrisQueue=function(i,j){'use strict';this.auxiliaryIrisQueues.set(i,j);this.updateCaches();};h.prototype.unsubscribeIrisQueue=function(i){'use strict';this.auxiliaryIrisQueues['delete'](i);this.updateCaches();};h.prototype.updateCaches=function(){'use strict';var i=[];this.auxiliaryIrisQueues.forEach(function(j,k,l){i.push(k);i.push(j);},this);if(i.length===0){this.aiq=null;}else this.aiq=i.join(',');};f.exports=h;},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){k=babelHelpers['extends']({},c('getAsyncParams')(i),k);var l=new (c('AjaxRequest'))(i,j,k);l.streamMode=false;var m=l._call;l._call=function(n){if(n=='onJSON'&&this.json){if(this.json.error){this.errorType=c('AjaxRequest').SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}m.apply(this,arguments);};l.ajaxReqSend=l.send;l.send=function(n){this.ajaxReqSend(babelHelpers['extends']({},n,k));};return l;}f.exports=h;},null);
__d('FBRTCSupport',['ChannelConstants','RTCConfig','UserAgent'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isSendWebrtcSupported:function(){return c('RTCConfig').SendNewVCGK;},isReceiveWebrtcSupported:function(){return c('RTCConfig').ReceiveNewVCGK;},isVideoInteropSupported:function(){return c('RTCConfig').VideoInteropGK;},isVideoCallBlockingSupported:function(){return c('RTCConfig').VideoCallBlockingGK;},isWebrtcSupported:function(){return (c('UserAgent').isBrowser('Chrome >= 28')||c('UserAgent').isBrowser('Firefox >= 25')||c('UserAgent').isBrowser('Opera >= 20'));},isOSSupported:function(){return !c('UserAgent').isPlatform('Android')&&!c('UserAgent').isPlatform('iOS');},getCapabilities:function(){var i=0;if(this.isReceiveWebrtcSupported())i=c('ChannelConstants').CAPABILITY_VOIP_INTEROP;return i;}};f.exports=h;},null);
__d('FantailLogger',['Bootloader','FantailConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={debug:function(i,j){for(var k=arguments.length,l=Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];if(c('FantailConfig').enabled)c('Bootloader').loadModules(["FantailLogQueue"],function(n){var o;(o=n.get(i)).debug.apply(o,[j].concat(l));});},info:function(i,j){for(var k=arguments.length,l=Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];if(c('FantailConfig').enabled)c('Bootloader').loadModules(["FantailLogQueue"],function(n){var o;(o=n.get(i)).info.apply(o,[j].concat(l));});},warn:function(i,j){for(var k=arguments.length,l=Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];if(c('FantailConfig').enabled)c('Bootloader').loadModules(["FantailLogQueue"],function(n){var o;(o=n.get(i)).warn.apply(o,[j].concat(l));});},error:function(i,j){for(var k=arguments.length,l=Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];if(c('FantailConfig').enabled)c('Bootloader').loadModules(["FantailLogQueue"],function(n){var o;(o=n.get(i)).error.apply(o,[j].concat(l));});}};f.exports=h;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('Dcode',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h,i={},j={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var l=[];for(var m in j){i[j[m]]=m;l.push(j[m]);}l.reverse();h=new RegExp(l.join("|"),'g');})();var k={encode:function(l){return encodeURIComponent(l).replace(/([_A-Z])|%../g,function(m,n){return n?'%'+n.charCodeAt(0).toString(16):m;}).toLowerCase().replace(h,function(m){return i[m];});},decode:function(l){return decodeURIComponent(l.replace(/[_A-Z]/g,function(m){return j[m];}));}};f.exports=k;},null);
__d('PresenceCookieManager',['Cookie','CurrentUser','Dcode','ErrorUtils','JSLogger','PresenceInitialData','PresenceUtil','URI'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('PresenceInitialData').cookieVersion,i='presence',j={},k=null,l=null,m=c('JSLogger').create('presence_cookie');function n(){try{var r=c('Cookie').get(i);if(k!==r){k=r;l=null;if(r&&r.charAt(0)=='E')r=c('Dcode').decode(r.substring(1));if(r)l=JSON.parse(r);}if(l){if(l.user&&l.user!==c('CurrentUser').getID())return null;if(l.v!==h)return null;return l;}}catch(q){m.warn('getcookie_error',q);}return null;}function o(){return parseInt(Date.now()/1000,10);}var p={register:function(q,r){j[q]=r;},store:function(){var q=n();if(q&&q.v&&h<q.v){m.debug('stale_cookie',h);return;}var r={v:h,time:o(),user:c('CurrentUser').getID()};for(var s in j)r[s]=c('ErrorUtils').applyWithGuard(j[s],j,[q&&q[s]],function(w){w.presence_subcookie=s;});var t='E'+c('Dcode').encode(JSON.stringify(r));if(c('PresenceUtil').hasUserCookie()){var u=t.length;if(u>1024)m.warn('big_cookie',u);var v=c('URI').getRequestURI(false).isSecure()&&!!c('Cookie').get('csm');c('Cookie').set(i,t,null,null,v);}},clear:function(){c('Cookie').clear(i);},getSubCookie:function(q){var r=n();if(!r)return null;return r[q];}};f.exports=p;},null);
__d('PresenceState',['Arbiter','ErrorUtils','JSLogger','PresenceCookieManager','debounceAcrossTransitions','setIntervalAcrossTransitions','PresenceInitialData'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('PresenceInitialData').cookiePollInterval||2000,i=c('PresenceInitialData').shouldSuppress||false,j=[],k=[],l=null,m=null,n=0,o=null,p=0,q=['sb2','t2','lm2','uct2','tr','tw','at','wml'],r=c('JSLogger').create('presence_state');function s(){return c('PresenceCookieManager').getSubCookie('state');}function t(){n=Date.now();c('PresenceCookieManager').store();x(m);}var u=c('debounceAcrossTransitions')(t,0);function v(ca){if(typeof ca=='undefined'||isNaN(ca)||ca==Number.POSITIVE_INFINITY||ca==Number.NEGATIVE_INFINITY)ca=0;return ca;}function w(ca){var da={};if(ca){q.forEach(function(ga){da[ga]=ca[ga];});if(n<ca.ut)r.error('new_cookie',{cookie_time:ca.ut,local_time:n});}da.ut=n;for(var ea=0,fa=j.length;ea<fa;ea++)c('ErrorUtils').applyWithGuard(j[ea],null,[da]);m=da;return m;}function x(ca){p++;n=v(ca.ut);if(!l)l=c('setIntervalAcrossTransitions')(aa,h);m=ca;if(o===null)o=ca;for(var da=0,ea=k.length;da<ea;da++)c('ErrorUtils').applyWithGuard(k[da],null,[ca]);p--;}function y(ca){if(ca&&ca.ut)if(n<ca.ut){return true;}else if(ca.ut<n)r.error('old_cookie',{cookie_time:ca.ut,local_time:n});return false;}function z(){var ca=s();if(y(ca))m=ca;return m;}function aa(){var ca=s();if(y(ca))x(ca);}c('PresenceCookieManager').register('state',w);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ca,da){da.presence_state={initial:babelHelpers['extends']({},o),state:babelHelpers['extends']({},m),update_time:n,sync_paused:p,poll_time:h};});(function(){var ca=z();if(ca){x(ca);}else{r.debug('no_cookie_initial');x(w());return;}})();var ba={doSync:function(ca){if(p)return;if(ca){t();}else u();},registerStateStorer:function(ca){j.push(ca);},registerStateLoader:function(ca){k.push(ca);},get:function(){return z();},getInitial:function(){return o;},shouldSuppress:function(){return i;},verifyNumber:v};f.exports=ba;},null);
__d('RTISession',['invariant','URI','AjaxRequest','ErrorUtils'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='.facebook.com';function j(k,l,m,n,o,p,q,r,s){!k?h(0):undefined;!n?h(0):undefined;!o?h(0):undefined;this.domain=k;this.port=l;this.edgePoolName=m;this.stickyToken=n;this.loggedInId=o;this.accountId=p;this.clientProfile=q||'desktop';this.clientId=r;this.capabilities=s;}j.prototype.issueRequest=function(k,l,m,n,o){!k?h(0):undefined;!l?h(0):undefined;!n?h(0):undefined;var p=this.domain.length-i.length,q=p>0&&this.domain.indexOf(i,p)!==-1,r=q?this.domain:this.domain+i,s=(1048576*Math.random()|0).toString(36),t={cb:s,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var u in t)!!l[u]?h(0):undefined;Object.assign(t,l);var v=new (c('URI'))(k).setDomain(r).setPort(this.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(t),w=m?'POST':'GET',x=new (c('AjaxRequest'))(w,v);x.timeout=o?o*1000:30000;if(x.xhr)x.xhr.withCredentials=true;var y={};x.onSuccess=function(){};x.onJSON=function(){y.data=x.json;y.error=null;c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.onError=function(){y.data=null;y.error=x.errorType||'error';c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.send(JSON.stringify(m));};f.exports=j;},null);
__d('ChannelManager',['errorCode','AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatConfig','ChatVisibility','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','Run','SystemEvents','URI','UserActivity','ChatProxyConnectionState','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j=c('JSLogger').create('channel'),k=c('LogHistory').getInstance('channel_manager'),l=null;function m(z){l=z;}var n={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},o={state:new (c('ChatProxyConnectionState'))(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:c('ChannelClientID').getID(),capabilities:c('FBRTCSupport').getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:c('PresenceState').shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},p=1,q={},r=0;function s(){return c('AsyncRequest').lastSuccessTime?Math.round((Date.now()-c('AsyncRequest').lastSuccessTime)/1000):-1;}function t(){var z={};if(i.getConfig('host'))z[i.getConfig('user_channel')]=i.getConfig('seq',0);return z;}function u(){var z=Date.now(),aa=Date.now(),ba={total:0},ca='idle',da=false;c('SystemEvents').subscribe([c('SystemEvents').USER,c('SystemEvents').ONLINE,c('SystemEvents').TIME_TRAVEL],function(ga,ha){w(true);aa=null;i.lastPullTime=Date.now();var ia;switch(ga){case c('SystemEvents').USER:ia=c('SystemEvents').isPageOwner()?c('ChannelConstants').SYS_OWNER:c('ChannelConstants').SYS_NONOWNER;break;case c('SystemEvents').ONLINE:ia=ha?c('ChannelConstants').SYS_ONLINE:c('ChannelConstants').SYS_OFFLINE;break;case c('SystemEvents').TIME_TRAVEL:if(0<ha&&ha<180000&&o.reduceTimeTravel){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'skipping time travel failure. %d',ha);return;}ia=c('ChannelConstants').SYS_TIMETRAVEL;break;}i.exitState({status:ia,stateId:p});});var ea=function(ga,ha){var ia=Date.now(),ja=null;if(ha){z=ia;ja=ha.nextState||ha.state;}else ja=ca;c('SystemEvents').checkTimeTravel();if(aa){var ka=Math.round((ia-aa)/1000);if(ka>0){ba[ca]=(ba[ca]||0)+ka;ba.total+=ka;}}ca=ja;aa=ia;if(!ga){ba.lastSuccessTime=s();ba.online=c('SystemEvents').isOnline();k.log('rollup',JSON.stringify(ba));}};c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,ea);c('setIntervalAcrossTransitions')(ea,60000);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ga,ha){ha.channelRollup=ba;});var fa=function(){if(i.isShutdown()||i.shouldIdle())return;c('SystemEvents').checkTimeTravel();var ga=Date.now()-(i.lastPullTime||c('Env').start);if(!da&&ga>o.STALL_THRESHOLD){var ha=s();k.error('stall',JSON.stringify({lastSuccessTime:ha,rollupState:ca}));da=true;}var ia=Date.now()-z;if(i.state=='pull'&&ia>o.JUMPSTART_THRESHOLD){z=null;k.warn('jumpstart',JSON.stringify({state:i.state,dormant:ia}));i.enterState('init');}};c('setIntervalAcrossTransitions')(fa,10000);}function v(){var z=Date.now(),aa=1;function ba(){c('setTimeoutAcrossTransitions')(ba,aa*1000);var ga=i.state;if(ga=='idle'&&i.shouldIdle())return;j.bump('conn_t',aa);if(ga=='pull')j.bump('conn_t_pull',aa);}ba();var ca=[15,30,60,120,240],da=false,ea=false;function fa(ga){c('setTimeoutAcrossTransitions')(function(){j.rate('pullenter_'+ga,da);j.rate('pullexit_'+ga,ea);},ga*1000);}while(ca.length)fa(ca.shift());c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,function(ga,ha){if(ha.state=='pull')da=true;z=Date.now();});c('Arbiter').subscribe(c('ChannelConstants').ON_EXIT_STATE,function(ga,ha){if(ha.state!='pull'||!z)return;var ia='other';if(ha.status==c('ChannelConstants').OK){ea=true;ia='ok';}else if(ha.xhr&&ha.xhr.errorType){ia=/ar:(\w+)/.test(ha.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(ha.status))return;var ja=(Date.now()-z)/1000;if(ja<0){return;}else if(ja>3600)ja=3600;j.bump('conn_num');j.bump('conn_exit',ja);j.bump('conn_num_'+ia);j.bump('conn_exit_'+ia,ja);});}function w(z){if(z){r=0;q={};}else r++;}function x(){var z=!c('AjaxRequest').supportsCORS()||o.forceIframe;if(o.subdomain===null||z){o.fullHost=o.host;}else o.fullHost=o.subdomain+'-'+o.host;}i={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:m,backoff:false,sessionRegistered:false,init:function(z,aa){this.init=function(){};c('Arbiter').subscribe(c('ChannelConstants').GET_RTI_SESSION_REQUEST,function(event,ea){this.informCurrentSession();}.bind(this));c('requestAnimationFrameAcrossTransitions')(function(){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'client initialized');c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'using session id: %s at seq: %d with sticky: %s/%s',o.sessionID,o.sequenceId,o.sticky_token,o.sticky_pool);c('UserActivity').subscribe(function(){o.userActive=Date.now();c('ChannelTransport').sendActivePing(o);});});c('PresenceCookieManager').register('ch',t);var ba=this.getConfig('max_conn',2);o.subdomain=c('ChannelSubdomain').allocate(ba);this._transportRate=new (c('MovingStat'))(30000);var ca=c('AjaxRequest').supportsCORS()&&!o.forceIframe?'CORSTransport':'IframeTransport';this.transport=new (c('ChannelTransport')[ca])(this);if(z)this.enterState(z,aa);c('requestAnimationFrameAcrossTransitions')(function(){c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(event,ea){ea.transportRate=this._transportRate.tally();ea.transportType=ca;ea.transportVersion=2;}.bind(this));u();v();}.bind(this));if(i.getConfig('tryStreaming')&&i.getConfig('host')&&c('AjaxRequest').supportsCORS()&&!o.forceIframe){var da=o.MIN_INIT_PROBE_DELAY+Math.random()*o.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c('setTimeoutAcrossTransitions')(this._probeTest,da);}},configure:function(){for(var z=arguments.length,aa=Array(z),ba=0;ba<z;ba++)aa[ba]=arguments[ba];k.log('configure',JSON.stringify(aa));aa.forEach(function(ca){return Object.assign(o,ca);});x();c('Arbiter').inform(c('ChannelConstants').ON_CONFIG,this);},getConfig:function(z,aa){return z in o?o[z]:aa;},getCompleteConfig:function(){return o;},subscribeIrisQueue:function(z,aa){o.state.subscribeIrisQueue(z,aa);this.exitState({status:c('ChannelConstants').OK,stateId:p});},unsubscribeIrisQueue:function(z){o.state.unsubscribeIrisQueue(z);},informCurrentSession:function(){var z=null;if(this.sessionRegistered&&o&&o.fullHost&&o.sticky_token&&o.uid)z=new (c('RTISession'))(o.fullHost,o.port,o.sticky_pool,o.sticky_token,o.uid,o.viewerUid,o.profile,o.sessionID,o.capabilities);c('Arbiter').inform(c('ChannelConstants').RTI_SESSION,z);},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(c('SystemEvents').isPageOwner()&&c('SystemEvents').isOnline());},_sendIframeError:function(z){var aa=new (c('AsyncRequest'))().setURI('/ajax/presence/reconnect.php').setData({reason:z,fb_dtsg:c('DTSG').getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);aa.specifiesWriteRequiredParams()&&aa.send();},_getDelay:function(){var z=Math.min(o.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,r-1)),o.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in o)z=o.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(z*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)k.warn('enterstate_recursion','{}');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(z){this._inEnterState=false;throw z;}},_enterState:function(z){var aa=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',z);return;}if(z!='idle!'&&this.shouldIdle()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'forced idleness');return;}p++;o.stateId=p;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(z)){var ba=this._transportRate.tally().timeAverage,ca=i.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(ba>=ca){if(!this._throttled){this._throttled=true;k.warn('throttled','{}');}j.bump('throttle');aa=1000/ca;}}else if(!(/#$/.test(z)))aa=this._getDelay();z=z.replace(/\W*$/,'');if(!n[z]){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'invalid state: %s',z);throw new Error('invalid state:'+z);}var da=Array.from(arguments),ea;if(aa<=0){ea={state:z};this._transportRate.add(1);this.state=z;var fa=this['_enter_'+this.state];if(fa){da.shift();fa.apply(this,da);}if(/init|idle|pull|ping/.test(this.state)){if(o.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];o.is_offline=!c('ChatVisibility').isOnline();o.capabilities=c('FBRTCSupport').getCapabilities();c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entering transport state: %s',this.state);this.transport.enterState(this.state,o);if(this.state=='ping'){ea.url=c('ChannelTransport').getURI(o).toString();ea.port=o.port||'undefined';}}}else{this.state='idle';this.nextState=z;ea={state:this.state,delay:aa,nextState:z};da[0]=z+'#';this._deferredTransition=c('setTimeoutAcrossTransitions')(function(){this._deferredTransition=null;this.enterState.apply(this,da);}.bind(this),aa);}if(/pull/.test(z)){ea.client_id=o.sessionID;ea.streaming=o.inStreaming;}c('Arbiter').inform(c('ChannelConstants').ON_ENTER_STATE,ea);},exitState:function(z,aa){var ba=z.stateId,ca=z.status;if(this.isShutdown()||ba<p)return;var da=this.state,ea=Array.from(arguments);ea[0]=z.status;var fa={state:da,status:ca};if(/pull/.test(da)){fa.client_id=o.sessionID;fa.streaming=o.inStreaming;}if(/ping/.test(da)&&ca!=c('ChannelConstants').OK)fa.url=c('ChannelTransport').getURI(o).toString();if(this.nextState)fa.nextState=this.nextState;if(aa&&aa.errorType){o.lastRequestErrorReason=aa.errorType;fa.xhr=aa.toJSON?aa.toJSON():aa;if(aa.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete fa.xhr.json;}else if(ca!=c('ChannelConstants').OK)o.lastRequestErrorReason=ca;if(aa&&aa.json){if(aa.json.t)fa.t=aa.json.t;if(aa.json.reason)fa.reason=aa.json.reason;if(aa.json.seq)fa.seq=aa.json.seq;}c('Arbiter').inform(c('ChannelConstants').ON_EXIT_STATE,fa);var ga=this['_exit_'+da];if(ga)ca=ga.apply(this,ea)||ca;if(ca!=c('ChannelConstants').OK){w();q[da]=(q[da]||0)+1;}var ha=n[this.nextState||da][ca]||n._all[ca],ia=ha&&ha.replace(/!*$/,'');if(!ia){k.error('terminal_transition',JSON.stringify(fa));this._shutdownHint=c('ChannelConstants').HINT_INVALID_STATE;ha='shutdown!';c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'entering shutdown state');}this._lastState=da;this._lastStatus=ca;this.enterState(ha);},_processTransportData:function(z,aa){this._processTransportData0(z,aa,aa.json);},_processTransportData0:function(z,aa,ba){var ca=ba.t;if('s' in ba){ba.seq=ba.s;delete ba.s;}if(ba.u&&o.user&&ba.u!=o.user){k.warn('misguided_msg',JSON.stringify({user:o.user,target:ba.u}));this._reportProxyMisguidedMsg(ba.u,o.user);return;}var da=o.seq;if('seq' in ba){o.seq=ba.seq;c('PresenceState').doSync();}switch(ca){case 'continue':if(o.inStreaming&&this.heartbeats.length<1){o.streamingCapable=false;k.log('switch_to_longpoll','{}');c('setTimeoutAcrossTransitions')(this._probeTest,o.PROBE_DELAY);}w(true);if(!o.inStreaming||o.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:c('ChannelConstants').OK,stateId:z});break;case 'refresh':case 'refreshDelay':c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got refresh with reason: %s',ba.reason);this.exitState({status:'refresh_'+(ba.reason||0),stateId:z},aa);break;case 'backoff':c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'server told client to back off');w();this.backoff=true;break;case 'lb':var ea=ba.lb_info;if(ea){o.sticky_token=ea.sticky;if('pool' in ea)o.sticky_pool=ea.pool;if('sd' in ea)o.subdomain=ea.subdomain;if('vip' in ea)o.host=ea.vip;x();}else k.error('missing_lb_info','{}');break;case 'test_streaming':c('setTimeoutAcrossTransitions')(this._probeTest,500);break;case 'fullReload':c('PresenceCookieManager').clear();k.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();c('Arbiter').inform(c('ChannelConstants').ON_INVALID_HISTORY);w(true);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'full reload incurred');var fa=c('ChannelConstants').OK;this.exitState({status:fa,stateId:z},aa);if('ms' in ba)this._processMessages(ba,da);break;case 'msg':w(true);this._processMessages(ba,da);break;case 'heartbeat':if(o.inStreaming){var ga=Date.now();if(this.heartbeats.length>0)var ha=ga-this.heartbeats[this.heartbeats.length-1];k.log('heartbeat_interval',JSON.stringify({client_id:o.sessionID,interval:ha}));this.heartbeats.push(ga);}break;case 'batched':var ia=ba.batches,ja;for(ja=0;ja<ia.length;ja++)this._processTransportData0(z,aa,ia[ja]);break;default:c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got an unknown protocol message: %s',ca);k.error('unknown_msg_type',JSON.stringify({type:ca}));break;}},_processMessages:function(z,aa){var ba,ca,da,ea;if('tr' in z)o.trace_id=z.tr;ca=z.ms;da=o.seq-ca.length;for(ba=0;ba<ca.length;ba++,da++){o.estimatedReceived++;if(da>=aa){ea=ca[ba];if(ea.type){var fa=c('ChannelConstants').getArbiterType(ea.type);if(ea.type==='messaging'){var ga={type:'messaging',event:ea.event};if(ea.message){ga.inbox_unread=ea.unread_counts&&ea.unread_counts.inbox;ga.tid=ea.message.tid;ga.mid=ea.message.mid;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got message with id: %s',ea.message.mid);}}else if(ea.type==='pages_messaging'){if(ea.unread_counts&&ea.unread_counts.inbox)c('Arbiter').inform(c('ChannelConstants').getArbiterType('pages_inbox_count_update'),{page_id:ea[c('MessagingRealtimeConstants').VIEWER_FBID],inbox_unread:ea.unread_counts.inbox});}else if(ea.type==='skywalker'){fa=c('ChannelConstants').SKYWALKER;}else if(ea.type==='qprimer'){ea.first=!o.ready;if(ea.first){o.ready=true;o.timeUntilReady=Date.now()-o.created;o.queueMade=ea.made;}fa=c('ChannelConstants').CHANNEL_ESTABLISHED;}else if(ea.type==='pws'){o.pws=ea.pws;}else if(ea.type==='delta')o.sequenceId=ea.iseq;c('Arbiter').inform(fa,{obj:ea});}}else k.warn('seq_regression',JSON.stringify({last_seq:aa,messages:ca.length,seq:da}));}},_enter_init:function(){if(q.init>=i.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:c('ChannelConstants').ERROR_MAX,stateId:p}),0);this._initTimer=c('setTimeoutAcrossTransitions')(this.exitState.bind(this,{status:c('ChannelConstants').ERROR,stateId:p},'timeout'),o.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(z){k.warn('enter_reconnect',z);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entered reconnect with reason: %s',z);var aa=p;if(!c('PresenceUtil').hasUserCookie()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'user has no cookie???');k.warn('no_user_cookie','{}');setTimeout(function(){i._shutdownHint=c('ChannelConstants').HINT_AUTH;i.exitState({status:c('ChannelConstants').ERROR_SHUTDOWN,stateId:aa});},0);return;}var ba={reason:z,fb_dtsg:c('DTSG').getToken()};if(c('ISB').token)ba.fb_isb=c('ISB').token;if(l)l(ba);var ca=new (c('FBAjaxRequest'))('GET','/ajax/presence/reconnect.php',ba);ca.onSuccess=function(){i.configure(ca.json);c('PresenceCookieManager').store();this.exitState({status:c('ChannelConstants').OK,stateId:aa});}.bind(this);ca.onError=function(){var da=ca.json&&ca.json.error;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'reconnect error: %s',ca.errorType);if(ca.errorType==c('AjaxRequest').TRANSPORT_ERROR||ca.errorType==c('AjaxRequest').PROXY_ERROR||ca.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE)this._shutdownHint=c('ChannelConstants').HINT_CONN;if(da&&da==1356007){this._shutdownHint=c('ChannelConstants').HINT_MAINT;}else if(da==1357001||da==1357004||da==1348009){this._shutdownHint=c('ChannelConstants').HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?c('ChannelConstants').ERROR_SHUTDOWN:c('ChannelConstants').ERROR,stateId:aa},ca);}.bind(this);ca.send();},_enter_shutdown:function(){c('Arbiter').inform(c('ChannelConstants').ON_SHUTDOWN,{reason:this._shutdownHint});if('shutdown_recovery_interval_seconds' in o&&o.shutdown_recovery_interval_seconds>0){var z=o.shutdown_recovery_interval_seconds*1000;c('setTimeoutAcrossTransitions')(function(){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}.bind(this),z);}},_exit_init:function(z){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(z==c('ChannelConstants').ERROR_MAX)this._sendIframeError(c('ChannelConstants').reason_IFrameLoadGiveUp);},_exit_pull:function(z,aa){var ba=z==c('ChannelConstants').OK;if(ba){this.lastPullTime=Date.now();}else{var ca='exit status: '+z;if(aa&&aa.errorType)ca+=' ajax request error: '+aa.errorType;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'pull failed with status: %s',ca);}},_exit_ping:function(z){if(z==c('ChannelConstants').OK){var aa=Date.now()-(this.lastPullTime||c('Env').start);if(aa>o.STALL_THRESHOLD){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'didnt complete a successful pull for too long');return c('ChannelConstants').ERROR_STALE;}}else c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'ping failed with status: %s',z);},_reportProxyMisguidedMsg:function(z,aa){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'misguided message to %d meant for %d',aa,z);var ba=Date.now();if(ba-this.lastReportOnMisguidedMsgTime<=o.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=ba;var ca={received_uid:z,expected_uid:aa};if(o.sticky_token)ca.sticky_token=o.sticky_token;var da=new (c('URI'))('/err_misguided_msg').setDomain(o.host+'.'+o.domain).setPort(o.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ca),ea=new (c('AjaxRequest'))('GET',da);if(c('AjaxRequest').supportsCORS())ea.xhr.withCredentials=true;ea.onSuccess=function(fa){};ea.onError=function(fa){};ea.onJSON=function(fa,ga){};ea.send();},_probeTest:function(){o.streamingCapable=false;var z=[],aa={mode:'stream',format:'json'};if(o.sticky_token)aa.sticky_token=o.sticky_token;var ba=new (c('URI'))('/probe').setDomain(o.host+'.'+o.domain).setPort(o.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(aa),ca=new (c('AjaxRequest'))('GET',ba);ca.onJSON=function(da,ea){if(da&&da.json&&da.json.t==='heartbeat'){z.push(Date.now());if(z.length>=2){var fa=z[1]-z[0];if(fa>=o.PROBE_HEARTBEATS_INTERVAL_LOW&&fa<=o.PROBE_HEARTBEATS_INTERVAL_HIGH){o.streamingCapable=true;k.log('switch_to_streaming','{}');}}}};ca.onSuccess=function(da){if(z.length!=2){o.streamingCapable=false;k.error('probe_error',JSON.stringify({error:'beats.length = '+z.length}));}k.log('probe_success','{}');};ca.onError=function(da){o.streamingCapable=false;k.error('probe_error',JSON.stringify(da));};ca.send();}};f.exports=i;function y(){if(c('ChannelInitialData').channelConfig){i.configure(c('ChannelInitialData').channelConfig);if(/shutdown/.test(c('ChannelInitialData').state))i._shutdownHint=c('ChannelConstants')[c('ChannelInitialData').reason];i.init(c('ChannelInitialData').state,c('ChannelInitialData').reason);}}if(c('ChatConfig').get('early_channel',false)){y();}else c('Run').onAfterLoad(y);},6);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('channel_connection'),i=null,j=null,k=null,l=null,m=0,n=Object.assign(new (c('Arbiter'))(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});c('Run').onBeforeUnload(function(){});function o(){if(j){clearTimeout(j);j=null;}}function p(){o();h.log('unmute_warning');n.inform(n.UNMUTE_WARNING);}function q(v){o();j=c('setTimeoutAcrossTransitions')(p,v);h.log('mute_warning',{time:v});n.inform(n.MUTE_WARNING);}function r(){if(k){clearTimeout(k);k=null;}}function s(v,w){r();if(v===c('ChannelConstants').ON_ENTER_STATE&&(w.nextState||w.state)==='pull'){if(l!==n.CONNECTED){h.log('connected');var x=!l;l=n.CONNECTED;m=0;n.inform(n.CONNECTED,{init:x});}}else if(v===c('ChannelConstants').ON_ENTER_STATE&&((w.nextState||w.state)==='ping'||!w.nextState&&w.state==='idle')){k=c('setTimeoutAcrossTransitions')(function(){var y=null;if(!(w.state==='idle'&&!w.nextState))y=w.delay||0;h.log('reconnecting',{delay:y});if(n.disconnected())h.log('reconnecting_ui',{delay:y});l=n.RECONNECTING;w.state==='idle'&&m++;if(m>1){n.inform(n.RECONNECTING,y);}else if(!w.nextState&&w.state==='idle')s(v,w);},500);}else if(v===c('ChannelConstants').ON_SHUTDOWN){h.log('shutdown',{reason:w.reason});l=n.SHUTDOWN;m=0;n.inform(n.SHUTDOWN,w.reason);}}function t(){if(c('ChannelManager').isShutdown()){s(c('ChannelConstants').ON_SHUTDOWN,c('ChannelManager')._shutdownHint);}else s(c('ChannelConstants').ON_ENTER_STATE,{state:c('ChannelManager').state,nextState:c('ChannelManager').nextState,delay:0});}c('Run').onAfterLoad(t);Object.assign(n,{disconnected:function(){return l===n.SHUTDOWN||l===n.RECONNECTING&&!j&&m>1;},isShutdown:function(){return l===n.SHUTDOWN;},reconnect:function(v){if(c('ChannelManager').state==='ping'||c('ChannelManager').isShutdown())return;h.log('reconnect',{now:v});n.inform(n.RECONNECTING,0);if(!!v){if(i!==null){clearTimeout(i);i=null;}c('ChannelManager').enterState('ping!');}else if(!i)i=c('setTimeoutAcrossTransitions')(function(){c('ChannelManager').enterState('ping!');i=null;},c('ChannelConstants').CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:p});function u(){c('Arbiter').subscribe([c('ChannelConstants').ON_ENTER_STATE,c('ChannelConstants').ON_SHUTDOWN],s);c('Arbiter').subscribe(c('ChannelConstants').ATTEMPT_RECONNECT,function(){if(n.disconnected())n.reconnect();});c('SystemEvents').subscribe(c('SystemEvents').TIME_TRAVEL,function(){n.reconnect();q(c('ChannelConstants').MUTE_WARNING_TIME_MSEC);});c('Run').onBeforeUnload(r,false);}c('Run').onAfterLoad(u);n.mockAfterLoad=function(){t();u();};f.exports=n;},6);
__d('GroupChatMessageBlockAlert',['fbt','DialogX','GenderConst','MercuryParticipants','React','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogTitle.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={show:function(j,k,l){var m=new (c('DialogX'))({width:445},c('React').createElement('div',null,c('React').createElement(c('XUIDialogTitle.react'),null,h._("See Conversations?")),c('React').createElement(c('XUIDialogBody.react'),null,this.dialogBodyText(j)),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:this.leaveGroupButton(),onClick:function(){return l();}}),c('React').createElement(c('XUIDialogButton.react'),{use:'confirm',action:'cancel',label:this.openChatButton(),onClick:function(){return k();}}))));m.show();},openChatButton:function(){return h._("See Conversation");},leaveGroupButton:function(){return h._("Leave Group");},dialogBodyText:function(j){if(j.length!==1){return h._("People you've blocked are in this conversation. If you see this conversation, you'll get each other's messages to the group.");}else{var k='';c('MercuryParticipants').get(j.pop(),function(l){switch(l.gender){case c('GenderConst').FEMALE_SINGULAR:k=h._("{name} is in this group conversation but you've blocked her. If you see this conversation, you'll see her messages to the group and she'll see yours.",[h.param('name',l.short_name)]);break;case c('GenderConst').MALE_SINGULAR:k=h._("{name} is in this group conversation but you've blocked him. If you see this conversation, you'll see his messages to the group and he'll see yours.",[h.param('name',l.short_name)]);break;default:k=h._("{name} is in this group conversation but you've blocked them. If you see this conversation, you'll see their messages to the group and they'll see yours.",[h.param('name',l.short_name)]);}});return k;}}};f.exports=i;},null);
__d('TypingDetector',['ArbiterMixin','Event','Input','Run','SubscriptionsHandler','TypingStates','createObjectFrom','emptyFunction'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){this._input=i;this._ignoreKeys={};this._getValueFn=j;}Object.assign(h.prototype,c('ArbiterMixin'),{_timeout:7000,_currentState:c('TypingStates').INACTIVE,init:function(){this.init=c('emptyFunction');this.reset();this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Event').listen(this._input,'keyup',this._update.bind(this)),c('Run').onUnload(this._onunload.bind(this)));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=c('TypingStates').INACTIVE;},setIgnoreKeys:function(i){this._ignoreKeys=c('createObjectFrom')(i);},destroy:function(){this._subscriptions.release();},_onunload:function(){if(this._currentState==c('TypingStates').TYPING)this._transition(c('TypingStates').QUITTING);},_update:function(event){var i=c('Event').getKeyCode(event),j=this._currentState;if(!this._ignoreKeys[i]){var k=this._getValueFn?this._getValueFn():c('Input').getValue(this._input);if(k.trim().length===0){if(j==c('TypingStates').TYPING)this._transition(c('TypingStates').INACTIVE);}else if(j==c('TypingStates').TYPING){this._recordKeystroke();}else if(j==c('TypingStates').INACTIVE){this._transition(c('TypingStates').TYPING);this._recordKeystroke();}}},_transition:function(i){this.reset();this._currentState=i;this.inform('change',i);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var i=this._lastKeystrokeTime+this._timeout,j=Date.now();if(j>i){this._transition(c('TypingStates').INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),i-j+10);}}});f.exports=h;},null);
__d('TypingDetectorController',['AsyncRequest','AvailableList','AvailableListConstants','ChannelConnection','ChatVisibility','Keys','MercuryServerRequestsConfig','TypingDetector','TypingStates','emptyFunction','setTimeoutAcrossTransitions','shield'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m,n){'use strict';this.userID=i;this.input=j;this.source=k;this.threadID=m;this.remoteState=c('TypingStates').INACTIVE;this.notifyTimer=null;l=l||{};this.notifyDelay=l.notifyDelay||this.notifyDelay;this._typingDetector=new (c('TypingDetector'))(j,n);this._typingDetector.init(l);this._typingDetector.subscribe('change',this._stateChange.bind(this));}h.prototype.setUserAndThread=function(i,j){'use strict';if(this.userID!==i||this.threadID!==j){this.resetState();this.userID=i;this.threadID=j;}};h.prototype.setIgnoreEnter=function(i){'use strict';var j=i?[c('Keys').RETURN]:[];this._typingDetector.setIgnoreKeys(j);};h.prototype.resetState=function(){'use strict';this._notifyState(c('TypingStates').INACTIVE);this.remoteState=c('TypingStates').INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};h.prototype.destroy=function(){'use strict';this.resetState();this._typingDetector.destroy();};h.prototype._stateChange=function(i,j){'use strict';if(j!=c('TypingStates').QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=c('setTimeoutAcrossTransitions')(c('shield')(this._notifyState,this,j),this.notifyDelay);}else this._notifyState(j,true);};h.prototype._notifyState=function(i,j){'use strict';if(!this.userID&&!this.threadID||!c('ChatVisibility').isOnline()||i===this.remoteState||c('ChannelConnection').disconnected())return;this._sendRequest(i,this.userID,j);};h.prototype._sendRequest=function(i,j,k){'use strict';this.remoteState=i;var l={typ:i,to:j,source:this.source,thread:this.threadID},m=new (c('AsyncRequest'))().setHandler(this._onTypResponse.bind(this,j)).setErrorHandler(c('emptyFunction')).setData(l).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous_DEPRECATED',!k);if(c('MercuryServerRequestsConfig').msgrRegion)m.setRequestHeader('X-MSGR-Region',c('MercuryServerRequestsConfig').msgrRegion);m.send();};h.prototype._onTypResponse=function(i,j){'use strict';var k=j.getPayload()||{};if(k.offline)c('AvailableList').set(i,c('AvailableListConstants').OFFLINE,'typing_response');};Object.assign(h.prototype,{notifyDelay:1000});f.exports=h;},null);
__d('ChatTabActions',['ChatDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),i={Types:h,closeTab:function(j,k){c('ChatDispatcher').dispatch({actionType:h.CLOSE_TAB,reason:k,threadID:j});},closeAllTabs:function(){c('ChatDispatcher').dispatch({actionType:h.CLOSE_ALL_TABS});},closeFragileTabs:function(){c('ChatDispatcher').dispatch({actionType:h.CLOSE_FRAGILE_TABS});},lowerTab:function(j){c('ChatDispatcher').dispatch({actionType:h.LOWER_TAB,threadID:j});},openFragileTab:function(j){c('ChatDispatcher').dispatch({actionType:h.OPEN_FRAGILE_TAB,threadID:j});},openTab:function(j){c('ChatDispatcher').dispatch({actionType:h.OPEN_TAB,threadID:j});},persistLocalState:function(){c('ChatDispatcher').dispatch({actionType:h.PERSIST_LOCAL_STATE});},promoteTab:function(j){c('ChatDispatcher').dispatch({actionType:h.PROMOTE_TAB,threadID:j});},raiseTab:function(j,k,l){c('ChatDispatcher').dispatch({actionType:h.RAISE_TAB,signatureID:l,threadID:j,userAction:k});}};f.exports=i;},null);
__d('MercuryMessageDeliveryState',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={SENDING:1,SENT:2,DELIVERED:3,ERROR:0,UNKNOWN:-1};f.exports=h;},null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='fbid:'+c('CurrentUser').getID(),i={getID:function(){return h;},isViewer:function(j){c('MercuryAssert').isParticipantID(j);return j===h;}};f.exports=i;},null);
__d('MercuryMessageInfo',['MercuryActionStatus','MercuryMessageDeliveryState','MercuryViewer'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={isOutbound:function(i){return i.author===c('MercuryViewer').getID();},isInbound:function(i){return !h.isOutbound(i);},isSending:function(i){return (i.status===c('MercuryActionStatus').UNSENT||i.status===c('MercuryActionStatus').UNCONFIRMED||i.status===c('MercuryActionStatus').UNABLE_TO_CONFIRM||i.status===c('MercuryActionStatus').RESENDING);},isSent:function(i){return (i.status===undefined||i.status===c('MercuryActionStatus').SUCCESS);},hasError:function(i){return (i.status===c('MercuryActionStatus').FAILED_UNKNOWN_REASON||i.status===c('MercuryActionStatus').UNABLE_TO_CONFIRM||i.status===c('MercuryActionStatus').ERROR);},getDeliveryState:function(i,j){if(this.hasError(i))return c('MercuryMessageDeliveryState').ERROR;if(this.isSending(i))return c('MercuryMessageDeliveryState').SENDING;if(this.isSent(i)){if(i.timestamp<=j)return c('MercuryMessageDeliveryState').DELIVERED;return c('MercuryMessageDeliveryState').SENT;}return c('MercuryMessageDeliveryState').UNKNOWN;}};f.exports=h;},null);
__d('MercuryErrorInfo',['fbt','MercuryErrorType','MercuryMessageInfo'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={getMessage:function(j){var k='';if(i.isConnectionError(j)){k=h._("This message didn't send.");if(i.isTransient(j))k=h._("{message} Check your internet connection and click to try again.",[h.param('message',k)]);}else{if(j&&j.description){k=j.description;}else k=h._("This message failed to send.");if(i.isTransient(j))k=h._("{message} Click to send again.",[h.param('message',k)]);}return k;},isConnectionError:function(j){if(j&&j.type==c('MercuryErrorType').TRANSPORT)return j.code===1001||j.code===1004||j.code===1006;return false;},isTransient:function(j){return j&&j.is_transient;},isPermanent:function(j){return j?!this.isTransient(j):false;},hasErrorStatus:function(j){return c('MercuryMessageInfo').hasError(j);}};f.exports=i;},null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={generateMessageID:function(j){var k=j||Date.now(),l=c('randomInt')(0,4294967295),m=c('PresenceUtil').getSessionID();return '<'+k+':'+l+'-'+m+'@mail.projektitan.com>';},generateThreadID:function(j){return 'root:'+h.generateOfflineThreadingID(j);},generateOfflineThreadingID:function(j){var k=j||Date.now(),l=c('randomInt')(0,4294967295),m=('0000000000000000000000'+l.toString(2)).slice(-22),n=k.toString(2)+m;return i(n.slice(-63));}};function i(j){var k='';while(j!='0'){var l=0,m='';for(var n=0;n<j.length;n++){l=2*l+parseInt(j[n],10);if(l>=10){m+='1';l-=10;}else m+='0';}k=l.toString()+k;j=m.slice(m.indexOf('1'));}return k;}f.exports=h;},null);
__d('MercuryMessageObject',['fbt','BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercuryTimePassed','MercurySendMessageFields','formatDate'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();i.getForFBID=function(m){'use strict';return l.getForFBID(m);};i.get=function(){'use strict';return l.get();};function i(m){'use strict';this.$MercuryMessageObject1=m;this.$MercuryMessageObject2=c('MercuryThreads').getForFBID(m);}i.prototype.constructUserGeneratedMessageObject=function(m,n,o,p,q){'use strict';var r=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,n,o);if(typeof m=='string')m=m.replace(/^\s+/,'').replace(/\s+$/,'');r.body=m;r.has_attachment=false;r.html_body=false;r.attachments=[];r.specific_to_list=p||[];r.creator_info=q;return r;};i.prototype.constructStickerMessageObject=function(m,n,o){'use strict';var p=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,n,o);p.has_attachment=true;p.html_body=false;p.attachments=[];p.sticker_id=m;p.specific_to_list=[];return p;};i.prototype.constructAttachmentMessageObject=function(m,n){'use strict';var o=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,m,n);o.attachments=[];o.specific_to_list=[];return o;};i.prototype.constructLogMessageObject=function(m,n,o,p){'use strict';var q=j(this.$MercuryMessageObject1,c('MercuryActionType').LOG_MESSAGE,m,n);q.log_message_type=o;q.log_message_data=p;if(p&&p.untypedData&&p.untypedData.ttl)q.ephemeral_ttl_mode=p.untypedData.ttl;return q;};i.prototype.normalizeNewMessage=function(m){'use strict';if(m.status===undefined)m.status=c('MercuryActionStatus').UNSENT;m.timestamp_absolute=h._("Today").toString();m.offline_threading_id=m.offline_threading_id||c('MercuryLocalIDs').generateOfflineThreadingID(m.timestamp);if(!m.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','invalid_otid_generated');m.message_id=m.message_id||m.offline_threading_id;var n=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryMessageObject1);m.specific_to_list=m.specific_to_list||[];if(m.specific_to_list.length&&m.specific_to_list.indexOf(n)===-1)m.specific_to_list.push(n);if(!m.thread_id){m.thread_id='root:'+m.offline_threading_id;}else{var o=this.$MercuryMessageObject2.getThreadMetaNow(m.thread_id);if(o&&o.ephemeral_ttl_mode!==null&&m.ephemeral_ttl_mode===undefined)m.ephemeral_ttl_mode=o.ephemeral_ttl_mode;}if(m.specific_to_list.length==1){m.thread_id='user:'+this.$MercuryMessageObject1;}else if(m.specific_to_list.length==2){var p=m.specific_to_list[0]==n?m.specific_to_list[1]:m.specific_to_list[0];m.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(p);}if(!m.specific_to_list.length){var q=c('MercuryIDs').tokenize(m.thread_id),r=q.type,s=q.value;if(r=='user')m.specific_to_list=['fbid:'+s,n];}if(!m[c('MercurySendMessageFields').MANUAL_RETRY_CNT])m[c('MercurySendMessageFields').MANUAL_RETRY_CNT]=0;};i.prototype.normalizeResendMessage=function(m){'use strict';m.status=c('MercuryActionStatus').RESENDING;m.timestamp=Date.now();m[c('MercurySendMessageFields').MANUAL_RETRY_CNT]+=1;};i.prototype.normalizeAddAttachmentPlaceholder=function(m,n,o){'use strict';if(o.preview_attachments.length>0){m.has_attachment=true;m.preview_attachments=o.preview_attachments;}m.client_state=c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER;m.status=c('MercuryActionStatus').RESENDING;m.upload_id=n;};function j(m,n,o,p){var q=k(o)?[c('MercuryMessageSourceTags').CHAT]:[],r=Date.now(),s=c('formatDate')(new Date(r),'g:ia'),t={action_type:n,thread_id:p,author:c('MercuryIDs').getParticipantIDFromUserID(m),author_email:null,timestamp:r,timestamp_absolute:new Date(r).toLocaleDateString(),timestamp_relative:s,timestamp_time_passed:c('MercuryTimePassed').TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:o,source_tags:q};return t;}function k(m){switch(m){case c('MercurySourceType').CHAT_WEB:case c('MercurySourceType').CHAT_JABBER:case c('MercurySourceType').CHAT_IPHONE:case c('MercurySourceType').CHAT_MEEBO:case c('MercurySourceType').CHAT_ORCA:case c('MercurySourceType').CHAT_TEST:case c('MercurySourceType').CHAT:case c('MercurySourceType').DESKTOP:return true;default:return false;}}var l=new (c('MercurySingletonProvider'))(i);f.exports=i;},null);
__d('MercuryMessageActions',['MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){this.$MercuryMessageActions1=i;this.$MercuryMessageActions2=c('MercuryMessageObject').getForFBID(this.$MercuryMessageActions1);this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryMessageActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryMessageActions1);}h.prototype.send=function(i,j,k){j=j||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(i,k);j(i.thread_id);};h.prototype.resend=function(i,j){var k=babelHelpers['extends']({},i);this.$MercuryMessageActions2.normalizeResendMessage(k);this.send(k,undefined,j);};h.prototype.addAttachmentPlaceholder=function(i,j,k){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(i,j,k);this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.cancelAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.confirmAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype['delete']=function(i,j,k){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(i,j,c('MercuryActionType').DELETE_MESSAGES,k||c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES));};h.prototype.unwrap=function(i){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:i.thread_id,unwrapped_message_id:i.message_id,action_type:c('MercuryActionType').UNWRAP_MESSAGE},c('MercuryPayloadSource').CLIENT_UNWRAP_MESSAGE));};h.prototype.__constructClientSingleMessagePayload=function(i,j){return {actions:[i],from_client:true,payload_source:j};};h.prototype.$MercuryMessageActions4=function(i,j){return {actions:[i],from_client:false,payload_source:j};};h.prototype.$MercuryMessageActions3=function(i,j,k,l){return {actions:[{action_type:k,thread_id:i,message_ids:j}],from_client:true,payload_source:l};};Object.assign(h,c('MercurySingletonMixin'));f.exports=h;},null);
__d('MercuryMessageError.react',['cx','CurrentUser','ImmutableObject','MercuryErrorInfo','MercuryMessageActions','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryMessageError',propTypes:{authorFBID:i.string,message:i.instanceOf(c('ImmutableObject')).isRequired},getDefaultProps:function(){return {authorFBID:c('CurrentUser').getID()};},render:function(){var k=this.props.message,l=k.error_data;return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')(this.props.className,this._getClassNameFromStatus(k)),tabIndex:c('MercuryErrorInfo').isTransient(l)?0:null,onClick:c('MercuryErrorInfo').isTransient(l)?this.messageResend:null}),c('React').createElement('div',{className:"_2fs1"}),c('React').createElement('span',{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(k)}})));},messageResend:function(){c('MercuryMessageActions').getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(k){if(c('MercuryErrorInfo').hasErrorStatus(k)){return "_2fs2"+(' '+"_2fs3")+(c('MercuryErrorInfo').isTransient(k.error_data)?' '+"_2fs4":'')+(c('MercuryErrorInfo').isPermanent(k.error_data)?' '+"_2fs5":'');}else return "_2fs6 _2fs2";},_getTextFromStatus:function(k){var l='',m=k.error_data;if(c('MercuryErrorInfo').hasErrorStatus(k))l=c('MercuryErrorInfo').getMessage(m);if(typeof l==='object'&&l.__html)l=l.__html;return l;}});f.exports=j;},null);
__d('WebMessengerEvents',['Arbiter'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=Object.assign(new (c('Arbiter'))(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',STICKER_CLICKED:'sticker-clicked',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(h.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(h.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(h.FOCUS_COMPOSER);},focusSearch:function(){this.inform(h.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(h.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(i){this.inform(h.UPDATE_SELECTION,i);},stickerClicked:function(i,j){this.inform(h.STICKER_CLICKED,{packID:i,stickerID:j});},submitReply:function(){this.inform(h.SUBMIT_REPLY);}});f.exports=h;},null);
__d('WebMessengerSubscriptionsHandler',['SubscriptionsHandler'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=new (c('SubscriptionsHandler'))('webmessenger');f.exports=h;},null);
__d("isWebMessengerURI",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){return (/^(\/messages)/.test(i.getPath()));}f.exports=h;},null);
__d('WebMessengerWidthControl',['cx','$','Arbiter','BlueBar','CSS','CSSClassTransition','Event','Style','URI','ViewportBounds','WebMessengerEvents','WebMessengerSubscriptionsHandler','getViewportDimensions','isWebMessengerURI','requestAnimationFrame','setTimeoutAcrossTransitions','shield','throttle'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=205,j=981,k=257,l=18,m=848,n=724,o=.57,p=56,q,r,s;function t(y,z,aa){this.masterChanged=y;this.detailChaned=z;c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(window,'resize',c('throttle')(c('shield')(u,this,this),100)),c('Arbiter').subscribe(['sidebar/initialized','sidebar/visibility','minisidebar/show'],c('shield')(u,this,this),c('Arbiter').SUBSCRIBE_NEW));var ba=x()?p:0;if(aa)ba=i;this._width=x()?0:m;s=true;u(this,ba);}function u(y,z){var aa=c('ViewportBounds').getRight()+c('ViewportBounds').getLeft();aa=aa||z||0;var ba=c('getViewportDimensions').withoutScrollbars().width-aa,ca=Math.round(Math.max(0,ba/2-j/2));ba=j+ca-k;ba-=l;ba=Math.max(n,Math.min(m,ba));if(!isNaN(ba)&&y._width!==ba){y._width=ba;var da=Math.round(ba/(1+o)),ea=ba-da;y.masterChanged(ea);y.detailChaned(da);if(x()){var fa=ba+k;v(function(){if(r){document.body.className=r;r='';}w(fa+'px');c('CSS').removeClass(document.body,"_5uj5");s&&c('WebMessengerEvents').detailDOMChanged();s=false;},r);}}}function v(y,z){z&&c('CSS').addClass(document.documentElement,"_5uj6");c('requestAnimationFrame')(y);z&&c('setTimeoutAcrossTransitions')(c('CSS').removeClass.bind(null,document.documentElement,"_5uj6"),1000);}function w(y){c('Style').set(c('BlueBar').getNavRoot(),'width',y);c('Style').set(c('$')('globalContainer'),'width',y);}function x(){if(!q)q=c('CSS').hasClass(document.body,"_6nw");return q;}c('CSSClassTransition').registerHandler(function(y,z,aa,ba){function ca(da){return x()&&c('isWebMessengerURI')(new (c('URI'))(da));}if(ca(ba)){r=z;return true;}else if(ca(aa)){v(function(){y.className=z;w('');},true);return true;}});f.exports=t;},null);
__d('Dock',['csx','Event','shield','WebMessengerWidthControl','Arbiter','ArbiterMixin','BlueBar','ChatQuietLinks','CSS','DataStore','DOM','Parent','Scroll','Style','Toggler','Vector','emptyFunction'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();c('WebMessengerWidthControl');function i(){}Object.assign(i,c('ArbiterMixin'),{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(j){this.init=c('emptyFunction');this.rootEl=j;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();c('ChatQuietLinks').removeEmptyHrefs(this.rootEl);c('Event').listen(j,'click',this._onClick.bind(this));c('Event').listen(window,'resize',this._onWindowResize.bind(this));c('Toggler').subscribe(['show','hide'],function(k,l){var m=l.getActive();if(!c('DOM').contains(j,m))return;if(c('CSS').hasClass(m,'fbNub')){this.notifyNub(m,k);if(k==='show')this._resizeNubFlyout(m);}else{var n=c('Parent').byClass(m,'fbNubFlyout');if(n)c('CSS').conditionClass(n,'menuOpened',k==='show');}}.bind(this));this.inform('init',{},c('Arbiter').BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return this.viewportDimensions=c('Vector').getViewportDimensions();},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+c('Vector').getElementDimensions(this.rootEl).y;var j=c('BlueBar').getBar();if(j){var k=c('Style').isFixed(j)?'viewport':'document';this.flyoutHeightOffset+=c('Vector').getElementPosition(j,k).y+c('Vector').getElementDimensions(j).y;}},toggle:function(j){var k=this._findFlyout(j);if(!k)return;this.subscribe('init',function(){c('Toggler').toggle(j);});},show:function(j){this.subscribe('init',function(){c('Toggler').show(j);});},showNub:function(j){c('CSS').show(j);},hide:function(j){this.subscribe('init',function(){var k=c('Toggler').getInstance(j);c('DOM').contains(j,k.getActive())&&k.hide();});},hideNub:function(j){c('CSS').hide(j);this.hide(j);},setUseMaxHeight:function(j,k){c('CSS').conditionClass(j,'maxHeight',k!==false);this._resizeNubFlyout(j);},_resizeNubFlyout:function(j){var k=this._findFlyout(j);if(!k||c('CSS').hasClass(j,'placeholder')||!(c('CSS').hasClass(j,'openToggler')||c('CSS').hasClass(j,'opened')))return;var l=c('DOM').find(k,'div.fbNubFlyoutOuter'),m=c('DOM').find(l,'div.fbNubFlyoutInner'),n=c('DOM').find(m,'div.fbNubFlyoutBody'),o=c('Scroll').getTop(n),p=n.offsetHeight;c('Style').set(n,'height','auto');var q=c('Vector').getElementDimensions(k),r=c('Vector').getElementDimensions(n),s=this.getMaxFlyoutHeight(j);c('Style').set(k,'max-height',s+'px');c('Style').set(l,'max-height',s+'px');q=c('Vector').getElementDimensions(k);var t=c('Vector').getElementDimensions(m),u=t.y-r.y,v=q.y-u,w=parseInt(n.style.height||n.clientHeight,10),x=v!==w;if(q.y>u&&x)c('Style').set(n,'height',v+'px');c('CSS').removeClass(k,'swapDirection');var y=c('Vector').getElementPosition(k).x;c('CSS').conditionClass(k,'swapDirection',function(){if(y<0)return true;return y+q.x>this.viewportDimensions.x;}.bind(this)());if(x&&o+p>=r.y){c('Scroll').setTop(n,n.scrollHeight);}else c('Scroll').setTop(n,o);this.notifyNub(j,'resize');},getMaxFlyoutHeight:function(j){var k=this._findFlyout(j),l=c('Vector').getElementPosition(k,'viewport'),m=c('Vector').getElementDimensions(k),n=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-l.y-m.y);return Math.max(n,0);},resizeAllFlyouts:function(){var j=this._getAllNubs(),k=j.length;while(k--)this._resizeNubFlyout(j[k]);},hideAllFlyouts:function(){var j=this._getAllNubs(),k=j.length;while(k--)this.hide(j[k]);},_getAllNubs:function(){var j=c('DOM').scry(this.rootEl,"div._50-v.openToggler");return j.concat(c('DOM').scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var j=event.getTarget(),k=c('Parent').byClass(j,'fbNub');if(k){if(c('Parent').byClass(j,'fbNubFlyoutTitlebar')){var l=c('Parent').byTag(j,'a'),m=j.nodeName=='INPUT'&&j.getAttribute('type')=='submit';if(!l&&!m){this.hide(k);return false;}}this.notifyNub(k,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(j){return c('CSS').hasClass(j,'fbNubFlyout')?j:c('DOM').scry(j,'div.fbNubFlyout')[0]||null;},registerNubController:function(j,k){c('DataStore').set(j,'dock:nub:controller',k);k.subscribe('nub/button/content-changed',c('shield')(this.inform,this,'resize',j));k.subscribe('nub/flyout/content-changed',c('shield')(this._resizeNubFlyout,this,j));},unregisterNubController:function(j){c('DataStore').remove(j,'dock:nub:controller');},notifyNub:function(j,k,l){var m=c('DataStore').get(j,'dock:nub:controller');m&&m.inform(k,l);}});f.exports=b.Dock||i;},null);
__d('PureStoreBasedStateMixin',['invariant','StoreBasedStateMixinHelper','setImmediate'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=function(){for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];return {getInitialState:function(){return this.constructor.calculateState();},componentWillMount:function(){!this.constructor.calculateState?h(0):undefined;this._recalculateStateID=null;var m=function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}.bind(this);this._mixin=new (c('StoreBasedStateMixinHelper'))(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=c('setImmediate')(m);}.bind(this));},componentWillUnmount:function(){this._mixin.release();this._mixin=null;}};}.bind(this);f.exports=i;},null);
__d('PhotoStoreCore',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(i){if(!this._photoCache[i])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[i];},hasBeenCreated:function(i){return !!this._photoCache[i];},clearSetCache:function(i){delete this._photoCache[i];delete this._postCreateCallbacks[i];},getByIndex:function(i,j,k){this.getPhotoCache(i).getItemAtIndex(j,k);},getByIndexImmediate:function(i,j){if(this._photoCache[i])return this._photoCache[i].getItemAtIndexImmediate(j);return undefined;},getItemsInAvailableRange:function(i){var j=this.getAvailableRange(i),k=[];for(var l=j.offset;l<j.length;l++)k.push(this.getByIndexImmediate(i,l));return k;},getItemsAfterIndex:function(i,j,k,l){var m=this.getCursorByIndexImmediate(i,j);this.fetchForward(i,m,k,l);},getAllByIDImmediate:function(i){var j=Object.keys(this._photoCache);return j.map(function(k){return this.getByIndexImmediate(k,this.getIndexForID(k,i));}.bind(this)).filter(function(k){return !!k;});},getIndexForID:function(i,j){if(this._photoCache[i])return this._photoCache[i].getIndexForID(j);return undefined;},getEndIndex:function(i){var j=this.getAvailableRange(i);return j.offset+j.length-1;},getCursorByIndexImmediate:function(i,j){var k=this.getByIndexImmediate(i,j);if(k)return this._photoCache[i].getCursorForID(k.id);return undefined;},hasNextPage:function(i){var j=this.getCursorByIndexImmediate(i,this.getEndIndex(i));return this.getPhotoCache(i).hasNextPage(j);},getAvailableRange:function(i){return this.getPhotoCache(i).getAvailableRange();},hasLooped:function(i){return this.getPhotoCache(i).hasLooped();},fetchForward:function(i,j,k,l){this.getPhotoCache(i).getItemsAfterCursor(j,k,l);},fetchBackward:function(i,j,k,l){this.getPhotoCache(i).getItemsBeforeCursor(j,k,l);},executePostCreate:function(i,j){if(this._photoCache[i]){j&&j();}else this._postCreateCallbacks[i]=j;},runPostCreateCallback:function(i){var j=this._postCreateCallbacks[i];if(j){j();delete this._postCreateCallbacks[i];}},setPreFetchCallback:function(i,j){this.getPhotoCache(i).setPreFetchCallback(j);},updateData:function(i){var j=i.set_id;if(!this._photoCache[j]){this._photoCache[j]=new i.cache_class(i);this.runPostCreateCallback(j);}else if(i.query_metadata.action==h.actions.UPDATE){this._photoCache[j].updateData(i);}else this._photoCache[j].addData(i);},updateFeedbackData:function(i){var j=Object.keys(i);j.forEach(function(k){return h.getAllByIDImmediate(k).forEach(function(l){l.feedback=i[k].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach(function(i){return this.clearSetCache(i);}.bind(this));}};f.exports=h;},null);
__d("XMercuryThreadLikeIconController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});},null);
__d("XMessagingSaveAdminsController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_admins\/",{});},null);
__d("XMessagingSaveNicknameController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessagingSaveThreadColorController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessagingSaveThreadEmojiController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});},null);
__d("XMessengerNotificationsSettingsDialogController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/settings\/dialog\/",{thread_key_id:{type:"String",required:true},modify:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null);
__d("XNFXMessengerBlockActionController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});},null);
__d('MercuryThreadActions',['cssVar','AsyncDialog','AsyncRequest','EmojiLikeConstants','IrisProtocolMessageLifetime','MercuryMessageActions','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryMessageObject','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryThreads','MercuryThreadIDMap','MercuryViewer','MessagingGenericAdminTextType','MessagingTag','XNFXMessengerBlockActionController','URI','XMercuryThreadLikeIconController','XMessagingSaveAdminsController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','MercuryAssert','XMessengerNotificationsSettingsDialogController'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('MercuryMessageActions').get(),j=c('MercuryMessageObject').get(),k=c('MercuryThreads').get(),l=c('MercuryThreadIDMap').get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryThreadActions1);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MARK_THREAD_SEEN,c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype['delete']=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c('MercuryActionType').DELETE_THREAD,c('MercuryPayloadSource').CLIENT_DELETE_THREAD));};m.prototype.openNotificationSettings=function(n){c('MercuryAssert').isThreadID(n);this.__threadIDMap.getServerIDFromClientID(n,function(o){var p=c('XMessengerNotificationsSettingsDialogController').getURIBuilder().setString('thread_key_id',o).setBool('modify',false).getURI();new (c('AsyncRequest'))().setURI(p).send();});};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:o}));};m.prototype.blockMessages=function(n){var o=c('XNFXMessengerBlockActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.unblockMessages=function(n){var o=JSON.stringify({reportable_ent_token:c('MercuryIDs').getUserIDFromThreadID(n),initial_action_name:c('MercuryMessengerBlockingUtils').block_messages});new (c('AsyncRequest'))(new (c('URI'))('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:o})).send();};m.prototype.turnOffSecretMode=function(n){if(k.isEmptyLocalThread(n))return;i.send(j.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').GENERIC_ADMIN_TEXT,{message_type:c('MessagingGenericAdminTextType').THREAD_EPHEMERAL_SEND_MODE,untypedData:{ttl:c('IrisProtocolMessageLifetime').TTL_OFF}}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.turnOnSecretMode=function(n){if(k.isEmptyLocalThread(n))return;i.send(j.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').GENERIC_ADMIN_TEXT,{message_type:c('MessagingGenericAdminTextType').THREAD_EPHEMERAL_SEND_MODE,untypedData:{ttl:c('IrisProtocolMessageLifetime').TTL_1HOUR}}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.leaveGroup=function(n){if(!k.isEmptyLocalThread(n))i.send(j.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.changeThreadColor=function(n,o,p){if(k.isEmptyLocalThread(n))return;l.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadColorController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadEmoji=function(n,o,p){if(k.isEmptyLocalThread(n))return;l.getServerIDFromClientID(n,function(q){var r={};if(o!=c('EmojiLikeConstants').THUMBS_UP_EMOJI)r.emoji_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadEmojiController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadNicknames=function(n,o,p,q){if(k.isEmptyLocalThread(n))return;l.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c('XMessagingSaveNicknameController').getURIBuilder().setEnum('source',q).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(s).send();});};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c('XMessagingSaveAdminsController').getURIBuilder().getURI();new (c('AsyncRequest'))(r).setMethod('POST').setData(q).send();};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').ADD_PARTICIPANTS,c('MercuryPayloadSource').CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.unpinThread=function(n){this.__serverRequests.unpinThread(n);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UNPIN_THREAD,c('MercuryPayloadSource').CLIENT_UNPIN_THREAD));};m.prototype.updateCustomLike=function(n,o){var p=c('XMercuryThreadLikeIconController').getURIBuilder().setString('emoji',o).getURI();new (c('AsyncRequest'))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_CUSTOM_LIKE,c('MercuryPayloadSource').CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}));}.bind(this)).send();};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MOVE_PENDING_TO_INBOX,c('MercuryPayloadSource').CLIENT_MOVE_PENDING_TO_INBOX));};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_SNIPPET,c('MercuryPayloadSource').CLIENT_UPDATE_SNIPPET,{deleted_ids:o}));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_READ_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_ARCHIVED_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_FOLDER,c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return babelHelpers['extends']({action_type:o,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,c('MercurySingletonMixin'));f.exports=m;},null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryConfig').activity_limit||60000,i=c('MercuryConfig').idle_limit||1800000,j=c('MercuryConfig').idle_poll_interval||300000,k=c('JSLogger').create('chat_activity'),l=Date.now(),m=true;function n(){var r=Date.now();return !!(m&&r-l<h);}var o=Object.assign(new (c('Arbiter'))(),{isActive:n});function p(){var r=l;l=Date.now();if(l-r>i){k.debug('idle_to_active',r);c('PresenceState').doSync();}o.inform('activity');}c('Event').listen(window,'focus',function(){m=true;p();});c('Event').listen(window,'blur',function(){m=false;});c('UserActivity').subscribe(function(){p();});function q(r){var s=r&&r.at&&c('PresenceState').verifyNumber(r.at);if(typeof s!=='number')s=null;return s||0;}setInterval(function(){var r=Date.now(),s=q(c('PresenceState').get()),t=Math.max(l,s);if(r-t>i){k.debug('idle',{cookie:s,local:l});o.inform('idle',r-t);}},j);c('PresenceState').registerStateStorer(function(r){var s=q(r);if(s<l)r.at=l;return r;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.chat_activity={activity_limit:h,idle_limit:i,idle_poll_interval:j,last_active_time:l};});f.exports=o;},null);
__d('MercuryMessages',['invariant','BanzaiODS','ChatReliabilityInstrumentation','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryDispatcher','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonMixin','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','isMessengerDotComURI','mergeDeep','setImmediate'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_messages');function k(t,u){var v=u;if(t._localIdsMap[u])v=t._localIdsMap[u];return t._messages.get(v);}function l(t){switch(t){case c('MercuryPayloadSource').UNKNOWN:case c('MercuryPayloadSource').SERVER_INITIAL_DATA:case c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:return true;}return false;}function m(t,u){if(!t._threadsToMessages[u])t._threadsToMessages[u]=new (c('RangedCallbackManager'))(function(v){return k(t,v).timestamp;},function(v,w){return w-v;});return t._threadsToMessages[u];}function n(t,u,v){u.forEach(function(w){var x=m(t,w);x.setReachedEndOfArray();t._emitReorderedChange(w,v);});}function o(t){this._fbid=t;this._messageActions=c('MercuryMessageActions').getForFBID(this._fbid);this._serverRequests=c('MercuryServerRequests').getForFBID(this._fbid);this._threadInformer=c('MercuryThreadInformer').getForFBID(this._fbid);this._threads=c('MercuryThreads').getForFBID(this._fbid);this._threadActions=c('MercuryThreadActions').getForFBID(this._fbid);this._dispatcher=c('MercuryDispatcher').getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new (c('Map'))();this._localIdsMap={};this._dispatcher.subscribe('update-messages',function(u,v){var w=(v.actions||[]).filter(function(y){var z=y.action_type,aa=(y.is_forward||y.thread_id)&&(z==c('MercuryActionType').LOG_MESSAGE||z==c('MercuryActionType').USER_GENERATED_MESSAGE||z==c('MercuryActionType').SEND_MESSAGE||z==c('MercuryActionType').DELETE_THREAD||z==c('MercuryActionType').DELETE_MESSAGES||z==c('MercuryActionType').MARK_MESSAGES_SPAM),ba=y.upload_id&&y.upload_data&&(z==c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER||z==c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER),ca=y.note&&z==c('MercuryActionType').CREATE_PAGE_ADMIN_NOTE,da=y.replaced_message_id&&z==c('MercuryActionType').REPLACE_MESSAGE,ea=y.unwrapped_message_id&&z==c('MercuryActionType').UNWRAP_MESSAGE;return aa||ba||ca||da||ea;}),x=l(v.payload_source);this.handleUpdates(w,x,v.payload_source,v.from_client);if(v.end_of_history)n(this,v.end_of_history,v.payload_source);if(this._didChange){this._didChange=false;i.emit('change');}}.bind(this));this._dispatcher.subscribe('invalidate-thread-state',function(u,v){this._invalidateThreadState(v);}.bind(this));this._dispatcher.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));j.debug('constructed',JSON.stringify({fbid:this._fbid}));}Object.assign(o.prototype,{getMessagesFromIDs:function(t){return (t||[]).map(k.bind(null,this)).filter(function(u){return u;});},getServerMessageID:function(t){var u=t;if(this._localIdsMap[t])u=this._localIdsMap[t];return u;},hasLoadedNMessages:function(t,u){var v=m(this,t);return v.hasReachedEndOfArray()||v.getCurrentArraySize()>=u;},hasLoadedExactlyNMessages:function(t,u){var v=m(this,t);return v.getCurrentArraySize()==u;},invalidateGlobalState:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new (c('Map'))();this._localIdsMap={};},getThreadMessagesRange:function(t,u,v,w,x,y){var z=m(this,t),aa=function(ka){w(p(this,ka));}.bind(this),ba=z.executeOrEnqueue(u,v,aa),ca=z.getUnavailableResources(ba),da=this._failedHistoryFetchThreads[t];if(ca.length&&!da){var ea=z.getCurrentArraySize(),fa=this._localTitanMessagesCount[t]||0,ga=ea-fa,ha=ca.length+fa,ia=this.getCurrentlyLoadedMessages(t),ja=ia.length?ia[0].timestamp:null;j.debug('fetch_missing_messages',JSON.stringify({threadID:t,offset:u,limit:v,timestamp:ja,missingIndices:ca,messageCount:ea,localMessageCount:fa}));this._serverRequests.fetchThreadMessages(t,ga,ha,ja,x,y);}else this._failedHistoryFetchThreads[t]=false;return ba;},getThreadMessagesRangeNow:function(t,u,v){var w=m(this,t),x=[];for(var y=u;y<u+v;y++){var z=w.getResourceAtIndex(y),aa=k(this,z);aa&&x.push(aa);}return x;},getThreadMessagesSinceTimestamp:function(t,u){var v=m(this,t),w=v.getElementsUntil(u);return p(this,w);},hasLoadedAllMessages:function(t){return m(this,t).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(t){var u=m(this,t).getAllResources();return p(this,u);},unsubscribe:function(t,u){c('MercuryAssert').isThreadID(u);var v=m(this,u);v.unsubscribe(t);},_addNewMessage:function(t,u){s(u);this._messages.set(t,new (c('ImmutableObject'))(u));},_addNewPageAdminNote:function(t,u){var v=this._messages.get(t);if(v){var w=v.page_admin_notes?v.page_admin_notes.slice():[],x=false,y=true;for(var z=0;z<w.length;++z)if(w[z].id===u.id){x=true;y=false;break;}else if((w[z].id===null||w[z].id===undefined)&&w[z].body===u.body){x=true;w[z]=u;}if(!x)w.push(u);if(y){var aa={};aa.page_admin_notes=w;this._updateMessage(t,v,aa);}}},_updateMessage:function(t,u,v){var w=c('ImmutableObject').set(u,v);this._messages.set(t,w);return w;},_shouldSortOutOfOrderMessages:function(t,u,v){if(t==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE){var w=this.getThreadMessagesSinceTimestamp(u,v);if(w.length>0){c('BanzaiODS').bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(t===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE||t===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;},_preprocessIncomingAction:function(t,u){var v=t.action_type;if(u==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&v==c('MercuryActionType').USER_GENERATED_MESSAGE&&t.offline_threading_id&&this._localIdsMap[t.offline_threading_id]===t.offline_threading_id){t.client_message_id=t.offline_threading_id;t.status=c('MercuryActionStatus').SUCCESS;t.action_type=c('MercuryActionType').SEND_MESSAGE;v=t.action_type;}if(u===c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&v==c('MercuryActionType').USER_GENERATED_MESSAGE){var w=this._threads.getThreadMetaNow(t.thread_id);if(w&&w.folder)t.folder=w.folder;c('ChatReliabilityInstrumentation').logMESSAGE_RECEIVED();}return t;},handleUpdates:function(t,u,v,w){var x,y={};for(var z=0;z<t.length;z++){var aa=this._preprocessIncomingAction(t[z],v),ba=aa.action_type,ca=k(this,aa.message_id);if(ba==c('MercuryActionType').LOG_MESSAGE)if(this.isLocalMessage(aa))continue;if(aa.is_forward||v==c('MercuryPayloadSource').SERVER_SEARCH){if(!this._messages.has(aa.message_id))this._addNewMessage(aa.message_id,aa);continue;}else if(aa.client_state===c('MercuryMessageClientState').SEND_TO_SERVER){this._addNewMessage(aa.message_id,aa);continue;}else if(ba==c('MercuryActionType').SEND_MESSAGE){var da=aa.client_message_id;if(da&&this._localIdsMap[da]&&aa.status){var ea=k(this,da),fa=ea.status;if(ea.status==c('MercuryActionStatus').SUCCESS)continue;if(!y[aa.thread_id])y[aa.thread_id]=[];this._updateLocalMessage(aa);if(typeof fa!==undefined||aa.status==c('MercuryActionStatus').FAILED_UNKNOWN_REASON||aa.status==c('MercuryActionStatus').UNABLE_TO_CONFIRM||aa.status==c('MercuryActionStatus').SUCCESS||aa.status==c('MercuryActionStatus').ERROR)this._emitUpdatedChange(aa.thread_id,k(this,da).message_id,v);}continue;}else if(ba==c('MercuryActionType').DELETE_THREAD){m(this,aa.thread_id).removeAllResources();continue;}else if(ba==c('MercuryActionType').DELETE_MESSAGES){this._deleteMessages(aa.thread_id,aa.message_ids,v);c('setImmediate')(function(){this._threadActions.updateSnippet(aa.thread_id,aa.message_ids);}.bind(this));continue;}else if(ba==c('MercuryActionType').CREATE_PAGE_ADMIN_NOTE){this._addNewPageAdminNote(aa.message_id,aa.note);this._emitUpdatedChange(aa.thread_id,aa.message_id,'link_shim');continue;}else if(aa.offline_threading_id&&this._localIdsMap[aa.offline_threading_id]||ca&&!ca.is_forward){if(ca&&aa.ranges&&aa.ranges.length>0){var ga=ca.message_id;this._updateMessage(this._localIdsMap[ga]||ga,ca,{ranges:t.ranges});this._emitUpdatedChange(ca.thread_id,ca.message_id,'link_shim');}continue;}else if(ba===c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(aa.upload_id,aa.upload_data);continue;}else if(ba===c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(aa.upload_id,aa.upload_data);continue;}else if(ba==c('MercuryActionType').REPLACE_MESSAGE){if(this._replaceMessage(aa)){if(!y[aa.thread_id])y[aa.thread_id]=[];y[aa.thread_id].push(aa.message_id);this._emitUpdatedChange(aa.thread_id,aa.replaced_message_id,v);this._emitUpdatedChange(aa.thread_id,aa.message_id,v);u=true;}continue;}else if(ba==c('MercuryActionType').UNWRAP_MESSAGE){if(this._unwrapMessage(aa))this._emitUpdatedChange(aa.thread_id,aa.unwrapped_message_id,v);}else{if(v===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE){this._localIdsMap[aa.message_id]=aa.message_id;if(aa.thread_id=='root:'+aa.offline_threading_id)m(this,aa.thread_id).setReachedEndOfArray();}if(ba==c('MercuryActionType').LOG_MESSAGE&&aa.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)this._failedHistoryFetchThreads[aa.thread_id]=true;if(aa.client_state===c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER&&aa.upload_id)this._uploadMessages[aa.upload_id]=aa;if(!y[aa.thread_id])y[aa.thread_id]=[];y[aa.thread_id].push(aa.message_id);this._addNewMessage(aa.message_id,aa);if(aa.offline_threading_id&&aa.offline_threading_id!=aa.message_id){this._localIdsMap[aa.offline_threading_id]=aa.message_id;c('MercuryMessageIDs').addServerID(aa.offline_threading_id,aa.message_id);if(aa.threading_id)c('MercuryMessageIDs').addServerID(aa.threading_id,aa.message_id);}if(aa[c('MercurySendMessageFields').MANUAL_RETRY_CNT]>0){x=m(this,aa.thread_id);x.resortResources([aa.message_id]);this._emitReorderedChange(aa.thread_id,c('MercuryPayloadSource').CLIENT_SEND_MESSAGE);}u=u||this._shouldSortOutOfOrderMessages(v,aa.thread_id,aa.timestamp);if(!u)this._emitReceivedChange(k(this,aa.message_id));continue;}}for(var ha in y){x=m(this,ha);var ia=x.getAllResources(),ja=ia.filter(function(ka){var la=this._messages.get(ka);if(!la)return true;return la.action_type==c('MercuryActionType').LOG_MESSAGE&&la.log_message_type==c('MercuryLogMessageType').SERVER_ERROR;}.bind(this));x.removeResources(ja);if(w)q(this,ha,y[ha]);if(u){x.addResources(y[ha]);this._emitReorderedChange(ha,v);}else x.addResourcesWithoutSorting(y[ha].reverse(),0);this._threadInformer.updatedThread(ha);}this._didChange&&j.debug('handle_updates',JSON.stringify({localMessageCounts:this._localTitanMessagesCount}));},isFirstMessage:function(t){var u=m(this,t.thread_id);if(u.getCurrentArraySize()===0)return false;var v=u.getResourceAtIndex(u.getCurrentArraySize()-1),w=k(this,v).message_id,x=k(this,t.message_id).message_id;return u.hasReachedEndOfArray()&&w==x;},isLocalMessage:function(t){if(t.offline_threading_id!==null&&t.offline_threading_id===t.message_id)return true;if(t.threading_id!==null&&t.threading_id===t.message_id)return true;return false;},_deleteMessages:function(t,u,v){if(!u.length)return;this._deleteIndividualMessages(t,u,v);if(v!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(t,u);},_deleteIndividualMessages:function(t,u,v){var w=u.map(function(y){return k(this,y).message_id;},this),x=m(this,t);x.removeResources(w);this._emitReorderedChange(t,v);},_updateLocalMessage:function(t){var u=k(this,t.client_message_id),v={};v.status=t.status;if(t.status===c('MercuryActionStatus').SUCCESS||t.error_data)v.error_data=t.error_data;var w=t.message_id,x=t.client_message_id;if(this._messages.has(w)){this._updateMessage(w,u,v);return false;}if(t.threading_id)v.threading_id=t.threading_id;if(t.timestamp)v.timestamp=t.timestamp;if(t.log_message_data)v.log_message_data=t.log_message_data;if(t.ranges&&t.ranges.length){s(t);v.ranges=t.ranges;}if(t.attachments&&t.attachments.length){v.raw_attachments=null;v.attachments=t.attachments;}this._localIdsMap[x]=w;c('MercuryMessageIDs').addServerID(x,w);var y=this._updateMessage(w,u,v);this._messages.set(x,new (c('ImmutableObject'))());if(r(y))this._localTitanMessagesCount[y.thread_id]--;return true;},_replaceMessage:function(t){var u=t.replaced_message_id,v=k(this,u);if(!v)return false;var w={};w.status=t.status;if(t.timestamp)w.timestamp=t.timestamp;if(t.log_message_data)w.log_message_data=t.log_message_data;if(t.ranges&&t.ranges.length){s(t);w.ranges=t.ranges;}if(t.attachments&&t.attachments.length){w.raw_attachments=null;w.attachments=t.attachments;}if(t.body)w.body=t.body;var x=t.message_id;c('MercuryMessageIDs').addServerID(x,x);this._updateMessage(x,v,w);this._messages['delete'](u);return true;},_unwrapMessage:function(t){var u=k(this,t.unwrapped_message_id);if(!u||!u.tags)return false;var v=u.tags.slice(0);v.push(c('MessagingGiftWrapConstants').UNWRAPPED_TAG);var w={tags:v};this._updateMessage(t.unwrapped_message_id,u,w);return true;},getNumberLocalMessages:function(t){return this._localTitanMessagesCount[t]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(t,u){var v=this._popPendingAttachmentMessage(t,u);delete v.preview_attachments;this._serverRequests.sendNewMessage(v);},_cancelAttachmentPlaceholder:function(t,u){var v=this._popPendingAttachmentMessage(t,u);this._deleteIndividualMessages(v.thread_id,[v.message_id]);if(this._localTitanMessagesCount[v.thread_id])this._localTitanMessagesCount[v.thread_id]--;},_popPendingAttachmentMessage:function(t,u){var v=this._uploadMessages[t];!v?h(0):undefined;v.image_ids=u.image_ids;v.file_ids=u.file_ids;v.audio_ids=u.audio_ids;v.gif_ids=u.gif_ids;v.video_ids=u.video_ids;v.client_state=c('MercuryMessageClientState').SEND_TO_SERVER;delete this._uploadMessages[t];return v;},_emitUpdatedChange:function(t,u,v){this._didChange=true;this._threadInformer.updatedMessage(t,u,v);},_emitReceivedChange:function(t){this._didChange=true;this._threadInformer.receivedMessage(t);},_emitReorderedChange:function(t,u){this._didChange=true;this._threadInformer.reorderedMessages(t,u);},_invalidateThreadState:function(t){if(!this._threadsToMessages[t])return;var u=this._threadsToMessages[t].getAllResources();u.forEach(function(v){var w=k(this,v).offline_threading_id;this._messages['delete'](v);var x=this._localIdsMap[w];if(x)this._messages['delete'](x);delete this._localIdsMap[v];delete this._localIdsMap[w];}.bind(this));delete this._threadsToMessages[t];}});Object.assign(o,c('MercurySingletonMixin'),{addListener:function(t,u){return i.addListener(t,u);}});function p(t,u){var v=u.map(k.bind(null,t));return v.reverse();}function q(t,u,v){var w=v.filter(function(x){return r(k(t,x));});if(!t._localTitanMessagesCount[u])t._localTitanMessagesCount[u]=0;t._localTitanMessagesCount[u]+=w.length;}function r(t){var u=t.action_type;if(u==c('MercuryActionType').USER_GENERATED_MESSAGE)return true;switch(t.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:return false;default:return true;}}function s(t){if(!t.ranges)return;t.ranges.forEach(function(u){if(!u.entity||u.entity.external||!u.entity.url)return;var v=new (c('URI'))(u.entity.url);if(c('isMessengerDotComURI')(c('URI').getRequestURI())&&!v.getDomain()){v.setProtocol('https').setDomain('www.facebook.com');u.entity.url=v.toString();}});}f.exports=o;},null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryMessages').get(),j=c('MercuryThreads').get();function k(l,m){c('MercuryAssert').isThreadID(l);j.getThreadMeta(l,function(n){i.getThreadMessagesRange(l,0,1,function(o){var p=o.length&&o[o.length-1];if(p&&p.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(p.author,function(q){var r=q.short_name;if(n.custom_nickname){var s=c('MercuryIDs').getUserIDFromParticipantID(q.id);if(n.custom_nickname[s])r=n.custom_nickname[s];}if(n.name){m(h._("{senderName} messaged {groupName}",[h.param('senderName',r),h.param('groupName',n.name)]));}else if(c('MercuryIDs').isGroupChat(l)){m(h._("{name} messaged your group",[h.param('name',r)]));}else m(h._("{name} messaged you",[h.param('name',r)]));});}else m(h._("New message!"));});});}f.exports={renderDocumentTitle:k};},null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryPayloadSource','MercurySingletonMixin','MercuryDispatcher'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){this._fbid=i;this._dispatcher=c('MercuryDispatcher').getForFBID(this._fbid);this._lastTimestamp=0;this._dispatcher.subscribe('update-messages',function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source==c('MercuryPayloadSource').CLIENT_SEND_MESSAGE||k.payload_source==c('MercuryPayloadSource').UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c('MercuryActionType').USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this._lastTimestamp)this._lastTimestamp=m.timestamp;}}.bind(this));}Object.assign(h.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});Object.assign(h,c('MercurySingletonMixin'));f.exports=h;},null);
__d('ChatTitleBarBlinker',['ChatActivity','ChatConfig','DocumentTitle','JSLogger','MercuryThreadInformer','MercuryNotificationRenderer','PresenceState','MercuryTimestampTracker'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadInformer').get(),i=c('MercuryTimestampTracker').get(),j=c('JSLogger').create('chat_title'),k=null,l=0,m=false;function n(){if(k){k.stop();k=null;return true;}return false;}function o(t){var u=t||i.getLastUserMessageTimestamp();if(l<=u){l=u;if(n()||m)c('PresenceState').doSync();}}var p={blink:function(t,u){if(!k&&l<u)c('MercuryNotificationRenderer').renderDocumentTitle(t,function(v){if(!k)k=c('DocumentTitle').blink(v);});},stopBlinking:function(){o();},blinkingElsewhere:function(){m=true;}};function q(t){var u=c('PresenceState').verifyNumber(t.sb2);if(!u||u<=l)return null;return u;}function r(t){var u=t&&q(t);if(u){l=u;j.debug('load',l);n();m=false;}}function s(t){var u=q(t);if(!u){j.debug('store',l);t.sb2=l;m=false;}return t;}c('PresenceState').registerStateStorer(s);c('PresenceState').registerStateLoader(r);h.subscribe('thread-read-changed',function(t,u){var v=i.getLastUserMessageTimestamp(),w=0;for(var x in u)if(u[x].mark_as_read&&u[x].timestamp>=v&&u[x].timestamp>w)w=u[x].timestamp;w&&o(w);});c('ChatActivity').subscribe('activity',function(){o();});(function(){var t=c('PresenceState').getInitial();if(t)l=q(t)||0;})();f.exports=p;},null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryBlockedParticipants1=j;this.$MercuryBlockedParticipants2=new (c('Set'))();this.$MercuryBlockedParticipants3=c('MercuryDispatcher').getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',function(k,l){if(l.message_blocked_ids)this.$MercuryBlockedParticipants2=new (c('Set'))(l.message_blocked_ids);var m=l.actions||l.global_actions;for(var n=m,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r.action_type!==c('MercuryActionType').UPDATE_BLOCKER_STATUS)continue;if(r.message_blocked){this.$MercuryBlockedParticipants4(r.thread_fbid);}else this.$MercuryBlockedParticipants5(r.thread_fbid);}}.bind(this));}h.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};h.prototype.setIDs=function(j){this.$MercuryBlockedParticipants2=j;};h.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};h.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};h.prototype.$MercuryBlockedParticipants4=function(j){this.$MercuryBlockedParticipants2.add(c('MercuryIDs').getParticipantIDFromUserID(j));};h.prototype.$MercuryBlockedParticipants5=function(j){this.$MercuryBlockedParticipants2['delete'](c('MercuryIDs').getParticipantIDFromUserID(j));};h.prototype.isMessageBlocked=function(j){if(!j.is_canonical)return false;var k=j.participants.filter(function(l){return l!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this));return !k.every(function(l){return !this.$MercuryBlockedParticipants2.has(l);}.bind(this));};h.prototype.isPresentInGroupThread=function(j){if(!j.is_canonical&&this.$MercuryBlockedParticipants7(j).length>0)return true;return false;};h.prototype.inGroupThread=function(j){if(j.is_canonical)return [];return this.$MercuryBlockedParticipants7(j);};h.prototype.$MercuryBlockedParticipants7=function(j){var k=j.participants.filter(function(m){return m!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this)),l=k.filter(function(m){return this.$MercuryBlockedParticipants2.has(m)!==false;}.bind(this));return l;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={messageMentionsViewer:function(i,j){c('ShortProfiles').get(c('CurrentUser').getID(),function(k){j(new RegExp('@'+k.firstName,'i').test(i.body));});}};f.exports=h;},null);
__d('SoundPlayer',['Arbiter','Flash','URI','createArrayFromMixed'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i=null,j=false,k='so_sound_player',l='/swf/cigars/SoundPlayer.swf?v=1',m=null,n={};function o(y){var z=new (c('URI'))(y);if(!z.getDomain())return new (c('URI'))(window.location.href).setPath(z.getPath()).toString();return y;}function p(y){var z=new (c('URI'))(y).getPath();if(/\.mp3$/.test(z))return 'audio/mpeg';if(/\.og[ga]$/.test(z))return 'audio/ogg';return '';}function q(){if(!m){var y=document.createElement('audio');if(!y||!y.canPlayType)return null;y.setAttribute('preload','auto');document.body.appendChild(y);m=y;}return m;}function r(y){return n[y];}function s(y,z){n[y]=z;}function t(){var y=document[k]||window[k];if(y)if(!y.playSound&&y.length)y=y[0];return y&&y.playSound&&y.loopSound?y:null;}function u(){return j;}function v(y,z,aa){i={path:y,sync:z,loop:aa};}function w(){j=true;if(i){var y=t();if(i.loop){y.loopSound(i.path,i.sync);}else y.playSound(i.path,i.sync);}}var x={init:function(y){y=c('createArrayFromMixed')(y);var z;for(var aa=0;aa<y.length;++aa){z=y[aa];if(h[z])return;}var ba=q();for(aa=0;ba&&aa<y.length;++aa){z=y[aa];if(ba.canPlayType(z)){h[z]=true;return;}}h['audio/mpeg']=true;if(t())return;try{c('Arbiter').registerCallback(w,['sound/player_ready','sound/ready']);var da=document.createElement('div');da.id='sound_player_holder';document.body.appendChild(da);var ea=window[k]=c('Flash').embed(l,da,{allowscriptaccess:'always',wmode:'transparent'},{swf_id:k});ea.setAttribute('id',k);ea.setAttribute('width','1px');ea.setAttribute('height','1px');c('Arbiter').inform('sound/player_ready');}catch(ca){}},createAndPlayNewNative:function(y,z){var aa=document.createElement('audio');aa.setAttribute('preload','auto');document.body.appendChild(aa);aa.src=o(y);if(z){aa.setAttribute('loop','');}else aa.removeAttribute('loop');aa.play();s(y,aa);return;},play:function(y,z){y=c('createArrayFromMixed')(y);var aa=q(),ba,ca;for(var da=0;aa&&da<y.length;++da){ba=y[da];var ea=r(ba);if(ea){if(z){ea.setAttribute('loop','');}else ea.removeAttribute('loop');ea.play();return;}ca=p(ba);if(!aa.canPlayType(ca))continue;x.init([ca]);x.createAndPlayNewNative(ba,z);return;}for(da=0;da<y.length;++da){ba=o(y[da]);ca=p(ba);if(ca!='audio/mpeg')continue;x.init([ca]);var fa=t();if(!u()){v(ba,true,z);return;}else if(fa){if(z){fa.loopSound(ba,true);}else fa.playSound(ba,true);return;}}},stop:function(y){y=c('createArrayFromMixed')(y);for(var z=0;z<y.length;++z){var aa=o(y[z]),ba=r(y[z]),ca=t();if(ba&&ba.src==aa){ba.pause();ba.removeAttribute('src');ba.src=aa;}else ca&&ca.stopSound(aa);}}};f.exports=x;},null);
__d('SoundSynchronizer',['SoundPlayer','WebStorage','createArrayFromMixed'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='fb_sounds_playing3';function i(){var m=c('WebStorage').getLocalStorage();if(m)try{var o=m[h];if(o){o=JSON.parse(o);if(Array.isArray(o))return o;}}catch(n){}return [];}function j(m){var n=c('WebStorage').getLocalStorage();if(n){var o=i();o.push(m);while(o.length>5)o.shift();try{n[h]=JSON.stringify(o);}catch(p){}}}function k(m){return i().some(function(n){return n===m;});}var l={play:function(m,n,o){m=c('createArrayFromMixed')(m);n=n||m[0]+Math.floor(Date.now()/1000);if(k(n))return;c('SoundPlayer').play(m,o);j(n);},isSupported:function(){return !!c('WebStorage').getLocalStorage();}};f.exports=l;},null);
__d('SoundRPC',['Event','FBJSON','SoundSynchronizer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(j,k,l){c('SoundSynchronizer').play(j,k,l);}var i={playLocal:h,playRemote:function(j,k,l,m){var n={name:'SoundRPC',data:{paths:k,sync:l,loop:m}};j.postMessage(c('FBJSON').stringify(n),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){c('Event').listen(window,'message',function(j){if(!/\.facebook.com$/.test(j.origin))return;var k={};try{k=c('FBJSON').parse(j.data);}catch(l){}if(k.name==='SoundRPC')h(k.data.paths,k.data.sync,k.data.loop);});}};f.exports=i;},null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','Visibility','isFacebookURI'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null,i=false,j={init:function(n){if(!h)c('SoundPlayer').init(n);},play:function(n,o,p){if(h){c('SoundRPC').playRemote(h.contentWindow,n,o,false);}else c('SoundRPC').playLocal(n,o,p);i=true;},hasPlayedSoundBefore:function(){return i;},playOnlyIfImmediate:function(n,o,p){if(!i&&c('Visibility').isHidden())return;this.play(n,o,p);},stop:function(n){if(!h)c('SoundPlayer').stop(n);}},k=new (c('URI'))(location.href);if(k.getSubdomain()&&k.getSubdomain()!=='www')k.setSubdomain('www');var l=k.getDomain();function m(){if(c('UserAgent_DEPRECATED').ie()<9)return false;if(c('SoundInitialData').RPC_DISABLED)return false;return c('SoundSynchronizer').isSupported()&&c('SoundRPC').supportsRPC();}if(c('isFacebookURI')(k)&&location.host!==l&&m()){h=document.createElement('iframe');h.setAttribute('src','//'+l+'/sound_iframe.php');h.style.display='none';document.body.appendChild(h);}f.exports=j;},null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','MercuryBlockedParticipants','MercuryConfig','MercuryGroupThreadMentions','MercuryThreadInfo','MercuryThreads','MercuryViewer','MessagingTag','Sound','UserActivity'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryBlockedParticipants').get(),i=c('MercuryThreads').get();c('Sound').init(['audio/ogg','audio/mpeg']);function j(){return !c('UserActivity').isOnTab()&&!c('UserActivity').hasBeenInactive();}function k(m){if(c('ChatOptions').getSetting('sound')&&!j())c('Sound').play([c('ChatConfig').get('sound.notif_ogg_url'),c('ChatConfig').get('sound.notif_mp3_url')],m,false);}var l={messageReceived:function(m){if(c('MercuryViewer').isViewer(m.author)||!m.is_unread||m.folder!=c('MessagingTag').INBOX&&m.folder!=c('MessagingTag').ARCHIVED)return;var n=m.thread_id,o=c('ChatActivity').isActive();if(o){var p=false;l.inform('before-alert',{threadID:n,cancelAlert:function(){p=true;}});}i.getThreadMeta(n,function(q){var r=c('MercuryThreadInfo').isMuted(q);c('MercuryGroupThreadMentions').messageMentionsViewer(m,function(s){if(r&&(!c('MercuryConfig').GroupChatMentionsGK||!s))return;if(h.isPresentInGroupThread(q))return;var t=m.timestamp;if(o){!p&&k(t);}else{c('ChatTitleBarBlinker').blink(n,t);k(t);}c('ChatTitleBarBlinker').blinkingElsewhere();});});}};f.exports=Object.assign(l,c('ArbiterMixin'));},null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=false,i=c('AvailableList').getWebChatNotification&&c('AvailableList').getWebChatNotification(),j=h,k=true,l=Object.assign(new (c('Arbiter'))(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return i!==c('ChatNotificationConstants').NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return j;},showsTabUnreadUI:function(){return k;}});function m(){l.inform(l.ON_CHANGED);}c('AvailableList').subscribe&&c('AvailableList').subscribe(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,function(){var n=i,o=c('AvailableList').getWebChatNotification();i=o;if(n!=o)m();});c('Arbiter').subscribe('chat/set_does_page_occlude_tabs',function(n,o){j=!!o;m();});c('Arbiter').subscribe('chat/set_show_tab_unread_ui',function(n,o){k=!!o;m();});f.exports=l;},null);
__d('ChatCookieInterface',['ChatConfig','InitialServerTime','MercuryIDs','LogHistory','PresenceState','PresenceUtil'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('chat_cookie'),i=c('InitialServerTime').serverTime,j=c('ChatConfig').get('tab_max_load_age')||3600000,k=i-j,l={store:function(p,q){if(p.uct2==q.lastChangeTime)return p;var r=o(p,q),s={};if(!r){s.old_tabs=p&&p.t2&&JSON.stringify(p.t2);s.old_promoted=p&&p.lm2;s.old_time=p&&p.uct2;s.old_reason=p&&p.tr;s.old_window=p&&p.tw;var t=[];q.tabs.forEach(function(u){if(!u.fragile||u.server_id){var v={i:u.fragile?c('MercuryIDs').getThreadIDFromThreadFBID(u.server_id):u.id,si:u.server_id};if(u.raised)v.r=1;t.push(v);}});p.t2=t;p.lm2=q.promotedID;p.uct2=q.lastChangeTime;p.tr=q.lastChangeReason;p.tw=c('PresenceUtil').getSessionID();h.debug('store','{}');}else h.warn('store_bad_state','{}');return p;},load:function(p,q){if(!p){h.warn('load_bad_state','{}');return false;}var r=o(p,q);if(!r||r===q.lastChangeTime)return false;q.lastChangeTime=r;q.lastChangeReason='load';var s=m(q,p.t2,p.lm2||null),event='load';if(!q.isInitialized)event+='_init';h.log(event,'{}');return s;},tabsChanged:function(){return n.apply(undefined,arguments);}};function m(p,q,r){var s;if(!n(p,q,r))return false;var t=p.tabs.filter(function(w){return !!w.fragile;}),u={};p.promotedID=null;p.tabs=q.map(function(w){var x={id:w.i,server_id:w.si};if(x.id==r)p.promotedID=x.id;if(w.r)x.raised=true;var y=t.find(function(z){return z.server_id&&z.server_id===x.server_id;});if(y){if(x.raised){y.raised=true;}else delete y.raised;t=t.filter(function(z){return !z.server_id||z.server_id!==x.server_id;});t.push(y);return null;}u[x.id]=x;return x;});p.tabs=p.tabs.filter(function(w){return !!w;});if(p.localRaised)for(var v in p.localRaised)if(!u[v]||!u[v].raised)delete p.localRaised[v];t=t.filter(function(w){return !u[w.id];});(s=p.tabs).push.apply(s,t);return true;}function n(p,q,r){if(r&&r!=p.promotedID)return true;var s=p.tabs.filter(function(v){return !v.fragile||v.server_id;});if(q.length!=s.length)return true;for(var t=0,u=q.length;t<u;t++)if(!!q[t].r!==s[t].raised||!q[t].si&&q[t].i!==s[t].id||q[t].si&&q[t].si!==s[t].server_id)return true;return false;}function o(p,q){var r=c('PresenceState').verifyNumber(p.uct2);if(!r||typeof r!=='number'){h.warn('bad_cookie_version','{}');return null;}if(r<q.lastChangeTime||r<k)return null;return r;}f.exports=l;},null);
__d('ChatTabModel',['Arbiter','ChatBehavior','ChatDispatcher','ChatConfig','ChatCookieInterface','ChatTabActions','EventEmitter','InitialServerTime','LogHistory','JSLogger','MercuryAssert','MercuryIDs','MercuryLocalIDs','MercuryThreadIDMap','MercuryThreads','MercuryTimestampTracker','PresenceState','PresenceUtil'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryThreads').get(),j=c('MercuryTimestampTracker').get(),k=c('InitialServerTime').serverTime,l=c('ChatConfig').get('tab_max_load_age')||3600000,m=20,n=new (c('EventEmitter'))(),o=c('LogHistory').getInstance('chat_tab_model'),p={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function q(ma){var na=c('ChatCookieInterface').load(ma,p);na&&u();return na;}function r(ma,na,oa){var pa=q(c('PresenceState').get());if(na===undefined||na>p.lastChangeTime){if(ma()){pa=true;p.lastChangeReason=oa||null;t(na);}}else o.error('rejected',JSON.stringify({change_time:na,state_time:p.lastChangeTime}));pa&&s();}function s(){if(p.isInitialized)n.emit('change');}function t(ma){if(ma===undefined)ma=Math.max(j.getLastUserMessageTimestamp()||1,p.lastChangeTime+1);p.lastChangeTime=ma;c('PresenceState').doSync();}function u(ma){var na=p.tabs.length-m;if(na>0)p.tabs=p.tabs.filter(function(oa){return oa.raised||oa.id==ma||na--<=0;});if(na>0)p.tabs=p.tabs.filter(function(oa){return (oa.id==p.promotedID||oa.id==ma||na--<=0);});}function v(ma){for(var na=0;na<p.tabs.length;na++)if(p.tabs[na].id==ma)return na;return -1;}function w(ma,na){var oa=i.getThreadMetaNow(ma);if(!oa)return false;if(oa.is_canonical_user){return z(ma,na);}else{var pa=y(ma);if(pa)h.getServerIDFromClientID(ma,function(qa){if(ca(ma,qa)){t();s();}});return pa;}}function x(ma){c('MercuryAssert').isThreadID(ma);if(y(ma))s();}function y(ma){if(v(ma)===-1){p.tabs.push({id:ma,fragile:true});o.log('open_fragile_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),opened:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function z(ma,na){var oa=v(ma);if(oa!=-1)if(p.tabs[oa].fragile){p.tabs.splice(oa,1);}else{na&&(p.tabs[oa].signatureID=na);return true;}for(var pa=0;pa<=p.tabs.length;pa++)if(pa==p.tabs.length||p.tabs[pa].fragile){p.tabs.splice(pa,0,{id:ma,signatureID:na});u(ma);o.log('open_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),opened:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}}function aa(ma,na,oa){c('MercuryAssert').isThreadID(ma);var pa=false;if(p.localRaised&&na){p.localRaised[ma]=true;pa=true;}r(function(){if(w(ma,oa))pa=true;var qa=v(ma);if(qa!=-1&&!p.tabs[qa].raised){p.tabs[qa].raised=true;pa=true;o.log('raise_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),raised:ma,window_id:c('PresenceUtil').getSessionID()}));}return pa;});}function ba(ma){if(v(ma)!==-1&&p.promotedID!==ma){p.promotedID=ma;return true;}return false;}function ca(ma,na){var oa=v(ma);if(oa!=-1&&p.tabs[oa].fragile){var pa=p.tabs[oa];pa.fragile=c('MercuryIDs').isLocalThread(ma);pa.server_id=na;var qa=[];p.tabs.forEach(function(ra){if(ra.id!=ma){if(pa&&ra.fragile){qa.push(pa);pa=null;}qa.push(ra);}});if(pa)qa.push(pa);p.tabs=qa;o.log('make_permanent',JSON.stringify({tabs:JSON.stringify(p.tabs),tab_id:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function da(ma,na){c('MercuryAssert').isThreadID(ma);var oa=false;if(p.localRaised){delete p.localRaised[ma];oa=true;}r(function(){if(ea(ma))oa=true;return oa;},undefined,na);}function ea(ma){var na=v(ma);if(ma==p.promotedID)p.promotedID=null;if(na!=-1){p.tabs.splice(na,1);o.log('close_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),closed:ma,window_id:c('PresenceUtil').getSessionID()}));return true;}return false;}function fa(){if(p.tabs.length){o.log('close_all_tabs',JSON.stringify({closed_tabs:JSON.stringify(p.tabs),window_id:c('PresenceUtil').getSessionID()}));p.tabs=[];p.promotedID=null;if(p.localRaised)p.localRaised={};t();s();}}function ga(){var ma=[];for(var na=0;na<p.tabs.length;na++)if(p.tabs[na].fragile&&!i.isNewEmptyLocalThread(p.tabs[na].id)){ma.push(p.tabs[na]);p.tabs.splice(na);s();break;}o.log('close_fragile_tabs',JSON.stringify({tabs:JSON.stringify(p.tabs),fragile_closed:ma,window_id:c('PresenceUtil').getSessionID()}));}function ha(ma){c('MercuryAssert').isThreadID(ma);var na=false;if(p.localRaised){delete p.localRaised[ma];na=true;}r(function(){var oa=v(ma);if(oa!=-1&&p.tabs[oa].raised){delete p.tabs[oa].raised;o.log('lower_tab',JSON.stringify({tabs:JSON.stringify(p.tabs),lowered:ma,window_id:c('PresenceUtil').getSessionID()}));na=true;}return na;});}function ia(){if(p.localRaised){r(function(){var ma=false;p.tabs.forEach(function(na){if(na.raised!=p.localRaised[na.id]){ma=true;if(p.localRaised[na.id]){na.raised=true;}else delete na.raised;}});return ma;});o.log('persist_local_raise',JSON.stringify({tabs:JSON.stringify(p.tabs),window_id:c('PresenceUtil').getSessionID()}));}}c('PresenceState').registerStateStorer(function(ma){return c('ChatCookieInterface').store(ma,p);});c('PresenceState').registerStateLoader(function(ma){if(q(ma))s();});var ja=null,ka={getDispatchToken:function(){return ja;},isTabPromoted:function(ma){if(ma)return ma==p.promotedID;return false;},indexOf:function(ma){return v(ma);},getTab:function(ma){c('MercuryAssert').isThreadID(ma);var na=this.indexOf(ma);if(na>-1){var oa=p.tabs[na];return babelHelpers['extends']({},oa);}return null;},getEmptyTab:function(){var ma;for(var na=0;na<p.tabs.length;na++){ma=p.tabs[na].id;if(i.isNewEmptyLocalThread(ma))return ma;}ma=c('MercuryLocalIDs').generateThreadID();i.createNewLocalThread(ma,[]);return ma;},get:function(){var ma=p.tabs.map(function(na){var oa=babelHelpers['extends']({},na);delete oa.fragile;if(p.localRaised)oa.raised=p.localRaised[oa.id];return oa;});return {tabs:ma,promoted:p.promotedID};},promoteThreadInPlaceOfThread:function(ma,na,oa,pa){c('MercuryAssert').isThreadID(ma);c('MercuryAssert').isThreadID(na);r(function(){var qa=v(ma),ra=v(na);if(pa){p.promotedID=ma;}else if(p.promotedID===na)return true;var sa=p.tabs[qa];if(oa){c('MercuryAssert').isThreadID(oa);var ta=v(oa),ua=p.tabs[ra];p.tabs[ra]=sa;p.tabs.splice(qa,1);p.tabs.splice(ta,0,ua);}else{p.tabs[qa]=p.tabs[ra];p.tabs[ra]=sa;}return true;});},addListener:function(ma){return n.addListener('change',ma);}};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ma,na){na.chat_tabs={promoted:p.promotedID,tabs:p.tabs.map(function(oa){return babelHelpers['extends']({},oa);}),time:p.lastChangeTime,max_load_age:l};});function la(){var ma=c('ChatBehavior').ignoresRemoteTabRaise();if(ma&&!p.localRaised){o.log('start_ignore_remote_raise','{}');p.localRaised={};s();}else if(!ma&&p.localRaised){o.log('stop_ignore_remote_raise','{}');p.localRaised=null;s();}}ja=c('ChatDispatcher').register(function(ma){switch(ma.actionType){case c('ChatTabActions').Types.CLOSE_TAB:da(ma.threadID,ma.reason);break;case c('ChatTabActions').Types.CLOSE_ALL_TABS:fa();break;case c('ChatTabActions').Types.CLOSE_FRAGILE_TABS:ga();break;case c('ChatTabActions').Types.LOWER_TAB:ha(ma.threadID);break;case c('ChatTabActions').Types.OPEN_FRAGILE_TAB:x(ma.threadID);break;case c('ChatTabActions').Types.OPEN_TAB:c('MercuryAssert').isThreadID(ma.threadID);r(function(){return w(ma.threadID);});break;case c('ChatTabActions').Types.PERSIST_LOCAL_STATE:ia();break;case c('ChatTabActions').Types.PROMOTE_TAB:c('MercuryAssert').isThreadID(ma.threadID);r(ba.bind(null,ma.threadID));break;case c('ChatTabActions').Types.RAISE_TAB:aa(ma.threadID,ma.userAction,ma.signatureID);break;}});c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,la);la();q(c('PresenceState').getInitial(),true);if(p.lastChangeTime===0)p.lastChangeTime=k-600000;p.isInitialized=true;f.exports=ka;},null);
__d('MessengerDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new (c('Dispatcher_DEPRECATED'))();},null);
__d('MercuryFilters',['MessagingTag','arrayContains'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=[c('MessagingTag').UNREAD],i={ALL:'all',UNREAD:c('MessagingTag').UNREAD,getSupportedFilters:function(){return h.concat();},isSupportedFilter:function(j){return c('arrayContains')(h,j);}};f.exports=i;},null);
__d('MessengerURIConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={COMPOSE_SUBPATH:'/new',GROUPS_PATH:'/groups',PEOPLE_PATH:'/people',FILTERED_REQUESTS_PATH:'/filtered',MESSAGE_REQUESTS_PATH:'/requests',THREAD_PREFIX:'/t/',GROUP_PREFIX:'group-'};f.exports=h;},null);
__d('MessengerStateProcessor',['MercuryAPIArgsSource','MercuryIDs','MercuryParticipantTypes','MercuryParticipants','MercuryThreadIDMap','MercuryThreads','MercuryVanityIDMap','MessengerURIConstants'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={preprocess:function(j){var k=j.activeThreadID;if(k){var l=c('MercuryIDs').getUserIDFromThreadID(k),m=l&&c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(l));if(m&&m.type!==c('MercuryParticipantTypes').EVENT){j.threadKey=m.vanity||l;}else if(l&&!m){var n=c('MercuryIDs').getParticipantIDFromUserID(l);j.threadKey=c('MercuryVanityIDMap').hasID(n)?c('MercuryVanityIDMap').getVanity(n):l;}else{var o=c('MercuryThreadIDMap').get(),p=o.getServerIDFromClientIDNow(k);j.threadKey=p||c('MercuryIDs').tokenize(k).value;}}delete j.activeThreadID;return j;},postprocess:function(j){var k=c('MercuryThreadIDMap').get(),l=c('MercuryThreads').get(),m=i(j.threadKey),n;n=c('MercuryIDs').isValid(m)?m:k.getClientIDFromServerIDNow(m);if(!n){var o=c('MercuryParticipants').getIDFromVanityOrFBID(m),p=o&&l.getCanonicalThreadToParticipant(o,null,c('MercuryAPIArgsSource').MESSENGER);if(p)n=p.thread_id;}if(n){j.activeThreadID=n;j.serverThreadID=k.getServerIDFromClientIDNow(n);}delete j.threadKey;return j;}};function i(j){if(!j)return null;return j.startsWith(c('MessengerURIConstants').GROUP_PREFIX)?j.substr(c('MessengerURIConstants').GROUP_PREFIX.length):j;}f.exports=h;},null);
__d('MessengerURISerializer',['MercuryFilters','MessagingTag','MessengerStateProcessor','MessengerURIConstants','MessengerView','URI','WWWBase'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='/?$',i={serialize:function(k){var l=new (c('URI'))(c('WWWBase').uri);k=c('MessengerStateProcessor').preprocess(k);switch(k.masterView){case c('MessengerView').MASTER.GROUPS:l.setPath(c('MessengerURIConstants').GROUPS_PATH);break;case c('MessengerView').MASTER.PEOPLE:l.setPath(c('MessengerURIConstants').PEOPLE_PATH);break;}switch(k.folder){case c('MessagingTag').OTHER:l.setPath(c('MessengerURIConstants').FILTERED_REQUESTS_PATH);break;case c('MessagingTag').PENDING:l.setPath(c('MessengerURIConstants').MESSAGE_REQUESTS_PATH);break;}if(k.detailView===c('MessengerView').DETAIL.COMPOSE){l.setPath(l.getPath()+c('MessengerURIConstants').COMPOSE_SUBPATH);}else if(k.threadKey)l.setPath(l.getPath()+c('MessengerURIConstants').THREAD_PREFIX+k.threadKey);if(c('MercuryFilters').isSupportedFilter(k.filter))l.addQueryData({filter:k.filter});return l;},deserialize:function(k){var l={},m=k.getPath();if(m.match('^'+c('MessengerURIConstants').GROUPS_PATH)){l.masterView=c('MessengerView').MASTER.GROUPS;}else if(m.match('^'+c('MessengerURIConstants').PEOPLE_PATH)){l.masterView=c('MessengerView').MASTER.PEOPLE;}else l.masterView=c('MessengerView').MASTER.RECENT;if(m.match('^'+c('MessengerURIConstants').FILTERED_REQUESTS_PATH)){l.folder=c('MessagingTag').OTHER;}else if(m.match('^'+c('MessengerURIConstants').MESSAGE_REQUESTS_PATH)){l.folder=c('MessagingTag').PENDING;}else l.folder=c('MessagingTag').INBOX;if(m.match(c('MessengerURIConstants').COMPOSE_SUBPATH+h)){l.detailView=c('MessengerView').DETAIL.COMPOSE;}else{var n=j(m);if(n){l.threadKey=n;l.detailView=c('MessengerView').DETAIL.THREAD;}}var o=k.getQueryData();if(c('MercuryFilters').isSupportedFilter(o.filter)){l.filter=o.filter;}else l.filter=c('MercuryFilters').ALL;return c('MessengerStateProcessor').postprocess(l);}};function j(k){var l=k.match(c('MessengerURIConstants').THREAD_PREFIX+'([^/]+)'+h);return l&&l[1];}f.exports=i;},null);
__d('MessengerActions',['MercuryIDs','MessengerDispatcher','MessengerURISerializer','MercuryTypeaheadConstants','MessengerView','URI','goURI','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({HIDE_DIALOG:null,REPLACE_STATE:null,SHOW_DIALOG:null}),i={Types:h,changeDetailView:function(k){j(function(l){if(l.detailView!==k)return {detailView:k};});},changeMasterView:function(k){j(function(l){if(l.masterView!==k)return {masterView:k};});},selectThread:function(k,l){if(l===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){var m=c('MercuryIDs').getUserIDFromThreadID(k),n=new (c('URI'))(),o=n.getQualifiedURI().getSubdomain();n.setDomain('facebook.com').setSubdomain(o).setPath('/'+m).setProtocol('https');window.open(n,'_blank');return;}j(function(p){if(p.activeThreadID!==k)return {activeThreadID:k,detailView:c('MessengerView').DETAIL.THREAD};});},changeState:function(k){c('MessengerDispatcher').dispatch({type:h.REPLACE_STATE,nextState:k});},showDialog:function(k,l){c('MessengerDispatcher').dispatch({type:i.Types.SHOW_DIALOG,dialogClass:k,dialogProps:l});},hideDialog:function(k){c('MessengerDispatcher').dispatch({type:i.Types.HIDE_DIALOG,dialogClass:k});},changeFolder:function(k){j(function(l){if(l.folder!==k)return {folder:k};});},changeFilter:function(k){j(function(l){if(l.filter!==k)return {filter:k};});}};function j(k){var l=c('MessengerURISerializer').deserialize(new (c('URI'))(window.location.href)),m=k(l);if(m)c('goURI')(c('MessengerURISerializer').serialize(Object.assign(l,m)));}f.exports=i;},null);
__d('MessengerHotLikePreviewEvents',['mixInEventEmitter'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={START:'start',STOP:'stop',POP:'pop',REMOVE:'remove',FINISH_ANIMATION:'finish_animation'};c('mixInEventEmitter')(h,{start:true,stop:true,pop:true,remove:'remove',finish_animation:'finish_animation'});f.exports=h;},null);
__d('MNCommerceActionTypes',['keyMirrorRecursive'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirrorRecursive')({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null},RETAIL_ITEM:{LOADED:null,LOAD_ERROR:null,RELOAD:null},PROMOTION_STATE:{LOADED:null,LOAD_ERROR:null,RELOAD:null}});f.exports=h;},null);
__d('MNCommerceDialogStateActions',['MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={showDialog:function(i,j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').DIALOG.SHOW,dialogContainer:i,state:j});},hideDialog:function(){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').DIALOG.HIDE});}};f.exports=h;},null);
__d('MNCommercePromotionStateActions',['MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={stateLoaded:function(i){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').PROMOTION_STATE.LOADED,state:i});},stateLoadError:function(i){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').PROMOTION_STATE.LOAD_ERROR,pageID:i});},stateReload:function(i){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').PROMOTION_STATE.RELOAD,pageID:i});}};f.exports=h;},null);
__d('MessengerContextBannerBootloader',['BootloadedComponent.react','CurrentUser','DOM','JSResource','React','ReactDOM'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(k,l,m,n,o){var p=c('DOM').create('div');i(k,l,function(q){c('ReactDOM').render(q,p,m(p));},n,o);}function i(k,l,m,n,o,p){p=babelHelpers['extends']({left:0,position:'absolute',right:0,top:0},p);j({otherUserFBIDs:n&&[n],threadID:k,style:p},l,m,o);}function j(k,l,m,n){m(c('React').createElement(c('BootloadedComponent.react'),babelHelpers['extends']({bootloadPlaceholder:c('React').createElement('div',{style:{height:80}}),bootloadLoader:c('JSResource')('MessengerContextBannerContainer.react'),location:l,onResize:n,viewer:c('CurrentUser').getID()},k)));}f.exports={bootload:h,getBootloadedComponent:i};},null);
__d('ContextualLayerAutoFlipHorizontal',['ContextualLayerAutoFlip'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('ContextualLayerAutoFlip'));i=h&&h.prototype;j.prototype.getValidPositions=function(k){'use strict';return [k.getPosition()];};function j(){'use strict';h.apply(this,arguments);}f.exports=j;},null);
__d('MessengerContextualDialog.react',['cx','ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=12,j=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal'),c('LayerHideOnEscape')],displayName:'MessengerContextualDialog',shouldSetARIAProperties:false,theme:{wrapperClassName:"_1r_9",arrowDimensions:{offset:i,length:16}}}));f.exports=j;},null);
__d("XMNCommercePromotionBlockController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/promotion\/block\/",{page_id:{type:"String",required:true},type:{type:"String",required:true}});},null);
__d('MNCommercePromotionBlockDataManager',['AsyncRequest','MNCommercePromotionStateActions','XMNCommercePromotionBlockController'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.prototype.block=function(i,j){var k=c('XMNCommercePromotionBlockController').getURIBuilder().setString('page_id',i).setString('type',j).getURI();new (c('AsyncRequest'))().setURI(k).setHandler(this.$MNCommercePromotionBlockDataManager1).setErrorHandler(this.$MNCommercePromotionBlockDataManager2).send();};h.prototype.$MNCommercePromotionBlockDataManager1=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MNCommercePromotionStateActions').stateReload(k);};h.prototype.$MNCommercePromotionBlockDataManager2=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MNCommercePromotionStateActions').stateLoadError(k);};function h(){}f.exports=new h();},null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}j.prototype.__onDispatch=function(k){var l=k.type;switch(l){case c('MNCommerceActionTypes').DIALOG.SHOW:this.$MNCommerceDialogStateStore1=k.dialogContainer;this.$MNCommerceDialogStateStore2=k.state;this.__emitChange();break;case c('MNCommerceActionTypes').DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};j.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};j.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new j();},null);
__d('FBRTCLogger',['Log','LogHistory','MarauderLogger','formatDate','pageID'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='webrtc',i='sent_message',j='received_message',k='send_succeeded',l='send_failed',m='info',n='call_action',o='client_event',p='client_error',q='type',r='msg_id',s='ack_msg_id',t='call_id',u='from',v='to',w='content',x='tag',y='peer_id',z='error_code',aa='trigger',ba='endcallstats',ca=null;da.getInstance=function(){'use strict';if(!ca)ca=new da();return ca;};function da(){'use strict';this.$FBRTCLogger1=c('LogHistory').getInstance(h);}da.prototype.logToConsole=function(ea){'use strict';var fa='Console';this.$FBRTCLogger2(null,null,fa,ea);this.$FBRTCLogger1.log(fa,ea);};da.prototype.logReceivedMessage=function(ea,fa,ga){'use strict';var ha={};ha[u]=ea;ha[t]=fa;ha[q]=ga.type;ha[r]=ga.msg_id;if(ga.sdp)ha[w]=ga.sdp;if(ga.ack_id)ha[s]=ga.ack_id;this.$FBRTCLogger3(j,ha);this.$FBRTCLogger2(ea,fa,'Received',ga.type+', '+ga.msg_id);};da.prototype.logSentMessage=function(ea,fa,ga){'use strict';var ha={};ha[v]=ea;ha[t]=fa;ha[q]=ga.type;ha[r]=ga.msg_id;if(ga.sdp)ha[w]=ga.sdp;if(ga.ack_id)ha[s]=ga.ack_id;this.$FBRTCLogger3(i,ha);this.$FBRTCLogger2(ea,fa,'Sent',ga.type+', '+ga.msg_id);};da.prototype.logSentMessageSuccess=function(ea,fa,ga,ha){'use strict';var ia={};ia[y]=ea;ia[t]=fa;ia[q]=ga;ia[r]=ha;this.$FBRTCLogger3(k,ia);};da.prototype.logSentMessageFailure=function(ea,fa,ga,ha,ia){'use strict';var ja={};ja[y]=ea;ja[t]=fa;ja[q]=ga;ja[r]=ha;ja[z]=ia;this.$FBRTCLogger3(l,ja);this.$FBRTCLogger2(ea,fa,'Send Failed',ga+', '+ia);};da.prototype.logCallAction=function(ea,fa,ga,ha,ia){'use strict';var ja={};ja[y]=ea;ja[t]=fa;ja[n]=ga;ja[w]=ha;if(ia)ja[aa]=ia;this.$FBRTCLogger3(n,ja);this.$FBRTCLogger2(ea,fa,'CallAction',ga+', '+ha);};da.prototype.logEvent=function(ea,fa,event){'use strict';var ga={};ga[y]=ea;ga[t]=fa;ga[w]=event;this.$FBRTCLogger3(o,ga);this.$FBRTCLogger2(ea,fa,'Event',event);};da.prototype.logInfo=function(ea,fa,ga){'use strict';var ha={};ha[y]=ea;ha[t]=fa;ha[w]=ga;this.$FBRTCLogger3(m,ha);this.$FBRTCLogger2(ea,fa,'Info',ga);};da.prototype.logError=function(ea,fa,ga){'use strict';var ha={};ha[y]=ea;ha[t]=fa;ha[w]=ga;this.$FBRTCLogger3(p,ha);this.$FBRTCLogger2(ea,fa,'Error',ga);};da.prototype.logErrorWithoutID=function(ea){'use strict';this.logError(null,null,ea);};da.prototype.logEndCallSummary=function(ea){'use strict';if(!ea)return;var fa={};fa[y]=ea.peerID;fa[t]=ea.callID;fa[x]=ba;fa[w]=ea.toString();var ga=ea.getExtraInfo();for(var ha in ga)if(ga.hasOwnProperty(ha))fa[ha]=ga[ha];this.$FBRTCLogger3(m,fa);this.$FBRTCLogger2(ea.peerID,ea.callID,'Call Summary',fa);};da.prototype.$FBRTCLogger3=function(ea,fa){'use strict';fa.page_id=c('pageID');this.$FBRTCLogger1.log(ea,fa);c('MarauderLogger').log(ea,h,fa);};da.prototype.$FBRTCLogger2=function(ea,fa,ga,ha){'use strict';};da.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};da.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown',RESET_CALL:'install_screen_sharing_ext_dialog'};da.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};f.exports=da;},null);
__d('FBRTCLocalMessageQueue',['CacheStorage','FBRTCLogger','Map','RTCConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='localstorage',i='RTC_',j='offer',k='offer_msg',l='data_',m=30*1000,n=15*1000,o=500,p=new (c('Map'))();function q(){'use strict';this.$FBRTCLocalMessageQueue1=c('FBRTCLogger').getInstance();}q.prototype.enqueueOffer=function(r,s){'use strict';var t=this.$FBRTCLocalMessageQueue2(r,k);this.$FBRTCLocalMessageQueue3(t,j,s);};q.prototype.getOffer=function(r){'use strict';var s=this.$FBRTCLocalMessageQueue2(r,k);return this.$FBRTCLocalMessageQueue4(s,j);};q.prototype.removeOffer=function(r){'use strict';var s=this.$FBRTCLocalMessageQueue2(r,k);s.remove(j);};q.prototype.enqueueMessage=function(r,s,t,u){'use strict';var v=l+t.toString(),w=p.get(r)||new (c('Map'))();w.set(v,u);p.set(r,w);this.$FBRTCLocalMessageQueue1.logToConsole('Queued '+v);};q.prototype.drainQueue=function(r,s){'use strict';var t=p.get(r)||new (c('Map'))(),u,v;for(var w=t,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){if(x){if(y>=w.length)break;var z=w[y++];u=z[0];v=z[1];}else{y=w.next();if(y.done)break;var aa=y.value;u=aa[0];v=aa[1];}void u;s(v);}p.set(r,new (c('Map'))());};q.prototype.enableDequeuing=function(r,s,t,u){'use strict';if(u===undefined)u=n;this.$FBRTCLocalMessageQueue5(r,s,t,u);};q.prototype.$FBRTCLocalMessageQueue5=function(r,s,t,u){'use strict';var v=this.$FBRTCLocalMessageQueue2(r,s),w=v.keys(),x=w.length;for(var y=0;y<x;y++){var z=this.$FBRTCLocalMessageQueue6(v,w[y]);if(z&&t)t(z);}this.$FBRTCLocalMessageQueue1.logToConsole('Dequeued '+x+' ('+r+') with '+u+' left)');if(u>0){u-=o;setTimeout(function(){this.$FBRTCLocalMessageQueue5(r,s,t,u);}.bind(this),o);}};q.prototype.$FBRTCLocalMessageQueue3=function(r,s,t){'use strict';var u={__t:Date.now(),__d:t};r.set(s,u);};q.prototype.$FBRTCLocalMessageQueue4=function(r,s){'use strict';var t=r.get(s);if(t&&this.$FBRTCLocalMessageQueue7(t)){return t.__d;}else if(t)r.remove(s);return null;};q.prototype.$FBRTCLocalMessageQueue6=function(r,s){'use strict';var t=this.$FBRTCLocalMessageQueue4(r,s);if(t!==null){r.remove(s);return t;}return null;};q.prototype.$FBRTCLocalMessageQueue7=function(r){'use strict';return Date.now()-r.__t<m;};q.prototype.$FBRTCLocalMessageQueue2=function(r,s){'use strict';return new (c('CacheStorage'))(h,''+i+r+'_'+s+'_');};f.exports=q;},null);
__d('FBRTCCallControlActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({ACCEPT_ESCALATION:null,HANG_UP:null,PARENT_WINDOW_START_CALL:null,TOGGLE_FULL_SCREEN:null,TOGGLE_MUTE_AUDIO:null,TOGGLE_MUTE_VIDEO:null,TOGGLE_SCREEN_SHARING:null,TOGGLE_SELF_VIEW:null,SHOW_SETTINGS:null,START_CALL:null,DECLINE_ESCALATION:null,RECEIVED_SIGNALING_MESSAGE:null,RESET_CALL:null,OPEN_SCREEN_IN_NEW:null,CLOSE_STANDALONE_SCREEN:null}),i={Types:h,hangUp:function(){c('FBRTCDispatcher').dispatch({type:h.HANG_UP});},toggleMuteAudio:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_MUTE_AUDIO});},toggleMuteVideo:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_MUTE_VIDEO});},toggleFullScreen:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_FULL_SCREEN});},toggleSelfView:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_SELF_VIEW});},showSettings:function(){c('FBRTCDispatcher').dispatch({type:h.SHOW_SETTINGS});},toggleScreenSharing:function(){c('FBRTCDispatcher').dispatch({type:h.TOGGLE_SCREEN_SHARING});},startCall:function(){c('FBRTCDispatcher').dispatch({type:h.START_CALL});},openScreenInNewWindow:function(){c('FBRTCDispatcher').dispatch({type:h.OPEN_SCREEN_IN_NEW});},receivedSignalingMessage:function(j){c('FBRTCDispatcher').dispatch({type:h.RECEIVED_SIGNALING_MESSAGE,message_type:j.msgType,message:j});},acceptEscalation:function(){c('FBRTCDispatcher').dispatch({type:h.ACCEPT_ESCALATION});},declineEscalation:function(){c('FBRTCDispatcher').dispatch({type:h.DECLINE_ESCALATION});},resetCall:function(j){c('FBRTCDispatcher').dispatch({type:h.RESET_CALL,trigger:j});},parentWindowStartCall:function(){c('FBRTCDispatcher').dispatch({type:h.PARENT_WINDOW_START_CALL});}};f.exports=i;},null);
__d('FBRTCMessageListener',['invariant','Arbiter','ChannelConstants','FBRTCCallControlActions','FBRTCLocalMessageQueue','FBRTCSupport','RTCConfig','guid','mixInEventEmitter'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=45*1000,j='rtc_child_window_ready',k='rtc_child_window_start_call',l='rtc_child_window_message',m=[],n=null,o=null,p=null,q=null,r=null,s=false,t=null,u={init:function(v,w){if(s)return;s=true;c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('webrtc'),function(y,z){this._onMessage(z.obj);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('webrtc_offer'),function(y,z){this._onMessage(z.obj);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('webrtc_offerack'),function(y,z){this._onMessage(z.obj);}.bind(this));if(c('RTCConfig').RtcConferencingGK)c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('rtc_multi_json'),function(y,z){this._onMultiwayMessage(z.obj);}.bind(this));this._localMessageQueue=new (c('FBRTCLocalMessageQueue'))();if(c('RTCConfig').PassMessagesBetweenWindowsGK){if(c('FBRTCSupport').isWebrtcSupported()&&window.addEventListener){var x=v?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener('message',x,false);}if(v)this._connectToParentWindow(w);}},setParentWindowNonce:function(v){q=v;},generateNewNonce:function(){r=c('guid')();return r;},setMultiwayMessageHandler:function(v,w){!!t?h(0):undefined;t=w?v.bind(w):v;},_onMultiwayMessage:function(v){this.emit('multiwayMessageReceived',v);if(t)t(v);},setMessageHandler:function(v,w){!!n?h(0):undefined;n=w?v.bind(w):v;while(m.length)n(m.shift());},removeMessageHandler:function(){n=null;},_onMessage:function(v){this.emit('messageReceived',v);if(n){n(v);}else m.push(v);this._passMessageToChildWindow(v);},_connectToParentWindow:function(v){if(window.opener&&window.opener.postMessage){var w={type:j,nonce:q,childNonce:this.generateNewNonce(),peerID:v};window.opener.postMessage(w,window.location.origin);}},_verifyWindowMessage:function(event){return event.origin===window.location.origin&&event.data&&r&&event.data.nonce===r;},_handleWindowMessageToParent:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===j){this.setParentWindowNonce(event.data.childNonce);this._setChildWindow(event.source);this._replayQueuedMessagesToChild(event.data.peerID,o);}},_handleWindowMessageToChild:function(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===l)this._onMessage(event.data.message);if(event.data.type===k)c('FBRTCCallControlActions').parentWindowStartCall();},_replayQueuedMessagesToChild:function(v,w){this._localMessageQueue.drainQueue(v,function(x){var y={type:l,nonce:q,message:x};w.postMessage(y,window.location.origin);});},_setChildWindow:function(v){o=v;clearTimeout(p);p=setTimeout(function(){o=null;},i);this._startCallInChildWindow();this.generateNewNonce();},_passMessageToChildWindow:function(v){if(o){var w={type:l,nonce:q,message:v};o.postMessage(w,window.location.origin);}},_startCallInChildWindow:function(){if(o){var v={type:k,nonce:q};o.postMessage(v,window.location.origin);}}};c('mixInEventEmitter')(u,{messageReceived:true,multiwayMessageReceived:true});f.exports=u;},null);
__d('FBRTCMessageHandler',['invariant','Bootloader','FBRTCMessageListener','FBRTCSupport'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=null,j=false,k=null,l={init:function(){if(!j&&c('FBRTCSupport').isReceiveWebrtcSupported()){j=true;c('FBRTCMessageListener').init(false);c('FBRTCMessageListener').once('messageReceived',function(o){m();});c('FBRTCMessageListener').once('multiwayMessageReceived',function(o){n();});}},resetListener:function(){!i?h(0):undefined;c('FBRTCMessageListener').removeMessageHandler();c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);}};function m(){if(!i)c('Bootloader').loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(o,p,q,r){i=new o(p,r,new q());c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);});}function n(){if(!k)c('Bootloader').loadModules(["FBRTCGroupCallIncomingController"],function(o){k=new o();c('FBRTCMessageListener').setMultiwayMessageHandler(k.onMessageReceived,k);});}f.exports=l;},null);
__d('HotLikeSound',['MercuryConfig','SoundPlayer','StickerConstants'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();c('SoundPlayer').init(['audio/ogg','audio/mpeg']);var h=[c('MercuryConfig')['sound.hot_like_grow_mp3_url'],c('MercuryConfig')['sound.hot_like_grow_ogg_url']],i=[c('MercuryConfig')['sound.hot_like_pop_mp3_url'],c('MercuryConfig')['sound.hot_like_pop_ogg_url']],j=[c('MercuryConfig')['sound.hot_like_outgoing_small_mp3_url'],c('MercuryConfig')['sound.hot_like_outgoing_small_ogg_url']],k=[c('MercuryConfig')['sound.hot_like_outgoing_medium_mp3_url'],c('MercuryConfig')['sound.hot_like_outgoing_medium_ogg_url']],l=[c('MercuryConfig')['sound.hot_like_outgoing_large_mp3_url'],c('MercuryConfig')['sound.hot_like_outgoing_large_ogg_url']],m=function(){return false;},n={setCheckSoundEnabledFunc:function(o){m=o;},start:function(){this._play(h);},stop:function(){c('SoundPlayer').stop(h);},pop:function(){this.stop();this._play(i);},snap:function(o){this.stop();if(o===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID)this._play(j);if(o===c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID)this._play(k);if(o===c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID)this._play(l);},_play:function(o){if(m())c('SoundPlayer').play(o);}};f.exports=n;},null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('MercuryActionStatus').SUCCESS;h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(o){'use strict';return l.getForFBID(o);};k.get=function(){'use strict';return l.get();};function k(o){'use strict';i.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=o;this.$MercuryRoger4=c('MercuryDispatcher').getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=c('MercuryThreads').getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',function(p,q){for(var r in q){var s=this.$MercuryRoger1[r]||c('immutable').OrderedMap();s=s.withMutations(function(t){for(var u in q[r]){var v=this.$MercuryRoger5.getThreadMetaNow(r);if(v&&v.participants)if(v.participants.indexOf(u)==-1){this.$MercuryRoger2.push(n(this.$MercuryRoger1));continue;}var w=t.get(u),x=q[r][u];if(!w||x>w)t.set(u,x);}}.bind(this));this.$MercuryRoger1[r]=s.sort();}q&&this.inform('change',q);}.bind(this));this.$MercuryRoger4.subscribe('invalidate-global-state',function(){this.$MercuryRoger6();}.bind(this));c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(p,q){var r={};for(var s in this.$MercuryRoger1)if(this.$MercuryRoger1.hasOwnProperty(s))r[s]=this.$MercuryRoger1[s].toObject();q.read_receipts={valid_receipts:r,bad_receipts:this.$MercuryRoger2};}.bind(this));}k.prototype.getSeenBy=function(o,p){'use strict';if(!o)return [];var q=[],r=this.$MercuryRoger1[o.thread_id];if(!r)return q;r.forEach(function(s,t){if(m(o,s,t,p))q.push(t);});return q;};k.prototype.wasSeenByAll=function(o){'use strict';if(!o)return false;var p=this.$MercuryRoger1[o.thread_id];if(!p)return false;return p.every(function(q,r){return m(o,q,r);});};k.prototype.getSeenTimestamps=function(o){'use strict';var p=this.$MercuryRoger1[o];if(!p){p=c('immutable').OrderedMap();this.$MercuryRoger1[o]=p;}return p;};k.prototype.getSeenTimestamp=function(o,p){'use strict';var q=this.$MercuryRoger1[o];return q?q.get(p):null;};k.prototype.$MercuryRoger6=function(){'use strict';this.$MercuryRoger1={};this.$MercuryRoger2=[];};var l=new (c('MercurySingletonProvider'))(k);function m(o,p,q,r){return !!(p>=o.timestamp&&(o.status===undefined||o.status===j)&&(!r||q!=o.author));}function n(o){return c('mapObject')(o,function(p){return p.toJS();});}f.exports=k;},null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','MercuryMessages','MercuryRoger','MercuryThreadInformer','MercuryThreads','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryMessages').get(),i=c('MercuryRoger').get(),j=c('MercuryThreadInformer').get(),k=c('MercuryThreads').get(),l={},m={},n=c('MercuryConfig')['roger.seen_delay'],o={getSeenBy:function(u,v){if(m[u])return [];return i.getSeenBy(p(u),v);},wasSeenByAll:function(u){if(m[u])return false;return i.wasSeenByAll(p(u));}};Object.assign(o,c('ArbiterMixin'));function p(u){if(!l[u]){var v=k.getThreadMetaNow(u);if(v)l[u]={thread_id:u,author:v.participants[0],timestamp:v.timestamp};}return l[u];}function q(u){var v=false;h.getThreadMessagesRange(u,0,1,function(w){var x=w[0];if(!x)return;var y=x.timestamp;if(x.status===c('MercuryActionStatus').SUCCESS)y-=c('LiveTimer').getServerTimeOffset();var z=o.getSeenBy(u);if(m[u]){clearTimeout(m[u]);delete m[u];}var aa=y+n,ba=aa-Date.now();if(ba>0)m[u]=c('setTimeoutAcrossTransitions')(function(){delete m[u];r(u);},ba);l[u]=x;var ca=o.getSeenBy(u);if(z.length||ca.length)v=true;});return v;}function r(u){var v={};v[u]=true;s(v);}function s(u){o.inform('state-changed',u);o.inform('change');}function t(event,u){var v={};for(var w in u)if(q(w))v[w]=true;for(var x in v){s(v);break;}}i.subscribe('change',function(u,v){for(var w in v)!m[w]&&r(w);});j.subscribe('messages-received',t);j.subscribe('messages-reordered',t);j.subscribe('messages-updated',t);f.exports=o;},null);
__d('MercuryTypingReceiver',['Arbiter','ChannelConstants','FBID','MercuryActionType','MercuryIDs','MercuryPayloadSource','MercuryDispatcher','MercurySingletonMixin','MercuryThreadIDMap','MercuryViewer','TypingStates','isEmpty','mixInEventEmitter','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=30000;function j(k){'use strict';this.$MercuryTypingReceiver1=null;this.$MercuryTypingReceiver2={};this.$MercuryTypingReceiver3=c('MercuryDispatcher').getForFBID(k);this.$MercuryTypingReceiver3.subscribe('update-typing-state',function(m,n){var o=n.payload_source;if(o!=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)return;var p=n.actions;if(!p||!p.length)return;var q=c('MercuryActionType').USER_GENERATED_MESSAGE;p.forEach(function(r){if(r.action_type==q&&r.author!=c('MercuryViewer').getID())this.$MercuryTypingReceiver4(r.thread_id,r.author);}.bind(this));}.bind(this));var l;if(c('FBID').isUser(k)){l=[c('ChannelConstants').getArbiterType('typ'),c('ChannelConstants').getArbiterType('ttyp')];}else l=[c('ChannelConstants').getArbiterType('page_typing')];c('Arbiter').subscribe(l,function(m,n){var o=n.obj,p=this.$MercuryTypingReceiver5(o);if(p){var q=c('MercuryIDs').getParticipantIDFromUserID(o.from);if(o.st==c('TypingStates').TYPING){this.$MercuryTypingReceiver2[p]=this.$MercuryTypingReceiver2[p]||{};var r=this.$MercuryTypingReceiver2[p][q];this.$MercuryTypingReceiver2[p][q]=Date.now();if(!this.$MercuryTypingReceiver1)this.$MercuryTypingReceiver1=c('setTimeoutAcrossTransitions')(function(){this.$MercuryTypingReceiver6();}.bind(this),3000);!r&&this.$MercuryTypingReceiver7(p);}else if(o.st==c('TypingStates').INACTIVE)this.$MercuryTypingReceiver4(p,q);}}.bind(this));}j.prototype.$MercuryTypingReceiver8=function(k){'use strict';var l=this.$MercuryTypingReceiver2[k]||{},m=Object.keys(l);m.sort(function(n,o){return l[n]-l[o];});return m;};j.prototype.$MercuryTypingReceiver6=function(){'use strict';this.$MercuryTypingReceiver1=null;var k=Date.now(),l={},m=false;for(var n in this.$MercuryTypingReceiver2){var o=false;for(var p in this.$MercuryTypingReceiver2[n]||{})if(this.$MercuryTypingReceiver2[n][p]<k-i){delete this.$MercuryTypingReceiver2[n][p];o=true;}else m=true;if(o)l[n]=this.$MercuryTypingReceiver8(n);}if(!c('isEmpty')(l))this.$MercuryTypingReceiver9(l);if(m)this.$MercuryTypingReceiver1=c('setTimeoutAcrossTransitions')(function(){this.$MercuryTypingReceiver6();}.bind(this),3000);};j.prototype.$MercuryTypingReceiver4=function(k,l){'use strict';if(k in this.$MercuryTypingReceiver2)if(l in this.$MercuryTypingReceiver2[k]){delete this.$MercuryTypingReceiver2[k][l];this.$MercuryTypingReceiver7(k);}};j.prototype.$MercuryTypingReceiver9=function(k){'use strict';this.releaseHeldEventType('state-changed');this.emitAndHold('state-changed',k);};j.prototype.$MercuryTypingReceiver7=function(k){'use strict';var l={};l[k]=this.$MercuryTypingReceiver8(k);this.$MercuryTypingReceiver9(l);};j.prototype.$MercuryTypingReceiver5=function(k){'use strict';if(k.thread_fbid)return h.getClientIDFromServerIDNow(k.thread_fbid.toString());if(k.type==='typ'||k.type==='page_typing')return c('MercuryIDs').getThreadIDFromUserID(k.from);return null;};c('mixInEventEmitter')(j,{'state-changed':true});Object.assign(j,c('MercurySingletonMixin'));f.exports=j;},null);
__d('MercuryIndicatorController',['fbt','ArbiterMixin','DOM','MercuryActionType','MercuryDelayedRoger','MercuryIDs','MercuryMessageSourceTags','MercuryParticipants','MercuryRoger','MercuryThreads','MercuryTypingReceiver','MercuryViewer','WorkModeConfig','arrayContains','formatDate','removeFromArray'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryRoger').get(),j=c('MercuryThreads').get(),k=c('MercuryTypingReceiver').get(),l=[];function m(n){this._threadID=n;this._canonicalUser=c('MercuryIDs').getUserIDFromThreadID(n);l.push(this);}Object.assign(m.prototype,c('ArbiterMixin'),{destroy:function(){c('removeFromArray')(l,this);},setLastMessage:function(n){this._lastMsg=n;this._handleStateChange();},_informStateChanged:function(n){if(n.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&c('MercuryViewer').isViewer(this._lastMsg.author))n.self_authored=true;this._currentActivity=n.activity;this.inform('state-changed',n);},_notifySentFrom:function(){var n,o,p=this._lastMsg.source_tags||[];if(c('arrayContains')(p,c('MercuryMessageSourceTags').MESSENGER)){if(!c('WorkModeConfig').is_work_user){n=c('DOM').create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},h._("Sent from Messenger"));}else n=c('DOM').create('a',{href:'/mobile','class':'fcg',target:'_blank'},h._("Sent from Work Chat"));o='sentFromMobile';}else if(c('arrayContains')(p,c('MercuryMessageSourceTags').MOBILE)){n=c('DOM').create('a',{href:'/mobile','class':'fcg',target:'_blank'},h._("Sent from Mobile"));o='sentFromMobile';}else if(c('arrayContains')(p,c('MercuryMessageSourceTags').EMAIL)){n=h._("Sent from email");o='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:o,text:n});},_notifySeenTimestamp:function(n){var o=i.getSeenTimestamp(this._threadID,n[0])*.001,p=Date.now()*.001,q;if(o<p-518400){q='M j';}else if(o<p-86400){q='D g:ia';}else q='g:ia';this._informStateChanged({activity:'seen-timestamp',text:h._("Seen {timestamp}",[h.param('timestamp',c('formatDate')(o,q))])});},_nameNormalizer:function(n){var o;c('MercuryParticipants').getMulti(n,function(p){function q(s){if(p[s]!==undefined&&p[s].short_name){return p[s].short_name.toLowerCase();}else return s;}var r=n.map(q);o=function(s){var t=q(s),u=r.indexOf(t)!==r.lastIndexOf(t);return u?p[s].name:p[s].short_name;};});return o;},_seenByEveryone:function(n,o,p){var q=p?p.participants.length:0,r=n.length;if(o.author!=c('MercuryViewer').getID()&&(!p||p.participants.indexOf(o.author)>-1))r++;return q>2&&r>=q-1;},_notifySeenBy:function(n){var o=this._lastMsg,p=true;c('MercuryParticipants').getMulti(n,function(q){p=false;if(this._lastMsg!=o)return;var r=j.getThreadMetaNow(this._threadID),s=null;if(r&&r.custom_nickname)s=r.custom_nickname;var t=[];for(var u in q){var v=q[u],w=v.short_name;if(s&&s[v.fbid])w=s[v.fbid];t[u]=w;}var x,y=false;if(this._seenByEveryone(n,o,r)){x=h._("Seen by everyone");}else if(n.length==1){x=h._("Seen by {user}",[h.param('user',t[n[0]])]);}else if(n.length==2){x=h._("Seen by {user1}, {user2}",[h.param('user1',t[n[0]]),h.param('user2',t[n[1]])]);}else if(n.length==3){x=h._("Seen by {user1}, {user2}, {user3}",[h.param('user1',t[n[0]]),h.param('user2',t[n[1]]),h.param('user3',t[n[2]])]);}else if(n.length>3){var z=Object.keys(q).length-2,aa=h._({"*":"{num} more"},[h.param('num',z,[0])]),ba=c('DOM').create('span',{className:'more'},aa);x=h._("Seen by {user1}, {user2}, {=num more link}",[h.param('user1',t[n[0]]),h.param('user2',t[n[1]]),h.param('=num more link',ba)]);y=true;}this._informStateChanged({activity:'seen-by',text:x,seenBy:n,tooltip:y});}.bind(this));p&&this._informStateChanged({activity:'none'});},_notifyTyping:function(n){var o=this._lastMsg,p=true;c('MercuryParticipants').getMulti(n,function(q){p=false;if(this._lastMsg!=o)return;var r=j.getThreadMetaNow(this._threadID),s=r?r.participants.length:0,t;if(r)t=this._nameNormalizer(r.participants);if(!t)t=function(z){return q[z].short_name;};var u,v=false;if(s>2&&n.length>=s-1){u=h._("Everyone is typing...");}else if(n.length==1){u=h._("{name} is typing...",[h.param('name',q[n[0]].short_name)]);}else if(n.length==2){u=h._("{user1} and {user2} are typing...",[h.param('user1',q[n[0]].short_name),h.param('user2',q[n[1]].short_name)]);}else if(n.length==3){u=h._("{user1}, {user2}, and {user3} are typing...",[h.param('user1',q[n[0]].short_name),h.param('user2',q[n[1]].short_name),h.param('user3',q[n[2]].short_name)]);}else if(n.length>3){var w=Object.keys(q).length-2,x=h._({"*":"{num} more"},[h.param('num',w,[0])]),y=c('DOM').create('a',{href:'#'},x);u=h._("{user1}, {user2}, and {=num more link} are typing...",[h.param('user1',q[n[0]].short_name),h.param('user2',q[n[1]].short_name),h.param('=num more link',y)]);v=true;}this._informStateChanged({activity:'typing',text:u,typing:n,tooltip:v});}.bind(this));p&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var n=c('MercuryActionType').LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==n){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=c('MercuryViewer').getID()){this._notifySentFrom();return;}var o=c('MercuryDelayedRoger').getSeenBy(this._threadID,true);if(o.length)if(this._canonicalUser){this._notifySeenTimestamp(o);return;}else{this._notifySeenBy(o);return;}this._informStateChanged({activity:'none'});}});k.addRetroactiveListener('state-changed',function(n){l.forEach(function(o){var p=n[o._threadID];if(p!==undefined){o._typing=p;o._handleStateChange();}});});c('MercuryDelayedRoger').subscribe('state-changed',function(n,o){l.forEach(function(p){o[p._threadID]&&p._handleStateChange();});});f.exports=m;},null);
__d('MercuryLastMessageIndicator.react',['cx','DOM','MercuryIndicatorController','MercuryParticipants','React','ReactDOM','TooltipData','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryLastMessageIndicator',propTypes:{hideTyping:i.bool,indicatorWillShow:i.func,indicatorDidShow:i.func,lastMessage:i.object,threadID:i.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:c('emptyFunction'),indicatorDidShow:c('emptyFunction')};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(k){if(k.threadID!=this.props.threadID){this._destroy();this._setup(k);}else if(k.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(k.lastMessage);},componentWillUpdate:function(k,l){if(this.isVisible(k,l))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (c('React').createElement('div',{className:this.getRootClass()},c('React').createElement('div',{className:"_510h"}),c('React').createElement('span',{className:"_510f",ref:'text'},'')));},getRootClass:function(){var k="_510g"+(this.state.data.self_authored?' '+"_510e":''),l=this.state.data.activity,m=null;if(String(l).startsWith('seen')){m='seen';}else if(l=='typing'){m=this.props.hideTyping?null:l;}else m=l;return c('joinClasses')(k,m,this.props.className);},isVisible:function(k,l){k=k||this.props;l=l||this.state;return (l.data&&l.data.activity!='none'&&!(k.hideTyping&&l.data.activity=='typing'));},setText:function(){if(this.state.data.text)c('DOM').setContent(c('ReactDOM').findDOMNode(this.refs.text),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)c('MercuryParticipants').getMulti(this.state.data.seenBy,function(k){var l=c('DOM').create('div',null,this.state.data.seenBy.map(function(m){return c('DOM').create('div',null,k[m].name);}));c('TooltipData').set(c('DOM').find(c('ReactDOM').findDOMNode(this),'span.more'),l,'above','center');}.bind(this));},_setup:function(k){this._controller=new (c('MercuryIndicatorController'))(k.threadID);this._subscription=this._controller.subscribe('state-changed',function(l,m){return this.setState({data:m});}.bind(this));k.lastMessage&&this._controller.setLastMessage(k.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});f.exports=j;},null);
__d('MercuryThreadTitle.react',['fbt','MercuryConfig','MercuryIDs','MercuryParticipantListRenderer','MercuryParticipants','React','TextWithEmoticons.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryThreadTitle',propTypes:{isNewThread:i.bool,thread:i.object.isRequired,viewer:i.string.isRequired,showUnreadCount:i.bool,useShortName:i.bool,useAndSeparator:i.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(k){this._renderParticipantsList(k);},render:function(){return (c('React').createElement('span',{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var k=this.props.thread,l=c('React').createElement(c('TextWithEmoticons.react'),{renderEmoticons:true,renderEmoji:true,text:k.name});if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEmoticonsModule){var m=c('MercuryConfig').MessengerTextWithEmoticonsModule;l=c('React').createElement(m,{renderEmoticons:true,renderEmoji:true,text:k.name});}if(!k.unread_count||!this.props.showUnreadCount)return l;return this._renderTitleWithUnreadCount(l,k.unread_count);},_renderParticipantsList:function(k){if(k.thread.name)return;var l=c('MercuryIDs').getParticipantIDFromUserID(k.viewer),m=k.thread.participants;if(m.length>1)m=m.filter(function(n){return n!=l;});c('MercuryParticipants').getMulti(m,function(n){if(!this.isMounted())return;var o=m.map(function(u){return n[u];}),p=k.thread.custom_nickname?{}:null;if(p&&c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEmoticonsModule){var q=c('MercuryConfig').MessengerTextWithEmoticonsModule;for(var r in k.thread.custom_nickname)p[r]=c('React').createElement(q,{renderEmoticons:true,renderEmoji:true,text:k.thread.custom_nickname[r]});}else if(p)p=k.thread.custom_nickname;var s=new (c('MercuryParticipantListRenderer'))().setUseShortName(k.useShortName).setUseAndSeparator(k.useAndSeparator).setIsNewThread(k.isNewThread).setNickname(p).renderParticipantList(o),t=k.showUnreadCount&&k.thread.unread_count?this._renderTitleWithUnreadCount(s,k.thread.unread_count):s;this.setState({participantNames:t});}.bind(this));},_renderTitleWithUnreadCount:function(k,l){return h._("{conversation-title} ({unread-count})",[h.param('conversation-title',k),h.param('unread-count',l)]);}});f.exports=j;},null);
__d('MercuryMeMessageProcessor',['ImmutableObject','MercuryActionType','MercuryConfig','MercuryLogMessageType','MercuryParticipants','MercuryCommands'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(l){if(!l)return false;if(l.action_type!==c('MercuryActionType').USER_GENERATED_MESSAGE)return false;var m=l.body;return i(m);}function i(l){if(!c('MercuryConfig').MessengerRenderMeAsAdminMessageGK)return false;if(typeof l==='string'&&l.startsWith(c('MercuryCommands').ME))return true;return false;}function j(l){var m=k(l.body,l.author);return c('ImmutableObject').set(l,{action_type:c('MercuryActionType').LOG_MESSAGE,body:m,log_message_body:m,log_message_data:{message_type:'',untypedData:{}},log_message_type:c('MercuryLogMessageType').GENERIC_ADMIN_TEXT});}function k(l,m){var n=c('MercuryParticipants').getOrFetch(m),o=n?n.short_name:c('MercuryCommands').ME;return l.replace(c('MercuryCommands').ME,o+' ');}f.exports={transform:j,transformSnippet:k,shouldTransform:h,shouldTransformSnippet:i};},null);
__d('MercuryShareAttachmentRenderLocations',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={CHAT:'chat',CHAT_PREVIEW:'chat_preview',MESSENGER:'messenger',WEB_INBOX:'web_inbox',getValues:function(){return [h.CHAT,h.CHAT_PREVIEW,h.MESSENGER,h.WEB_INBOX];},isPreview:function(i){return i===h.CHAT_PREVIEW;}};f.exports=h;},null);
__d('MercuryMessageGroup',['MercuryActionType','MercuryAttachmentType','MercuryMeMessageProcessor','MercuryShareAttachmentRenderLocations','MercuryThreadlistConstants','enumerate'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={calculateMessageGroups:function(k,l){var m=[],n=null,o={value:null},p=c('enumerate')(k),q;while(!(q=p.next()).done){var r=h.canAppendMessageToLastGroup(o.value,q.value,l);if(!r){n=[];m.push(n);}n.push(q.value);o=q;}return m;},canAppendMessageToLastGroup:function(k,l,m){var n=c('MercuryThreadlistConstants').GROUPING_THRESHOLD;if(!k||i(k,m)||i(l,m)||k.author!=l.author||k.timestamp<l.timestamp-n||k.is_spoof_warning!==l.is_spoof_warning||k.page_admin_notes)return false;return true;}};function i(k,l){var m=k.has_attachment;if(m&&(l===c('MercuryShareAttachmentRenderLocations').MESSENGER||l===c('MercuryShareAttachmentRenderLocations').CHAT))m=j(k);return !!(k.action_type==c('MercuryActionType').LOG_MESSAGE||c('MercuryMeMessageProcessor').shouldTransform(k)||m||k.forward_count||k.html_body||k.body&&k.body.length>c('MercuryThreadlistConstants').MAX_CHARS_BEFORE_BREAK);}function j(k){var l=k.attachments[0];return (!l||l.attach_type===c('MercuryAttachmentType').STICKER||l.attach_type===c('MercuryAttachmentType').ANIMATED_IMAGE);}f.exports=h;},null);
__d('MessageList.react',['cx','immutable','ImmutableObject','MercuryActionType','MercuryIDs','MercuryMeMessageProcessor','MercuryMessageGroup','MercuryShareAttachmentRenderLocations','MessengerDomIDs','ReactComponentWithPureRenderMixin','React','ReactDOM','MercuryLogMessageType'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=1000*60*60,k=c('React').createClass({displayName:'MessageList',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{DateBreak:i.func.isRequired,deliveryTimestamp:i.number.isRequired,isCanonical:i.bool,isPageMessage:i.bool,location:i.string.isRequired,LogMessage:i.func.isRequired,loadMoreMessages:i.func,MessageGroup:i.func.isRequired,messages:i.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:i.func,onStickerClick:i.func,readReceipts:i.instanceOf(c('immutable').OrderedMap).isRequired,viewer:i.string.isRequired,thread:i.object,threadID:i.string},getInitialState:function(){return {activeMessageID:null,messageGroups:c('MercuryMessageGroup').calculateMessageGroups(this.props.messages,this.props.location)};},componentWillReceiveProps:function(q){if(q.messages!==this.props.messages)this.setState({messageGroups:c('MercuryMessageGroup').calculateMessageGroups(q.messages,q.location)});},render:function(){var q=this.props,r=q.DateBreak,s=q.location,t=q.MessageGroup,u=[],v=this.state.activeMessageID,w=this.state.messageGroups,x=w.length,y=this.props.readReceipts,z=y.last()||0,aa=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer);for(var ba=0;ba<x;ba++){var ca=ba>0?w[ba-1]:null,da=ca&&ca.length>0?ca[ca.length-1]:null,ea=w[ba],fa=ea[0],ga=ea[ea.length-1],ha=false;if(!da||fa.timestamp-da.timestamp>j){ha=true;u.push(c('React').createElement(r,{date:new Date(fa.timestamp),key:'db:'+fa.message_id,ref:'db:'+fa.message_id}));}if(fa.action_type==c('MercuryActionType').LOG_MESSAGE){if((s===c('MercuryShareAttachmentRenderLocations').CHAT||s===c('MercuryShareAttachmentRenderLocations').MESSENGER)&&(fa.log_message_type===c('MercuryLogMessageType').VIDEO_CALL||fa.log_message_type===c('MercuryLogMessageType').PHONE_CALL)){var ia=this._createRTCMessageGroup(fa,aa,w,x,ba,y,z,ga);u.push(ia);}else{var ja=this._createLogMessageGroup(fa);u.push(ja);}continue;}if(c('MercuryMeMessageProcessor').shouldTransform(fa)){var ka=c('MercuryMeMessageProcessor').transform(fa);u.push(this._createLogMessageGroup(ka));continue;}ea=c('immutable').List(ea);var la=m(w,x,ba),ma=!o(y,ea,la),na=n(z,ga),oa=p(this.props.deliveryTimestamp,ga);u.push(c('React').createElement(t,{activeMessageID:l(v,ea),author:ea.first().author,deliveryTimestamp:oa,hasDateBreak:ha,isCanonical:this.props.isCanonical,isFromViewer:aa===fa.author,isPageMessage:this.props.isPageMessage,key:'mg:'+fa.message_id,lastReadTimestamp:na,maxBubbleWidth:this.props.maxBubbleWidth,messages:ea,nextTimestamp:la,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:ma?y:c('immutable').OrderedMap(),ref:'mg:'+fa.message_id,thread:this.props.thread,threadID:this.props.threadID}));}return (c('React').createElement('div',{id:s===c('MercuryShareAttachmentRenderLocations').MESSENGER?c('MessengerDomIDs').CONVERSATION:null},u));},getMessageElement:function(q,r){if(r){var s=this.refs['db:'+q];if(s)return c('ReactDOM').findDOMNode(s);}var t=this.state.messageGroups.find(function(w){return w.some(function(x){return x.message_id===q;});});if(!t)return null;var u=t[0].message_id,v=this.refs['mg:'+u];if(!v)return null;if(r&&u===q)return c('ReactDOM').findDOMNode(v);return v.getMessageElement(q);},_handleMessageDeselect:function(q){this.setState(function(r){return {activeMessageID:r.activeMessageID===q?null:r.activeMessageID};});},_handleMessageSelect:function(q){this.setState({activeMessageID:q});},_createRTCMessageGroup:function(q,r,s,t,u,v,w,x){var y=this.props.MessageGroup,z={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:q.log_message_body,log_message_data:q.log_message_data,log_message_type:q.log_message_type,timestamp:q.timestamp}},aa=c('ImmutableObject').setProperty(q,'attachments',[z]);aa=c('ImmutableObject').setProperty(aa,'body','');var ba=c('immutable').List([aa]),ca=m(s,t,u),da=!o(v,ba,ca),ea=n(w,x),fa=p(this.props.deliveryTimestamp,x);return (c('React').createElement(y,{author:ba.first().author,deliveryTimestamp:fa,isFromViewer:r===q.author,key:q.message_id,lastReadTimestamp:ea,maxBubbleWidth:this.props.maxBubbleWidth,messages:ba,nextTimestamp:ca,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this._handleMessageDeselect,onMessageSelect:this._handleMessageSelect,onStickerClick:this.props.onStickerClick,readReceipts:da?v:c('immutable').OrderedMap(),thread:this.props.thread,threadID:this.props.threadID}));},_createLogMessageGroup:function(q){var r=this.props.LogMessage;return (c('React').createElement(r,{className:this.props.location===c('MercuryShareAttachmentRenderLocations').CHAT?"_5w0o":null,key:q.message_id,loadMoreMessages:this.props.loadMoreMessages,message:q,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread}));}});function l(q,r){return r.find(function(s){return s.message_id===q;})?q:null;}function m(q,r,s){return s<r-1?q[s+1][0].timestamp:Infinity;}function n(q,r){return r.timestamp>q?q:Infinity;}function o(q,r,s){return (r.isEmpty()||q.last()<r.first().timestamp||q.first()>=s);}function p(q,r){return r.timestamp>q?q:Infinity;}f.exports=k;},null);
__d('WebMessengerThreadPermalinks',['MercuryIDs','MessagingTag','URI','WebMessengerPermalinkConstants','WWWBase','requireWeak'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={getThreadURI:function(l,m,n){if(c('MercuryIDs').isCanonical(l)){i(l,m,n);}else j(l,m,n);}};function i(l,m,n){var o=new (c('URI'))(c('WWWBase').uri),p=c('MercuryIDs').tokenize(l).value;o.setPath(k(n)+'/'+p);m&&m(o.toString());}function j(l,m,n){c('requireWeak')('MercuryThreadIDMap',function(o){var p=o.get();p.getServerIDFromClientID(l,function(q){var r=new (c('URI'))(c('WWWBase').uri);r.setPath(c('WebMessengerPermalinkConstants').getURIPathForThreadID(q,k(n)));m&&m(r.toString());});});}function k(l){var m=c('WebMessengerPermalinkConstants').BASE_PATH;if(l&&l!=c('MessagingTag').INBOX)m+='/'+l;return m;}f.exports=h;},null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryConfig').delivery_timeout||120000;i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercuryDeliveryState1=k;this.$MercuryDeliveryState2=c('MercuryServerRequests').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=c('MercuryThreadInformer').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=c('MercuryThreadIDMap').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));c('UserActivity').subscribe(c('debounceAcrossTransitions')(this.$MercuryDeliveryState8,300,this));}i.prototype.$MercuryDeliveryState7=function(k,l){for(var m in l){var n=l[m];n.forEach(function(o){if(this.$MercuryDeliveryState9(o)){this.$MercuryDeliveryState5.push(o);this.$MercuryDeliveryState4.getServerIDFromClientID(m,function(p){if(!this.$MercuryDeliveryState6[p])this.$MercuryDeliveryState6[p]=[];this.$MercuryDeliveryState6[p].push(o.message_id);}.bind(this));}}.bind(this));}if(c('UserActivity').isActive(h))this.$MercuryDeliveryState8();};i.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&this.$MercuryDeliveryState6.length===0)return;var k=this.$MercuryDeliveryState5.map(function(l){return l.message_id;});if(k)this.$MercuryDeliveryState2.sendDeliveryReceipts(k,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6=[];this.$MercuryDeliveryState5=[];};i.prototype.$MercuryDeliveryState9=function(k){var l=k.author?c('MercuryIDs').getUserIDFromParticipantID(k.author):null;if(l===this.$MercuryDeliveryState1)return false;if(!k.is_unread)return false;if(!c('PresencePrivacy').allows(l))return false;return true;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;},null);
__d('MercuryOrderedThreadlist',['LogHistory','MercuryActionType','MercuryDispatcher','MercuryFilters','MercuryFolders','MercuryPayloadSource','MercurySingletonMixin','MercuryThreadIDMap','MessagingTag','PageMessageEnumTag','RangedCallbackManager','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('ordered_threadlist_model'),i=c('MercuryFilters').getSupportedFilters().concat([c('MercuryFilters').ALL,c('MessagingTag').GROUPS]),j=c('MercuryFolders').getSupportedFolders().concat([c('MessagingTag').SPAM]);function k(u,v,w,x){var y=[],z=false,aa=false,ba=(v||[]).filter(function(ia){var ja=ia.filter||c('MercuryFilters').ALL;return (ia.folder==w||!ia.folder&&w==c('MessagingTag').INBOX)&&ja==x;}),ca=u._threadlistOrderMap[w][x].getAllResources(),da;ba.forEach(function(ia){y=y.concat(ia.thread_ids);if(ia.error){if(ia.end>ca.length)aa=ia.error;}else{var ja=ia.end-ia.start;if(ia.thread_ids.length<ja)z=true;}if(!da||ia.end>da)da=ia.end;});o(u,y,w,x);if(z){u._threadlistOrderMap[w][x].setReachedEndOfArray();}else if(aa){u._threadlistOrderMap[w][x].setError(aa);}else{var ea=u._threadlistOrderMap[w][x].getCurrentArraySize();if(da&&ea<da){var fa={},ga=ca.concat(y),ha=ga.filter(function(ia){var ja=fa[ia];fa[ia]=true;return ja;});if(ha.length){h.warn('duplicate_threads',JSON.stringify({folder:w,expected_final_size:da,actual_final_size:ea,duplicate_thread_ids:ha}));u._serverRequests.fetchThreadlistInfo(da,ha.length,w,x==c('MercuryFilters').ALL?null:x);}}}}function l(u,v){j.forEach(function(w){i.forEach(function(x){k(u,v,w,x);});});}function m(u,v){var w={};j.forEach(function(x){w[x]={};i.forEach(function(y){w[x][y]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});v.forEach(function(x){if(x.is_forward)return;var y=x.thread_id,z=p(u,y),aa=q(u,y);function ba(){aa.forEach(function(da){if(!c('arrayContains')(i,da))return;w[z][da].to_add.push(y);if(!u._threadlistOrderMap[z][da].hasReachedEndOfArray()&&!u._threadlistOrderMap[z][da].hasResource(y))w[z][da].to_remove_if_last_after_add[y]=true;});}function ca(da){if(c('arrayContains')(i,da))if(c('arrayContains')(aa,da)){w[z][da].to_add.push(y);}else w[z][da].to_remove.push(y);}if(!z){if(x.action_type===c('MercuryActionType').CHANGE_FOLDER||x.action_type===c('MercuryActionType').CHANGE_ARCHIVED_STATUS)j.forEach(function(da){if(da!==z)i.forEach(function(ea){u._threadlistOrderMap[da][ea].removeResources([y]);});});return;}switch(x.action_type){case c('MercuryActionType').DELETE_THREAD:aa.forEach(function(da){if(!c('arrayContains')(i,da))return;w[z][da].to_remove.push(y);});break;case c('MercuryActionType').CHANGE_ARCHIVED_STATUS:case c('MercuryActionType').CHANGE_FOLDER:ba();break;case c('MercuryActionType').CHANGE_READ_STATUS:ca(c('MessagingTag').UNREAD);break;case c('MercuryActionType').USER_GENERATED_MESSAGE:case c('MercuryActionType').LOG_MESSAGE:aa.forEach(function(da){if(!c('arrayContains')(i,da))return;if(r(u,y,z,da))w[z][da].to_add.push(y);});break;case c('MercuryActionType').CHANGE_FLAG:ca(c('PageMessageEnumTag').FLAG);break;}});j.forEach(function(x){i.forEach(function(y){var z=u._threadlistOrderMap[x][y];o(u,w[x][y].to_add,x,y);for(var aa=z.getCurrentArraySize()-1;aa>=0;aa--){var ba=z.getResourceAtIndex(aa);if(!w[x][y].to_remove_if_last_after_add[ba])break;w[x][y].to_remove.push(ba);}z.removeResources(w[x][y].to_remove);});});}function n(u,v){var w={};j.forEach(function(x){w[x]={};i.forEach(function(y){w[x][y]=[];});});v.forEach(function(x){var y=p(u,x.thread_id),z=q(u,x.thread_id);if(y)z.forEach(function(aa){if(r(u,x.thread_id,y,aa))w[y][aa].push(x.thread_id);});});j.forEach(function(x){i.forEach(function(y){if(w[x][y].length>0)o(u,w[x][y],x,y);});});}function o(u,v,w,x){x=x||c('MercuryFilters').ALL;u._threadlistOrderMap[w][x].addResources(v);j.forEach(function(y){if(y!=w)u._threadlistOrderMap[y][x].removeResources(v);});}function p(u,v){var w=u._threads.getThreadMetaNow(v),x=null;if(!w){x='No thread metadata';}else if(!w.folder)x='No thread folder';if(x){var y={error:x,tid:v};h.warn('no_thread_folder',JSON.stringify(y));return null;}var z=w.folder;if(w.is_archived)z=c('MessagingTag').ACTION_ARCHIVED;if(u._threadlistOrderMap[z]){return z;}else return null;}function q(u,v){var w=u._threads.getThreadMetaNow(v),x=[c('MercuryFilters').ALL];if(!w){var y={error:'no_thread_metadata',tid:v};h.warn('no_thread_metadata',JSON.stringify(y));return [];}if(w.unread_count)x.push(c('MessagingTag').UNREAD);if(!w.is_canonical)x.push(c('MessagingTag').GROUPS);var z=w.page_thread_info;if(z&&z.flagged)x.push(c('PageMessageEnumTag').FLAG);return x;}function r(u,v,w,x){var y=u._threads.getThreadMetaNow(v);return !!(y&&y.timestamp&&p(u,v)==w&&c('arrayContains')(q(u,v),x));}function s(u){this._fbid=u;this._serverRequests=c('MercuryServerRequests').getForFBID(this._fbid);this._threadIDMap=c('MercuryThreadIDMap').getForFBID(this._fbid);this._threadInformer=c('MercuryThreadInformer').getForFBID(this._fbid);this._threads=c('MercuryThreads').getForFBID(this._fbid);this._dispatcher=c('MercuryDispatcher').getForFBID(this._fbid);this._threadlistOrderMap={};this._initializeThreadlistOrderMap();this._dispatcher.subscribe('update-threadlist',function(v,w){if(!t(w))return;var x=w.ordered_threadlists;if(x&&x.length){l(this,x);}else{var y=(w.actions||[]).filter(function(z){return z.thread_id;});n(this,w.threads||[]);m(this,y);}this._threadInformer.updatedThreadlist();}.bind(this));this._dispatcher.subscribe('invalidate-global-state',function(){return this._invalidateGlobalState();}.bind(this));}Object.assign(s.prototype,{getThreadlistOrderMap:function(u,v){if(!this._threadlistOrderMap[u][v]){i=i.concat([v]);j.forEach(function(w){this._threadlistOrderMap[w][v]=new (c('RangedCallbackManager'))(function(x){return this._threads.getThreadMetaNow(x).timestamp;}.bind(this),function(x,y){return y-x;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}return this._threadlistOrderMap[u][v];},getThreadlist:function(u,v,w,x,y,z){return this.getFilteredThreadlist(u,v,w,c('MercuryFilters').ALL,x,y,z);},getFilteredThreadlist:function(u,v,w,x,y,z,aa){var ba=this.getThreadlistOrderMap(w,x),ca=ba.executeOrEnqueue(u,v,y,z),da=ba.getUnavailableResources(ca),ea=ba.getError(u,v,z);if(da.length||ea){if(ba.getCurrentArraySize()<u){var fa={start:u,limit:v,filter:x,resources_size:ba.getCurrentArraySize()};h.warn('range_with_gap',JSON.stringify(fa));}ba.setError(false);this._serverRequests.fetchThreadlistInfo(ba.getCurrentArraySize(),da.length,w,x==c('MercuryFilters').ALL?null:x,aa);}return ca;},getThreadlistUntilTimestamp:function(u,v,w){w=w||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(v,w).getElementsUntil(u);},getAvailableThreadlistNow:function(u,v){v=v||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(u,v).getAllResources();},getThreadCount:function(u,v){v=v||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(u,v).getCurrentArraySize();},hasLoadedThreadlist:function(u,v){v=v||c('MercuryFilters').ALL;return this.getThreadlistOrderMap(u,v).hasReachedEndOfArray();},unsubscribe:function(u,v,w){w=w||c('MercuryFilters').ALL;this.getThreadlistOrderMap(v,w).unsubscribe(u);},_invalidateGlobalState:function(){this._threadlistOrderMap={};this._initializeThreadlistOrderMap();},_initializeThreadlistOrderMap:function(){j.forEach(function(u){this._threadlistOrderMap[u]={};i.forEach(function(v){this._threadlistOrderMap[u][v]=new (c('RangedCallbackManager'))(function(w){return this._threads.getThreadMetaNow(w).timestamp;}.bind(this),function(w,x){return x-w;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}.bind(this));}});Object.assign(s,c('MercurySingletonMixin'));function t(u){switch(u.payload_source){case c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS:case c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS:case c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER:case c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE:case c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES:case c('MercuryPayloadSource').CLIENT_DELETE_THREAD:case c('MercuryPayloadSource').CLIENT_SEND_MESSAGE:case c('MercuryPayloadSource').SERVER_SEND_MESSAGE:case c('MercuryPayloadSource').SERVER_FETCH_THREADLIST_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:case c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE:return true;case c('MercuryPayloadSource').SERVER_INITIAL_DATA:return !!u.ordered_threadlists;default:return false;}}f.exports=s;},null);
__d('MercuryStateCheck',['Arbiter','ChannelConstants','ChatReliabilityInstrumentation','LogHistory','MercuryAPIArgsSource','MercuryConfig','MercuryFolders','MercuryOrderedThreadlist','MercuryServerRequests','MercurySingletonProvider','MercurySyncFakeDFFSender','MessagingTag','URI','requireWeak'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('mercury_state_check');i.getForFBID=function(k){'use strict';return j.getForFBID(k);};i.get=function(){'use strict';return j.get();};function i(k){'use strict';this.$MercuryStateCheck1=k;this.$MercuryStateCheck3=c('MercuryServerRequests').getForFBID(this.$MercuryStateCheck1);this.$MercuryStateCheck2=c('MercuryOrderedThreadlist').getForFBID(this.$MercuryStateCheck1);this.$MercuryStateCheck4=c('MercurySyncFakeDFFSender').getForFBID(this.$MercuryStateCheck1);c('Arbiter').subscribe(c('ChannelConstants').ON_INVALID_HISTORY,function(){this.$MercuryStateCheck5(c('ChannelConstants').ON_INVALID_HISTORY);c('ChatReliabilityInstrumentation').logCHANNEL_HISTORY_INVALID();}.bind(this));c('requireWeak')('ChannelConnection',function(l){l.subscribe(l.CONNECTED,function(m,n){if(!n.init)this.$MercuryStateCheck6(l.CONNECTED);}.bind(this));}.bind(this));}i.prototype.$MercuryStateCheck5=function(k){'use strict';var l;if(c('URI').getRequestURI().getPath().search(/messages/)!==-1){l=c('MercuryFolders').getSupportedFolders();}else l=[c('MessagingTag').INBOX];h.debug('check',JSON.stringify({folders:l,source:k}));if(c('MercuryConfig').WWWSyncGlobalDFFOnChannelReconnect){this.$MercuryStateCheck4.sendGlobalDFF();}else this.$MercuryStateCheck3.fetchMissedMessages(l,c('MercuryAPIArgsSource').MERCURYSYNC);};i.prototype.$MercuryStateCheck6=function(k){'use strict';var l=this.$MercuryStateCheck2.getAvailableThreadlistNow(c('MessagingTag').INBOX)||[];l=l.slice(0,20);h.debug('full_check',JSON.stringify({source:k}));this.$MercuryStateCheck3.fetchThreadData(l,c('MercuryAPIArgsSource').MERCURYSYNC);this.$MercuryStateCheck5(k);};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;},null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonMixin','MercuryThreadInfo','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');function l(aa){this._fbid=aa;this._serverRequests=c('MercuryServerRequests').getForFBID(this._fbid);this._threadIDMap=c('MercuryThreadIDMap').getForFBID(this._fbid);this._threads=c('MercuryThreads').getForFBID(this._fbid);this._threadInformer=c('MercuryThreadInformer').getForFBID(this._fbid);this._dispatcher=c('MercuryDispatcher').getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new (c('KeyedCallbackManager'))();this._dispatcher.subscribe('update-unseen',function(ba,ca){r(this,ca);}.bind(this));this._dispatcher.subscribe('update-thread-ids',function(ba,ca){x(this,ca);}.bind(this));}Object.assign(l.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return q(this)||0;},exceedsMaxCount:function(){return this._maxCount||q(this)>h;},markAsSeen:function(){var aa=q(this);if(aa===null){this._pendingServerUpdates=true;}else if(aa>0||this._maxCount){this._serverRequests.markSeen();var ba=this._serverRequests.getLastActionTimestamp();s(this,ba,[]);}}});Object.assign(l,c('MercurySingletonMixin'));function m(aa,ba,ca){var da={};da[ba]=0;u(aa,da,ca);}function n(aa,ba){aa._unseenResources.setResource(i,ba);aa._unseenResources.setResource(j,Object.keys(ba));}function o(aa,ba){var ca=aa._unseenResources.executeOrEnqueue(i,ba),da=aa._unseenResources.getUnavailableResources(ca);if(da.length)aa._serverRequests.fetchUnseenThreadIDs();}function p(aa){return aa._unseenResources.getResource(i);}function q(aa){var ba=aa._unseenResources.getResource(j);if(ba){return ba.length;}else return aa._initialUnseenCount;}function r(aa,ba){var ca=z(ba);if(ba.unseen_thread_fbids){ba.unseen_thread_fbids.forEach(function(na){if(na.folder!=c('MessagingTag').INBOX)return;var oa=na.thread_fbids||[];oa=oa.concat(na.other_user_fbids||[]);var pa=w(aa,oa),qa=aa._lastSeenTimestamp;if(ca&&ca.seen_timestamp)qa=ca.seen_timestamp;s(aa,qa,pa);if(ca&&ca.unseen_count>h)aa._maxCount=true;});}else if(ca&&ca.seen_timestamp!==undefined){aa._lastSeenTimestamp=ca.seen_timestamp;if(ca.unseen_count>h){aa._maxCount=true;n(aa,{});}else{aa._initialUnseenCount=ca.unseen_count;if(aa._initialUnseenCount===0)n(aa,{});}}else{if(aa._maxCount)return;var da=ba.actions;if(!da||!da.length)return;var ea={},fa={};for(var ga=0;ga<da.length;ga++){var ha=da[ga];if(ha.is_forward)continue;var ia=ha.action_type,ja=ha.other_user_fbid?ha.other_user_fbid:ha.thread_fbid,ka=ha.thread_id?ha.thread_id:ja;if(ia==c('MercuryActionType').MARK_THREAD_SEEN){m(aa,ka,ha.persistent);continue;}if(!y(aa,ha))continue;if(ia==c('MercuryActionType').USER_GENERATED_MESSAGE||ia==c('MercuryActionType').LOG_MESSAGE){var la=ea[ka]?ha.timestamp>ea[ka]:false,ma=la||!ea[ka];if(ha.is_unread&&ma)aa._threads.getThreadMeta(ka,function(na){var oa=false;if(na&&na.last_read_timestamp)if(na.last_read_timestamp>=ha.timestamp)oa=true;if(!c('MercuryThreadInfo').isMuted(na)&&!oa)ea[ka]=ha.timestamp;});}else if(ia==c('MercuryActionType').CHANGE_READ_STATUS&&ha.mark_as_read)fa[ka]=ha.timestamp;}t(aa,ea);u(aa,fa);}if(aa._pendingServerUpdates){aa._pendingServerUpdates=false;aa.markAsSeen();}}function s(aa,ba,ca){var da=p(aa);if(da===undefined||ba>aa._lastSeenTimestamp||aa._maxCount){aa._lastSeenTimestamp=ba;ca=ca||[];if(ca.length<=h)aa._maxCount=false;var ea={},fa=p(aa)||{};for(var ga in fa)if(fa[ga]!==true){var ha=fa[ga];if(v(aa,ha))ea[ga]=ha;}var ia=Object.assign(c('createObjectFrom')(ca,true),ea);n(aa,ia);aa._threadInformer.updatedUnseenState();}}function t(aa,ba){if(aa._maxCount)return;var ca={},da=false;for(var ea in ba){var fa=ba[ea];if(v(aa,fa)){ca[ea]=fa;da=true;}}if(!da)return;o(aa,function(ga){for(var ha in ca){var ia=ca[ha];if(!ga[ha]&&v(aa,ia))ga[ha]=ca[ha];}n(aa,ga);aa._threadInformer.updatedUnseenState();});}function u(aa,ba,ca){var da=false;if(!c('isEmpty')(ba))da=true;if(da)o(aa,function(ea){var fa=false;for(var ga in ba){var ha=ba[ga],ia=ha>=ea[ga];if(ea[ga]&&(!ha||ia)){delete ea[ga];fa=true;}}if(fa){n(aa,ea);aa._threadInformer.updatedUnseenState();if(ca&&q(aa)===0)aa._serverRequests.markSeen();}});}function v(aa,ba){return ba>aa._lastSeenTimestamp;}function w(aa,ba){return ba.map(aa._threadIDMap.convertThreadIDIfAvailable,aa._threadIDMap);}function x(aa,ba){var ca=p(aa);if(!ca)return;for(var da in ba){var ea=ba[da];if(ca[da]){ca[ea]=ca[da];delete ca[da];}}n(aa,ca);}function y(aa,ba){var ca=ba.thread_id?aa._threads.getThreadMetaNow(ba.thread_id):null,da=ca?c('MercuryFolders').getFromMeta(ca):ba.folder;return da===c('MessagingTag').INBOX||da===undefined;}function z(aa){var ba=aa.message_counts||[];for(var ca=0;ca<ba.length;ca++)if(ba[ca].folder==c('MessagingTag').INBOX)return ba[ca];return null;}f.exports=l;},null);
__d('MNAdsMessageUtils',['cx','fbt','AdPageMessageTypeEnum','Bootloader','FBJSON','Link.react','MercuryConfig','MercuryIDs','MessagingGenericAdminTextType','MessagingTag','MNCommerceDialogStateActions','MNCommercePromotionBlockDataManager','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='offsite_ad';k.prototype.isAdsMessageRequest=function(l){return l.folder==c('MessagingTag').PENDING&&l.last_message_type!==c('AdPageMessageTypeEnum').NON_AD;};k.prototype.renderAdsMessageRequestStatus=function(){if(c('MercuryConfig').ADS_MESSAGE_PROMOTION_TAG)return (c('React').createElement('span',null,c('MercuryConfig').ADS_MESSAGE_PROMOTION_TAG));return null;};k.prototype.isAdsAdminMessage=function(l){return l&&l.log_message_data&&l.log_message_data.message_type&&l.log_message_data.message_type===c('MessagingGenericAdminTextType').AD_MANAGE_MESSAGE;};k.prototype.isOffsiteAd=function(l){if(l.log_message_data&&l.log_message_data.untypedData&&l.log_message_data.untypedData.ad_properties){var m=c('FBJSON').parse(l.log_message_data.untypedData.ad_properties);for(var n=m,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r===j)return true;}}return false;};k.prototype.getadPreferencesUrl=function(l){if(l.log_message_data&&l.log_message_data.untypedData&&l.log_message_data.untypedData.ad_preferences_url)return l.log_message_data.untypedData.ad_preferences_url;return '';};k.prototype.getAdsPageManage=function(l,m){var n=null;if(c('MercuryConfig').WWWMessengerManageAdminGK){var o=function(){var p=this.isOffsiteAd(l),q=c('MercuryIDs').getUserIDFromParticipantID(l.author),r=this.getadPreferencesUrl(l),s=function(t,u){return c('MNCommercePromotionBlockDataManager').block(t,u);};c('Bootloader').loadModules(["MNAdsMessagesManageBlockDialogContainer.react"],function(t){c('MNCommerceDialogStateActions').showDialog(t,{adPreferencesUrl:r,isOffsiteAd:p,onConfirmButtonClick:s,pageID:q});});}.bind(this);n=c('React').createElement(c('Link.react'),{className:(!m?"_3kyk":'')+(m?' '+"_3kyl":''),onClick:o},i._("Manage"));return (c('React').createElement('span',{className:!m?"_3kym":''},l.log_message_body,' ','',' ',n));}return (c('React').createElement('span',{className:!m?"_3kym":''},l.log_message_body));};function k(){}f.exports=new k();},null);
__d('MercuryXMATRenderer',['fbt','MercuryConfig','MercuryIDs','MercuryParticipants','MessagingGenericAdminTextType','MNAdsMessageUtils','React','TextWithEntities.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={renderText:function(j){var k=null;if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEntitiesModule){var l=c('MercuryConfig').MessengerTextWithEntitiesModule;k=c('React').createElement(l,{renderEmoji:true,text:j.log_message_body});}else k=c('React').createElement(c('TextWithEntities.react'),{renderEmoji:true,text:j.log_message_body});switch(j.log_message_data.message_type){case c('MessagingGenericAdminTextType').TURN_ON_PUSH:var m=j.log_message_data.untypedData&&j.log_message_data.untypedData.recipient_id,n=m&&c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(m)),o=c('MercuryIDs').getUserIDFromParticipantID(j.author),p=c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(o));if(o!==j.other_user_fbid){if(n){k=h._("You asked {admin-text-message} to turn on notifications for Messenger on mobile.",[h.param('admin-text-message',n.name)]);}else k=h._("You asked a contact to turn on notifications for Messenger on mobile.");}else if(p){k=h._("{admin-text-message} asked you to turn on notifications for Messenger on mobile.",[h.param('admin-text-message',p.name)]);}else k=h._("A contact asked you to turn on notifications for Messenger on mobile.");break;case c('MessagingGenericAdminTextType').JOURNEY_PROMPT_COLOR:k=h._("You need to be on the latest version of Messenger on a mobile device to pick a color for this conversation.");break;case c('MessagingGenericAdminTextType').JOURNEY_PROMPT_NICKNAME:var q=null,r=c('MercuryIDs').getUserIDFromParticipantID(j.author);if(j.other_user_fbid&&r!==j.other_user_fbid){var s=c('MercuryIDs').getParticipantIDFromUserID(j.other_user_fbid);q=c('MercuryParticipants').getOrFetch(s);}if(q&&q.short_name){k=h._("You need to be on the latest version of Messenger on a mobile device to set a nickname for {admin-text-message} .",[h.param('admin-text-message',q.short_name)]);}else k=h._("You need to be on the latest version of Messenger on a mobile device to set a nickname for yourself.");break;case c('MessagingGenericAdminTextType').JOURNEY_PROMPT_LIKE:k=h._("You need to be on the latest version of Messenger on a mobile device to pick an emoji for this conversation.");break;case c('MessagingGenericAdminTextType').JOURNEY_PROMPT_BOT:k=h._("You need to be on the latest version of Messenger on a mobile device to add a subscription to this conversation.");break;case c('MessagingGenericAdminTextType').AD_MANAGE_MESSAGE:if(c('MNAdsMessageUtils').isAdsAdminMessage(j))k=c('MNAdsMessageUtils').getAdsPageManage(j,false);break;default:break;}return c('React').createElement('span',null,k);}};f.exports=i;},null);
__d('PhotoStore',['Arbiter','PhotoStoreCore'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();c('Arbiter').subscribe('update-photos',function(h,i){c('PhotoStoreCore').updateData(i);});f.exports=c('PhotoStoreCore');},null);
__d('MessagesViewer',['AsyncRequest','Bootloader','DOM','MessagesViewerSetID','PhotoStore','React','ReactDOM','Run','emptyFunction','ge'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={bootstrapWithElem:function(k){h.bootstrapWithConfig({fbid:k.getAttribute('data-fbid'),dimensions:k.getAttribute('data-dimensions'),src:k.getAttribute('href'),endpoint:k.getAttribute('data-endpoint'),disablePaging:k.getAttribute('data-disablepaging')},k);},bootstrapWithConfig:function(k,l){var m=k.setID;if(!m)m=c('MessagesViewerSetID').MESSAGES;j(function(n,o){i(c('React').createElement(n,{actorid:k.actorid,dimensions:[k.dimensions],disablepaging:k.disablePaging,disableForward:k.disableForward,open:true,photoid:k.fbid,reverse:false,rootClassName:k.rootClassName,setid:m,snapToPhoto:k.snapToPhoto,thumbsrc:k.src}));if(!c('PhotoStore').hasBeenCreated(m)&&k.endpoint){var p=new (c('AsyncRequest'))(k.endpoint);if(l)p.setRelativeTo(l);p.send();}});},renderVideo:function(k){j(function(l,m){i(c('React').createElement(m,k));});},preload:function(){c('Run').onAfterLoad(function(){return j(c('emptyFunction'));});}};function i(k){var l=c('ge')('messages_viewer');if(!l){l=c('DOM').create('div',{id:'messages_viewer'});document.body.appendChild(l);}k=c('ReactDOM').render(k,l);k.subscribeOnce('close',function(){c('ReactDOM').unmountComponentAtNode(l);});}function j(k){c('Bootloader').loadModules(["SpotlightMessagesViewer","MessagingVideoViewer.react"],k);}f.exports=h;},null);
__d('MercuryLogMessageRenderer',['cx','fbt','ix','Bootloader','CSS','HovercardLink','Image.react','MercuryConfig','MercuryViewer','MercuryXMATRenderer','MessagesViewer','MercuryLogMessageType','MercuryParticipants','React','ReactDOM','TextWithEntities.react','TooltipLink.react','UserAgent'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={renderText:function(z,aa,ba){switch(z.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:n(z,ba);break;case c('MercuryLogMessageType').UNSUBSCRIBE:s(z,ba);break;case c('MercuryLogMessageType').THREAD_NAME:t(z,aa,ba);break;case c('MercuryLogMessageType').THREAD_IMAGE:u(z,aa,ba);break;case c('MercuryLogMessageType').WALLPAPER:v(z,ba);break;case c('MercuryLogMessageType').GENERIC_ADMIN_TEXT:w(z,ba);break;default:c('Bootloader').loadModules(["MercurySpecialLogMessageRenderer"],function(ca){ca.renderText(z,ba);});break;}},renderIcon:function(z){return (c('React').createElement(c('Image.react'),{className:l(z),src:j('images/spacer.gif')}));},renderLegacy:function(z,aa,ba,ca){l(ca).split(' ').forEach(function(da){return da&&c('CSS').addClass(z,da);});this.renderText(ca,null,function(da){c('ReactDOM').render(c('React').createElement('span',null,da),aa);});this.renderAttachmentLegacy(ba,ca);},renderAttachmentLegacy:function(z,aa){if(aa.log_message_type==c('MercuryLogMessageType').THREAD_IMAGE){var ba=aa.log_message_data.image;if(ba&&ba.preview_url){c('ReactDOM').render(c('React').createElement(c('Image.react'),{className:"_z6a",onClick:function(){return m(ba);},src:ba.preview_url}),z);c('CSS').show(z);}}}};f.exports=k;function l(z){var aa=z.log_message_type,ba=z.log_message_data;return "_5wzu"+(aa==c('MercuryLogMessageType').SUBSCRIBE?' '+"_5wzj":'')+(aa==c('MercuryLogMessageType').UNSUBSCRIBE?' '+"_5wzk":'')+(aa==c('MercuryLogMessageType').THREAD_NAME?' '+"_5wzl":'')+(aa==c('MercuryLogMessageType').THREAD_IMAGE?' '+"_5wzm":'')+(aa==c('MercuryLogMessageType').VIDEO_CALL&&ba.answered?' '+"_5wzn":'')+(aa==c('MercuryLogMessageType').VIDEO_CALL&&!ba.answered?' '+"_5wzo":'')+(aa==c('MercuryLogMessageType').PHONE_CALL&&ba.answered?' '+"_5wzp":'')+(aa==c('MercuryLogMessageType').PHONE_CALL&&!ba.answered?' '+"_5wzq":'')+(aa==c('MercuryLogMessageType').SERVER_ERROR?' '+"_5wzr":'');}function m(z){c('MessagesViewer').bootstrapWithConfig({src:z.preview_url,endpoint:z.url,fbid:z.metadata.fbid,dimensions:z.metadata.dimensions,disablePaging:true},null);}function n(z,aa){var ba=y(z.log_message_data.added_participants);switch(ba.length){case 1:o(z,aa,ba);break;case 2:p(z,aa,ba);break;case 3:q(z,aa,ba);break;default:r(z,aa,ba);break;}}function o(z,aa,ba){var ca=[z.author,ba[0]];c('MercuryParticipants').getMulti(ca,function(da){if(z.author==c('MercuryViewer').getID()){aa(i._("You added {subscriber1}.",[i.param('subscriber1',x(da[ba[0]]))]));}else if(ba[0]==c('MercuryViewer').getID()){aa(i._("{actor} added you.",[i.param('actor',x(da[z.author]))]));}else aa(i._("{actor} added {subscriber1}.",[i.param('actor',x(da[z.author])),i.param('subscriber1',x(da[ba[0]]))]));});}function p(z,aa,ba){var ca=[z.author].concat(ba);c('MercuryParticipants').getMulti(ca,function(da){if(z.author==c('MercuryViewer').getID()){aa(i._("You added {subscriber1} and {subscriber2}.",[i.param('subscriber1',x(da[ba[0]])),i.param('subscriber2',x(da[ba[1]]))]));}else if(ba[0]==c('MercuryViewer').getID()){aa(i._("{actor} added you and {subscriber2}.",[i.param('actor',x(da[z.author])),i.param('subscriber2',x(da[ba[1]]))]));}else aa(i._("{actor} added {subscriber1} and {subscriber2}.",[i.param('actor',x(da[z.author])),i.param('subscriber1',x(da[ba[0]])),i.param('subscriber2',x(da[ba[1]]))]));});}function q(z,aa,ba){var ca=[z.author].concat(ba);c('MercuryParticipants').getMulti(ca,function(da){if(z.author==c('MercuryViewer').getID()){aa(i._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[i.param('subscriber1',x(da[ba[0]])),i.param('subscriber2',x(da[ba[1]])),i.param('subscriber3',x(da[ba[2]]))]));}else if(ba[0]==c('MercuryViewer').getID()){aa(i._("{actor} added you, {subscriber2} and {subscriber3}.",[i.param('actor',x(da[z.author])),i.param('subscriber2',x(da[ba[1]])),i.param('subscriber3',x(da[ba[2]]))]));}else aa(i._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[i.param('actor',x(da[z.author])),i.param('subscriber1',x(da[ba[0]])),i.param('subscriber2',x(da[ba[1]])),i.param('subscriber3',x(da[ba[2]]))]));});}function r(z,aa,ba){var ca=[z.author].concat(ba);c('MercuryParticipants').getMulti(ca,function(da){function ea(ga){var ha=c('React').createElement('div',null,ga.map(function(ia){return c('React').createElement('div',null,ia.name);}));return (c('React').createElement(c('TooltipLink.react'),{alignH:'center',position:'above',tooltip:ha},i._({"*":"{num} more"},[i.param('num',ga.length,[0])])));}var fa=ba.map(function(ga){return da[ga];});if(z.author==c('MercuryViewer').getID()){aa(i._("You added {subscriber1}, {subscriber2} and {more_people}.",[i.param('subscriber1',x(fa[0])),i.param('subscriber2',x(fa[1])),i.param('more_people',ea(fa.slice(2)))]));}else if(ba[0]==c('MercuryViewer').getID()){aa(i._("{actor} added you, {subscriber2} and {more_people}.",[i.param('actor',x(da[z.author])),i.param('subscriber2',x(fa[1])),i.param('more_people',ea(fa.slice(2)))]));}else aa(i._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[i.param('actor',x(da[z.author])),i.param('subscriber1',x(fa[0])),i.param('subscriber2',x(fa[1])),i.param('more_people',ea(fa.slice(2)))]));});}function s(z,aa){var ba=[z.author],ca=z.log_message_data.removed_participants,da;if(ca.length===1){da=ca[0];ba.push(da);}c('MercuryParticipants').getMulti(ba,function(ea){var fa=ea[z.author],ga=ea[da];if(z.author==c('MercuryViewer').getID()){if(!da||da==z.author){aa(i._("You left the conversation."));}else aa(i._("You removed {name} from the conversation.",[i.param('name',x(ga))]));}else if(!da||da==z.author){aa(i._("{actor} left the conversation.",[i.param('actor',x(fa))]));}else if(da==c('MercuryViewer').getID()){aa(i._("{actor} removed you from the conversation.",[i.param('actor',x(fa))]));}else aa(i._("{actor} removed {name} from the conversation.",[i.param('actor',x(fa)),i.param('name',x(ga))]));});}function t(z,aa,ba){var ca=z.log_message_data.name,da="_5wzs"+(c('UserAgent').isBrowser('Chrome')?' '+"_4fbd":'');if(z.author==c('MercuryViewer').getID()){if(ca){var ea=c('React').createElement(c('TextWithEntities.react'),{renderEmoticons:true,renderEmoji:true,text:ca});if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEmoticonsModule){var fa=c('MercuryConfig').MessengerTextWithEmoticonsModule;ea=c('React').createElement(fa,{renderEmoticons:true,renderEmoji:true,text:ca});}ba(i._("You named the conversation: {name}.",[i.param('name',c('React').createElement('span',{className:da},ea))]));}else ba(i._("You removed the conversation name."));}else c('MercuryParticipants').get(z.author,function(ga){var ha=x(ga,aa);if(ca){var ia=c('React').createElement(c('TextWithEntities.react'),{renderEmoticons:true,renderEmoji:true,text:ca});if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEmoticonsModule){var ja=c('MercuryConfig').MessengerTextWithEmoticonsModule;ia=c('React').createElement(ja,{renderEmoticons:true,renderEmoji:true,text:ca});}ba(i._("{actor} named the conversation: {name}.",[i.param('actor',ha),i.param('name',c('React').createElement('span',{className:da},ia))]));}else ba(i._("{actor} removed the conversation name.",[i.param('actor',ha)]));});}function u(z,aa,ba){if(z.author==c('MercuryViewer').getID()){if(z.log_message_data.image){ba(i._("You changed the conversation picture."));}else ba(i._("You removed the conversation picture."));}else c('MercuryParticipants').get(z.author,function(ca){var da=x(ca,aa);if(z.log_message_data.image){ba(i._("{actor} changed the conversation picture.",[i.param('actor',da)]));}else ba(i._("{actor} removed the conversation picture.",[i.param('actor',da)]));});}function v(z,aa){if(z.author==c('MercuryViewer').getID()){aa(i._("You changed the wallpaper."));}else c('MercuryParticipants').get(z.author,function(ba){var ca=x(ba);aa(i._("{actor} changed the wallpaper.",[i.param('actor',ca)]));});}function w(z,aa){var ba=c('MercuryXMATRenderer').renderText(z);aa(ba);}function x(z,aa){var ba=z.fbid,ca=c('HovercardLink').constructEndpoint({id:ba}),da=aa&&aa.custom_nickname&&aa.custom_nickname[ba];if(da&&c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEmoticonsModule){var ea=c('MercuryConfig').MessengerTextWithEmoticonsModule;da=c('React').createElement(ea,{renderEmoticons:true,renderEmoji:true,text:da});}var fa=da?da:z.name;if(z.href)return (c('React').createElement('a',{className:"_5wzt",href:z.href,'data-hovercard':ca},fa));return fa;}function y(z){var aa=z.indexOf(c('MercuryViewer').getID());if(aa>0){var ba=z.filter(function(ca){return ca!==c('MercuryViewer').getID();});return [c('MercuryViewer').getID()].concat(ba);}return z;}},null);
__d('MessagingGiftWrap.react',['cx','CurrentEnvironment','ReactComponentWithPureRenderMixin','React','emptyFunction'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessagingGiftWrap',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isSticker:i.bool,onUnwrap:i.func},getDefaultProps:function(){return {onUnwrap:c('emptyFunction')};},getInitialState:function(){return {unwrapped:false};},render:function(){var k=c('CurrentEnvironment').messengerdotcom;return (c('React').createElement('div',{className:"_4p0m"+(this.state.unwrapped?' '+"_4p0o":'')+(k?' '+"_mxz":'')+(k?' '+"_4br2":'')+(!k?' '+"_3_om":'')+(this.props.isSticker?' '+"_52vq":''),onClick:this._handleClick},c('React').createElement('div',{className:"_4p0r"}),c('React').createElement('div',{className:"_4p0s _4p0t"}),c('React').createElement('div',{className:"_4p0s _4p0u"})));},_handleClick:function(k){k.stopPropagation();this.setState({unwrapped:true});this.props.onUnwrap&&this.props.onUnwrap();}});f.exports=j;},null);
__d('P2PActionConstants',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={CREDIT_CARDS_UPDATED:'credit_cards_updated',CREDIT_CARDS_UPDATED_ERROR:'credit_cards_updated_error',CHANNEL_EVENTS_ALLOWED:'channel_events_allowed',CHANNEL_EVENTS_IGNORED:'channel_events_ignored',CREDIT_CARD_SAVING:'credit_card_saving',CREDIT_CARD_ADDED:'credit_card_added',CREDIT_CARD_ADDED_ERROR:'credit_card_added_error',CREDIT_CARD_ADDED_ERROR_CLEARED:'credit_card_added_error_cleared',CREDIT_CARD_DELETED:'credit_card_deleted',CREDIT_CARD_DELETED_ERROR:'credit_card_deleted_error',CREDIT_CARD_UPDATED:'credit_card_updated',CREDIT_CARD_UPDATED_ERROR:'credit_card_updated_error',PRESET_CREDIT_CARD_UPDATED:'preset_credit_card_updated',PRESET_CREDIT_CARD_UPDATED_ERROR:'preset_credit_card_updated_error',CREDIT_CARD_VERIFIED:'credit_card_verified',CREDIT_CARD_VERIFIED_ERROR:'credit_card_verified_error',TRANSFERS_UPDATED:'transfers_updated',TRANSFERS_UPDATED_ERROR:'transfers_updated_error',NUX_TRANSFERS_UPDATED:'nux_transfers_updated',TRANSFER_ADDED:'transfer_added',TRANSFER_ADDED_ERROR:'transfer_added_error',TRANSFER_UPDATED:'transfer_updated',TRANSFER_UPDATED_ERROR:'transfer_updated_error',TRANSFER_ACCEPTED:'transfer_accepted',TRANSFER_DECLINED:'transfer_declined',CHAT_SEND_VIEW_OPENED:'chat_send_view_opened',CHAT_SEND_VIEW_CLOSED:'chat_send_view_closed',BIN_NUMBER_VALIDATED:'bin_number_validated',BIN_NUMBER_VALIDATED_ERROR:'bin_number_validated_error',USER_ELIGIBILITY_UDPATED:'user_eligibility_updated',FRIENDS_LIST_UPDATED:'friends_list_updated',DIALOG_SHOWN:'dialog_shown',DIALOG_CLOSED:'dialog_closed',BANNER_STATES_UPDATED:'banner_states_updated',BANNER_DISMISSED:'banner_dismissed',BANNER_VIEWED:'banner_viewed',BANNER_COMPLETED:'banner_completed',MONEYPENNY_TRANSFER_CREATED:'moneypenny_transfer_created',MONEYPENNY_TRANSFER_CREATED_ERROR:'moneypenny_transfer_created_error',PLATFORM_CONTEXT_ADDED:'platform_context_added',PLATFORM_CONTEXT_ADDED_ERROR:'platform_context_added_error',PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED:'platform_context_save_errors_cleared',PLATFORM_CONTEXT_BANNER_DISMISSED:'platform_context_banner_dismissed',PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD:'platform_context_product_item_sold',PLATFORM_CONTEXT_CHANGED:'platform_context_changed',EXTENSIVE_TRANSFER_DETAILS_UPDATED:'extensive_transfer_details_updated',ADDRESS_SAVING:'address_saving',ADDRESSES_UPDATED:'addresses_updated',ADDRESS_ADDED:'address_added',ADDRESS_ADDED_ERROR:'address_added_error',ADDRESS_ADDED_ERROR_CLEARED:'address_added_error_cleared',CHECKOUT_CART_INITIATED:'checkout_cart_initiated',CHECKOUT_CART_CREATED:'checkout_cart_created',CHECKOUT_SHIPPING_OPTION_SELECTED:'checkout_shipping_option_selected',CHECKOUT_ADDRESS_SELECTED:'checkout_address_selected',CHECKOUT_CREDIT_CARD_SELECTED:'checkout_credit_card_selected',CHECKOUT_ADDRESS_FORM_TOGGLED:'checkout_address_form_toggled',CHECKOUT_CREDIT_CARD_FORM_TOGGLED:'checkout_credit_card_form_toggled',CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED:'checkout_address_options_toggled',CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED:'checkout_credit_card_edit_options_toggled',CHECKOUT_ADDRESS_FORM_VALIDATED:'checkout_address_form_validated',CHECKOUT_CREDIT_CARD_FORM_VALIDATED:'checkout_credit_card_form_validated',CHECKOUT_EDIT_COMPLETED:'checkout_completed',CHECKOUT_PROCESSING:'checkout_processing',CHECKOUT_BUYER_PROFILE_UPDATED:'checkout_buyer_profile_updated',PAYMENT_REQUEST_INITIATED:'payment_request_initiated',PAYMENT_REQUEST_INITIATED_COMPLETE:'payment_request_initiated_completed',PAYMENT_REQUEST_CREATED:'payment_request_created',PAYMENT_REQUEST_CREATED_ERROR:'payment_request_created_error',PAYMENT_REQUEST_UPDATED:'payment_request_updated',PAYMENT_REQUEST_DECLINE_INITIATED:'payment_request_decline_initiated',PAYMENT_REQUEST_DECLINED:'payment_request_declined',PAYMENT_REQUEST_DECLINE_ERROR:'payment_request_decline_error',PAYMENT_REQUESTS_FETCHED:'payment_requests_fetched',PAYMENT_REQUEST_CANCEL_INITIATED:'payment_request_cancel_initiated',PAYMENT_REQUEST_CANCELED:'payment_request_canceled',PAYMENT_REQUEST_CANCEL_ERROR:'payment_request_cancel_error'};f.exports=h;},null);
__d('P2PDispatcher',['Dispatcher_DEPRECATED'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new (c('Dispatcher_DEPRECATED'))();},null);
__d('P2PActions',['ChatOpenTab','CurrentEnvironment','MessengerActions','P2PActionConstants','P2PDispatcher','MercuryShareAttachmentRenderLocations'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={updateCreditCards:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARDS_UPDATED,data:i});},updateCreditCardsError:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARDS_UPDATED_ERROR});},ignoreCreditCardChannelEvents:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHANNEL_EVENTS_IGNORED});},allowCreditCardChannelEvents:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHANNEL_EVENTS_ALLOWED});},creditCardSaving:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_SAVING});},addCreditCard:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_ADDED,data:i});},addCreditCardError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_ADDED_ERROR,data:i});},addCreditCardErrorCleared:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_ADDED_ERROR_CLEARED});},updatePresetCreditCard:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PRESET_CREDIT_CARD_UPDATED,data:i});},updatePresetCreditCardError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PRESET_CREDIT_CARD_UPDATED_ERROR,data:i});},updateCreditCard:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_UPDATED,data:i});},updateCreditCardError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_UPDATED_ERROR,data:i});},deleteCreditCard:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_DELETED,data:i});},deleteCreditCardError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_DELETED_ERROR,data:i});},verifyCreditCard:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_VERIFIED,data:i});},verifyCreditCardError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CREDIT_CARD_VERIFIED_ERROR,data:i});},updateTransfers:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFERS_UPDATED,data:i});},updateTransfersError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFERS_UPDATED_ERROR,data:i});},updateNUXTransfers:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').NUX_TRANSFERS_UPDATED,data:i});},transferAdded:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFER_ADDED,data:i});},transferAddedError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFER_ADDED_ERROR,data:i});},transferUpdated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFER_UPDATED,data:i});},transferUpdatedError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFER_UPDATED_ERROR,data:i});},transferAccepted:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFER_ACCEPTED});},transferDeclined:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').TRANSFER_DECLINED,data:i});},chatSendViewOpened:function(i){function j(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHAT_SEND_VIEW_OPENED,data:i});}if(i.referrer===c('MercuryShareAttachmentRenderLocations').WEB_INBOX){j();}else if(c('ChatOpenTab').canOpenTab()){c('ChatOpenTab').openThread(i.threadID,null,null,j);}else if(c('CurrentEnvironment').messengerdotcom){c('MessengerActions').selectThread(i.threadID);j();}else j();},chatSendViewClosed:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHAT_SEND_VIEW_CLOSED,data:i});},binNumberValidated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').BIN_NUMBER_VALIDATED,data:i});},binNumberValidatedError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').BIN_NUMBER_VALIDATED_ERROR,data:i});},friendsListUpdated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').FRIENDS_LIST_UPDATED,data:i});},userEligibilityUpdated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').USER_ELIGIBILITY_UDPATED,data:i});},showDialog:function(i,j){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').DIALOG_SHOWN,data:{dialogClass:i,dialogProps:j}});},hideDialog:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').DIALOG_CLOSED});},bannerStatesUpdated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').BANNER_STATES_UPDATED,data:i});},bannerDismissed:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').BANNER_DISMISSED,data:i});},bannerCompleted:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').BANNER_COMPLETED,data:i});},moneypennyTransferCreated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').MONEYPENNY_TRANSFER_CREATED,data:i});},moneypennyTransferCreatedError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').MONEYPENNY_TRANSFER_CREATED_ERROR,data:i});},addPlatformContext:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PLATFORM_CONTEXT_ADDED,data:i});},addPlatformContextError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PLATFORM_CONTEXT_ADDED_ERROR,data:i});},clearPlatformContextSaveErrors:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED,data:i});},platformContextBannerDismissed:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PLATFORM_CONTEXT_BANNER_DISMISSED,data:i});},platformContextProductItemSold:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD,data:i});},platformContextChanged:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PLATFORM_CONTEXT_CHANGED,data:i});},extensiveTransferDetailsLoaded:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').EXTENSIVE_TRANSFER_DETAILS_UPDATED,data:i});},updateAddresses:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').ADDRESSES_UPDATED,data:i});},addressSaving:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').ADDRESS_SAVING});},addAddress:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').ADDRESS_ADDED,data:i});},addAddressError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').ADDRESS_ADDED_ERROR,data:i});},addAddressErrorCleared:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').ADDRESS_ADDED_ERROR_CLEARED});},checkoutCartInitiated:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_CART_INITIATED});},checkoutCartCreated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_CART_CREATED,data:i});},checkoutShippingOptionSelected:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_SHIPPING_OPTION_SELECTED,data:i});},checkoutAddressSelected:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_ADDRESS_SELECTED,data:i});},checkoutCreditCardSelected:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_CREDIT_CARD_SELECTED,data:i});},checkoutAddressFormToggled:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_ADDRESS_FORM_TOGGLED,data:i});},checkoutCreditCardFormToggled:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_CREDIT_CARD_FORM_TOGGLED,data:i});},checkoutAddressEditOptionsToggled:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED,data:i});},checkoutCreditCardEditOptionsToggled:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED,data:i});},checkoutCreditCardFormValidated:function(i,j){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_CREDIT_CARD_FORM_VALIDATED,data:{isValid:i,formData:j}});},checkoutAddressFormValidated:function(i,j){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_ADDRESS_FORM_VALIDATED,data:{isValid:i,formData:j}});},checkoutEditCompleted:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_EDIT_COMPLETED});},checkoutProcessing:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_PROCESSING,data:i});},checkoutBuyerProfileUpdated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').CHECKOUT_BUYER_PROFILE_UPDATED,data:i});},paymentRequestInitiated:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_INITIATED});},paymentRequestInitiatedComplete:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_INITIATED_COMPLETE});},paymentRequestCreated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_CREATED,data:i});},paymentRequestCreatedError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_CREATED_ERROR,data:i});},paymentRequestUpdated:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_UPDATED,data:i});},paymentRequestDeclineInitiated:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_DECLINE_INITIATED});},paymentRequestDeclined:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_DECLINED,data:i});},paymentRequestDeclineError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_DECLINE_ERROR,data:i});},paymentRequestCancelInitiated:function(){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_CANCEL_INITIATED});},paymentRequestCanceled:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_CANCELED,data:i});},paymentRequestCancelError:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUEST_CANCEL_ERROR,data:i});},paymentRequestsFetched:function(i){c('P2PDispatcher').dispatch({type:c('P2PActionConstants').PAYMENT_REQUESTS_FETCHED,data:i});}};f.exports=h;},null);
__d('P2PLoadingMask.react',['cx','React','XUISpinner.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'P2PLoadingMask',propTypes:{visible:i.bool},getDefaultProps:function(){return {visible:false};},render:function(){if(!this.props.visible)return null;return (c('React').createElement('div',{className:"_3de"},c('React').createElement(c('XUISpinner.react'),{background:'dark',size:'large',className:"_3df"}),c('React').createElement('div',{className:"_3dg"})));}});f.exports=j;},null);
__d('P2PAbstractSendMoneyButton.react',['cx','fbt','React','TooltipLink.react','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'P2PAbstractSendMoneyButton',propTypes:{button:j.object,isActive:j.bool.isRequired,isDisabled:j.bool,isMessenger:j.bool.isRequired,onClick:j.func.isRequired,onMouseOver:j.func,recipientName:j.string},_clickGuard:false,render:function(){return (c('React').createElement(c('TooltipLink.react'),{alignH:'center',className:c('joinClasses')(this.props.className,(this.props.isActive?"open":'')+(this.props.isDisabled?' '+"disabled":'')+(this.props.isActive?' '+"_10gz":'')+(this.props.isDisabled?' '+"_10g-":'')+(!this.props.isMessenger&&!this.props.className?' '+"_5uqy":'')+(this.props.isMessenger?' '+"_3ggc":'')),href:'#',onClick:this._handleClick,onMouseDown:this._prepareForClick,onMouseOver:this.props.onMouseOver,position:'above',role:'button',title:this._getLinkTitle()},this.getButton()));},getButton:function(){if(this.props.button)return this.props.button;return c('React').createElement('i',{className:"_5s8l"});},_getLinkTitle:function(){if(this.props.isDisabled)return null;return i._("Send Money");},_prepareForClick:function(){this.props.onMouseDown&&this.props.onMouseDown();this._clickGuard=this.props.isActive;},_handleClick:function(l){l.stopPropagation();if(this._clickGuard){this._clickGuard=false;return;}this.props.onClick();}});f.exports=k;},null);
__d('P2PLogger',['BanzaiLogger'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='P2PPaymentLoggerConfig',i={log:function(j,k){k=babelHelpers['extends']({event:j},k);c('BanzaiLogger').log(h,k);}};f.exports=i;},null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','P2PDispatcher'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j,k;h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;function l(){i.constructor.call(this);k={};j=c('P2PDispatcher').register(this.onEventDispatched.bind(this));}l.prototype.onEventDispatched=function(m){var n=m.data,o=m.type;switch(o){case c('P2PActionConstants').CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(n);this.emit('change');break;case c('P2PActionConstants').CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(n);this.emit('change');break;}};l.prototype.getStateByThreadID=function(m){return k[m];};l.prototype.handleChatSendViewOpened=function(m){k[m.threadID]={amount:m.amount,groupSendRecipientUserID:m.groupSendRecipientUserID,groupSendReceiptDetails:m.groupSendReceiptDetails,groupThreadFBID:m.groupThreadFBID,openRequestTab:m.openRequestTab,memoText:m.memoText,platformData:m.platformData,referrer:m.referrer,paymentRequestID:m.paymentRequestID,sendMoneyDialogShown:true,sendMoneyNUXDismissed:m.sendMoneyNUXDismissed,useModal:m.useModal};};l.prototype.handleChatSendViewClosed=function(m){k[m.threadID]={amount:'',groupSendRecipientUserID:null,groupSendReceiptDetails:null,groupThreadFBID:'',openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false,useModal:false};};f.exports=new l();},null);
__d('P2PSendMoneyContainerBootloader.react',['cx','Bootloader','CurrentEnvironment','DeferredComponent.react','MercuryIDs','MessengerContextualDialog.react','P2PAbstractSendMoneyButton.react','P2PActions','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PSendMoneyDialogStore','React','ReactLayeredComponentMixin','ReactDOM','Run','XUIContextualDialog.react','emptyFunction'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();c('P2PSendMoneyDialogStore');var i=c('React').PropTypes,j=c('CurrentEnvironment').messengerdotcom,k=c('React').createClass({displayName:'P2PSendMoneyContainerBootloader',propTypes:{button:i.node,className:i.string,flyoutAlignment:i.string,onTrigger:i.func,participantIDs:i.array,referrer:i.string,threadID:i.string},getInitialState:function(){return {showPlaceholderDialog:false};},mixins:[c('ReactLayeredComponentMixin')],_clicked:false,log:function(l,m){c('P2PLogger').log(l,babelHelpers['extends']({www_event_referrer:this.props.referrer,www_event_flow:c('P2PPaymentLoggerEventFlow').UI_FLOW_P2P_SEND},m));},onPlaceholderClick:function(){var l=this.props.threadID?c('MercuryIDs').tokenize(this.props.threadID).value:null;this._handleDialogVisibility(!this.state.showPlaceholderDialog);this.log(c('P2PPaymentLoggerEvent').UI_ACTN_SEND_MONEY_BUTTON_PLACEHOLDER_CLICKED,{object_id:l});this._clicked=false;},_handleDialogVisibility:function(l){if(!l){c('P2PActions').chatSendViewClosed({threadID:this.props.threadID});}else c('P2PActions').chatSendViewOpened({referrer:this.props.referrer,threadID:this.props.threadID});this.setState({showPlaceholderDialog:l});},renderLayers:function(){var l={};if(this.state.showPlaceholderDialog){var m=c('CurrentEnvironment').messengerdotcom,n=m?c('MessengerContextualDialog.react'):c('XUIContextualDialog.react'),o=m?282:260;l.placeholderDialog=c('React').createElement(n,{alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:m?'right':'left',context:c('ReactDOM').findDOMNode(this.refs.placeholderButton),onBlur:function(){if(!this._clicked)this._handleDialogVisibility(false);this._clicked=false;}.bind(this),ref:'dialog',shown:true,width:o,position:'above'},c('React').createElement('div',{className:"_c_5"},c('React').createElement(c('P2PLoadingMask.react'),{visible:true})));}return l;},render:function(){return (c('React').createElement(c('DeferredComponent.react'),babelHelpers['extends']({deferredComponent:this._bootloadComponent,deferredPlaceholder:this._renderPlaceholder()},this.props)));},_renderPlaceholder:function(){return (c('React').createElement(c('P2PAbstractSendMoneyButton.react'),{button:this.props.button,className:this.props.className,isActive:false,isDisabled:false,isMessenger:j,onClick:this.onPlaceholderClick,onMouseDown:function(){return this._clicked=true;}.bind(this),onMouseOver:this._bootloadComponentNow,ref:'placeholderButton'}));},_bootloadComponent:function(l){c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["P2PSendMoneyContainer.react"],function(){l.apply(this,arguments);this.setState({showPlaceholderDialog:false});}.bind(this));}.bind(this));},_bootloadComponentNow:function(){c('Bootloader').loadModules(["P2PSendMoneyContainer.react"],c('emptyFunction'));}});f.exports=k;},null);
__d('StickersDispatcher',['Dispatcher_DEPRECATED','StickerConstants'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=Object.assign(new (c('Dispatcher_DEPRECATED'))(),{_handleUpdate:function(i,j){var k=babelHelpers['extends']({payloadSource:i},j);this.dispatch(k);},handleUpdateFromViewActions:function(i){this._handleUpdate(c('StickerConstants').PayloadSource.VIEW_ACTION,i);}});f.exports=h;},null);
__d('StickerActions',['BanzaiLogger','StickersDispatcher','keyMirror'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({ADD_PACK:null,CLICKED_STICKER_IN_THREAD:null,HIDE_TRAY:null,REMOVE_PACK:null,REPLACE_STICKER_STATE:null,RESET_NUM_NEW_PACKS:null,SELECT_PACK:null,SELECT_STORE_PACK:null,SHOW_TRAY:null,UPDATE_TRAY_DATA:null,TRAY_DATA_READY:null,SUBSCRIBE_ASSOCIATED_PAGE:null}),i={Types:h,addPack:function(j){c('StickersDispatcher').dispatch({type:h.ADD_PACK,packID:j});},removePack:function(j){c('StickersDispatcher').dispatch({type:h.REMOVE_PACK,packID:j});},selectPack:function(j,k){if(!k)c('BanzaiLogger').log('StickersLoggerConfig',{event:'select_pack',packid:j});c('StickersDispatcher').dispatch({type:h.SELECT_PACK,packID:j});},selectStorePack:function(j){c('StickersDispatcher').dispatch({type:h.SELECT_STORE_PACK,packID:j});},resetNumNewPacks:function(){c('StickersDispatcher').dispatch({type:h.RESET_NUM_NEW_PACKS});},handleStickerClick:function(j,k){c('StickersDispatcher').dispatch({packID:j,threadID:k,type:i.Types.CLICKED_STICKER_IN_THREAD});},showStickerTray:function(j){c('StickersDispatcher').dispatch({type:i.Types.SHOW_TRAY,threadID:j});},hideStickerTray:function(){c('StickersDispatcher').dispatch({type:i.Types.HIDE_TRAY});},updateTrayData:function(){c('StickersDispatcher').dispatch({type:i.Types.UPDATE_TRAY_DATA});},loadedTrayData:function(){c('StickersDispatcher').dispatch({type:i.Types.TRAY_DATA_READY});},subscribeAssociatedPage:function(j,k){c('StickersDispatcher').dispatch({type:i.Types.SUBSCRIBE_ASSOCIATED_PAGE,packID:j,callback:k});}};f.exports=i;},null);
__d("XMNStickerAssociatedPageSubscriptionController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/commerce\/stickers\/subscription\/",{pack_id:{type:"FBID"}});},null);
__d("XStickerPackImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int",defaultValue:50}});},null);
__d("XStickerQueryImagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/query\/images\/",{query:{type:"String",required:true},sticker_interface:{type:"String"}});},null);
__d("XStickerStateInitialDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/",{});},null);
__d("XStickerStatePackDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});},null);
__d("XStickerStateStoreDataController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/state\/store\/",{});},null);
__d("XStickersAddPackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/addpack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},is_promoted:{type:"Bool",defaultValue:false},no_async_dom:{type:"Bool",defaultValue:false}});},null);
__d("XStickersRemovePackController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/removepack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},no_async_dom:{type:"Bool",defaultValue:false}});},null);
__d('StickerServerRequests',['Promise','AsyncRequest','XMNStickerAssociatedPageSubscriptionController','XStickerPackImagesController','XStickersAddPackController','XStickersRemovePackController','XStickerStateInitialDataController','XStickerStatePackDataController','XStickerStateStoreDataController','XStickerQueryImagesController'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={addPack:function(j,k,l){var m=c('XStickersAddPackController').getURIBuilder().setInt('pack_id',j).setBool('is_promoted',k).getURI();new (c('AsyncRequest'))(m).setHandler(function(n){return l(n.payload);}).send();},removePack:function(j,k){var l=c('XStickersRemovePackController').getURIBuilder().setInt('pack_id',j).getURI();new (c('AsyncRequest'))(l).setHandler(function(m){return k(m.payload);}).send();},getStickersForPack:function(j,k){var l=c('XStickerPackImagesController').getURIBuilder().setInt('pack_id',j).setInt('sticker_size',k).getURI();return new (c('Promise'))(function(m,n){return (new (c('AsyncRequest'))().setURI(l).setMethod('GET').setReadOnly(true).setHandler(function(o){return m(o.payload);}).send());});},getStickersForQuery:function(j,k,l){new (c('AsyncRequest'))().setURI(c('XStickerQueryImagesController').getURIBuilder().setString('query',j).setString('sticker_interface',k).getURI()).setMethod('GET').setReadOnly(true).setHandler(function(m){return l(m);}).send();},fetchTrayData:function(j){return i(c('XStickerStateInitialDataController').getURIBuilder().getURI(),j,true);},fetchStoreData:function(j){return i(c('XStickerStateStoreDataController').getURIBuilder().getURI(),j);},fetchPackData:function(j,k){return i(c('XStickerStatePackDataController').getURIBuilder().setInt('pack_id',j).getURI(),k);},subscribeAssociatedPage:function(j,k){var l=c('XMNStickerAssociatedPageSubscriptionController').getURIBuilder().setFBID('pack_id',j).getURI();new (c('AsyncRequest'))(l).setHandler(function(m){return k();}).send();}};function i(j,k,l){return new (c('Promise'))(function(m,n){return (new (c('AsyncRequest'))(j).setHandler(function(o){return m(o.getPayload());}).setAllowCrossPageTransition(l).send());}).then(k);}f.exports=h;},null);
__d('StickerImages',['StickerServerRequests'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={},i={},j={requestStickersForPack:function(k,l,m){if(!k)return;if(!i[k]){i[k]=c('StickerServerRequests').getStickersForPack(k,l);i[k].then(function(n){n.forEach(function(o){return this.cacheSticker(o);}.bind(this));}.bind(this));}i[k].then(function(n){return m(n);});},cacheSticker:function(k){h[k.id]=k;},getSticker:function(k){return h[k];}};f.exports=j;},null);
__d('StickerState',['ImmutableObject','StickerConfig','PresenceState','StickerActions','StickerConstants','StickerImages','StickerServerRequests'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={},i,j,k,l=null,m=0,n={},o=[],p=[],q=[],r=null,s=null,t=c('PresenceState').get();if(t)r=t.tray_pack_id;var u=c('StickerConfig').ShowStickerReplyNUX,v={onTrayDataReady:function(x){if(!j)j=c('StickerServerRequests').fetchTrayData(function(y){o=y.packs.map(function(z){return w(z);});k=y.mru;m=y.num_new_packs;q=y.tags;});j.then(function(){x();c('StickerActions').loadedTrayData();});},onStoreDataReady:function(x){if(!i)i=c('StickerServerRequests').fetchStoreData(function(y){p=y.packs.map(function(z){return w(z);});});i.then(x);},onPackDataReady:function(x,y){if(!h[x])h[x]=c('StickerServerRequests').fetchPackData(x,function(z){w(z);});h[x].then(y);},getPacksInTrayAllInterfaces:function(){return o;},getPacksInTray:function(){var x=[],y;for(var z=0;z<o.length;z++)if(o[z].id==c('StickerConstants').EMOTICON_PACK_ID){y=o[z];}else if(o[z].isMessengerCapable)x.push(o[z]);y&&x.push(y);return x;},getPacksInCommentsTray:function(){var x=[],y=[],z;for(var aa=0;aa<o.length;aa++)if(o[aa].id==c('StickerConstants').EMOTICON_PACK_ID){z=o[aa];}else if(o[aa].isCommentsCapable){x.push(o[aa]);}else y.push(o[aa]);var ba=x.concat(y);if(z)ba.push(z);return ba;},getPacksInComposerTray:function(){return o.filter(function(x){return x.isComposerCapable;});},getPacksInFramesTray:function(){return o.filter(function(x){return x.isFramePack;});},getPackIDsInTray:function(){return o.map(function(x){return x.id;});},getPacksInStore:function(){return p.filter(function(x){return x.isMessengerCapable;});},getComposerPacksInStore:function(){return p.filter(function(x){return x.isComposerCapable;});},getPack:function(x){return n[x];},getNumNewPacks:function(){return m;},getFeaturedTags:function(){return q;},resetNumNewPacks:function(){m=0;},addMRUPack:function(){if(k){this._addPackToTray(k);k=null;}},addPack:function(x){var y=false;if(n[x])y=n[x].isPromoted;c('StickerServerRequests').addPack(x,y,function(z){this._addPackToTray(z);}.bind(this));},removePack:function(x){c('StickerServerRequests').removePack(x,function(y){o=o.filter(function(z){return z.id!==y;});n[y]=c('ImmutableObject').set(n[y],{isInTray:false});p=p.map(function(z){return n[z.id];});c('StickerActions').updateTrayData();});},setTrayPackID:function(x){r=x;c('PresenceState').doSync();},getTrayPackID:function(x){if(x&&x.length>0&&!x.some(function(y){return y.id===r;})){return x[0].id;}else return r;},setStorePackID:function(x){s=x;},getStorePackID:function(){return s;},shouldShowStickerReplyNUX:function(){return u;},clearShowStickerReplyNUX:function(){u=false;},subscribeAssociatedPage:function(x,y){c('StickerServerRequests').subscribeAssociatedPage(x,function(){n[x]=c('ImmutableObject').set(n[x],{isAssociatedPageSubscribed:true});p=p.map(function(z){return n[z.id];});c('StickerActions').updateTrayData();y();});},_addPackToTray:function(x,y){w(x);n[x.id]=c('ImmutableObject').set(n[x.id],{isPurchased:!y,isInTray:true});var z=o.filter(function(ba){return ba.id===x.id;}).length>0;if(!z){var aa;if(!y){aa=o.filter(function(ba){return ba.isMRU||ba.isSearch;}).length;}else aa=o.filter(function(ba){return ba.id!==c('StickerConstants').EMOTICON_PACK_ID;}).length;o.splice(aa,0,n[x.id]);}p=p.map(function(ba){return n[ba.id];});c('StickerActions').updateTrayData();},_addRecentlyUsedSticker:function(x){for(var y=0;y<l.length;++y)if(l[y].id===x.id){l.splice(y,1);break;}l.unshift(x);},getMRUStickerPack:function(x){if(!l)l=x;return l;},updateRecentlyUsed:function(x){if(!l){this.addMRUPack();return;}this._addRecentlyUsedSticker(c('StickerImages').getSticker(x));}};c('PresenceState').registerStateStorer(function(x){x.tray_pack_id=r;});function w(x){var y=x.id;if(!n[y]){return n[y]=new (c('ImmutableObject'))(x);}else return n[y]=c('ImmutableObject').set(n[y],x);}f.exports=v;},null);
__d('AbstractDialogFitHeight',['csx','cx','CSS','DOM','Event','Style','SubscriptionsHandler','Vector','throttle'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=450,k=100,l=67,m=67;function n(o){'use strict';this.$AbstractDialogFitHeight1=o;}n.prototype.enable=function(){'use strict';this.$AbstractDialogFitHeight2=new (c('SubscriptionsHandler'))();this.$AbstractDialogFitHeight2.addSubscriptions(this.$AbstractDialogFitHeight1.subscribe('beforeshow',this.$AbstractDialogFitHeight3.bind(this)),c('Event').listen(window,'resize',c('throttle')(this.$AbstractDialogFitHeight3.bind(this))));this.$AbstractDialogFitHeight4=c('DOM').find(this.$AbstractDialogFitHeight1.getRoot(),"._4-i2");c('CSS').addClass(this.$AbstractDialogFitHeight4,"_5pfh");this.$AbstractDialogFitHeight5=k;if(c('DOM').scry(this.$AbstractDialogFitHeight1.getRoot(),"._4-i0").length)this.$AbstractDialogFitHeight5+=l;if(c('DOM').scry(this.$AbstractDialogFitHeight1.getRoot(),"._5a8u").length)this.$AbstractDialogFitHeight5+=m;};n.prototype.disable=function(){'use strict';this.$AbstractDialogFitHeight2.release();this.$AbstractDialogFitHeight2=null;c('CSS').removeClass(this.$AbstractDialogFitHeight4,"_5pfh");};n.prototype.$AbstractDialogFitHeight3=function(){'use strict';var o=c('Vector').getViewportDimensions().y,p=o-this.$AbstractDialogFitHeight5;c('Style').set(this.$AbstractDialogFitHeight4,this.getHeightProperty(),Math.max(j,p)+'px');this.$AbstractDialogFitHeight1.updatePosition();};f.exports=n;},null);
__d('DialogFitHeight',['AbstractDialogFitHeight'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('AbstractDialogFitHeight'));i=h&&h.prototype;j.prototype.getHeightProperty=function(){'use strict';return 'height';};function j(){'use strict';h.apply(this,arguments);}f.exports=j;},null);
__d('StickerStoreController',['cx','Bootloader','DialogFitHeight','DOM','LayerAutoFocus','LayerFadeOnHide','LayerHideOnEscape','React','ReactComponentRenderer','StickerActions','XUIDialog.react','XUIDialogBody.react','XUISpinner.react','isSocialPlugin','requestAnimationFrame'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=688,k=320,l=null,m=c('React').createClass({displayName:'StoreLayer',propTypes:{isComposer:i.bool,shown:i.bool},getDefaultProps:function(){return {isComposer:false,shown:false};},getInitialState:function(){return {renderStore:function(){return (c('React').createElement('div',{className:"_5r5e"},c('React').createElement(c('XUISpinner.react'),{background:'light',size:'large'})));}};},componentDidMount:function(){c('Bootloader').loadModules(["StickerStore.react"],function(p){this.setState({renderStore:function(){return (c('React').createElement(p,{isComposer:this.props.isComposer,shown:this.props.shown}));}.bind(this)});}.bind(this));},_onToggle:function(p){c('requestAnimationFrame')(function(){if(l)l.setProps({shown:p});});},render:function(){var p=c('isSocialPlugin')()&&document.body.offsetWidth<j?k:j;return (c('React').createElement(c('XUIDialog.react'),{behaviors:{DialogFitHeight:c('DialogFitHeight'),LayerAutoFocus:c('LayerAutoFocus'),LayerFadeOnHide:c('LayerFadeOnHide'),LayerHideOnEscape:c('LayerHideOnEscape')},onToggle:this._onToggle,shown:this.props.shown,width:p},c('React').createElement(c('XUIDialogBody.react'),{className:"_5rq- autofocus"},this.state.renderStore())));}});function n(p){var q=c('DOM').create('div');c('DOM').appendContent(document.body,q);l=new (c('ReactComponentRenderer'))(m,q);l.setProps({isComposer:p,shown:true});}var o={showStore:function(p,q){if(!l){n(!!q);}else l.setProps({shown:true,isComposer:!!q});c('StickerActions').selectStorePack(p);}};f.exports=o;},null);