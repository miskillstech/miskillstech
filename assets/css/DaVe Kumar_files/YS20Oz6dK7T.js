/*!CK:4110140871!*//*1458167452,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["vD6\/A"]); }

__d("MercurySyncTopicType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELTA:"delta",DELTAFLOW:"deltaflow"};},null);
__d("MessagingEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",UPDATE_BLOCKER_STATUS:"update_blocker_status",UPDATE_BLOCKEE_STATUS:"update_blockee_status",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"};},null);
__d("OzConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTHOR_TYPES:{BOT:"bot",TRAINER:"trainer",USER:"user"},ATTS:{COMMAND:"\u0040COMMAND",IMAGE:"image",SUGG:"\u0040SUGG",TEMPLATE:"template",SURVEY:"survey"},SESSION_INFO_EVENT:"iframenonce_fb_session_info",TOKENS:{USER_FIRST_NAME:"user-first-name"},REMINDERS:{RANGE_IN_YEARS:5},M_FBIDS:{M:"881263441913087",M_DEV:"1579802578966277",P:"506060876211905"}};},null);
__d('ChatOpenTabEventLogger',['Banzai','ChatImpressionLogger','MercuryIDs'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h='messaging_tracking',i={log:function(j,k,l,m){var n={referrer:j||'',message_thread_id:k,message_view:'chat',timestamp_send:Date.now(),message_target_ids:null};if(l!==undefined)n.message_target_ids=[l];c('ChatImpressionLogger').logImpression(j,l,m);c('Banzai').post(h,n,{delay:0,retry:true});var o=c('MercuryIDs').getUserIDFromThreadID(String(k));c('Banzai').post('page_message_button_click',{page_id:o,ref:j});}};f.exports=i;},null);
__d('ChatWelcomeMessage',['ImmutableObject'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.$ChatWelcomeMessage1={};}h.prototype.setWelcomeMessage=function(j,k,l){this.$ChatWelcomeMessage1[j]=new (c('ImmutableObject'))({timestamp:Date.now(),thread_id:j,author:k,body:l});};h.prototype.getWelcomeMessage=function(j){return this.$ChatWelcomeMessage1[j];};var i=new h();f.exports=i;},null);
__d('ChatOpenTabImpl',['csx','ChatApp','ChatOpenTabEventLogger','ChatWelcomeMessage','DOM','GroupChatMessageBlockAlert','LogHistory','MercuryBlockedParticipants','MercuryIDs','MercuryThreadActions','MercuryThreadIDMap','MercuryThreads','Toggler','requireWeak'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('MercuryBlockedParticipants').get(),j=c('MercuryThreadActions').get(),k=c('MercuryThreadIDMap').get(),l=c('MercuryThreads').get(),m=null;c('requireWeak')('ChatTabModel',function(o){return m=o;});var n={canOpenTab:function(){return !!(c('ChatApp')&&!c('ChatApp').isHidden());},openEmptyTab:function(o,p,q){if(this.canOpenTab()&&m){var r=m.getEmptyTab();this._openClientTab(r,null);this._logChatOpenTabEvent(p,r,null,q);this._closeJewelFlyout();}},openThreadTab:function(o,p,q,r,s){if(!c('MercuryIDs').isValid(o)){k.getClientIDFromServerID(o,function(t){n.openThreadTabImpl(t,p,q,r,s);});}else n.openThreadTabImpl(o,p,q,r,s);},openThreadTabImpl:function(o,p,q,r,s){l.getThreadMeta(o,function(t){if(i.isPresentInGroupThread(t)){c('GroupChatMessageBlockAlert').show(i.inGroupThread(t),function(){this.openClientTab(o,p,q,r,s);}.bind(this),function(){j.leaveGroup(o);});}else this.openClientTab(o,p,q,r,s);}.bind(this));},openClientTab:function(o,p,q,r,s){this._openClientTab(o,r,s);this._logChatOpenTabEvent(p,o,null,q);this._closeJewelFlyout();},openUserTab:function(o,p,q){var r=c('MercuryIDs').getThreadIDFromUserID(o);this._openClientTab(r);this._logChatOpenTabEvent(p,r,o,q);},openPageTab:function(o,p,q){var r=c('MercuryIDs').getThreadIDFromUserID(p);l.getThreadMeta(r,function(s){if(o&&o.length>0){var t=(Date.now()-s.timestamp)/1000,u=t/3600;if(s.message_count===0||u>24)c('ChatWelcomeMessage').setWelcomeMessage(r,c('MercuryIDs').getParticipantIDFromUserID(p),o);}});this._openClientTab(r);this._logChatOpenTabEvent(q,r,p);},_closeJewelFlyout:function(){var o=c('DOM').scry(document,"div._1z4y")[0],p=c('Toggler').getInstance(o);if(p&&p.getActive())p.hide();},_openClientTab:function(o,p,q){l.getThreadMeta(o,function(r){if(!this.canOpenTab())c('LogHistory').getInstance('mercury').error('Unable to open chat tab',o);c('ChatApp').tabController.openTab(o,c('ChatApp').tabsViewport,p,!!q);}.bind(this));},_logChatOpenTabEvent:function(o,p,q,r){c('ChatOpenTabEventLogger').log(o,p,q,r);}};f.exports=n;},null);
__d('ChatMentionsNotifications',['fbt','CurrentUser','MercuryParticipants'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={notifyIfMessageToMe:function(j){var k='fbid:'+c('CurrentUser').getID(),l=j.body;c('MercuryParticipants').get(k,function(m){var n=new RegExp(m.short_name,"i");if(n.test(l))i._notify(j);});},_notify:function(j){var k=48,l=j.body;if(l.length>k)l=l.substr(0,k-3)+"...";new Notification(h._("You were tagged in a message!"),{body:l,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};f.exports=i;},null);
__d('ChatTabViewInstances',['Map'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new (c('Map'))();},null);
__d('ChatNewMessageHandler',['ChatActivity','ChatMentionsNotifications','ChatTabModel','ChatTabViewInstances','JSLogger','MercuryAssert','MercuryBrowserAlerts','UserActivity','MercuryConfig','MercuryThreadlistConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('chat_new_message'),i={_notify:function(j,k,l){if(c('MercuryConfig').DesktopNotificationsGK)c('ChatMentionsNotifications').notifyIfMessageToMe(k);var m=c('ChatTabViewInstances').get(j);l.view_is_visible=m&&m.isVisible();l.view_is_focused=m&&m.isFocused();if(!l.view_is_visible)h.log('message_to_hidden');l.is_active=c('ChatActivity').isActive();c('MercuryBrowserAlerts').messageReceived(k);},newMessage:function(j,k){c('MercuryAssert').isThreadID(j);var l=c('ChatTabModel').getTab(j),m={thread_id:j,message_id:k.message_id,to_new_tab:!l,to_raised_tab:l?!!l.raised:true};this._notify(j,k,m);h.log('message',m);}};c('MercuryBrowserAlerts').subscribe('before-alert',function(j,event){var k=event.threadID,l=c('ChatTabViewInstances').get(k),m=c('ChatTabModel').getTab(k),n=c('MercuryThreadlistConstants').MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(m&&m.raised&&l&&l.isVisible()&&l.isFocused()&&c('UserActivity').isActive(n)){l.tryMarkAsRead();event.cancelAlert();}});f.exports=i;},null);
__d('ChatTabLRUManager',['ChatTabViewInstances','ChatTabModel','InitialServerTime','MercuryThreads'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreads').get(),i={getLRUVisibleTab:function(j){if(j.hasRoomForRaisedTab())return undefined;var k=Object.keys(j.getTabsToShow()||{}),l=1*60,m=null,n=Infinity;for(var o=0;o<k.length;o++){var p=k[o],q=h.getThreadMetaNow(p);if(c('ChatTabModel').isTabPromoted(p))continue;if(!c('ChatTabViewInstances').get(p).hasEmptyInput()||!q)continue;var r=(c('InitialServerTime').serverTime-q.timestamp)/1000;if(!q.timestamp||q.timestamp&&q.timestamp<n&&r>l){m=q.thread_id;n=q.timestamp;}}return m;}};f.exports=i;},null);
__d('ChatTabPolicy',['ChatBehavior','JSLogger','MercuryActionType','MercuryLogMessageType','MercuryAssert','MercuryBlockedParticipants','MercuryConfig','MercuryGroupThreadMentions','MercuryIDs','MercuryParticipantTypes','MercurySourceType','MercuryThreadActions','MercuryThreadInfo','MercuryViewer','MessagingTag','OzConstants','PresencePrivacy','Set','ShortProfiles','WorkModeConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryBlockedParticipants').get(),i=c('MercuryThreadActions').get(),j=c('OzConstants').M_FBIDS,k=j.M_DEV,l=j.M,m=j.P,n=new (c('Set'))([k,l,m]),o=c('JSLogger').create('tab_policy');f.exports={messageIsAllowed:function(p,q,r){var s=p.thread_id,t=q.message_id;c('MercuryAssert').isThreadID(s);c('MercuryAssert').isParticipantID(q.author);var u;if(c('MercuryThreadInfo').isMuted(p)){u={thread_id:s,message_id:t,mute_settings:p.mute_settings};o.log('message_thread_muted',u);if(c('MercuryConfig').GroupChatMentionsGK)c('MercuryGroupThreadMentions').messageMentionsViewer(q,function(x){if(x)r();});return;}if(p.read_only){u={thread_id:s,message_id:t,mode:p.mode};o.log('message_read_only',u);return;}if(q.source==c('MercurySourceType').EMAIL||q.source==c('MercurySourceType').TITAN_EMAIL_REPLY){u={thread_id:s,message_id:t,source:q.source};o.log('message_source_not_allowed',u);return;}var v=c('MercuryIDs').getUserIDFromParticipantID(q.author);if(!v){o.log('message_bad_author',{thread_id:s,message_id:t,user:v});return;}if(q.action_type!=c('MercuryActionType').USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(q,p)){u={thread_id:s,message_id:t,type:q.action_type};o.log('message_non_user_generated',u);return;}if(p.is_canonical_user&&!c('ChatBehavior').notifiesUserMessages()){o.log('message_jabber',{thread_id:s,message_id:t});i.markSeen(s,true);return;}if(p.is_canonical&&!p.other_user_fbid){o.log('message_canonical_contact',{thread_id:s,message_id:t});return;}if(p.folder!=c('MessagingTag').INBOX){o.log('message_folder',{thread_id:s,message_id:t,folder:p.folder});return;}if(h.isPresentInGroupThread(p)){u={thread_id:s,message_id:t};o.log('message_blocked_participants',u);return;}var w=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());c('ShortProfiles').getMulti([v,w],function(x){if(!c('PresencePrivacy').allows(v)){o.log('message_privacy',{thread_id:s,message_id:t,user:v});return;}var y=x[v].employee&&x[w].employee,z=c('WorkModeConfig').is_work_user;if(!y&&!z&&!x[v].isCommercePage&&!n.has(v)&&x[v].type!==c('MercuryParticipantTypes').FRIEND){o.log('message_non_friend',{thread_id:s,message_id:t,user:v});return;}r();});},_messageIsNewlyCreatedGroup:function(p,q){return p.action_type===c('MercuryActionType').LOG_MESSAGE&&p.log_message_type===c('MercuryLogMessageType').THREAD_NAME&&q.message_count===1;}};},null);
__d('ChatTabPresence',['AvailableList','ChatTabModel','MercuryIDs'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};function i(j){var k=c('MercuryIDs').getUserIDFromThreadID(j);if(k)c('AvailableList').updateForID(k);}c('ChatTabModel').addListener(function(){var j=c('ChatTabModel').get();j.tabs.forEach(function(k){if(k.raised&&!h[k.id])i(k.id);});h={};j.tabs.forEach(function(k){if(k.raised)h[k.id]=true;});});f.exports={};},null);
__d('ChatTabViewEvents',['Arbiter'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new (c('Arbiter'))();},null);
__d('NubController',['ArbiterMixin','Dock'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){}Object.assign(h.prototype,c('ArbiterMixin'),{init:function(i){this.el=i;c('Dock').registerNubController(i,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){c('Dock').hide(this.el);},show:function(){c('Dock').show(this.el);}});f.exports=h;},null);
__d('ChatTabViewSelector',['Arbiter','ArbiterMixin','CSS','ChatTabActions','CurrentUser','DOM','DataStore','Event','MenuDeprecated','MercuryThreadInformer','MercuryThreadTitle.react','MercuryThreads','NubController','React','ReactDOM','ChatTabTemplates','Toggler'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadInformer').get(),i=c('MercuryThreads').get();function j(k){var l=c('ChatTabTemplates')[':fb:chat:tab:selector'].build(),m=l.getRoot(),n=l.getNode('menu'),o=c('DOM').find(n,'.uiMenuInner'),p={},q=new (c('NubController'))().init(m);c('CSS').hide(m);c('DOM').insertBefore(k,m);function r(u){var v=0;for(var w in p){var x=p[w],y=i.getThreadMetaNow(w),z=x.getNode('unreadCount'),aa=y&&y.unread_count||0;v+=aa;if(aa>9)aa='+';c('CSS').conditionClass(z,'invisible_elem',!aa);c('DOM').setContent(z,aa);}var ba=l.getNode('numMessages');c('CSS').conditionShow(ba,v);c('DOM').setContent(ba,v);}this.setTabData=function(u){var v=p;p={};if(u.length<1){c('CSS').hide(m);return;}c('CSS').show(m);c('DOM').empty(o);u.forEach(function(y){var z=c('ChatTabTemplates')[':fb:chat:tab:selector:item'].build(),aa=z.getNode('content');p[y.id]=z;i.getThreadMeta(y.id,function(ca){c('ReactDOM').render(c('React').createElement(c('MercuryThreadTitle.react'),{thread:ca,useAndSeparator:true,viewer:c('CurrentUser').getID()}),aa);});c('DOM').prependContent(o,z.getRoot());c('DataStore').set(z.getRoot(),'threadID',y.id);var ba=z.getNode('closeButton');c('Event').listen(ba,'click',function(event){c('ChatTabActions').closeTab(y.id,'selector/close-tab');event.kill();});});for(var w in v)if(v.hasOwnProperty(w)){var x=v[w].getNode('content');x&&c('ReactDOM').unmountComponentAtNode(x);}q.flyoutContentChanged();c('DOM').setContent(l.getNode('numTabs'),u.length);r();};function s(event,u){if(u.menu!=n)return;var v=c('DataStore').get(u.item,'threadID');j.inform('selected',v);c('Toggler').hide(m);}function t(event,u){c('MenuDeprecated').register(n);}c('MenuDeprecated').subscribe('select',s.bind(this));c('Toggler').listen('show',m,function(){c('Arbiter').inform('layer_shown',{type:'ChatTabSelector'});t();});c('Toggler').listen('hide',m,function(){c('Arbiter').inform('layer_hidden',{type:'ChatTabSelector'});});h.subscribe('threads-updated',r);}Object.assign(j,c('ArbiterMixin'));f.exports=j;},null);
__d('ChatTabController',['ChatTabPresence','Arbiter','ChatActivity','ChatConfig','ChatNewMessageHandler','ChatTabActions','ChatTabLRUManager','ChatTabModel','ChatTabPolicy','ChatTabViewEvents','ChatTabViewInstances','ChatTabViewSelector','JSLogger','MercuryThreadInformer','MercuryThreadActions','MercuryThreads','MercuryViewer','Style','UserAgent_DEPRECATED'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();c('ChatTabPresence');var h=c('MercuryThreadInformer').get(),i=c('MercuryThreadActions').get(),j=c('MercuryThreads').get(),k=c('ChatConfig').get('tab_auto_close_timeout')||7200000,l=c('JSLogger').create('tab_controller');function m(x,y,z){var aa=c('ChatTabModel').get().tabs,ba=aa[x],ca,da;if(aa.length<2)return false;var ea=aa.slice(x+1),fa=aa.slice(0,x),ga=ea.concat(fa);if(!y)ga.reverse();if(ba)ga.push(ba);for(var ha=0;ha<ga.length;ha++){ca=ga[ha];da=c('ChatTabViewInstances').get(ca.id);if(da&&da.isVisible()&&(!z||ca.raised)){da.focus();return true;}}return false;}function n(x,y){var z=y&&y.getRightmostHiddenTab();if(z===x)return null;return z;}function o(){return Math.floor(Math.random()*2147483648).toString(16);}function p(x,y,z,aa){c('ChatTabActions').raiseTab(x,true,z);var ba=y&&y.getLeftmostVisibleTab(),ca=y&&y.getTabsToShow();if(ca&&!ca[x]&&ba){c('ChatTabModel').promoteThreadInPlaceOfThread(x,ba,n(x,y),true);}else c('ChatTabActions').promoteTab(x);c('Arbiter').inform('chat/open-tab',x);if(aa)return;var da=c('ChatTabViewInstances').get(x);da&&da.focus();}function q(x,y){if(!c('ChatTabModel').getTab(x))c('ChatTabActions').raiseTab(x,false);var z=y&&c('ChatTabLRUManager').getLRUVisibleTab(y),aa=y&&y.getTabsToShow();if(aa&&!aa[x]&&z)c('ChatTabModel').promoteThreadInPlaceOfThread(x,z,n(x,y));}function r(x){c('ChatTabViewSelector').subscribe('selected',function(y,z){p(z,x);});c('Arbiter').subscribe('page_transition',function(y,z){c('ChatTabActions').closeFragileTabs();});c('Arbiter').subscribe('chat-visibility/go-offline',function(){c('ChatTabActions').closeAllTabs();});c('ChatActivity').subscribe('idle',function(y,z){if(z>k){var aa=c('ChatTabModel').get().tabs;aa.forEach(function(ba){var ca=ba.id;j.getThreadMeta(ca,function(da){if(!da.unread_count){l.log('autoclose_idle_seen',{thread_id:ca,idleness:z});c('ChatTabActions').closeTab(ca,'autoclose_idle_seen');}});});}});c('ChatTabViewEvents').subscribe('nub-activated',function(y,z){p(z,x);});c('ChatTabViewEvents').subscribe('focus-tab',function(y,z){var aa=c('ChatTabModel').getTab(z);if(aa&&aa.raised)p(z,x,aa.signatureID,false);});c('ChatTabViewEvents').subscribe('interaction-with-tab',function(y,z){var aa=c('ChatTabModel').getTab(z);aa&&aa.raised&&i.markSeen(z);});c('ChatTabViewEvents').subscribe('esc-pressed',function(y,z){l.log('close_esc',{thread_id:z});var aa=c('ChatTabModel').indexOf(z);c('ChatTabActions').closeTab(z,'close_esc');setTimeout(function(){m(aa-1,true,true);},0);});h.subscribe('messages-received',function(y,z){for(var aa in z){var ba=z[aa];for(var ca=0;ca<ba.length;ca++){var da=ba[ca];if(da.author!=c('MercuryViewer').getID()){if(!da.is_unread){l.log('message_already_read',{thread_id:da.thread_id});continue;}j.getThreadMeta(aa,function(ea){c('ChatTabPolicy').messageIsAllowed(ea,da,function(){q(aa,x);c('ChatNewMessageHandler').newMessage(aa,da);});});}}}});h.subscribe('thread-read-changed',function(y,z){for(var aa in z)if(!z[aa].mark_as_read){l.log('autoclose_marked_unread',{thread_id:aa});c('ChatTabActions').closeTab(aa,'autoclose_marked_unread');}});c('ChatTabViewEvents').subscribe('tab-pressed',function(y,z){return !m(c('ChatTabModel').indexOf(z.id),z.shiftPressed);});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(y,z){z.chat_controller={auto_close_timeout:k};});this.openTab=function(y,z,aa,ba){p(y,z,o(),ba);if(aa)aa(c('ChatTabViewInstances').get(y));};}if(c('UserAgent_DEPRECATED').firefox()){var s=function(){return c('Style').get(document.body,'overflowX')+' '+c('Style').get(document.body,'overflowY');},t=s(),u=function(){var x=s();if(x!==t){t=x;c('Arbiter').inform('overflow-applied-to-body');}};if('MutationObserver' in window){var v=new MutationObserver(u),w={attributes:true,attributeFilter:['class','style']};v.observe(document.documentElement,w);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))u();},false);}f.exports=r;},null);
__d('ChatNubLogger',['BanzaiLogger','ScriptPath','pageID'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='TimeSpentChatNubLoggerConfig',i={INPUT_ACTIVE:'active',INPUT_INACTIVE:'inactive'},j={ENTER:'enter',LEAVE:'leave'},k=i.INPUT_INACTIVE,l=0,m=false;function n(){if(k==i.INPUT_ACTIVE&&!m){k=i.INPUT_INACTIVE;o(j.LEAVE);l=0;}else if(k==i.INPUT_INACTIVE&&m){k=i.INPUT_ACTIVE;l=Date.now();o(j.ENTER);}}function o(event){var q=c('BanzaiLogger').create({retry:true}),r=Date.now();q.log(h,{event:event,client_event_time_ms:r,active_time_ms:event==j.LEAVE?r-l:0,page_id:c('pageID'),script_path:c('ScriptPath').getScriptPath(),page_data:c('ScriptPath').getPageInfo()?c('ScriptPath').getPageInfo().extraData:{}});}var p={processEvent:function(q){switch(q){case 'focus':m=true;break;case 'blur':m=false;break;default:break;}n();}};f.exports=p;},null);
__d('ChatPhotoUploader.react',['cx','fbt','ix','Promise','Bootloader','Image.react','InlineBlock.react','Link.react','MercuryConfig','React','ReactDOM','SubscriptionsHandler','emptyFunction','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('React').createClass({displayName:'ChatPhotoUploader',propTypes:{actionURI:k.string,allowCrossPage:k.bool,customUI:k.bool,disabled:k.bool,imageClassName:k.string,imagesOnly:k.bool,linkClassName:k.string,onSubmit:k.func,onAllUploadsComplete:k.func,onLastUploadFail:k.func,onLastUploadCancel:k.func,onMount:k.func,onUploadError:k.func},getDefaultProps:function(){return {actionURI:c('MercuryConfig').upload_url,allowCrossPage:true,costomUI:false,disabled:false,imageClassName:"_509w",imagesOnly:true,linkClassName:'',onSubmit:c('emptyFunction'),onAllUploadsComplete:c('emptyFunction'),onLastUploadFail:c('emptyFunction'),onLastUploadCancel:c('emptyFunction')};},shouldComponentUpdate:function(m,n){return m.actionURI!=this.props.actionURI||m.disabled!==this.props.disabled;},componentDidMount:function(){if(this.props.onMount)this.props.onMount(this);},componentDidUpdate:function(m,n){if(this._uploader)this._uploader.setAllowCrossPage(this.props.allowCrossPage);},componentWillUnmount:function(){if(!this.isUploading()||!this.props.allowCrossPage)this._cleanup();},render:function(){var m=this.props.imagesOnly?i._("Add Photos"):i._("Add Files"),n=c('joinClasses')("_4q61"+(!this.props.customUI?' '+"_5f0v":'')+(!this.props.customUI?' '+"_509v":''),this.props.linkClassName);return (c('React').createElement('form',{action:this.props.actionURI,className:"_vzk",title:m,method:'post',onClick:function(o){o.stopPropagation();if(this.props.disabled)o.preventDefault();}.bind(this),ref:'form'},c('React').createElement('input',{type:'hidden',name:'attach_id',ref:'attachID'}),c('React').createElement('input',{type:'hidden',name:'images_only',value:this.props.imagesOnly}),c('React').createElement(c('InlineBlock.react'),{onClick:this._bootloadChatAutoSendPhotoUploader,className:c('joinClasses')(this.props.className,"_m _4q60 _3rzn")},c('React').createElement('input',{disabled:this.props.disabled,type:'file',className:"_n _2__f",name:'attachment[]',multiple:'true',accept:this.props.imagesOnly?'image/*':'*',ref:'input',title:m}),c('React').createElement(c('Link.react'),{className:n,tabIndex:-1},c('React').createElement('i',{className:this.props.imageClassName,alt:i._("Camera")})))));},_handleSubmit:function(m,n){this.props.onSubmit(m,n);},_handleAllUploadsCompleted:function(m,n){this.props.onAllUploadsComplete(m,n);if(!this.isMounted())this._cleanup();},_handleLastUploadFailed:function(m,n){this.props.onLastUploadFail(m,n);if(!this.isMounted())this._cleanup();},_handleLastUploadCanceled:function(m,n){this.props.onLastUploadCancel(m,n);if(!this.isMounted())this._cleanup();},_handleUploadError:function(m,n){this.props.onUploadError(n);if(!this.isMounted())this._cleanup();},isUploading:function(){return (this._uploader&&this._uploader.isUploading()||this._uploaderPromiseIsResolving);},_bootloadChatAutoSendPhotoUploader:function(){if(!this._uploaderPromise){this._uploaderPromiseIsResolving=true;this._uploaderPromise=new (c('Promise'))(function(m){c('Bootloader').loadModules(["ChatAutoSendPhotoUploader"],function(n){this._uploaderPromiseIsResolving=false;this._uploader=new n(c('ReactDOM').findDOMNode(this.refs.form),c('ReactDOM').findDOMNode(this.refs.input),c('ReactDOM').findDOMNode(this.refs.attachID));this._uploader.setAllowCrossPage(this.props.allowCrossPage);this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled),this._uploader.subscribe('file-upload-error',this._handleUploadError));m(this._uploader);}.bind(this));}.bind(this));}return this._uploaderPromise;},uploadFiles:function(m){this._bootloadChatAutoSendPhotoUploader().then(function(n){n.uploadFiles(m);});},uploadURL:function(m){this._bootloadChatAutoSendPhotoUploader().then(function(n){n.uploadURL(m);});},_cleanup:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();}});f.exports=l;},null);
__d('ChatDateBreak.react',['cx','React','formatDate','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatDateBreak',propTypes:{date:i.instanceOf(Date).isRequired},shouldComponentUpdate:function(k){return this.props.date.getTime()!==k.date.getTime();},render:function(){var k=c('formatDate')(this.props.date,{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});return (c('React').createElement('time',{className:c('joinClasses')(this.props.className,"_5w-5")},c('React').createElement('span',{className:"_5w-6"},k)));}});f.exports=j;},null);
__d('ChatAnimatedGifs',['URI'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={shouldHideBody:function(i){if(!i.has_attachment)return false;for(var j=0;j<i.attachments.length;j++){var k=i.attachments[j];if(k.preview_url){var l=h.getRawUrlFromSafeUrl(k.preview_url);if(i.body==l)return true;}}return false;},getRawUrlFromSafeUrl:function(i){return new (c('URI'))(i).getQueryData().url;}};f.exports=h;},null);
__d('ChatAttachmentProgressBar.react',['cx','Animation','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=34,k=c('React').createClass({displayName:'ChatAttachmentProgressBar',propTypes:{ephemeralTTLMode:i.number.isRequired,timestamp:i.number.isRequired,isMessageAuthor:i.bool},componentDidMount:function(){if(!this.refs.progressBar)return;var l=j,m=this.props.ephemeralTTLMode,n=l/m*(Date.now()-this.props.timestamp),o=this._getRemainingTime();if(o>0&&n<l){var p=this.props.isMessageAuthor?'left':'right';new (c('Animation'))(this.refs.progressBar).from(p,n).to(p,l).duration(o).go();}},_getRemainingTime:function(){return this.props.ephemeralTTLMode-(Date.now()-this.props.timestamp);},render:function(){return (c('React').createElement('a',{className:"_4yo"},c('React').createElement('span',{className:"_1gxq"}),c('React').createElement('span',{className:"_1gxr",ref:'progressBar'},c('React').createElement('span',{className:"_4yu"}))));}});f.exports=k;},null);
__d('ChatProgressBar.react',['cx','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=2000,k=250,l=c('React').createClass({displayName:'ChatProgressBar',_timer:null,propTypes:{isMessageAuthor:i.bool,onDone:i.func,setExpiredAnimation:i.func,timestamp:i.number.isRequired,ttl:i.number.isRequired},getInitialState:function(){return {percentage:this._getRemainingPercentage()};},componentDidMount:function(){if(this._getRemainingTime()>0){this._animateProgressBar();}else this.props.setExpiredAnimation&&this.props.setExpiredAnimation();},componentWillUnmount:function(){this._timer&&clearTimeout(this._timer);},render:function(){return (c('React').createElement('div',{className:"_3pcc"+(this._getRemainingTime()<0?' '+"_3pcd":''),ref:'item',style:{width:this.state.percentage.toString()+'%'}}));},_getRemainingTime:function(){return this.props.ttl-(Date.now()-this.props.timestamp)-j;},_getRemainingPercentage:function(){return 100-(Date.now()-this.props.timestamp)/(this.props.ttl-j)*100;},_animateProgressBar:function(){this._timer=setInterval(function(){if(this.isMounted())this.setState({percentage:this._getRemainingPercentage()});if(this._getRemainingTime()<0){clearTimeout(this._timer);this.props.onDone&&this.props.onDone();}}.bind(this),k);}});f.exports=l;},null);
__d('EmojiOnlyMessage.react',['cx','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'EmojiOnlyMessage',propTypes:{sourceURIs:i.arrayOf(i.shape({emoji:i.any,type:i.string.isRequired,title:i.string,url:i.string.isRequired})).isRequired},render:function(){var k=this.props.sourceURIs,l=0,m=k.map(function(n){l++;if(n.emoji)return c('React').createElement('span',{key:l},n.emoji);return c('React').createElement('span',{className:"_5qi2",key:l,style:{backgroundImage:'url('+n.url+')'},title:n.title});});return (c('React').createElement('div',{className:this.props.className,tabIndex:'0'},m));}});f.exports=j;},null);
__d('EmployeeLinkMatcher',['CurrentUser'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new RegExp('^[\\s.,:]'),i=new RegExp('(?:[\\s.,:]|^)([DTP]\\d{4,})(?:[\\s.,:?]|$)','im'),j=function(m){if(!c('CurrentUser').isEmployee())return null;var n=i.exec(m);if(n==null)return null;return {lnk:n[1],idx:n.index+(h.exec(n[0])?1:0)};},k=function(m){var n=c('CurrentUser').isEmployee()&&i.exec(m)!=null;return n;},l={match:j,isMatch:k};f.exports=l;},null);
__d('EmployeeLinkRanges',['EmployeeLinkMatcher'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={PHABRICATOR_PREFIX:'https://phabricator.fb.com/',TASKS_PREFIX:'https://our.intern.facebook.com/intern/tasks/?t=',get:function(i){var j=arguments.length<=1||arguments[1]===undefined?0:arguments[1],k=i.substr(j),l=c('EmployeeLinkMatcher').match(k);if(!l)return [];var m=l.lnk;j+=l.idx;var n='';switch(m[0].toLowerCase()){case 'd':case 'p':n=this.PHABRICATOR_PREFIX+m.toUpperCase();break;case 't':n=this.TASKS_PREFIX+m.substr(1);break;default:return [];}var o=m.length,p=[{offset:j,length:o,entity:{url:n}}];return p.concat(this.get(i,j+o));}};f.exports=h;},null);
__d('P2PTriggersUtils',['P2PGKValues'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/,i={canSeeTriggers:function(j){if(!c('P2PGKValues').P2PEnabled)return false;return true;},getMatches:function(j){return j.match(h);}};f.exports=i;},null);
__d('getURLRanges',['URI','URLScraper'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=arguments.length<=1||arguments[1]===undefined?0:arguments[1],k=i.substr(j),l=c('URLScraper').match(k);if(!l)return [];var m=l;if(!/^[a-z][a-z0-9\-+.]+:\/\//i.test(l))m='http://'+l;if(!c('URI').isValidURI(m))return [];j+=k.indexOf(l);var n=l.length,o=[{offset:j,length:l.length,entity:{url:m}}];return o.concat(h(i,j+n));}f.exports=h;},null);
__d('MercuryMessageBody.react',['cx','fbt','BootloadedComponent.react','EmoticonsList','EmployeeLinkMatcher','JSResource','Link.react','MercuryConfig','MessengerSupportedEmoji','P2PTriggersUtils','ReactComponentWithPureRenderMixin','React','SupportedEmoji','TextWithEntities.react','URI','URLMatcher','cancelAnimationFrame','EmployeeLinkRanges','getURLRanges','isFacebookURI','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'MercuryMessageBody',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{body:j.string,ranges:j.array,threadID:j.string,customLike:j.object},getInitialState:function(){return {richText:false};},_shouldRenderP2PTriggers:false,componentDidMount:function(){this._raf=c('requestAnimationFrame')(this.setIsRichText);},targetBlankLinkInterpolator:function(l,m){if(m.entity&&m.entity.url){var n=new (c('URI'))(m.entity.url);if(c('isFacebookURI')(n)&&!n.getFragment())m.entity.url=n.addQueryData({__mref:'message_bubble'}).toString();m.entity.url=/.*[^#]/.exec(m.entity.url)[0];}return (c('React').createElement(c('Link.react'),{href:{url:m.entity.url.toString(),shimhash:m.entity.shimhash},s:m.entity.s,target:'_blank'},l));},setIsRichText:function(){delete this._raf;var l=this.props,m=l.body,n=l.ranges;m=m||'';this._shouldRenderP2PTriggers=!!(this.props.threadID&&c('P2PTriggersUtils').canSeeTriggers(this.props.threadID)&&c('P2PTriggersUtils').getMatches(m));if(n&&n.length||c('EmoticonsList').noncapturingRegexp.test(m)||c('SupportedEmoji').findEmoji(m)||c('URLMatcher').match(m)||c('EmployeeLinkMatcher').isMatch(m)||this._shouldRenderP2PTriggers||c('MercuryConfig').MessengerNewEmojiGK&&c('MessengerSupportedEmoji').findEmoji(m))this.setState({richText:true});},componentWillUnmount:function(){this._raf&&c('cancelAnimationFrame')(this._raf);},render:function(){var l=this.props.body||'';if(l.startsWith('?OTR'))return (c('React').createElement('span',{className:"_89h"},i._("[encrypted message]")));l=l.replace(/\s+$/,'');if(l.length===0)return null;if(!this.state.richText)return c('React').createElement('span',{className:this.props.className},l);var m=this.props.ranges;if(m==undefined)m=c('getURLRanges')(l);if(m==undefined){m=c('EmployeeLinkRanges').get(l);}else{m=m.concat(c('EmployeeLinkRanges').get(l));m=m.filter(function(q){return q!=undefined;});}var n={className:this.props.className,interpolator:this.targetBlankLinkInterpolator,text:l,ranges:m,renderEmoticons:true,renderEmoji:true},o=c('React').createElement(c('TextWithEntities.react'),n);if(this._shouldRenderP2PTriggers){return (c('React').createElement(c('BootloadedComponent.react'),babelHelpers['extends']({bootloadPlaceholder:o,bootloadLoader:c('JSResource')('TextWithEntitiesAndP2P.react')},n,{threadID:this.props.threadID})));}else if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEntitiesModule){var p=c('MercuryConfig').MessengerTextWithEntitiesModule;return (c('React').createElement(p,n));}else return o;}});f.exports=k;},null);
__d('MessageBubbleMixin',['DOMDimensions','ReactDOM'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=2,i={getInitialState:function(){return {bubbleWidth:null};},componentDidMount:function(){this._restyleBubble(this.props);},componentDidUpdate:function(j){if(j.maxWidth!==this.props.maxWidth||j.body!==this.props.body||!j.attachments&&this.props.attachments)this._restyleBubble(j);},_restyleBubble:function(j){if(this.props.attachments){this.setState({bubbleWidth:null});return;}var k=c('ReactDOM').findDOMNode(this.refs.bubble);if(j.maxWidth!==this.props.maxWidth||c('DOMDimensions').getElementDimensions(k).width>this.props.maxWidth){var l=this.props.maxWidth;this.setState({bubbleWidth:l},this._shrinkBubble);return;}this._shrinkBubble();},_shrinkBubble:function(){var j=c('ReactDOM').findDOMNode(this.refs.bubble),k=c('DOMDimensions').getElementDimensions(j).width,l=c('ReactDOM').findDOMNode(this.refs.content),m=l?c('DOMDimensions').getElementDimensions(l).width+c('DOMDimensions').measureElementBox(c('ReactDOM').findDOMNode(this.refs.contentWrapper),'width',true,false,false):0,n=m+h;if(m>0&&n<this.props.maxWidth&&k-n-this.getBoxWidth()>0)this.setState({bubbleWidth:n});}};f.exports=i;},null);
__d('ChatBubble.react',['cx','Animation','ChatProgressBar.react','DOMDimensions','EmojiLikeUtils','EmojiOnlyMessage.react','MercuryAttachment','MercuryMessageBody.react','MessageBubbleMixin','MessagingGiftWrap.react','React','ReactDOM','joinClasses','messengerCustomColorUtils'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=1000,k=c('React').createClass({displayName:'ChatBubble',_boxWidth:0,mixins:[c('MessageBubbleMixin')],propTypes:{attachments:i.node,body:i.string,customColor:i.string,customLike:i.object,isEmojiLike:i.bool,isGiftWrapped:i.bool,isMessageAuthor:i.bool,maxWidth:i.number.isRequired,onUnwrap:i.func,threadID:i.string,timestamp:i.number,ttl:i.number},getInitialState:function(){return {emojis:undefined,ephemeralExpiring:false,ephemeralExpired:false};},componentDidMount:function(){if(this.props.attachments&&!this.props.isEmojiLike)return;if(!this.props.emojis){var l=this.props.body||'',m=c('EmojiLikeUtils').richContent(l);if(m)this.setState({emojis:m});}},render:function(){var l=this.props.body||'',m=null;if(this.props.customColor&&!this.state.emojis)m=c('messengerCustomColorUtils').customChatTabBubbleStyle(this.props.customColor);return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')("_5w1r"+(this._isEpehmeralStylePreferred()?' '+"_4gx-":'')+(this.state.ephemeralExpiring?' '+"_1xti":'')+(this.state.ephemeralExpired?' '+"_1xtj":'')+(!!m?' '+"_47yl":'')+(!this.state.emojis?' '+"_3_om":'')+(!!this.state.emojis?' '+"_31xx":''),this.props.className),ref:'bubble',style:babelHelpers['extends']({},m,{maxWidth:this.props.maxWidth,width:this.state.emojis?null:this.state.bubbleWidth,wordWrap:l.length>=15?'break-word':'inherit'})}),this._renderProgressBar(),c('React').createElement('div',{className:"_4gx_",ref:'inner'},this._renderContent(),this.props.attachments),this.props.isGiftWrapped?c('React').createElement(c('MessagingGiftWrap.react'),{onUnwrap:this.props.onUnwrap}):null));},_renderContent:function(){if(!this.props.body||this.props.isEmojiLike)return null;if(this.state.emojis){var l=c('EmojiLikeUtils').getSourceURIs(this.state.emojis),m=c('React').createElement(c('EmojiOnlyMessage.react'),{sourceURIs:l});}else m=c('React').createElement(c('MercuryMessageBody.react'),{body:this.props.body,ranges:this.props.ranges,threadID:this.props.threadID,customLike:this.props.customLike});return (c('React').createElement('div',{className:"_d97"+(!!this.state.emojis?' '+"_31xy":''),ref:'contentWrapper'},c('React').createElement('span',{className:"_5yl5",ref:'content'},m)));},_isEpehmeralStylePreferred:function(){if(!this.props.ttl)return false;if(!this.props.attachments)return true;return this.props.attachments.props.attachments.every(function(l){return c('MercuryAttachment').isEphemeralTextStyle(l);});},_onProgressBarAnimationDone:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});new (c('Animation'))(this.refs.inner).to('opacity',0).duration(j).go();}},_setExpiredAnimation:function(){if(this.isMounted()){this.setState({ephemeralExpiring:true});this.setState({ephemeralExpired:true});}},_renderProgressBar:function(){if(!this.props.timestamp||!this.props.ttl||!this._isEpehmeralStylePreferred()||this.state.emojis&&this.state.emojis.length>0)return null;return (c('React').createElement(c('ChatProgressBar.react'),{ttl:this.props.ttl,timestamp:this.props.timestamp,isMessageAuthor:this.props.isMessageAuthor,onDone:this._onProgressBarAnimationDone,setExpiredAnimation:this._setExpiredAnimation}));},contentWraps:function(){var l=c('ReactDOM').findDOMNode(this.refs.content),m=l.getClientRects(),n=c('DOMDimensions').getElementDimensions(l).height;return m&&m.length>1&&m[0].height<n;},getBoxWidth:function(){if(!this._boxWidth)this._boxWidth=c('DOMDimensions').measureElementBox(c('ReactDOM').findDOMNode(this.refs.bubble),'width',true,true,false);return this._boxWidth;}});f.exports=k;},null);
__d('MercuryTimestamp',['fbt','formatDate','MercuryTimePassed'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=86400000,j=6*i,k={getFormatedTimestamp:function(l){var m=l/1000;return k.getFormattedTimestampByBucket(m,this.getTimeBucket(l));},getFormattedTimestampByBucket:function(l,m){switch(m){case c('MercuryTimePassed').TODAY:return {absolute:h._("Today"),relative:c('formatDate')(l,'g:ia')};case c('MercuryTimePassed').WEEK_AGO:return {absolute:c('formatDate')(l,'l'),relative:c('formatDate')(l,'D')};case c('MercuryTimePassed').CURRENT_YEAR:return {absolute:c('formatDate')(l,'F j'),relative:c('formatDate')(l,'M j')};default:return {absolute:c('formatDate')(l,'F j, Y'),relative:c('formatDate')(l,'n/j/y')};}},getTimeBucket:function(l){var m=new Date(l),n=new Date(),o=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(o<m){return c('MercuryTimePassed').TODAY;}else if(o-j<m){return c('MercuryTimePassed').WEEK_AGO;}else if(o.getFullYear()===m.getFullYear()){return c('MercuryTimePassed').CURRENT_YEAR;}else return c('MercuryTimePassed').OTHER_YEAR;},getPreciseTimestamp:function(l){return c('formatDate')(new Date(l),k.getPreciseFormat(l));},getPreciseFormat:function(l){var m=k.getTimeBucket(l);switch(m){case c('MercuryTimePassed').TODAY:return 'g:ia';case c('MercuryTimePassed').WEEK_AGO:return 'l g:ia';case c('MercuryTimePassed').CURRENT_YEAR:return 'F jS, g:ia';case c('MercuryTimePassed').OTHER_YEAR:default:return 'F j, Y g:i a';}}};f.exports=k;},null);
__d('ChatMessage.react',['cssVar','cx','fbt','BootloadedComponent.react','ChatAnimatedGifs','ChatAttachmentProgressBar.react','ChatBubble.react','EmojiLikeUtils','MercuryTimestamp','CSS','CurrentUser','immutable','ImmutableObject','JSResource','MercuryAttachment','MercuryConfig','MercuryErrorInfo','MercuryIDs','MercuryMessageActions','MercuryMessageError.react','MercuryMessageInfo','MercuryThreads','MessagingGiftWrapChecker','MercuryDisplayTimeFilterMessageRenderer','React','ReactDOM','XUISpinner.react','isRTL','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('React').createClass({displayName:'ChatMessage',propTypes:{message:k.instanceOf(c('ImmutableObject')).isRequired,maxBubbleWidth:k.number.isRequired,onAttachmentLoad:k.func,onStickerClick:k.func,thread:k.instanceOf(c('ImmutableObject'))},componentDidMount:function(){c('CSS').conditionClass(c('ReactDOM').findDOMNode(this),"_2cnu",this.isOneLine());},isOneLine:function(){var m=this.props.message;return (c('MercuryMessageInfo').isInbound(m)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps());},shouldComponentUpdate:function(m,n){return m.message!==this.props.message||!c('immutable').is(this.props.thread,m.thread);},render:function(){var m=this.props.message,n=c('MercuryAttachment').get(m).length>0,o=c('MercuryMessageInfo').isInbound(m),p=c('MercuryIDs').isGroupChat(m.thread_id),q=c('isRTL')(m.body),r=c('MercuryErrorInfo').hasErrorStatus(m),s="_5wd4"+(o?' '+"_1nc7":'')+(!o?' '+"_1nc6":'')+(n?' '+"_2_-t":'')+(o&&p?' '+"_5ysy":'')+(r?' '+"_1zcs":'')+(q?' '+"direction_rtl":'')+(!q?' '+"direction_ltr":'');return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,s)},this._renderInner(),this._renderUndertext()));},_renderInner:function(){var m=this.props.message,n={};if(c('MercuryMessageInfo').isOutbound(m)){var o=j._("{time}",[j.param('time',c('MercuryTimestamp').getPreciseTimestamp(m.timestamp))]);n['data-hover']='tooltip';n['data-tooltip-position']='right';n['data-tooltip-content']=o;}if(m.is_filtered_content)return (c('React').createElement('div',babelHelpers['extends']({className:"_5wd9 _5wdc uiBoxYellow clearfix",ref:'inner'},n),c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(m)));return (c('React').createElement('div',babelHelpers['extends']({className:"_5wd9",ref:'inner'},n),this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (c('React').createElement('div',{className:"_3ry4",ref:'undertext'},c('React').createElement(c('MercuryMessageError.react'),{className:"_5wda clearfix",message:this.props.message,ref:'status'}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('MercurySpoofWarning.react'),authorID:this.props.message.author,className:"_5wdb"}):null);},_getAttachmentPlaceholder:function(){return (c('React').createElement('div',{style:{padding:'20px',text_align:'center'}},c('React').createElement(c('XUISpinner.react'),null)));},_renderProgressBar:function(){var m=this.props.message;if(!m.ephemeral_ttl_mode||!m.timestamp)return null;return (c('React').createElement(c('ChatAttachmentProgressBar.react'),{ephemeralTTLMode:m.ephemeral_ttl_mode,timestamp:m.timestamp,isMessageAuthor:!c('MercuryMessageInfo').isInbound(m)}));},_renderAttachments:function(m){var n=this.props.message,o=this.props.thread?this.props.thread.custom_like_icon:null,p=m=='inside'?'attachmentsInside':'attachmentsOutside',q=c('MercuryAttachment').get(n).filter(function(s){var t=c('MercuryAttachment').isBubblePreferred(s);return t&&m==='inside'||!t&&m==='outside';}),r=n.attachments.length>0&&n.attachments.every(function(s){return c('MercuryAttachment').isEphemeralAttachmentStyle(s);});if(q.length>0)return (c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:this._getAttachmentPlaceholder(),bootloadLoader:c('JSResource')('MercuryAttachments.react'),className:(m==='outside'?"_3e7u":'')+(!!n.body?' '+"_16ys":'')+(!!n.ephemeral_ttl_mode?' '+"_3-rb":'')+(' '+"_n4o"),attachments:q,customLike:o,customColor:this.props.thread&&c('MercuryConfig').CustomColorChatTabGK?this.props.thread.custom_color:'',isChat:true,isGiftWrapped:c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(n)&&m==='outside',maxWidth:this.props.maxBubbleWidth,message:n,onUnwrap:this._handleUnwrap,renderProgressBar:r?this._renderProgressBar:null,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,ref:p}));},_renderBubble:function(){var m=this.props.message,n=m.body,o=this._renderAttachments('inside'),p=c('MercuryMessageInfo').isInbound(m);if(c('ChatAnimatedGifs').shouldHideBody(m))n='';if(n||o)return (c('React').createElement('div',{className:"_5wde _n4o"},c('React').createElement(c('ChatBubble.react'),{attachments:o,body:n,className:"_5wdf",isMessageAuthor:!p,maxWidth:this.props.maxBubbleWidth,ranges:m.ranges,ref:'bubble',isEmojiLike:c('EmojiLikeUtils').isEmojiLike(m),isGiftWrapped:c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(m),onUnwrap:this._handleUnwrap,threadID:m.thread_id,ttl:m.ephemeral_ttl_mode,timestamp:m.timestamp,customLike:m.customLike,customColor:c('MercuryConfig').CustomColorChatTabGK&&this.props.thread&&this.props.isFromViewer?this.props.thread.custom_color:''})));},_handleUnwrap:function(){var m="2500ms";setTimeout(function(){return this._persistUnwrapping();}.bind(this),m.substring(0,m.length-2));},_persistUnwrapping:function(){c('MercuryMessageActions').get().unwrap(this.props.message);}});f.exports=l;},null);
__d('ChatMessageGroup.react',['cx','fbt','ChatConfig','ChatDateBreak.react','ChatMessage.react','Image.react','immutable','ImmutableObject','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryTimestamp','React','StoreAndPropBasedStateMixin','MercuryThreads'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('MercuryThreads').get(),k=c('React').PropTypes,l=new (c('ImmutableObject'))({name:'',href:'#',image_src:''}),m=c('ChatConfig').get('chattab_rounded_profile',false),n=c('React').createClass({displayName:'ChatMessageGroup',mixins:[c('StoreAndPropBasedStateMixin')(c('MercuryParticipants'))],propTypes:{activeMessageID:k.string,author:k.string,hasDateBreak:k.bool,isCanonical:k.bool,isFromViewer:k.bool,isPageMessage:k.bool,maxBubbleWidth:k.number,messages:k.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:k.func,onStickerClick:k.func,thread:k.instanceOf(c('ImmutableObject')),threadID:k.string},statics:{calculateState:function(p){return {participants:o(p)};}},shouldComponentUpdate:function(p,q){return (this.props.activeMessageID!==p.activeMessageID||this.props.isFromViewer!==p.isFromViewer||!c('immutable').is(this.props.messages,p.messages)||!c('immutable').is(this.state.participants,q.participants)||!c('immutable').is(this.props.thread,p.thread));},render:function(){return (c('React').createElement('div',{className:"_4tdt"},this._renderProfileColumn(),this._renderName(),c('React').createElement('div',{className:"_4tdv"},this._renderMessages())));},_renderProfileColumn:function(){if(this.props.isFromViewer)return null;var p=this.state.participants.get(this.props.author)||l,q=i._("{name} {time}",[i.param('name',p.name),i.param('time',c('MercuryTimestamp').getPreciseTimestamp(this.props.messages.last().timestamp))]),r=p.image_src?c('React').createElement(c('Image.react'),{src:p.image_src}):null;return (c('React').createElement('div',{className:"_31o4"+(m?' '+"_3njy":'')},c('React').createElement('a',{'aria-label':q,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':q,'data-tooltip-position':'left',href:p.href,ref:'link'},r)));},_renderName:function(){if(this.props.isCanonical||this.props.isFromViewer)return null;var p=this.state.participants.get(this.props.messages.first().author);if(!p)return null;var q=p.short_name;if(this.props.thread&&this.props.thread.custom_nickname){var r=c('MercuryIDs').getUserIDFromParticipantID(p.id);if(this.props.thread.custom_nickname[r]){q=this.props.thread.custom_nickname[r];if(c('MercuryConfig').MessengerNewEmojiGK&&c('MercuryConfig').MessengerTextWithEmoticonsModule){var s=c('MercuryConfig').MessengerTextWithEmoticonsModule;q=c('React').createElement(s,{renderEmoticons:true,renderEmoji:true,text:q});}}}return (c('React').createElement('div',{className:"_4tdx"},q));},_renderMessages:function(){var p=this.props.messages.size,q=[];this.props.messages.forEach(function(r,s,t){var u=r.message_id===this.props.activeMessageID;if(u&&!(s===0&&this.props.hasDateBreak))q.push(c('React').createElement(c('ChatDateBreak.react'),{date:new Date(r.timestamp),key:'db:'+r.message_id}));q.push(c('React').createElement(c('ChatMessage.react'),{isFromViewer:this.props.isFromViewer,key:r.message_id,maxBubbleWidth:this.props.maxBubbleWidth,message:r,nextTimestamp:this._getNextTimestamp(t,p,s),onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,thread:this.props.thread}));}.bind(this));return q;},_getNextTimestamp:function(p,q,r){return r<q-1?p.get(r+1).timestamp:this.props.nextTimestamp;}});function o(p){return c('immutable').Map().withMutations(function(q){p.readReceipts.forEach(function(r,s){q.set(s,c('MercuryParticipants').getOrFetch(s));});q.set(p.author,c('MercuryParticipants').getOrFetch(p.author));});}f.exports=n;},null);
__d('MercuryLogMessage.react',['cx','fbt','DOM','DOMDimensions','Event','ImmutableObject','MercuryLogMessageRenderer','MercuryLogMessageType','React','ReactDOM','cancelAnimationFrame','emptyFunction','formatDate','joinClasses','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'MercuryLogMessage',propTypes:{loadMoreMessages:j.func,maxWidth:j.number,message:j.instanceOf(c('ImmutableObject')).isRequired,onImageLoad:j.func,thread:j.object},getDefaultProps:function(){return {onImageLoad:c('emptyFunction')};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillUnmount:function(){if(this._raf)c('cancelAnimationFrame')(this._raf);},_renderErrorMessage:function(){return (c('React').createElement('a',{onClick:this._loadMoreMessages},i._("Show previous messages.")));},_loadMoreMessages:function(){var l=this.props.loadMoreMessages&&this.props.loadMoreMessages();if(l){this.setState({messageText:this._renderErrorMessage()});}else{var m=i._("Couldn't find previous messages.");this.setState({messageText:m});}},componentWillReceiveProps:function(l){if(l.message.log_message_type===c('MercuryLogMessageType').SERVER_ERROR){this._loadMoreMessages();return;}c('MercuryLogMessageRenderer').renderText(l.message,l.thread,function(m){this.setState({messageText:m});}.bind(this));},shouldComponentUpdate:function(l,m){return (this.state.messageText!=m.messageText||l.maxWidth!==this.props.maxWidth);},componentDidUpdate:function(){this._informAttachmentLoaded();if(!this.refs.attachment)return;c('MercuryLogMessageRenderer').renderAttachmentLegacy(this.refs.attachment,this.props.message);c('DOM').scry(this.refs.wrap,'img').forEach(function(l){var m=c('Event').listen(l,'load',function(){this._informAttachmentLoaded();m.remove();}.bind(this));}.bind(this));},render:function(){return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')(this.props.className,"_5ye6"),ref:'wrap',style:babelHelpers['extends']({},this.props.style,this._getStyle()),title:c('formatDate')(new Date(this.props.message.timestamp),'g:ia')}),c('React').createElement('div',{className:"_5ye7"},c('MercuryLogMessageRenderer').renderIcon(this.props.message),this.state.messageText),c('React').createElement('div',{className:"_5ye8",ref:'attachment'})));},_getStyle:function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null;},_informAttachmentLoaded:function(){if(this._raf)c('cancelAnimationFrame')(this._raf);this._raf=c('requestAnimationFrame')(function(){this.props.onImageLoad&&this.props.onImageLoad(c('DOMDimensions').getElementDimensions(this.refs.wrap).height);delete this._raf;}.bind(this));}});f.exports=k;},null);
__d('MessengerDomIDs',['uniqueID'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={COMPOSER_INPUT_DESCRIPTION:c('uniqueID')(),CONVERSATION:c('uniqueID')(),MAIN_LABEL:c('uniqueID')(),MUTE_DIALOG_TITLE:c('uniqueID')(),THREAD_INFO_PANEL:c('uniqueID')(),THREAD_TITLE:c('uniqueID')()};f.exports=h;},null);
__d('ChatConversation.react',['invariant','ChatDateBreak.react','ChatMessageGroup.react','ChatMessage.react','immutable','MercuryActionType','MercuryLogMessage.react','MessageList.react','React','MercuryShareAttachmentRenderLocations','cancelAnimationFrame','requestAnimationFrame'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatConversation',_raf:(undefined,Number),_onMountTimeout:(undefined,Number),propTypes:{contextBanner:i.object,isCanonical:i.bool.isRequired,loadMoreMessages:i.func,maxBubbleWidth:i.number.isRequired,messages:i.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:i.func,onMount:i.func,onStickerClick:i.func,viewer:i.string.isRequired,thread:i.object,threadID:i.string},componentDidMount:function(){this._raf=c('requestAnimationFrame')(function(){this._onMountTimeout=setTimeout(function(){this.props.onMount&&this.props.onMount();delete this._onMountTimeout;}.bind(this),0);delete this._raf;}.bind(this));},componentWillUnmount:function(){if(this._raf)c('cancelAnimationFrame')(this._raf);clearTimeout(this._onMountTimeout);},componentWillReceiveProps:function(k){!(k.maxBubbleWidth===this.props.maxBubbleWidth)?h(0):undefined;},render:function(){return (c('React').createElement('div',null,this.props.contextBanner,c('React').createElement(c('MessageList.react'),{DateBreak:c('ChatDateBreak.react'),LogMessage:c('MercuryLogMessage.react'),MessageGroup:c('ChatMessageGroup.react'),deliveryTimestamp:0,isCanonical:this.props.isCanonical,location:c('MercuryShareAttachmentRenderLocations').CHAT,loadMoreMessages:this.props.loadMoreMessages,maxBubbleWidth:this.props.maxBubbleWidth,messages:this.props.messages,onAttachmentLoad:this.props.onAttachmentLoad,onStickerClick:this.props.onStickerClick,readReceipts:c('immutable').OrderedMap(),viewer:this.props.viewer,thread:this.props.thread,threadID:this.props.threadID})));}});f.exports=j;},null);
__d('MercuryTypingAnimation.react',['cx','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryTypingAnimation',propTypes:{color:i.oneOf(['light','dark'])},getDefaultProps:function(){return {color:'dark'};},render:function(){var k="_4a0v"+(this.props.color==='light'?' '+"_4a0w":'')+(this.props.color==='dark'?' '+"_4a0x":'');return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,k)},c('React').createElement('div',{className:"_4b0g"},c('React').createElement('div',{className:"_5pd7"}),c('React').createElement('div',{className:"_5pd7"}),c('React').createElement('div',{className:"_5pd7"}))));}});f.exports=j;},null);
__d('ChatTypingIndicator.react',['cx','fbt','ChatConfig','Image.react','MercuryParticipants','MercuryTypingAnimation.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('ChatConfig').get('chattab_rounded_profile',false),l=c('React').createClass({displayName:'ChatTypingIndicator',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{userID:j.string,showName:j.bool},render:function(){var n=undefined;if(this.props.userID)n=c('MercuryParticipants').getNow(this.props.userID);if(!n)return null;return (c('React').createElement('div',{className:"_4tdt"},m(n),this._renderBubble()));},getBubble:function(){return this.refs.bubble;},_renderBubble:function(){var n=this.props.showName;return (c('React').createElement('div',{className:"_4tdv"},c('React').createElement('div',{className:"_5wd4"+(' '+"_1nc7")+(' '+"_2cnu")+(n?' '+"_5ysy":'')},c('React').createElement('div',{className:"_5wd9"+(' '+"_n4o")},c('React').createElement('div',{className:"_5w1r"+(' '+"_5wdf")+(' '+"_3_om")},c('React').createElement(c('MercuryTypingAnimation.react'),{className:"_5x7x",ref:'bubble'}))))));}});function m(n){var o=i._("{name}",[i.param('name',n.name)]);return (c('React').createElement('div',{className:"_31o4"+(k?' '+"_3njy":'')},c('React').createElement('a',{'aria-label':o,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':o,'data-tooltip-position':'left',href:n.href||'#',ref:'link'},c('React').createElement(c('Image.react'),{src:n.image_src,ref:'image'}))));}f.exports=l;},null);
__d('ChatTypingIndicators.react',['fbt','ChatTypingIndicator.react','DOM','MercuryIDs','MercuryThreadInformer','MercuryTypingReceiver','MercuryParticipants','React','ReactDOM','SubscriptionsHandler','TooltipData','createObjectFrom','emptyFunction'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorClass:i.func,indicatorsWillShow:i.func,indicatorsDidShow:i.func,rootClassName:i.string,threadID:i.string.isRequired,viewer:i.string.isRequired},getDefaultProps:function(){return {indicatorClass:c('ChatTypingIndicator.react'),indicatorsWillShow:c('emptyFunction'),indicatorsDidShow:c('emptyFunction')};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){var k=c('MercuryThreadInformer').getForFBID(this.props.viewer),l=c('MercuryTypingReceiver').getForFBID(this.props.viewer);this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(l.addRetroactiveListener('state-changed',this.typingStateChanged),k.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(k){if(k.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(k,l){if(l.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();c('MercuryParticipants').getMulti(this.state.typingUserIDs,function(k){if(this.isMounted())this.state.typingUserIDs.forEach(function(l){var m=k[l],n=this.refs[l]&&this.refs[l].getBubble();if(n&&m)c('TooltipData').set(c('ReactDOM').findDOMNode(n),this.renderTooltip(m.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var k=c('MercuryIDs').isGroupChat(this.props.threadID);return (c('React').createElement('div',{className:this.props.rootClassName},this.state.typingUserIDs.map(function(l){return (this._renderTypingIndicator(l,!!k));}.bind(this))));},_renderTypingIndicator:function(k,l){var m=this.props.indicatorClass;return (c('React').createElement(m,{key:k,ref:k,showName:l,userID:k}));},renderTooltip:function(k){var l=c('DOM').create('span');c('ReactDOM').render(c('React').createElement('span',null,h._("{name} is typing...",[h.param('name',k)])),l);return l;},typingStateChanged:function(k){if(this.props.threadID in k)this.setState({typingUserIDs:k[this.props.threadID].slice().sort()});},messagesReceived:function(k,l){if(this.props.threadID in l){var m=l[this.props.threadID],n=c('createObjectFrom')(m.map(function(o){return o.author;}));this.setState({typingUserIDs:this.state.typingUserIDs.filter(function(o){return !n[o];}).sort()});}}});f.exports=j;},null);
__d('MercuryMessageList',['immutable','LogHistory','Map','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('mercury_message_list');function i(k){this.$MercuryMessageList1=c('immutable').List(k||[]);this.$MercuryMessageList2();}i.prototype.append=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).push.apply(l,k);this.$MercuryMessageList2();j('append',k);};i.prototype.prepend=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).unshift.apply(l,k);this.$MercuryMessageList2();j('prepend',k);};i.prototype.update=function(k){var l=k.filter(function(m){return this.contains(m);}.bind(this));if(l.length===0)return;this.$MercuryMessageList1=this.$MercuryMessageList1.withMutations(function(m){l.forEach(function(n){var o=this.$MercuryMessageList3.get(n.message_id);if(o!==undefined)m.set(o,n);}.bind(this));}.bind(this));j('update',l);};i.prototype.reorder=function(k){this.$MercuryMessageList1=c('immutable').List(k);this.$MercuryMessageList2();j('reorder',k);};i.prototype.at=function(k){return this.$MercuryMessageList1.get(k);};i.prototype.contains=function(k){return this.$MercuryMessageList3.has(k.message_id);};i.prototype.toArray=function(){return this.$MercuryMessageList1.toArray();};i.prototype.toMap=function(){return new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k){return [k.message_id,k];}));};i.prototype.$MercuryMessageList2=function(){this.$MercuryMessageList3=new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k,l){return [k.message_id,l];}));};function j(event,k){c('setTimeoutAcrossTransitions')(function(){h.debug(event,JSON.stringify({messageIDs:k.map(function(l){return l.message_id;})}));},0);}f.exports=i;},null);
__d('MercuryMessageStore',['MercuryAPIArgsSource','LogHistory','MercuryMessages','MercuryViewer','MercuryMessageList','SubscriptionsHandler','MercuryThreadInformer','MercuryThreadlistConstants','MercuryThreads','mixInEventEmitter','setImmediate','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreads').get(),i=c('LogHistory').getInstance('mercury_message_store');function j(l,m,n){this.$MercuryMessageStore1=l;this.$MercuryMessageStore2=new (c('MercuryMessageList'))();this.$MercuryMessageStore3=n?c('MercuryMessages').getForFBID(n):c('MercuryMessages').get();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore7=m||c('MercuryThreadlistConstants').RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore8=n?c('MercuryThreadInformer').getForFBID(n):c('MercuryThreadInformer').get();this.$MercuryMessageStore9=new (c('SubscriptionsHandler'))();this.$MercuryMessageStore9.addSubscriptions(this.$MercuryMessageStore8.subscribe('messages-received',function(o,p){return this.$MercuryMessageStore10(p);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-updated',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore11(p[this.$MercuryMessageStore1]);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-reordered',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore12();}.bind(this)));i.debug('constructed',JSON.stringify({threadID:this.$MercuryMessageStore1}));this.$MercuryMessageStore13();}j.prototype.setNewThreadID=function(l){this.$MercuryMessageStore14=l;};j.prototype.destroy=function(){this.$MercuryMessageStore9&&this.$MercuryMessageStore9.release();i.debug('destroyed',JSON.stringify({threadID:this.$MercuryMessageStore1}));};j.prototype.subscribe=function(l){return this.addRetroactiveListener('updated',l);};j.prototype.fetchMoreMessages=function(){if(this.hasFetchedAll())return false;this.$MercuryMessageStore13();return true;};j.prototype.hasFetchedAll=function(){if(this.$MercuryMessageStore3.hasLoadedExactlyNMessages(this.$MercuryMessageStore1,this.$MercuryMessageStore6)&&this.$MercuryMessageStore3.hasLoadedAllMessages(this.$MercuryMessageStore1))return true;return h.isNewEmptyLocalThread(this.$MercuryMessageStore1);};j.prototype.$MercuryMessageStore13=function(){var l=this.$MercuryMessageStore6+this.$MercuryMessageStore7*this.$MercuryMessageStore4;i.debug('fetching',JSON.stringify({threadID:this.$MercuryMessageStore1,limit:l}));this.$MercuryMessageStore3.getThreadMessagesRange(this.$MercuryMessageStore1,0,l,this.$MercuryMessageStore15.bind(this),null,c('MercuryAPIArgsSource').MERCURY);if(this.$MercuryMessageStore4<10)this.$MercuryMessageStore4+=1;if(this.$MercuryMessageStore3.hasLoadedNMessages(this.$MercuryMessageStore1,l))c('setImmediate')(function(){this.$MercuryMessageStore12();}.bind(this));};j.prototype.$MercuryMessageStore15=function(l){if(l&&l.length){this.$MercuryMessageStore5=l[0].timestamp;this.$MercuryMessageStore6=l.length;i.debug('fetched',JSON.stringify({threadID:this.$MercuryMessageStore1,earliestMessageTimestamp:this.$MercuryMessageStore5,count:this.$MercuryMessageStore6}));}else if(l&&!l.length&&!this.$MercuryMessageStore6)this.$MercuryMessageStore16(j.THREAD_IS_EMPTY);};j.prototype.$MercuryMessageStore10=function(l){var m=[],n=l[this.$MercuryMessageStore1];if(n&&n.length)m=m.concat(n);if(this.$MercuryMessageStore14){var o=l[this.$MercuryMessageStore14];if(o&&o.length){m=m.concat(o);this.$MercuryMessageStore14=null;}}if(m.length){this.$MercuryMessageStore2.append(m);this.$MercuryMessageStore6+=m.length;var p=m.every(function(q){return q.author!=c('MercuryViewer').getID();});this.$MercuryMessageStore16(j.MESSAGES_RECEIVED,{allFromOthers:p});}};j.prototype.$MercuryMessageStore11=function(l){this.$MercuryMessageStore2.update(this.$MercuryMessageStore3.getMessagesFromIDs(Object.keys(l)));this.$MercuryMessageStore17();this.$MercuryMessageStore16(j.MESSAGES_CHANGED);};j.prototype.$MercuryMessageStore12=function(){if(!this.$MercuryMessageStore5)return;this.$MercuryMessageStore2.reorder(this.$MercuryMessageStore3.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore1,this.$MercuryMessageStore5));this.$MercuryMessageStore17();this.$MercuryMessageStore16(j.MESSAGES_REORDERED);};j.prototype.$MercuryMessageStore16=function(l,m){var n=this.$MercuryMessageStore2.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',babelHelpers['extends']({messages:n,eventType:l},m));k(this.$MercuryMessageStore1,l,n);};j.prototype.$MercuryMessageStore17=function(){var l=this.$MercuryMessageStore2.at(0);if(l)this.$MercuryMessageStore5=l.timestamp;};function k(l,m,n){c('setTimeoutAcrossTransitions')(function(){i.debug('update:'+m,JSON.stringify({threadID:l,messageIDs:n.map(function(o){return o.message_id;})}));},0);}Object.assign(j,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});c('mixInEventEmitter')(j,{updated:true});f.exports=j;},null);
__d('ChatTabMessagesView',['Animation','Arbiter','BanzaiLogger','CSS','ChatConversation.react','ChatPerfInstrumentation','ChatTabViewEvents','ChatTypingIndicators.react','ChatWelcomeMessage','CurrentUser','DOM','Event','immutable','MercuryLastMessageIndicator.react','LiveTimer','MercuryIDs','MercuryThreads','MercuryViewer','MercuryMessageStore','MessengerContextBannerBootloader','MessengerHotLikePreviewEvents','React','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','Scroll','ServerTime','StickerActions','StickerState','StickerStoreController','Style','SubscriptionsHandler','UserAgent_DEPRECATED','arrayContains','getElementPosition','throttle'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreads').get(),i=64,j=null,k=20;function l(n){if(j===null){var o=n.childNodes[0];c('Style').set(n,'overflow','scroll');j=o.clientWidth-i;c('Style').set(n,'overflow','');}return j;}function m(n,o,p,q,r,s,t,u,v){this.loadingIcon=r;this.threadID=n;this.sheetController=o;this.scrollContainer=p;this.conversationElem=q;this.contextBannerEligible=v;this.contextBannerElem=null;this.tabView=u;c('LiveTimer').restart(c('ServerTime').get()/1000);this._loadingMoreMessages=false;this._initialLoadFinished=false;function w(){c('ChatTabViewEvents').inform('interaction-with-tab',n);}this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Arbiter').subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),c('Event').listen(this.scrollContainer,'mousedown',w));if(c('UserAgent_DEPRECATED').firefox()){var x='WheelEvent' in window?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(x,w,false);}else this._subscriptions.addSubscriptions(c('Event').listen(this.scrollContainer,'mousewheel',w));this._subscriptions.addSubscriptions(c('Event').listen(this.scrollContainer,'scroll',c('throttle')(this.scrolling,50,this)));var y;c('ReactDOM').render(c('React').createElement(c('ChatTypingIndicators.react'),{threadID:this.threadID,indicatorsWillShow:function(){return (y=this.isScrolledToBottom());}.bind(this),indicatorsDidShow:function(){return (y&&this.scrollToBottom(true));}.bind(this),viewer:c('CurrentUser').getID()}),t);var z;this.lastMessageIndicatorNode=s;this.lastMessageIndicator=new (c('ReactComponentRenderer'))(c('MercuryLastMessageIndicator.react'),this.lastMessageIndicatorNode);this.lastMessageIndicator.setProps({threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return z=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return z&&this.scrollToBottom(true);}.bind(this)});this.initializeConversation();}Object.assign(m.prototype,{initializeConversation:function(){this._store=new (c('MercuryMessageStore'))(this.threadID);this._conversation=new (c('ReactComponentRenderer'))(c('ChatConversation.react'),this.conversationElem);this._conversation.setProps({isCanonical:c('MercuryIDs').isCanonical(this.threadID),loadMoreMessages:this._loadMoreMessages.bind(this),maxBubbleWidth:l(this.scrollContainer),messages:c('immutable').List(),onAttachmentLoad:function(n){var o=this.scrollContainer,p=c('Scroll').getTop(o)+o.clientHeight;if(p+n>=o.scrollHeight-k||this._shouldScrollToBottom){this._shouldScrollToBottom=true;this.scrollToBottom();}}.bind(this),onMount:this.scrollToBottom.bind(this),onStickerClick:this._onStickerClick.bind(this),viewer:c('CurrentUser').getID(),threadID:this.threadID});h.getThreadMeta(this.threadID,function(n){return this._conversation.setProps({thread:n});}.bind(this));this._subscriptions.addSubscriptions(this._store.subscribe(this._updateMessageFromStore.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').START,function(n,o){if(this.threadID!==o)return;this._likePreview=n;this._conversation.setProps({messages:this._getNormalizedMessages()},this.scrollToBottom.bind(this));this.scrollToBottom();clearInterval(this._scrollToBottomInterval);this._scrollToBottomInterval=setInterval(this.scrollToBottom.bind(this),50);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').STOP,function(n){if(this.threadID!==n)return;this._likePreview=null;}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_ANIMATION,function(n){clearInterval(this._scrollToBottomInterval);}.bind(this)),c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').REMOVE,function(n){if(this.threadID!==n)return;clearInterval(this._scrollToBottomInterval);this._likePreview=null;this._conversation.setProps({messages:this._getNormalizedMessages()});}.bind(this)));},_updateMessageFromStore:function(n){if(n.eventType==c('MercuryMessageStore').MESSAGES_RECEIVED&&n.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;this._shouldScrollToBottom=false;}if(n.eventType==c('MercuryMessageStore').MESSAGES_REORDERED){this._loadingMoreMessages=false;c('CSS').hide(this.loadingIcon);}var o=this.isScrolledToBottom(),p=this._getLoadingHeight(),q=this.scrollContainer.scrollHeight,r=c('Scroll').getTop(this.scrollContainer);this._messages=n.messages;var s=c('ChatWelcomeMessage').getWelcomeMessage(this.threadID);if(s)this._messages.push(s);this._conversation.setProps({messages:this._getNormalizedMessages()},function(){if(o||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(n.eventType==c('MercuryMessageStore').MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-q-p+r);if(!this._initialLoadFinished){this._initialLoadFinished=true;c('ChatPerfInstrumentation').logCHAT_CONVERSATION_TTI();}if(this._store.hasFetchedAll()&&this.contextBannerEligible)this.renderContextBanner(this.threadID);}.bind(this));h.getThreadMeta(this.threadID,function(t){return this._conversation.setProps({thread:t});}.bind(this));this.lastMessageIndicator.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(n.eventType==c('MercuryMessageStore').MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(this._messages)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();if(n.eventType==c('MercuryMessageStore').MESSAGES_CHANGED)this._checkToAnimateSticker();},setShouldScrollToBottom:function(n){this._shouldScrollToBottom=n;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){c('CSS').show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&c('Scroll').getTop(this.scrollContainer);},getThreadID:function(){return this.threadID;},destroy:function(){c('DOM').scry(this.conversationElem,'.stickerContainer').forEach(function(n){return c('ReactDOM').unmountComponentAtNode(n);});this.unmountContextBanner();c('ReactDOM').unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();c('ReactDOM').unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_shouldShowStickerReplyNUX:function(n){if(!c('StickerState').shouldShowStickerReplyNUX()||!n.length)return false;var o=n[n.length-1];if(o.author===c('MercuryViewer').getID())return false;if(o.has_attachment)return o.attachments.some(function(p){return p.attach_type==='sticker';});return false;},isScrolledToBottom:function(n){var o=this.scrollContainer;n=n||k;return c('Scroll').getTop(o)+o.clientHeight>=o.scrollHeight-n;},isScrolledNearTop:function(){return c('Scroll').getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},scrollToBottom:function(n){this.scrollToPosition(this.scrollContainer.scrollHeight,n);},scrollToPosition:function(n,o){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(o===true){this._scrollTopAnimation=new (c('Animation'))(this.scrollContainer).to('scrollTop',n).ease(c('Animation').ease.end).duration(400).go();}else c('Scroll').setTop(this.scrollContainer,n);},_loadMoreMessages:function(){return this._store.fetchMoreMessages();},_onStickerClick:function(n,o){if(!n)return;c('BanzaiLogger').log('StickersLoggerConfig',{event:'click_sticker',packid:n,stickerid:o});var p=this.tabView;c('StickerState').onTrayDataReady(function(){if(c('arrayContains')(c('StickerState').getPackIDsInTray(),n)){var q=c('StickerState').getPack(n);if(q&&q.isPromoted)c('StickerActions').addPack(n);p.setStickersFlyoutPackID(n);}else c('StickerStoreController').showStore(n);});},_checkToAnimateSticker:function(){var n=c('getElementPosition')(this.scrollContainer);c('Arbiter').inform('chatScrolled/'+this.threadID,{scrollTop:c('Scroll').getTop(this.scrollContainer),top:n.y,viewHeight:n.height});},setNewThreadID:function(n){this._store.setNewThreadID(n);},_getNormalizedMessages:function(){if(this._likePreview){this._messages.push(this._likePreview);}else this._messages=this._messages.filter(function(n){return !n.is_like_preview;});return c('immutable').List(this._messages);},renderContextBanner:function(n,o){c('MessengerContextBannerBootloader').getBootloadedComponent(n,c('MercuryShareAttachmentRenderLocations').CHAT,function(p){c('Style').set(this.conversationElem,'padding-top','80px');this._conversation.setProps({contextBanner:p});}.bind(this),o,function(p){c('Style').set(this.conversationElem,'padding-top',p+'px');}.bind(this));},unmountContextBanner:function(){if(this._conversation)this._conversation.setProps({contextBanner:null});}});f.exports=m;},null);
__d('ChatPrivacyActionController',['ChatVisibility','JSLogger','PresencePrivacy'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(i,j){this._userID=i;this._logger=c('JSLogger').create('blackbird');this._getState=function(){if(c('ChatVisibility').isOnline())return c('PresencePrivacy').allows(this._userID)?h.NORMAL:h.BLOCKED;return h.OFFLINE;};this._togglePrivacy=function(){var l=this._getState();switch(this._getState()){case h.OFFLINE:if(c('ChatVisibility').isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});c('ChatVisibility').goOnline(function(){if(!c('PresencePrivacy').allows(this._userID)){if(this._getState()!==h.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case h.BLOCKED:c('PresencePrivacy').allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case h.NORMAL:c('PresencePrivacy').disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};var k=function(){j&&j(this._getState());}.bind(this);k();this._subscribeToken=c('PresencePrivacy').subscribe('privacy-changed',k);};h.OFFLINE='offline';h.BLOCKED='blocked';h.NORMAL='normal';Object.assign(h.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){this._subscribeToken&&c('PresencePrivacy').unsubscribe(this._subscribeToken);}});f.exports=h;},null);
__d('ChatTabSheetListener',['ChatPrivacyActionController','MercuryIDs','MercuryParticipants','MercuryThreadInformer','MercuryThreads','MercuryViewer'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){this.$ChatTabSheetListener1=j;this.$ChatTabSheetListener3=i;this.$ChatTabSheetListener4=c('MercuryIDs').getUserIDFromThreadID(this.$ChatTabSheetListener3);c('MercuryThreadInformer').get().subscribe('threads-updated',function(){return this.$ChatTabSheetListener5();}.bind(this));if(this.$ChatTabSheetListener4)this.$ChatTabSheetListener2=new (c('ChatPrivacyActionController'))(this.$ChatTabSheetListener4,function(k){return this.$ChatTabSheetListener6(k);}.bind(this));}h.prototype.destroy=function(){this.$ChatTabSheetListener2&&this.$ChatTabSheetListener2.destroy();};h.prototype.$ChatTabSheetListener5=function(){var i=c('MercuryThreads').get();i.getThreadMeta(this.$ChatTabSheetListener3,function(j){var k=c('MercuryViewer').getID(),l=j.participants.filter(function(m){return m!==k;});l.length<1&&!i.isNewEmptyLocalThread(this.$ChatTabSheetListener3)?this.$ChatTabSheetListener1.openNoRecipientsSheet():this.$ChatTabSheetListener1.closeNoRecipientsSheet();}.bind(this));};h.prototype.$ChatTabSheetListener6=function(i){switch(i){case c('ChatPrivacyActionController').OFFLINE:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.openOfflineSheet();break;case c('ChatPrivacyActionController').NORMAL:this.$ChatTabSheetListener1.closeUserBlockedSheet();this.$ChatTabSheetListener1.closeOfflineSheet();break;case c('ChatPrivacyActionController').BLOCKED:this.$ChatTabSheetListener1.closeOfflineSheet();c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(this.$ChatTabSheetListener4),function(j){j.is_friend?this.$ChatTabSheetListener1.openUserBlockedSheet():this.$ChatTabSheetListener1.closeUserBlockedSheet();}.bind(this));break;}};f.exports=h;},null);
__d('ChatTabSheetController',['Bootloader','ChatTabSheetListener','Deferred','MercuryIDs'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(i,j,k,l){this._threadID=i;this._rootElement=j;this._tabElement=k;this._view=l;this._deferred=new (c('Deferred'))();this._isLoading=false;this._listener=new (c('ChatTabSheetListener'))(this._threadID,this);};Object.assign(h.prototype,{openAddFriendsSheet:function(){this._load(function(){this._addFriendsTabSheet.open();}.bind(this));},openMessageBlockedTabSheet:function(){this._load(function(){this._threadIsMessageBlockedSheet.open();}.bind(this));},getAddFriendsParticipants:function(){return this._addFriendsTabSheet?this._addFriendsTabSheet.getParticipants():[];},openNameConversationSheet:function(i){this._load(function(){this._nameConversationTabSheet.open(i);}.bind(this));},openReadOnlySheet:function(){this._load(function(){this._readOnlyTabSheet.open();}.bind(this));},openNewMessagesSheet:function(){this._load(function(){this._newMessagesTabSheet.open();}.bind(this));},openUploadWarningTabSheet:function(){this._load(function(){this._uploadWarningTabSheet.open();}.bind(this));},openThreadIsMutedTabSheet:function(){this._load(function(){this._threadIsMutedTabSheet.open();}.bind(this));},openEmployeeAwaySheet:function(){this._load(function(){this._employeeAwaySheet.open();}.bind(this));},openOfflineSheet:function(){this._load(function(){this._offlineTabSheet.open();}.bind(this));},openUserBlockedSheet:function(){this._load(function(){this._userBlockedTabSheet.open();}.bind(this));},openNoRecipientsSheet:function(){this._load(function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.open();}.bind(this));},openSecretModeSheet:function(){this._load(function(){this._secretModeSheet.open();}.bind(this));},closeAddFriendsSheet:function(){this._lazy(function(){this._addFriendsTabSheet.close();}.bind(this));},closeAutomaticNameConversationSheet:function(){this._lazy(function(){if(this._nameConversationTabSheet&&this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();}.bind(this));},closeMessageBlockedTabSheet:function(){this._lazy(function(){this._threadIsMessageBlockedSheet.close();}.bind(this));},closeThreadIsMutedTabSheet:function(){this._lazy(function(){this._threadIsMutedTabSheet.close();}.bind(this));},closeNewMessagesSheet:function(){this._lazy(function(){this._newMessagesTabSheet.close();}.bind(this));},closeUploadWarningTabSheet:function(){this._lazy(function(){this._uploadWarningTabSheet.close();}.bind(this));},closeOfflineSheet:function(){this._lazy(function(){this._offlineTabSheet.close();}.bind(this));},closeUserBlockedSheet:function(){this._lazy(function(){this._userBlockedTabSheet.close();}.bind(this));},closeSecretModeSheet:function(){this._lazy(function(){this._secretModeSheet.close();}.bind(this));},onClickMessagesBlockedSheet:function(i){this._lazy(function(){this._unblockMessagesSub=this._threadIsMessageBlockedSheet.subscribe('clicked',i);}.bind(this));},closeNoRecipientsSheet:function(){this._lazy(function(){this._noRecipientsTabSheet&&this._noRecipientsTabSheet.close();}.bind(this));},onClickNewMessagesSheet:function(i){this._lazy(function(){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',i);}.bind(this));},onClickThreadIsMutedSheet:function(i){this._lazy(function(){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',i);}.bind(this));},onClickSecretModeSheet:function(i){this._lazy(function(){this._secretModeClickSub=this._secretModeSheet.subscribe('clicked',i);}.bind(this));},onResize:function(i){this._lazy(function(){this._sheetView.subscribe('resize',i);}.bind(this));},onTokensChanged:function(i){this._lazy(function(){this._addFriendsTabSheet.subscribe('chat/tokens-changed',i);}.bind(this));},onEscape:function(i){this._lazy(function(){this._addFriendsTabSheet.subscribe('esc-pressed',i);}.bind(this));},destroy:function(){this._listener&&this._listener.destroy();this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();},_load:function(i){this._bootload();this._deferred.then(i);},_lazy:function(i){this._deferred.then(i);},_bootload:function(){if(this._isLoading)return;this._isLoading=true;c('Bootloader').loadModules(["ChatAddFriendsTabSheet","ChatEmployeeAwaySheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatReadOnlyTabSheet","ChatThreadIsMessageBlockedSheet","ChatThreadIsMutedTabSheet","ChatThreadSecretModeSheet","ChatUploadWarningTabSheet","ChatUserBlockedTabSheet","MercurySheetView"],function(i,j,k,l,m,n,o,p,q,r,s,t,u){this._sheetView=new u(this._threadID,this._rootElement,this._tabElement);var v=this._threadID,w=this._rootElement,x=this._sheetView,y=this._view;this._addFriendsTabSheet=new i(v,w,x,y);this._employeeAwaySheet=new j(v,w,x);this._nameConversationTabSheet=new k(v,w,x);this._newMessagesTabSheet=new l(v,w,x);this._offlineTabSheet=new n(v,w,x);this._readOnlyTabSheet=new o(v,w,x);this._threadIsMessageBlockedSheet=new p(v,w,x);this._threadIsMutedTabSheet=new q(v,w,x);this._secretModeSheet=new r(v,w,x);this._uploadWarningTabSheet=new s(v,w,x);this._userBlockedTabSheet=new t(v,w,x);if(!c('MercuryIDs').getUserIDFromThreadID(this._threadID))this._noRecipientsTabSheet=new m(v,w,x);this._deferred.resolve();}.bind(this));}});f.exports=h;},null);
__d('ChatTitleLink.react',['cx','Link.react','MercuryThreadTitle.react','React','TrackingNodes','UserAgent'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatTitleLink',propTypes:{href:i.string,isNewThread:i.bool,thread:i.object,viewer:i.string},getDefaultProps:function(){return {href:null};},getTitle:function(){return this.refs.threadTitle.getTitle();},render:function(){if(!this.props.thread)return null;return (c('React').createElement(c('Link.react'),{'aria-level':'3',className:"titlebarText"+(c('UserAgent').isBrowser('Chrome')&&!c('UserAgent').isPlatform('Windows')?' '+"fixemoji":'')+(this.props.href===null?' '+"noLink":''),'data-ft':c('TrackingNodes').getTrackingInfo(c('TrackingNodes').types.TITLE),'data-hover':'tooltip',href:this.props.href},c('React').createElement(c('MercuryThreadTitle.react'),{ref:'threadTitle',isNewThread:this.props.isNewThread,thread:this.props.thread,useAndSeparator:true,useShortName:!this.props.thread.is_canonical,viewer:this.props.viewer})));}});f.exports=j;},null);
__d('EmoticonUtils',['EmoticonsList','Parent'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='emoticon_',i=c('EmoticonsList').symbols,j={getEmoteFromTarget:function(k){var l=c('Parent').byClass(k,'emoticon');if(!l)return null;var m=null;l.className.split(' ').forEach(function(n){if(n.startsWith(h))m=n.substring(h.length);});return i[m]||null;},insertEmoticon:function(k,l,m){var n=l.substring(0,m.start),o=l.substring(m.end);if(m.start>0&&!n.endsWith(' '))k=' '+k;if(!o.startsWith(' '))k+=' ';var p=n+k+o;m.start+=k.length;m.end=m.start;return {result:p,start:m.start,end:m.end};}};f.exports=j;},null);
__d('MercuryCanonicalGroupThreadManager',['KeyedCallbackManager','MercuryIDs','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreads','MercuryServerDispatcher'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercuryCanonicalGroupThreadManager1=j;this.$MercuryCanonicalGroupThreadManager2=new (c('KeyedCallbackManager'))();this.$MercuryCanonicalGroupThreadManager3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4=c('MercuryThreads').getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager5();}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.getCanonicalGroupThreadIDForParticipants=function(j,k){if(j.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)j.push(this.$MercuryCanonicalGroupThreadManager1);var l=this.$MercuryCanonicalGroupThreadManager6(j);this.$MercuryCanonicalGroupThreadManager2.setResource(l,undefined);var m=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(l,k);this.$MercuryCanonicalGroupThreadManager7(j);return m;};h.prototype.unsubscribe=function(j){if(j)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(j);};h.prototype.$MercuryCanonicalGroupThreadManager6=function(j){return j.sort().join(',');};h.prototype.$MercuryCanonicalGroupThreadManager8=function(j,k){var l=c('MercuryIDs').getThreadIDFromThreadFBID(k);this.$MercuryCanonicalGroupThreadManager2.setResource(j,l);};h.prototype.$MercuryCanonicalGroupThreadManager7=function(j){var k={canonical_group_key:this.$MercuryCanonicalGroupThreadManager6(j),participants:j};c('MercuryServerDispatcher').trySend('/ajax/mercury/search_canonical_groups.php',k,null,this.$MercuryCanonicalGroupThreadManager1);};h.prototype.$MercuryCanonicalGroupThreadManager5=function(){c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_canonical_groups.php':{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function(j){this.handleUpdate(j);}.bind(this)}});};h.prototype.handleUpdate=function(j){if(j.mercury_payload)this.$MercuryCanonicalGroupThreadManager3.handleUpdate(j.mercury_payload);var k=j.canonical_group;if(k)for(var l in k)this.$MercuryCanonicalGroupThreadManager8(l,k[l]);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d("XPagesMercuryIndicatorController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/pages\/messaging\/mercury\/indicator\/",{});},null);
__d('PagesMercuryChatTabIndicatorHandler',['Animation','AsyncRequest','AvailableListConstants','DOM','FBID','MercuryIDs','XPagesMercuryIndicatorController'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();h.tryCreateHandler=function(i,j,k){'use strict';if(!j)return null;var l=c('MercuryIDs').getUserIDFromThreadID(i);if(!l||c('FBID').isUser(l))return null;return new h(l,j,k);};function h(i,j,k){'use strict';this.$PagesMercuryChatTabIndicatorHandler2=false;this.$PagesMercuryChatTabIndicatorHandler3=j;this.$PagesMercuryChatTabIndicatorHandler4=false;this.$PagesMercuryChatTabIndicatorHandler5=false;this.$PagesMercuryChatTabIndicatorHandler6=k;this.$PagesMercuryChatTabIndicatorHandler7=false;this.$PagesMercuryChatTabIndicatorHandler8=i;}h.prototype.__getEnableTimeSwitch=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler2;};h.prototype.__getIndicator=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler3;};h.prototype.__getIsShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler5;};h.prototype.__getPageOnlineStatus=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler6;};h.prototype.__getShouldPreventFutureShown=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler7;};h.prototype.__getTargetID=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler8;};h.prototype.__getIsChecking=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler4;};h.prototype.__getResponsivenessDescription=function(){'use strict';return this.$PagesMercuryChatTabIndicatorHandler1;};h.prototype.checkResponsiveness=function(){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler4)return;var i=c('XPagesMercuryIndicatorController').getURIBuilder().getURI();this.$PagesMercuryChatTabIndicatorHandler4=true;new (c('AsyncRequest'))().setURI(i).setMethod('POST').setData({page_id:this.$PagesMercuryChatTabIndicatorHandler8}).setHandler(function(j){this.$PagesMercuryChatTabIndicatorHandler4=false;var k=j.payload;if(k.responsiveness)this.$PagesMercuryChatTabIndicatorHandler9(k.responsiveness,k.enableTimeSwitch);}.bind(this)).send();};h.prototype.hideIndicator=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(false);};h.prototype.hideIndicatorAndPreventFutureShow=function(){'use strict';this.$PagesMercuryChatTabIndicatorHandler10(true);};h.prototype.$PagesMercuryChatTabIndicatorHandler10=function(i){'use strict';this.$PagesMercuryChatTabIndicatorHandler7=this.$PagesMercuryChatTabIndicatorHandler7||i;if(this.$PagesMercuryChatTabIndicatorHandler3&&this.$PagesMercuryChatTabIndicatorHandler5){this.$PagesMercuryChatTabIndicatorHandler5=false;new (c('Animation'))(this.$PagesMercuryChatTabIndicatorHandler3).to('height',0).duration(100).hide().go();}};h.prototype.showIndicator=function(){'use strict';if(!this.$PagesMercuryChatTabIndicatorHandler3||this.$PagesMercuryChatTabIndicatorHandler5||this.$PagesMercuryChatTabIndicatorHandler6!==c('AvailableListConstants').OFFLINE||!this.$PagesMercuryChatTabIndicatorHandler1||this.$PagesMercuryChatTabIndicatorHandler7)return;c('DOM').setContent(this.$PagesMercuryChatTabIndicatorHandler3,this.$PagesMercuryChatTabIndicatorHandler1);this.$PagesMercuryChatTabIndicatorHandler5=true;new (c('Animation'))(this.$PagesMercuryChatTabIndicatorHandler3).show().to('height',16).duration(100).go();};h.prototype.notifyPageOnlineStatusChanged=function(i){'use strict';if(this.$PagesMercuryChatTabIndicatorHandler6===i)return;this.$PagesMercuryChatTabIndicatorHandler6=i;if(!this.$PagesMercuryChatTabIndicatorHandler2)return;switch(i){case c('AvailableListConstants').ACTIVE:this.hideIndicator();break;default:this.showIndicator();break;}};h.prototype.$PagesMercuryChatTabIndicatorHandler9=function(i,j){'use strict';this.$PagesMercuryChatTabIndicatorHandler1=i;this.$PagesMercuryChatTabIndicatorHandler2=j;this.showIndicator();};f.exports=h;},null);
__d('SelectionPosition',['Event','InputSelection','SubscriptionsHandler'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this.$SelectionPosition1=i;this.$SelectionPosition2={start:0,end:0};this.$SelectionPosition3=new (c('SubscriptionsHandler'))();this.$SelectionPosition4=false;this.updatePos();this.enable();}h.prototype.getPos=function(){'use strict';return babelHelpers['extends']({},this.$SelectionPosition2);};h.prototype.setPos=function(i,j){'use strict';this.$SelectionPosition2={start:i,end:j};this.restore();};h.prototype.updatePos=function(){'use strict';this.$SelectionPosition2=c('InputSelection').get(this.$SelectionPosition1);};h.prototype.restore=function(){'use strict';c('InputSelection').set(this.$SelectionPosition1,this.$SelectionPosition2.start,this.$SelectionPosition2.end);};h.prototype.enable=function(){'use strict';if(!this.$SelectionPosition4){this.$SelectionPosition3.addSubscriptions(c('Event').listen(this.$SelectionPosition1,'keyup',this.updatePos.bind(this)),c('Event').listen(this.$SelectionPosition1,'click',this.updatePos.bind(this)));this.$SelectionPosition4=true;}};h.prototype.disable=function(){'use strict';if(this.$SelectionPosition4){this.$SelectionPosition3.release();this.$SelectionPosition4=false;}};f.exports=h;},null);
__d("XStickerReplyNUXController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/stickers\/tooltip\/",{});},null);
__d('ChatTabView',['csx','cx','fbt','Promise','AsyncRequest','AsyncSignal','AvailableListConstants','BanzaiODS','BootloadedComponent.react','Bootloader','ChatBehavior','ChatConfig','ChatReactInput','ChatNubLogger','ChatOpenTab','ChatPhotoUploader.react','ChatTabActions','ChatTabMessagesView','ChatTabSheetController','ChatTabViewEvents','ChatTabViewInstances','ChatTitleLink.react','ChatVisibility','CSS','CurrentUser','Dock','DOM','DOMQuery','DragDropTarget','EmojiLikeUtils','EmoticonsList','EmoticonUtils','Event','FBID','JSResource','Keys','LogHistory','MercuryBlockedParticipants','MercuryCanonicalGroupThreadManager','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryShareAttachmentRenderLocations','MercurySourceType','MercuryThreadInfo','MercuryThreadTitle.react','MercuryTypingAnimation.react','MercuryTypingReceiver','MercuryViewer','MessagingTag','NubController','P2PGKValues','P2PSendMoneyContainerBootloader.react','PagesMercuryChatTabIndicatorHandler','Parent','PhotosUploadWaterfall','PresenceStatus','React','ReactComponentRenderer','ReactDOM','Run','Scroll','SelectionPosition','ShortProfiles','SimpleXUIDialog','SiteData','StickerActions','StickerConstants','StickerState','Style','SubscriptionsHandler','SyntheticMouseEvent','ChatTabTemplates','TextAreaControl','TooltipData','TypingDetectorController','UserAgent_DEPRECATED','WaterfallIDGenerator','WebMessengerThreadPermalinks','WorkFileUploadsGating','WorkModeConfig','XStickerReplyNUXController','createCancelableFunction','emptyFunction','getActiveElement','isEmpty','requireWeak','setIntervalAcrossTransitions','MercuryMessageObject','MercuryMessages','MercuryServerRequests','MercuryThreadActions','MercuryThreadIDMap','MercuryThreadInformer','MercuryThreads','MercuryMessageActions'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('ChatReactInput').module,l=c('MercuryBlockedParticipants').get(),m=c('MercuryTypingReceiver').get(),n=c('MercuryMessageObject').get(),o=c('MercuryMessages').get(),p=c('MercuryServerRequests').get(),q=c('MercuryThreadActions').get(),r=c('MercuryThreadIDMap').get(),s=c('MercuryThreadInformer').get(),t=c('MercuryThreads').get(),u=c('MercuryMessageActions').get(),v=/^\s*$/,w=c('ChatTabViewInstances'),x,y='right',z=960,aa=10,ba=c('ChatConfig').get('chat_react_composer'),ca=c('ChatConfig').get('chat_simple_group_title_tooltip'),da='\n',ea=c('LogHistory').getInstance('chat_tab_view');c('requireWeak')('AvailableList',function(za){za.subscribe(c('AvailableListConstants').ON_AVAILABILITY_CHANGED,wa);});function fa(za,ab){var bb=c('DOM').create('div'),cb=[];ab=ab&&ab.filter(function(fb){return fb!=c('MercuryViewer').getID();});if(c('isEmpty')(ab))return c('TooltipData').remove(za);var db=ab.length,eb=db-aa;if(eb>1)ab=ab.slice(0,aa);c('MercuryParticipants').getMulti(ab,function(fb){for(var gb in fb){var hb=fb[gb];if(ca){cb.push(hb.name);continue;}var ib=c('ChatTabTemplates')[':fb:mercury:chat:multichat-tooltip-item'].build();c('DOM').setContent(ib.getNode('name'),hb.name);var jb=c('MercuryIDs').getUserIDFromParticipantID(gb),kb=jb&&c('PresenceStatus').get(jb)==c('AvailableListConstants').ACTIVE;c('CSS').conditionShow(ib.getNode('icon'),kb);c('CSS').conditionClass(ib.getNode('name'),"_1aly",kb);c('DOM').appendContent(bb,ib.getRoot());}if(eb>1){var lb=j._("and {number of hidden chat participants} more.",[j.param('number of hidden chat participants',eb)]);if(!ca){c('DOM').appendContent(bb,c('DOM').create('div',{},lb));}else cb.push(lb);}c('TooltipData').set(za,ca?cb.join(da):bb,'above');});}var ga={},ha=null,ia=false;function ja(za,ab,bb){if(bb){ga[za]=ab;if(!ha)ha=c('setIntervalAcrossTransitions')(ka,600);}else{c('CSS').removeClass(ab,'highlightTitle');delete ga[za];}}function ka(){for(var za in ga){var ab=ga[za];if(ab.parentNode){c('CSS').conditionClass(ab,'highlightTitle',ia);}else delete ga[za];}ia=!ia;if(!Object.keys(ga).length){clearInterval(ha);ha=null;}}function la(za){var ab=c('MercuryIDs').tokenize(za);switch(ab.type){case 'user':return c('ChatTabTemplates')[':fb:mercury:chat:user-tab'].build();}return c('ChatTabTemplates')[':fb:mercury:chat:multichat-tab'].build();}function ma(za){var ab=za._getInputValue(),bb=za._filesUploader,cb=bb?bb.getAttachments():[];if(ra(za))oa(za,ab,cb,function(db){db=ya(db,bb);u.send(db,function(eb){var fb=t.getThreadMetaNow(eb);if(fb&&fb.folder===c('MessagingTag').PENDING)q.movePendingToInbox(eb);});bb&&bb.removeAttachments();if(za._sharePreview)za._sharePreview.setProps({share:null,uri:null});if(ba){za._composer.onSend();}else za._chatInput.component.resetState();za._typingDetector&&za._typingDetector.resetState();if(za._messagesView){za._messagesView.scrollToBottom();za._messagesView.setShouldScrollToBottom(true);za.tryMarkAsRead();}});}function na(za,ab){if(ab===0)return;ta(za,c('PhotosUploadWaterfall').POST_PUBLISHED,{count:ab});za._waterfallID=c('WaterfallIDGenerator').generate();}function oa(za,ab,bb,cb){t.getThreadMeta(za._threadID,function(db){if(db&&db.is_canonical&&!c('MercuryThreadInfo').canReply(db)){za._showMessageBlockedDialog(db);return;}var eb=c('MercurySourceType').CHAT_WEB,fb=n.constructUserGeneratedMessageObject(ab,eb,za._threadID);if(bb.length>0){fb.has_attachment=true;fb.raw_attachments=bb;}if(za._sharePreview){var gb=za._sharePreview.component.getShareData();if(gb){fb.has_attachment=true;fb.shareable_attachment=gb;}}if(t.isNewEmptyLocalThread(za._threadID)){var hb=za._sheetController.getAddFriendsParticipants();za._sheetController.closeAddFriendsSheet();if(hb===null||hb.length===0)return;hb=hb.filter(function(lb){return lb!=c('MercuryViewer').getID();});if(hb.length===0){fb.thread_id=c('MercuryIDs').getThreadIDFromUserID(c('CurrentUser').getID());}else if(hb.length===1){fb.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(hb[0]);}else{var ib=za.getMessagesView().getThreadID();if(ib!=za._threadID)fb.thread_id=ib;q.addParticipants(za._threadID,hb);}}if(t.isEmptyLocalThread(za._threadID)){fb.offline_threading_id=c('MercuryIDs').tokenize(za._threadID).value;var jb=t.getThreadMetaNow(db.thread_id);fb.specific_to_list=Array.from(jb.participants);}if(typeof fb!='undefined')fb.signatureID=za._signatureID;fb.ui_push_phase=c('SiteData').push_phase;cb(fb);if(za._threadID!==fb.thread_id&&!za.isUploading()){var kb=za._getInputValue();c('ChatTabActions').closeTab(za._threadID);c('ChatOpenTab').openThread(fb.thread_id,'ChatTabView',null,ab?c('emptyFunction'):function(lb){return lb.appendTextToInput(kb);});}});}function pa(za){za._blocked=true;za._sheetController.openUploadWarningTabSheet();}function qa(za){return za.isUploading();}function ra(za){var ab=za._getInputValue();if(!v.test(ab))return true;var bb=za._filesUploader;if(bb&&(bb.getAttachments().length>0||bb.getImageFiles().length>0||bb.getAnimatedImageFiles().length>0||bb.getVideoFiles().length>0||bb.getAudioFiles().length>0||bb.getFiles().length>0))return true;if(za._sharePreview&&za._sharePreview.component.getShareData())return true;return false;}function sa(za){za._nubController.flyoutContentChanged();var ab=za._getNode('attachmentShelf');c('Scroll').setTop(ab,ab.scrollHeight);}function ta(za,ab,bb){c('PhotosUploadWaterfall').sendSignal(babelHelpers['extends']({qn:za._waterfallID,step:ab,uploader:c('PhotosUploadWaterfall').APP_CHAT},bb||{}));}function ua(za,ab,bb,cb,db){if(ab)p.ensureThreadIsFetched(ab);this._threadID=za;this._signatureID=bb;this._eventListeners=[];this._onlineStatus=c('AvailableListConstants').OFFLINE;this._tabTemplate=la(za);this._tabElem=this._tabTemplate.getRoot();if(db&&db.getTabElem()){this.insertBefore(db);}else this.appendTo(cb);this._stickersFlyoutShown=false;this._messagesView=null;this._titlebar=this._getNode('nubFlyoutTitlebar');if(!ba){this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._contentSearchNode=this._getNode('contentSearchContainer');this._fileUploaderNode=this._getNode('fileUploaderContainer');}this._pagesMessageIndicator=this._getNode('pagesMessageIndicator');this._waterfallID=c('WaterfallIDGenerator').generate();this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._canonicalGroupSearchSubscriptionID=null;this._initializeSheetController();var eb=[c('emptyFunction'),this._initializeHeader.bind(this),this._initializeUIListeners.bind(this),this._initializeAutoSendPhotoUploader.bind(this),this._initializeAutoSendFileUploader.bind(this),this._initializeTitleHREF.bind(this),this._initializeP2P.bind(this),this._initializeInput.bind(this),this._initializeStickers.bind(this),this._initializeContentSearch.bind(this),function(){this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);}.bind(this),this._initializeUnloadListeners.bind(this),this._initializeDragDropTarget.bind(this),this._initializePageMessagingIndicator.bind(this),this._initializePagesGreeting.bind(this),this._initializeP2PChatThreadBannerContainer.bind(this),this._initializeP2PRainMoneyContainer.bind(this)];for(var fb=eb,gb=Array.isArray(fb),hb=0,fb=gb?fb:fb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ib;if(gb){if(hb>=fb.length)break;ib=fb[hb++];}else{hb=fb.next();if(hb.done)break;ib=hb.value;}var jb=ib;jb();}w.set(za,this);this._logOpenTab();}function va(za){if(za._photoUploader&&za._photoUploader.isUploading())ta(za,c('PhotosUploadWaterfall').CANCEL_DURING_UPLOAD);}function wa(){for(var za=w.values(),ab=Array.isArray(za),bb=0,za=ab?za:za[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var cb;if(ab){if(bb>=za.length)break;cb=za[bb++];}else{bb=za.next();if(bb.done)break;cb=bb.value;}var db=cb;db.updateAvailableStatus();db.updateTitlebarTooltip();}}c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,function(){for(var za=w.keys(),ab=Array.isArray(za),bb=0,za=ab?za:za[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var cb;if(ab){if(bb>=za.length)break;cb=za[bb++];}else{bb=za.next();if(bb.done)break;cb=bb.value;}var db=cb;t.getThreadMeta(db,function(eb){w.get(db)._updateUnreadCount(eb);});}});m.addRetroactiveListener('state-changed',function(za){for(var ab in za){var bb=za[ab]&&za[ab].length,cb=w.get(ab);cb&&cb.showTypingIndicator(bb);}});s.subscribe('threads-updated',function(za,ab){for(var bb=w.keys(),cb=Array.isArray(bb),db=0,bb=cb?bb:bb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var eb;if(cb){if(db>=bb.length)break;eb=bb[db++];}else{db=bb.next();if(db.done)break;eb=db.value;}var fb=eb,gb=w.get(fb);ab[fb]&&gb.updateTab();if(gb._newThreadIDFromPhotoUpload&&!gb.isUploading()&&ab[gb._newThreadIDFromPhotoUpload]){c('ChatTabActions').closeTab(gb._threadID);c('ChatOpenTab').openThread(gb._newThreadIDFromPhotoUpload,'ChatTabView');gb._newThreadIDFromPhotoUpload=null;}}});s.subscribe('threads-deleted',function(za,ab){for(var bb=w.keys(),cb=Array.isArray(bb),db=0,bb=cb?bb:bb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var eb;if(cb){if(db>=bb.length)break;eb=bb[db++];}else{db=bb.next();if(db.done)break;eb=db.value;}var fb=eb;ab[fb]&&c('ChatTabActions').closeTab(fb,'thread_deleted');if(t.isNewEmptyLocalThread(fb)){var gb=w.get(fb);gb.ensureValidCanonicalGroup(ab);}}});Object.assign(ua.prototype,{getThreadID:function(){return this._threadID;},getTabElem:function(){return this._tabElem;},showAddFriend:function(){setTimeout(function(){this._sheetController.openAddFriendsSheet();}.bind(this),0);},showNameConversation:function(za){setTimeout(function(){this._sheetController.openNameConversationSheet(za);}.bind(this),0);},hideAutomaticNameConversation:function(){setTimeout(function(){this._sheetController.closeAutomaticNameConversationSheet();}.bind(this),0);},isVisible:function(){return c('CSS').shown(this._tabElem);},isUploading:function(){var za=ba?this._composer&&this._composer.isUploading():!!(this._fileUploader&&this._fileUploader.isUploading()||this._photoUploader&&this._photoUploader.isUploading());return !!(za||this._filesUploader&&this._filesUploader.isUploading()||this._sharePreview&&this._sharePreview.component.isLoading());},setVisibleState:function(za,ab){var bb=c('CSS').shown(this._tabElem),cb=c('CSS').hasClass(this._tabElem,'opened');c('CSS').conditionShow(this._tabElem,za);c('CSS').conditionClass(this._tabElem,'opened',ab);if(!(bb&&cb)&&za&&ab){if(!this._messagesView)this._updateChatTabMessagesView(this._threadID);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();this.setP2PChatThreadBannerContainerVisibility();}},_updateChatTabMessagesView:function(za){if(this._messagesView&&this._messagesView.getThreadID()===za)return;var ab=c('MercuryIDs').tokenize(za);this._messagesView&&this._messagesView.destroy();this._messagesView=new (c('ChatTabMessagesView'))(za,this._sheetController,this._getNode('scrollingArea'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this,c('MercuryConfig').ShowContextBanner&&ab.type==='user');},focus:function(){if(c('CSS').hasClass(this._tabElem,'opened')){try{this._focusInput();}catch(za){}}else this._getNode('dockButton').focus();},isFocused:function(){var za=c('getActiveElement')();return c('Parent').bySelector(za,"._50mz")===this._tabElem;},hasEmptyInput:function(){return v.test(this._getInputValue());},getInputElem:function(){if(ba)return this._composer&&c('ReactDOM').findDOMNode(this._composer.getInput());if(!this._chatInput||!this._chatInput.component.isMounted())return null;return c('ReactDOM').findDOMNode(this._chatInput.component);},getMessagesView:function(){return this._messagesView;},setStickersFlyoutPackID:function(za){if(!this._stickerButton.isMounted())return;c('StickerActions').selectPack(za);this._toggleStickersFlyoutShown(true);},loadShareFromParams:function(za,ab){this._getSharePreview().done(function(bb){bb.setProps({share:{params:ab,type:za},uri:null});});},_linkDropped:function(za){this._getSharePreview().done(function(ab){ab.setProps({share:null,uri:za});});},_filesDropped:function(za){this._loadReactMenu().done(function(ab){var bb=ab.component.getFileUploaderPromise();if(bb)bb.done(function(cb){setTimeout(function(){cb.addDroppedFiles(za);},0);});});},_toggleStickersFlyoutShown:function(za){this._stickerButton.showFlyout();this._stickersFlyoutShown=za;},showStickerReplyNUX:function(){if(x)return;new (c('AsyncRequest'))(c('XStickerReplyNUXController').getURIBuilder().getURI()).setRelativeTo(this._getNode('stickerButtonContainer')).setData({thread_id:this._threadID}).setHandler(function(za){c('StickerState').clearShowStickerReplyNUX();}).send();},insertBefore:function(za){c('DOM').insertBefore(za.getTabElem(),this._tabElem);},appendTo:function(za){c('DOM').appendContent(za,this._tabElem);},nextTabIs:function(za){var ab=za&&za.getTabElem();return this._tabElem.nextSibling==ab;},getScrollTop:function(){return c('Scroll').getTop(c('DOM').find(this._tabElem,'.fbNubFlyoutBody.scrollable'));},setScrollTop:function(za){c('Scroll').setTop(c('DOM').find(this._tabElem,'.fbNubFlyoutBody.scrollable'),za);},destroy:function(){this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._checkUnsentMessages&&this._checkUnsentMessages.cancel();this._logUnsentPhotos&&this._logUnsentPhotos.cancel();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();c('ReactDOM').unmountComponentAtNode(this._getNode('animationContainer'));c('ReactDOM').unmountComponentAtNode(this._getNode('menuContainer'));if(this._addToThreadButton){this._addToThreadButton.unmount();this._addToThreadButton=null;}if(this._archiveWarning){this._archiveWarning.unmount();this._archiveWarning=null;}if(this._videoCallButton){this._videoCallButton.unmount();this._videoCallButton=null;}if(this._voiceCallButton){this._voiceCallButton.unmount();this._voiceCallButton=null;}if(this._closeButton){this._closeButton.unmount();this._closeButton=null;}if(this._title){this._title.unmount();this._title=null;}if(this._sharePreview){this._sharePreview.unmount();this._sharePreview=null;}this._subscriptionsHandler&&this._subscriptionsHandler.release();c('ReactDOM').unmountComponentAtNode(this._getNode('name'));if(ba){c('ReactDOM').unmountComponentAtNode(this._getNode('footer'));}else{try{c('ReactDOM').unmountComponentAtNode(this._getNode('photoUploaderContainer'));c('ReactDOM').unmountComponentAtNode(this._getNode('fileUploaderContainer'));}catch(za){c('BanzaiODS').bumpEntityKey('chat.web','chattab.unmount_failed');}c('ReactDOM').unmountComponentAtNode(this._getNode('stickerButtonContainer'));c('ReactDOM').unmountComponentAtNode(this._getNode('inputContainer'));if(this._getNode('hotLikeContainer'))c('ReactDOM').unmountComponentAtNode(this._getNode('hotLikeContainer'));if(this._p2pButtonContainer){if(this._p2pButton)this._p2pButton.unmount();this._p2pButtonContainer=null;this._p2pButton=null;}if(this._p2pChatThreadBannerContainerEl){c('ReactDOM').unmountComponentAtNode(this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainerEl=null;}if(this._p2pRainMoneyContainerEl){c('ReactDOM').unmountComponentAtNode(this._p2pRainMoneyContainerEl);this._p2pRainMoneyContainerEl=null;}}c('DOM').remove(this._tabElem);w['delete'](this._threadID);c('Dock').unregisterNubController(this._nubController);},updateAvailableStatus:function(){t.getThreadMeta(this._threadID,function(za){var ab=c('AvailableListConstants').OFFLINE,bb=this._getCanonicalUserID(),cb=null;if(bb){ab=c('PresenceStatus').get(bb);cb=c('ShortProfiles').getNow(bb);}else{var db=za.participants.map(function(fb){return c('MercuryIDs').getUserIDFromParticipantID(fb);});ab=c('PresenceStatus').getGroup(db);}if(!c('ChatVisibility').isOnline())ab=c('AvailableListConstants').OFFLINE;c('CSS').conditionClass(this._tabElem,"_5238",ab===c('AvailableListConstants').ACTIVE&&(cb===undefined||cb===null||!cb.is_messenger_only));var eb=this._getNode('presenceIndicator');this._onlineStatus=ab;this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.notifyPageOnlineStatusChanged(ab);switch(ab){case c('AvailableListConstants').ACTIVE:eb.setAttribute('alt',j._("Online"));break;default:eb.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){t.getThreadMeta(this._threadID,function(za){var ab=[this._getNode('name')];if(this._title)this._title.setProps({thread:za},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.component.getTitle());}.bind(this));for(var bb=ab,cb=Array.isArray(bb),db=0,bb=cb?bb:bb[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var eb;if(cb){if(db>=bb.length)break;eb=bb[db++];}else{db=bb.next();if(db.done)break;eb=db.value;}var fb=eb;c('ReactDOM').render(c('React').createElement(c('MercuryThreadTitle.react'),{isNewThread:t.isNewEmptyLocalThread(this._threadID),thread:za,useAndSeparator:true,useShortName:!za.is_canonical,viewer:c('CurrentUser').getID()}),fb);}this._updateControls(za);this._updateMessageBlockSettings(za);this._updateMessageManageSettings(za);this._updateSecretModeSettings(za);this._updateMutingSettings(za);this._updateUnreadCount(za);this.updateTitlebarTooltip();this._updateArchiveWarning(za);this._updateConfidentialStatus(za);this._updateEmployeeAwayWarning(za);this._updateOfficeStatus(za);this._updateNewThread(za);this._updateNameConversationSheet(za);this._updateReadOnlySheet(za);this._updateSwitchToWork(za);this._updateCustomLike(za);}.bind(this));},_updateNameConversationSheet:function(za){if(c('MercuryThreadInfo').canReply(za)&&!za.name&&!za.is_canonical&&!za.name_conversation_sheet_dismissed&&!za.has_email_participant&&!za.read_only&&!t.isEmptyLocalThread(za.thread_id)&&!c('MercuryConfig').SuppressNamingUpsell){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(za){var ab=c('MercuryThreadInfo').showComposer(za),bb=c('MercuryThreadInfo').canReply(za),cb=t.isEmptyLocalThread(za.thread_id);if(!bb&&!ab&&!cb)this._sheetController.openReadOnlySheet();},_updateMessageManageSettings:function(za){var ab=c('MercuryIDs').getParticipantIDFromFromThreadID(za.thread_id),bb=c('MercuryParticipants').getNow(ab);this._updateMenuPropsSafe({isBusinessEnabled:bb&&bb.is_business_enabled});},updateSignatureID:function(za){this._signatureID=za;},_updateMessageBlockSettings:function(za){this._updateMenuPropsSafe({hasMessageBlocked:l.isMessageBlocked(za),isEmptyConversation:za&&za.message_count==0});},_updateCustomLike:function(za){if(ba||!this._getNode('hotLikeContainer'))return;var ab="_6h1 _6gb";c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('a',{className:ab}),bootloadLoader:c('JSResource')('MessengerHotLikeButton.react'),className:ab,customLike:za.custom_like_icon,sendSticker:this._stickerSelected.bind(this),sendCustomLike:this._customLikeSelected.bind(this),threadID:this._threadID}),this._getNode('hotLikeContainer'));c('CSS').addClass(this._inputContainerNode,"_n4k");},_updateSecretModeSettings:function(za){var ab=!!(za&&za.ephemeral_ttl_mode);this._updateMenuPropsSafe({hasSecretModeOn:ab});c('CSS').conditionClass(this._tabElem,"_5iq8",ab);var bb=ab?j._("Type a disappearing message..."):j._("Type a message...");if(ba){this._composer&&this._composer.setPlaceholder(bb);}else this._chatInput.setProps({placeholder:bb});},_updateMutingSettings:function(za){var ab=!!za&&c('MercuryThreadInfo').isMuted(za);ab&&!this._reactChatTabMenu&&this._loadReactMenu();this._updateMenuPropsSafe({isMuted:ab});},_updateMenuPropsSafe:function(za){if(this._menuPromise)this._menuPromise.done(function(ab){ab&&ab.component&&ab.component.isMounted()&&ab.setProps(za);});},_updateArchiveWarning:function(za){if(c('CurrentUser').isEmployee())c('MercuryParticipants').getMulti(za.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));},_updateConfidentialStatus:function(za){if(za.other_user_fbid)c('MercuryParticipants').getMulti(za.participants,function(ab){var bb=this._getNode('titlebarConfidentialStatus');if(bb){var cb=za.other_user_fbid&&ab[c('MercuryIDs').getParticipantIDFromUserID(za.other_user_fbid)].is_anonymous_crisis_support;c('CSS').conditionShow(bb,cb);}}.bind(this));},_updateEmployeeAwayWarning:function(za){if(!c('CurrentUser').isEmployee())return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatEmployeeAwayWarning"],function(ab){ab.updateEmployeeAwayWarning(za,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),c('emptyFunction'));}.bind(this));}.bind(this));},_updateOfficeStatus:function(za){var ab=this._getNode('officeStatus');if(!ab||c('MercuryIDs').isGroupChat(za.thread_id))return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatTabOfficeStatus"],function(bb){var cb=c('MercuryIDs').getParticipantIDFromUserID(za.other_user_fbid);c('MercuryParticipants').get(cb,function(db){bb.update(ab,db);});});});},_updateSwitchToWork:function(za){if(c('CurrentUser').isEmployee()&&c('CurrentUser').hasWorkUser()&&c('MercuryIDs').isGroupChat(za.thread_id)){c('MercuryParticipants').getMulti(za.participants,function(ab){var bb=this._isEmployeesOnly(ab);this._updateMenuPropsSafe({hasSwitchToWork:bb});}.bind(this));}else this._updateMenuPropsSafe({hasSwitchToWork:false});},_updateControls:function(za,ab,bb){var cb=false;if(za&&za.thread_id){var db=c('MercuryIDs').tokenize(za.thread_id);if(db.type==='user'){var eb=db.value;cb=!c('FBID').isUser(eb);}}var fb=c('MercuryThreadInfo').showComposer(za)&&(!c('isEmpty')(za.participants)||!!ab)&&!this._pendingActions,gb=this._getNode('footer');c('CSS').conditionShow(gb,fb);c('CSS').conditionShow(this._getNode('menuContainer'),fb);var hb={isEmptyChat:t.isNewEmptyLocalThread(za.thread_id),show:fb};if(cb)hb.showAddFriend=null;this._updateMenuPropsSafe(hb);var ib=fb&&!cb;this._addToThreadButton&&this._addToThreadButton.setProps({shown:ib});if(bb&&bb.length===1&&c('MercuryConfig').ShowContextBanner&&c('MercuryConfig').ShowContextBannerNullState){this._messagesView&&this._messagesView.renderContextBanner(null,bb[0].info&&bb[0].info.uid);}else this._messagesView&&this._messagesView.unmountContextBanner();this._resizeInputContainer();},_isP2PVisible:function(){return c('P2PGKValues').P2PVisible;},_getP2PProps:function(){return {button:c('React').createElement('i',{className:"hidden_elem"}),className:"_6ga _6gb",flyoutAlignment:y,onTrigger:this._p2pTriggered.bind(this),referrer:c('MercuryShareAttachmentRenderLocations').CHAT,threadID:this._threadID};},_renderP2PButton:function(){var za=this._getCanonicalUserID();if(this._isP2PVisible()&&za!==c('CurrentUser').getID()){this._p2pButtonContainer=this._getNode('orionTriggerContainer');this._p2pButton=new (c('ReactComponentRenderer'))(c('P2PSendMoneyContainerBootloader.react'),this._p2pButtonContainer);this._p2pButton.setProps(this._getP2PProps());c('CSS').addClass(this._inputContainerNode,"_11d6");}else c('CSS').addClass(this._getNode('orionTriggerContainer'),"hidden_elem");},_resizeInputContainer:function(){if(ba)return;},_updateNewThread:function(za){if(t.isNewEmptyLocalThread(za.thread_id))this.showAddFriend();},_isEmployeesOnly:function(za){for(var ab in za)if(!za[ab].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(za){var ab=this._isEmployeesOnly(za),bb=this._getNode('archiveContainer');if(bb){if(this._titlebarTooltipAnchor)c('CSS').conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',ab);c('CSS').conditionShow(bb,ab);this._archiveWarning&&this._archiveWarning.setProps({shown:ab});}},updateTitlebarTooltip:function(){t.getThreadMeta(this._threadID,function(za){var ab=c('ReactDOM').findDOMNode(this._title.component);if(!ab)return;fa(ab,za.participants);}.bind(this));},_getNode:function(za){return this._tabTemplate.getNode(za);},_getCanonicalUserID:function(){return c('MercuryIDs').getUserIDFromThreadID(this._threadID);},_listen:function(za,event,ab,bb){var cb=this._getNode(za);if(cb){this._eventListeners.push(c('Event').listen(cb,event,ab.bind(this)));}else if(!bb)throw new Error('Could not find node "'+za+'"');},_closePreClicked:function(za){this._closeMouseDown=true;},_closeClicked:function(za){va(this);c('ChatTabActions').closeTab(this._threadID);if(za instanceof c('SyntheticMouseEvent')){za.stopPropagation();return;}za.kill();},_closeEnter:function(za){if(za.keyCode===c('Keys').RETURN)this._closeClicked(za);},_nubClicked:function(za){za.kill();return c('ChatTabViewEvents').inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===c('Keys').RETURN||event.keyCode===c('Keys').SPACE){c('ChatTabViewEvents').inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===c('Keys').ESC){this._handleEscape();event.kill();}else if(event.keyCode===c('Keys').TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var za=c('ChatTabViewEvents').inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!za&&event.preventDefault();}},_handleEscape:function(){if(this._stickersFlyoutShown){this._toggleStickersFlyoutShown(false);return;}va(this);if(this.hasEmptyInput()){c('ChatTabViewEvents').inform('esc-pressed',this._threadID);}else{var za=j._("Are you sure you want to close this chat window?"),ab=j._("You haven't sent your message.");c('SimpleXUIDialog').showConfirm(za,ab,function(bb){if(bb){c('ChatTabViewEvents').inform('esc-pressed',this._threadID);}else this.focus();}.bind(this),{autofocusConfirm:true});}},_titleClicked:function(event){var za=event.getTarget();if(!c('Parent').byClass(za,'titlebarText')&&!c('Parent').byClass(za,'uiSelector')&&!c('Parent').bySelector(za,"._3olv")&&!c('Parent').byClass(za,'close')){event.kill();c('ChatTabActions').lowerTab(this._threadID);this.focus();}},_addFriendLinkClicked:function(){this.showAddFriend();},_getUserParticipants:function(za){var ab=[];za.forEach(function(bb){var cb=c('MercuryIDs').getUserIDFromParticipantID(bb);cb&&ab.push(cb);});return ab;},_enableDesktopNotif:function(){Notification.requestPermission();},_inputPasted:function(event){if(c('UserAgent_DEPRECATED').chrome()){var za=event.clipboardData||event.originalEvent.clipboardData;if(!za||!za.items||za.items.length<1)return;var ab=za.items[0].type;if(ab!=='image/png')return;if(za.items[0].getAsFile){var bb=za.items[0].getAsFile();this._photoUploader&&this._photoUploader.uploadFiles([bb]);}}},_focusInput:function(){c('ChatNubLogger').processEvent('focus');if(ba){this._composer&&this._composer.getInput().focus();}else this._chatInput&&this._chatInput.component.isMounted()&&this._chatInput.component.focus();},_focusTab:function(){c('CSS').addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._closeMouseDown=false;this._setCloseTooltip(true);c('ChatTabViewEvents').inform('focus-tab',this._threadID);},_blurTab:function(){c('ChatNubLogger').processEvent('blur');c('CSS').removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(za){if(this._closeButton){this._closeButton.setProps({active:za});return;}var ab=this._getNode('titlebarCloseButton');if(!ab)return;var bb=za?j._("Press Esc to close"):j._("Close tab");c('TooltipData').set(ab,bb,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===c('Keys').RETURN&&!event.shiftKey){if(qa(this)){pa(this);event.kill&&event.kill();return;}ma(this);event.kill?event.kill():event.preventDefault();return;}if(event.keyCode===c('Keys').DOWN&&event.shiftKey&&this.hasEmptyInput()){event.kill&&event.kill();c('ChatTabActions').lowerTab(this._threadID);this.focus();return;}this._handleHotkeyPressed(event);},_showMessageBlockedDialog:function(za){var ab=this._getCanonicalUserID();if(!ab)return;var bb='fbid:'+ab;c('MercuryParticipants').get(bb,function(cb){c('Bootloader').loadModules(["MessageBlockedDialog"],function(db){db.show(za.thread_id,za.can_reply,l.isMessageBlocked(za),cb.short_name);});});},_initializeInput:function(){if(ba){var za=new (c('ReactComponentRenderer'))(c('BootloadedComponent.react'),this._getNode('footer'));za.setProps({bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('ChatTabComposerContainer.react'),initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onMount:function(bb){this._composer=bb;}.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:function(){return this._toggleStickersFlyoutShown(true);}.bind(this),resizeFn:function(){this._nubController.flyoutContentChanged();}.bind(this),placeholder:j._("Type a message..."),photoUploaderProps:this._getPhotoUploaderProps(),fileUploaderProps:this._getFileUploaderProps(),stickerButtonProps:this._getStickerButtonProps(),p2pProps:this._getP2PProps(),onCustomLikeSelect:this._customLikeSelected.bind(this),onEmojiSelect:this._emojiSelected.bind(this),onStickerSelect:this._stickerSelected.bind(this),threadID:this._threadID,viewer:c('CurrentUser').getID()});return;}var ab=j._("Type a message...");this._chatInput=new (c('ReactComponentRenderer'))(k,this._getNode('chatInputContainer'));this._chatInput.setProps({initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:function(){return this._toggleStickersFlyoutShown(true);}.bind(this),resizeFn:function(bb){c('Style').set(this._getNode('inputContainer'),'height',bb+'px');this._nubController.flyoutContentChanged();}.bind(this),uploadPhotoFn:function(bb){this._photoUploader&&this._photoUploader.uploadFiles([bb]);}.bind(this),placeholder:ab});},_initializeSharePreview:function(za,ab){c('Event').listen(za,'keyup',function(){var bb=ab?ab():za.value;if(!bb.length)if(this._urlScraper){this._urlScraper.reset();delete this._urlScraperData;}}.bind(this));c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["URLScraper"],function(bb){this._urlScraper=new bb(za,ab);this._urlScraper.subscribe('match',function(cb,db){this._urlScraperData=db;this._getSharePreview().done(function(eb){var fb=this._urlScraperData;eb.setProps({share:null,uri:fb&&fb.url});}.bind(this));}.bind(this));}.bind(this));}.bind(this));},_getSharePreview:function(){if(!this._sharePreview&&!this._sharePreviewPromise){this._sharePreviewLoading=true;this._sharePreviewPromise=new (c('Promise'))(function(za){c('Bootloader').loadModules(["MercurySharePreview.react"],function(ab){this._sharePreview=new (c('ReactComponentRenderer'))(ab,this._getNode('shareAttachmentShelf'));this._sharePreview.setProps({imageSize:{width:z,height:z},location:c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:function(){sa(this);this._unblockSend();}.bind(this)});this._sharePreviewLoading=false;za(this._sharePreview);}.bind(this));}.bind(this));}return this._sharePreviewPromise;},_initializeThingsWithInputFn:function(za,ab){if(ba)this._getValueFromReactComposer=ab;this._initializeSharePreview(za,ab);t.getThreadMeta(this._threadID,function(bb){if(bb&&bb.folder===c('MessagingTag').PENDING){var cb=c('DOM').create('div');c('DOM').appendContent(this._getNode('chatConv'),cb);this._pendingActions=cb;c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',{style:{height:27}}),bootloadLoader:c('JSResource')('ChatPendingActions.react'),onDeleteClick:function(db){q.changeFolder(this._threadID,c('MessagingTag').OTHER);c('ChatTabActions').closeTab(this._threadID);}.bind(this),onReplyClick:function(db){q.changeFolder(this._threadID,c('MessagingTag').INBOX);c('DOM').remove(cb);delete this._pendingActions;this._updateControls(bb);}.bind(this)}),cb);}r.getServerIDFromClientID(this._threadID,function(db){this._typingDetector=new (c('TypingDetectorController'))(this._getCanonicalUserID(),za,'mercury-chat',null,db,ab);}.bind(this));}.bind(this));},_getInputValue:function(){if(this._getValueFromReactComposer)return this._getValueFromReactComposer();if(!this._chatInput||!this._chatInput.component.isMounted())return '';return this._chatInput.component.getValue()||'';},appendTextToInput:function(za){if(ba){this._composer&&this._composer.getInput().appendText(za);}else if(this._chatInput&&this._chatInput.component.isMounted())this._chatInput.component.appendText(za);},_hasUnfinishedPost:function(){return ra(this)||this.isUploading();},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){q.markRead(this._threadID);q.markSeen(this._threadID);return true;}return false;},_chatConvClicked:function(za){this.tryMarkAsRead();if(c('Parent').byTag(za.getTarget(),'a')||c('DOM').getSelection())return;this.focus();},_inputContainerClicked:function(za){this.tryMarkAsRead();this.focus();},_initializePageMessagingIndicator:function(){if(!this._pagesMessageIndicator)return;c('CSS').hide(this._pagesMessageIndicator);this._pagesMessageIndicatorHandler=c('PagesMercuryChatTabIndicatorHandler').tryCreateHandler(this._threadID,this._pagesMessageIndicator,this._onlineStatus);this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.checkResponsiveness();},_initializePagesGreeting:function(){var za=c('DOMQuery').scry(this._tabElem,"._av1"),ab=this._threadID,bb=c('MercuryIDs').getUserIDFromThreadID(ab);if(!za||za.length===0||c('FBID').isUser(bb))return;var cb=c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('MercuryChatTabPagesGreetingContainer.react'),threadID:ab});c('ReactDOM').render(cb,za[0]);},showTypingIndicator:function(za){this._renderTypingIndicator();c('CSS').conditionClass(this._tabElem,"_54m8",za);},_renderTypingIndicator:function(){var za=c('CSS').hasClass(this._tabElem,'highlightTab')?'light':'dark';c('ReactDOM').render(c('React').createElement(c('MercuryTypingAnimation.react'),{color:za}),this._getNode('animationContainer'));},_updateUnreadCount:function(za){var ab=za.unread_count;if(typeof ab!='undefined'){var bb=!!ab&&(!c('ChatBehavior').showsTabUnreadUI||c('ChatBehavior').showsTabUnreadUI()),cb=this._getNode('numMessages');c('CSS').conditionShow(cb,bb);c('CSS').conditionClass(this._tabElem,'highlightTab',bb);this._renderTypingIndicator();ja(this._threadID,this._tabElem,bb);c('DOM').setContent(cb,ab);}},ensureValidCanonicalGroup:function(za){if(this._messagesView&&this._messagesView.getThreadID()===this._threadID)return;if(za[this._messagesView.getThreadID()])this._updateChatTabMessagesView(this._threadID);},_initializeSheetController:function(){this._sheetController=new (c('ChatTabSheetController'))(this._threadID,this._getNode('sheet'),this._tabElem,this);this._sheetController.onClickMessagesBlockedSheet(function(){q.unblockMessages(this._threadID);this.focus();}.bind(this));this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();this.tryMarkAsRead();}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){q.unmute(this._threadID);this.focus();}.bind(this));this._sheetController.onClickSecretModeSheet(function(){q.turnOffSecretMode(this._threadID);this.focus();}.bind(this));this._sheetController.onTokensChanged(function(za,ab){this._handleSheetControllerTokensChanged(ab);}.bind(this));this._nubController=new (c('NubController'))().init(this._tabElem);this._sheetController.onResize(function(){this._nubController.flyoutContentChanged();}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));},_handleSheetControllerTokensChanged:function(za){this._updateP2PParticipants(za.tokens);t.getThreadMeta(this._threadID,function(ab){this._updateControls(ab,za.token_count,za.tokens);}.bind(this));this._updateMessagesViewIfNecessary(za);},_updateMessagesViewIfNecessary:function(za){if(!c('MercuryConfig').MessengerChatTabSnapCanonialGK||!t.isEmptyLocalThread(this._threadID))return;var ab=c('MercuryCanonicalGroupThreadManager').get();ab.unsubscribe(this._canonicalGroupSearchSubscriptionID);if(za.token_count===1){var bb=za.tokens[0].info&&za.tokens[0].info.uid;this._updateMercuryMessagesViewCanonical(c('MercuryIDs').getThreadIDFromUserID(bb));return;}this._updateMercuryMessagesViewCanonical(this._threadID);if(za.token_count>1){var cb=za.tokens.map(function(db){return db.info.uid;});this._canonicalGroupSearchSubscriptionID=ab.getCanonicalGroupThreadIDForParticipants(Array.from(cb),this._updateMercuryMessagesViewCanonical.bind(this));}},_updateMercuryMessagesViewCanonical:function(za){if(za){this._updateChatTabMessagesView(za);this._messagesView.scrollToBottom();}},_updateP2PParticipants:function(za){var ab;if(za&&za.length===1&&za[0].info&&za[0].info.uid)ab=[c('MercuryIDs').getParticipantIDFromUserID(za[0].info.uid)];if(this._p2pButton){this._p2pButton.setProps({participantIDs:ab});}else if(this._composer)this._composer.setParticipantIDs(ab);},_initializeHeader:function(){this._initializeTitle();this._initializeCloseButton();this._initializeReactMenu();this._initializeAddToThreadButton();this._initializeRTC();this._initializeArchiveWarning();},_loadReactMenu:function(){var za=c('MercuryIDs').isGroupChat(this._threadID),ab=t.isNewEmptyLocalThread(this._threadID),bb=this._sheetController.openAddFriendsSheet.bind(this._sheetController);c('JSResource')('ChatTabMenu.react').load().done(function(cb){this._reactChatTabMenu=new (c('ReactComponentRenderer'))(cb,this._getNode('menuContainer'));this._reactChatTabMenu.setProps({sheetController:this._sheetController,onFileUploaderMounted:this.setFilesUploader.bind(this),nameConversationFunc:function(){return this.showNameConversation();}.bind(this),isGroupChat:za,isEmptyChat:ab,showAddFriend:bb,threadID:this._threadID,otherUserID:this._getCanonicalUserID(),attachmentsShelf:this._getNode('fileAttachmentShelf'),onUploadFinished:this._unblockSend.bind(this),onUpdateAttachmentsShelf:function(){return sa(this);}.bind(this),onSubmit:this._focusInput.bind(this)},function(){this._menuPromiseResolve(this._reactChatTabMenu);}.bind(this));}.bind(this));return this._menuPromise;},_initializeReactMenu:function(){this._menuPromise=new (c('Promise'))(function(za){this._menuPromiseResolve=za;}.bind(this));this._listen('menuButton','click',function(za){za.preventDefault();this._loadReactMenu().done(function(ab){ab.component.open();});}.bind(this));},_initializeArchiveWarning:function(){var za=this._getNode('archiveContainer');if(!za)return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ArchiveWarning.react"],function(ab){this._archiveWarning=new (c('ReactComponentRenderer'))(ab,za);this._archiveWarning.setProps({isFBAtWork:c('WorkModeConfig').is_work_user,shown:true});}.bind(this));}.bind(this));},_initializeAddToThreadButton:function(){c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatAddToThreadButton.react"],function(za){this._addToThreadButton=new (c('ReactComponentRenderer'))(za,this._getNode('addToThreadContainer'));this._addToThreadButton.setProps({isFBAtWork:c('WorkModeConfig').is_work_user,onClick:this._addFriendLinkClicked.bind(this),shown:true});}.bind(this));}.bind(this));},_initializeRTC:function(){var za=c('MercuryIDs').isGroupChat(this._threadID);if(za&&!c('ChatConfig').get('rtc_conferencing_www'))return;c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatVideoCallButton.react"],function(ab){var bb=c('CurrentUser').getID();this._videoCallButton=new (c('ReactComponentRenderer'))(ab,this._getNode('videoCallButtonContainer'));this._videoCallButton.setProps({isAudio:false,isGroupChat:za,threadID:this._threadID,viewer:bb});this._voiceCallButton=new (c('ReactComponentRenderer'))(ab,this._getNode('voiceCallButtonContainer'));this._voiceCallButton.setProps({isAudio:true,isGroupChat:za,threadID:this._threadID,viewer:bb});}.bind(this));}.bind(this));},_initializeCloseButton:function(){this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatCloseButton.react"],function(za){this._closeButton=new (c('ReactComponentRenderer'))(za,this._getNode('titlebarCloseButtonContainer'));this._closeButton.setProps({active:this.isFocused(),className:"_3olu _3olv",onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)});}.bind(this));}.bind(this));},_initializeTitle:function(){var za=t.getThreadMetaNow(this._threadID);this._title=new (c('ReactComponentRenderer'))(c('ChatTitleLink.react'),this._getNode('titleContainer'));this._title.setProps({isNewThread:t.isNewEmptyLocalThread(this._threadID),thread:za,viewer:c('CurrentUser').getID()});},_initializeTitleHREF:function(){c('WebMessengerThreadPermalinks').getThreadURI(this._threadID,function(ab){return this._setTitleHref(ab);}.bind(this));this._titlebarTooltipAnchor=this._getNode('titlebarText');var za=this._getCanonicalUserID();if(this._getCanonicalUserID())c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(za),function(ab){if(ab.href)this._setTitleHref(ab.href);}.bind(this));},_initializeUIListeners:function(){if(this._pagesMessageIndicator)this._listen('scrollingArea','scroll',function(event){var za=event.target;if(za.scrollHeight-za.offsetHeight!==za.scrollTop)this._pagesMessageIndicatorHandler&&this._pagesMessageIndicatorHandler.hideIndicatorAndPreventFutureShow();}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);if(this._getNode('inputContainer'))this._listen('inputContainer','click',this._inputContainerClicked);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===c('Keys').TAB){this._focusInput();event.kill();}if(event.keyCode===c('Keys').ESC)this._handleEscape();}.bind(this));if(this._getNode('officeStatus'))this._listen('officeStatus','click',function(){return false;},true);},setFilesUploader:function(za){this._filesUploader=za;},_getPhotoUploaderProps:function(){return {className:"_6gd",customUI:true,imageClassName:"hidden_elem",linkClassName:"_6gb _6ge",onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)};},_initializeAutoSendPhotoUploader:function(){if(ba)return;this._photoUploader=c('ReactDOM').render(c('React').createElement(c('ChatPhotoUploader.react'),this._getPhotoUploaderProps()),this._getNode('photoUploaderContainer'));},_getStickerButtonProps:function(){return {className:"_6gb _6gf",flyoutAlignment:y,onFlyoutShown:this._onStickerFlyoutShown.bind(this),onFlyoutHidden:this._onStickerFlyoutHidden.bind(this),onLoad:function(za){this._stickerButton=za;}.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),threadID:this._threadID};},_initializeStickers:function(){if(ba)return;var za=this._getStickerButtonProps();c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),babelHelpers['extends']({bootloadPlaceholder:c('React').createElement('a',{className:za.className}),bootloadLoader:c('JSResource')('ChatStickerButton.react')},za)),this._getNode('stickerButtonContainer'));},_getFileUploaderProps:function(){var za=this._getPhotoUploaderProps();za.linkClassName="_6gb _6gg";za.onLastUploadFail=this._handleFileLastUploadFailed.bind(this);za.imagesOnly=false;return za;},_initializeAutoSendFileUploader:function(){if(ba)return;if(!this._fileUploaderNode)return;this._fileUploader=c('ReactDOM').render(c('React').createElement(c('ChatPhotoUploader.react'),this._getFileUploaderProps()),this._fileUploaderNode);},_initializeContentSearch:function(){if(ba)return;if(this._contentSearchNode){var za="_6gb _6gs";c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('a',{className:za}),bootloadLoader:c('JSResource')('ChatContentSearchButton.react'),className:za,getQuery:function(){return this._getInputValue();}.bind(this),onLoad:function(ab){this._contentSearchButton=ab;}.bind(this),onSelect:function(ab,bb){var cb=this.getInputElem();cb&&cb.select&&cb.select();if(ab.platformFBID.toString()===c('MercuryConfig').MessengerAppID){this._stickerSelected(ab.resultID.toString());}else{this._photoUploader&&this._photoUploader.uploadURL({attribution_app_id:ab.platformFBID,errorDialogParams:{body:j._("There was a problem sending this GIF. Choose another one and try again."),title:j._("Couldn't Send GIF")},external_image_url:ab.source.url,preview_url:ab.media.preview?ab.media.preview.url:ab.media.thumbnail.url,source:ab.source});this._messagesView&&this._messagesView.scrollToBottom();}}.bind(this)}),this._contentSearchNode);c('CSS').addClass(this._inputContainerNode,"_35li");c('BanzaiODS').bumpEntityKey('chat.web','content_search_button.mounting_attempted');}},_initializeDragDropTarget:function(){if(c('WorkFileUploadsGating').canUploadFiles){var za=c('DOMQuery').scry(this._tabElem,"._1ia");if(za&&za.length>0){this._dropTarget=new (c('DragDropTarget'))(za[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}}},_initializeP2PChatThreadBannerContainer:function(){var za=c('DOMQuery').scry(this._tabElem,"._2hc2");if(za&&za.length>0){this._p2pChatThreadBannerContainerEl=za[0];c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["P2PChatThreadBannerContainer.react"],function(ab){this._p2pChatThreadBannerContainer=new (c('ReactComponentRenderer'))(ab,this._p2pChatThreadBannerContainerEl);this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable(),otherUserID:c('MercuryIDs').getUserIDFromThreadID(this._threadID),threadID:this._threadID});}.bind(this));}.bind(this));}},_initializeP2PRainMoneyContainer:function(){if(!this._isP2PVisible||!c('P2PGKValues').P2PRainMoneyWWW)return false;var za=c('DOMQuery').scry(this._tabElem,"._3bpu");if(za&&za.length>0){this._p2pRainMoneyContainerEl=za[0];c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["P2PRainMoneyContainer.react"],function(ab){this._p2pRainMoneyContainer=new (c('ReactComponentRenderer'))(ab,this._p2pRainMoneyContainerEl);this._p2pRainMoneyContainer.setProps({threadID:this._threadID,width:this._tabElem.clientWidth});}.bind(this));}.bind(this));}},setP2PChatThreadBannerContainerVisibility:function(){if(this._p2pChatThreadBannerContainer)this._p2pChatThreadBannerContainer.setProps({isVisible:this.isChatViewable()});},isChatViewable:function(){return (this._tabElem&&c('CSS').hasClass(this._tabElem,'opened')&&!c('CSS').hasClass(this._tabElem,'hidden_elem'));},_initializeP2P:function(){if(ba)return;this._renderP2PButton();},_initializeUnloadListeners:function(){this._checkUnsentMessages=c('createCancelableFunction')(function(){if(this._hasUnfinishedPost())return j._("You haven't sent your message yet. Do you want to leave without sending?");if(o.getNumberLocalMessages(this._threadID))return j._("Your message is still being sent. Are you sure you want to leave?");return null;}.bind(this));c('Run').onBeforeUnload(this._checkUnsentMessages,false);this._logUnsentPhotos=c('createCancelableFunction')(va.bind(null,this));c('Run').onUnload(this._logUnsentPhotos);},_handlePUSubmit:function(za,ab){ta(this,c('PhotosUploadWaterfall').UPLOAD_START,ab);oa(this,'',[],function(bb){if(this._threadID!==bb.thread_id){this._newThreadIDFromPhotoUpload=bb.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(bb.thread_id);}bb.content_attachment=null;u.addAttachmentPlaceholder(bb,ab.upload_id,ab);}.bind(this));xa('submit',ab);this._focusInput();},_handleFileLastUploadFailed:function(za,ab){ta(this,c('PhotosUploadWaterfall').CLIENT_ERROR,ab);xa('failed',ab);u.cancelAttachmentPlaceholder(ab.upload_id,ab);var bb=j._("File Upload Failed"),cb=j._("Please try again. There was a problem uploading the file.");if(ab.errorDialogParams){bb=ab.errorDialogParams.title||bb;cb=ab.errorDialogParams.body||cb;}c('SimpleXUIDialog').show(bb,cb);},_handlePULastUploadFailed:function(za,ab){ta(this,c('PhotosUploadWaterfall').CLIENT_ERROR,ab);xa('failed',ab);u.cancelAttachmentPlaceholder(ab.upload_id,ab);var bb=j._("Photo Upload Failed"),cb=j._("Please try again. Make sure you are uploading a valid photo.");if(ab.errorDialogParams){bb=ab.errorDialogParams.title||bb;cb=ab.errorDialogParams.body||cb;}c('SimpleXUIDialog').show(bb,cb);},_handlePULastUploadCanceled:function(za,ab){ta(this,c('PhotosUploadWaterfall').CANCEL_DURING_UPLOAD,ab);xa('canceled',ab);u.cancelAttachmentPlaceholder(ab.upload_id,ab);},_handlePUAllUploadsCompleted:function(za,ab){ta(this,c('PhotosUploadWaterfall').ALL_UPLOADS_DONE,ab);xa('completed',ab);u.confirmAttachmentPlaceholder(ab.upload_id,ab);var bb=ab.image_ids.length||ab.attachments.length;na(this,bb);},_stickerSelected:function(za){oa(this,'',[],function(ab){ab.has_attachment=true;ab.sticker_id=za;u.send(ab);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emojiSelected:function(za){this.appendTextToInput(za);},_customLikeSelected:function(za,ab){oa(this,za.emoji,[],function(bb){bb.has_attachment=false;u.send(c('EmojiLikeUtils').setEmojiSize(bb,ab));this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(za){var ab=c('EmoticonsList').symbols[za];if(!ab)return;if(ba){this._composer&&this._composer.getInput().insertEmoticon(ab);return;}else if(!c('ChatConfig').get('chat_basic_input')){this._chatInput.component.insertEmoticon(ab);return;}this._selectionPosition=this._selectionPosition||new (c('SelectionPosition'))(this._getNode('input'));var bb=c('TextAreaControl').getInstance(this._getNode('input')),cb=bb.getValue(),db=c('EmoticonUtils').insertEmoticon(ab,cb,this._selectionPosition.getPos());bb.setValue(db.result);this._selectionPosition.setPos(db.start,db.end);},_p2pTriggered:function(){oa(this,'',[],function(za){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_onStickerFlyoutShown:function(za){this.focus();za();this._stickersFlyoutShown=true;},_searchStickers:function(za,ab){this._stickersFlyout&&this._stickersFlyout.setProps({packID:c('StickerConstants').SEARCH_PACK_ID,trigger:za},ab);},_onStickerFlyoutHidden:function(){this._stickersFlyoutShown=false;if(!ba)this.focus();},_setTitleHref:function(za){this._title&&this._title.setProps({href:za});},_unblockSend:function(){if(!this._blocked||qa(this))return;this._blocked=false;ma(this);this._sheetController.closeUploadWarningTabSheet();},_logOpenTab:function(){new (c('AsyncSignal'))('/ajax/chat/opentab_tracking.php',{threadID:this._threadID,userID:this._getCanonicalUserID(),signatureID:this._signatureID}).send();}});function xa(za,ab){ea.debug('photo_uploader:'+za,'{}');}function ya(za,ab){if(!ab)return za;var bb=ab.getImageFiles();if(bb.length>0){za.image_ids=bb;za.has_attachment=true;}var cb=ab.getAnimatedImageFiles();if(cb.length>0){za.gif_ids=cb;za.has_attachment=true;}var db=ab.getVideoFiles();if(db.length>0){za.video_ids=db;za.has_attachment=true;}var eb=ab.getAudioFiles();if(eb.length>0){za.audio_ids=eb;za.has_attachment=true;}var fb=ab.getFiles();if(fb.length>0){za.file_ids=fb;za.has_attachment=true;}return za;}f.exports=ua;},null);
__d('ChatTabViewCoordinator',['Arbiter','ChatTabModel','ChatTabView','ChatTabViewSelector','CSS','ErrorUtils','FBRTCSupport','LogHistory'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('chat_tab_coordinator');function i(j,k){var l=new (c('ChatTabViewSelector'))(j),m={},n=false;function o(){var s=c('ChatTabModel').get(),t={};s.tabs.forEach(function(v){t[v.id]=1;});h.log('process_tab_changed',{model_tabs:Object.keys(t),view_tabs:Object.keys(m)});for(var u in m)if(!t[u]){h.log('remove_tab',{tab_id:u});m[u].destroy();delete m[u];}p(s);q(s);if(s.tabNeedsFocus&&!s.tabNeedsFocus.isFocused())s.tabNeedsFocus.focus();}function p(s){var t=null;s.tabs.forEach(function(u){var v=u.id,w=false;if(!m[v]){h.log('add_tab',{tab_id:v});m[v]=new (c('ChatTabView'))(v,u.server_id,u.signatureID,j,t);w=true;if(m[v].onBeingReplaced)m[v].onBeingReplaced(function(z,aa){m[z]=aa;});}else m[v].updateSignatureID(u.signatureID);if(m[v].isFocused())s.tabNeedsFocus=m[v];if(!w&&!m[v].nextTabIs(t)){var x=m[v].getScrollTop();if(t){try{m[v].insertBefore(t);}catch(y){h.log('insertBeforeFailed','{}');m[v].appendTo(j);c('ErrorUtils').reportError(y);}}else m[v].appendTo(j);if(x)m[v].setScrollTop(x);}t=m[v];});}function q(s){var t=k.getTabsToShow(s),u=[],v=false;s.tabs.forEach(function(w){if(!t[w.id]){m[w.id].setVisibleState(false,w.raised);u.push(w);}});s.tabs.forEach(function(w){if(t[w.id]){m[w.id].setVisibleState(true,w.raised);v|=w.raised;}});l.setTabData(u);r(v);}function r(s){if(!s&&n){c('Arbiter').inform('layer_hidden',{type:'ChatTab'});n=false;}else if(s&&!n){c('Arbiter').inform('layer_shown',{type:'ChatTab'});n=true;}}if(c('FBRTCSupport').isSendWebrtcSupported())c('CSS').addClass(j,'videoCallEnabled');k.subscribe('tabs-changed',o);o();}f.exports=i;},null);
__d('MNCommerceDialogContainer.react',['MNCommerceDialogStateStore','PureStoreBasedStateMixin','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').createClass({displayName:'MNCommerceDialogContainer',mixins:[c('PureStoreBasedStateMixin')(c('MNCommerceDialogStateStore'))],statics:{calculateState:function(){var i=c('MNCommerceDialogStateStore').getDialogContainer();return {dialogContainer:i};}},render:function(){var i=this.state.dialogContainer;if(!i)return null;return c('React').createElement(i,null);}});f.exports=h;},null);
__d('MercuryChannelMessageTransformer',['MercuryActionType'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k={author:i.mercury_author_id,author_email:i.mercury_author_email,body:i.body,subject:i.subject,has_attachment:i.has_attachment,attachments:i.attachments,ephemeral_ttl_mode:i.ephemeral_ttl_mode,html_body:i.html_body,thread_id:i.tid,thread_fbid:i.thread_fbid&&i.thread_fbid.toString(),other_user_fbid:i.other_user_fbid&&i.other_user_fbid.toString(),offline_threading_id:i.offline_threading_id,message_id:i.mid,is_spoof_warning:i.is_spoof_warning,ranges:i.ranges,source:i.mercury_source,source_tags:i.mercury_source_tags,tags:i.tags&&i.tags.split(','),threading_id:i.threading_id,timestamp:i.timestamp,timestamp_absolute:i.timestamp_absolute,timestamp_relative:i.timestamp_relative,timestamp_datetime:i.timestamp_datetime,timestamp_time_passed:i.timestamp_time_passed,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_unread:i.is_unread,is_forward:false,forward_count:i.forward_count||i.forward,forward_message_ids:i.forward_msg_ids,folder:j,sync_id:i.sync_id};return k;}f.exports={transform:h};},null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercuryDelayedDispatcher1=j;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=c('MercuryThreadIDMap').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=c('MercuryDispatcher').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=c('MercuryServerRequests').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',function(k,l){return this.$MercuryDelayedDispatcher7();}.bind(this));}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.handleUpdateWaitForThread=function(j,k){var l=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(k);if(l){this.$MercuryDelayedDispatcher8(j);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(k,function(){return this.$MercuryDelayedDispatcher2.push(j);}.bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(k);};h.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var j=this.$MercuryDelayedDispatcher2[0];this.$MercuryDelayedDispatcher2=this.$MercuryDelayedDispatcher2.slice(1);this.$MercuryDelayedDispatcher8(j);}};h.prototype.$MercuryDelayedDispatcher8=function(j){if(j.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(j);}else this.$MercuryDelayedDispatcher6.handleUpdate(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d('MercuryChannelHandler',['Arbiter','ChannelConstants','LogHistory','MercuryActionType','MercuryChannelMessageTransformer','MercuryConfig','MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryLogMessageType','MercuryMessages','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonMixin','MercuryThreadInformer','MercuryViewer','MessagingEvent','MessagingTag','PresenceUtil','mixin'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('LogHistory').getInstance('mercury_channel_handler');h=babelHelpers.inherits(k,c('mixin')(c('MercurySingletonMixin')));i=h&&h.prototype;function k(l){'use strict';i.constructor.call(this);this.$MercuryChannelHandler1=l;this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler2=c('MercuryThreadInformer').getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler3=c('MercuryMessages').getForFBID(this.$MercuryChannelHandler1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercuryChannelHandler1);this.$MercuryChannelHandler4=[];}k.prototype.getInstanceFBID=function(){'use strict';return this.$MercuryChannelHandler1;};k.prototype.$MercuryChannelHandler5=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj||!m.obj.message)return;var n=m.obj.message,o=n.other_user_fbid?n.other_user_fbid:n.thread_fbid;o=o.toString();var p=c('MercuryChannelMessageTransformer').transform(n,m.obj.folder);if(this.__shouldDropMessageBecauseOfSync(n)){j.debug('dropped',JSON.stringify(n));return;}var q=[babelHelpers['extends']({},p)];q=q.concat(n.forward_actions||[]);var r=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:q,payload_source:r},o);};k.prototype.$MercuryChannelHandler7=function(l,m){'use strict';if(c('MercuryConfig').WWWSyncDeliveryReceipt)return;var n=m.obj.other_user_fbid,o=m.obj.thread_fbid;if(!this.$MercuryChannelHandler6(l)||!n&&!o)return;this.__payloadPreprocessor.handleUpdate({delivery_receipts:[{other_user_fbid:n?n.toString():'',thread_fbid:o?o.toString():'',time:m.obj.timestamp}]});};k.prototype.$MercuryChannelHandler8=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj||!m.obj.thread_fbids&&!m.obj.other_user_fbids)return;var n=[],o=m.obj.event==c('MessagingEvent').READ;if(o&&c('MercuryConfig').WWWSyncMarkRead)return;(m.obj.thread_fbids||[]).forEach(function(p){n.push({action_type:c('MercuryActionType').CHANGE_READ_STATUS,thread_fbid:p,mark_as_read:o,timestamp:m.obj.timestamp||0,folder:m.obj.folder_info[p]});});(m.obj.other_user_fbids||[]).forEach(function(p){n.push({action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:p,mark_as_read:o,timestamp:m.obj.timestamp||0,folder:m.obj.folder_info[p]});});this.__payloadPreprocessor.handleUpdate({actions:n,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};k.prototype.$MercuryChannelHandler9=function(l,m){'use strict';if(c('MercuryConfig').WWWSyncThreadDelete)return;if(!this.$MercuryChannelHandler6(l)||!m.obj||!(m.obj.thread_fbids||m.obj.other_user_fbids))return;var n=[];(m.obj.thread_fbids||[]).forEach(function(o){n.push({action_type:c('MercuryActionType').DELETE_THREAD,thread_fbid:o});});(m.obj.other_user_fbids||[]).forEach(function(o){n.push({action_type:c('MercuryActionType').DELETE_THREAD,other_user_fbid:o});});this.__payloadPreprocessor.handleUpdate({actions:n,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};k.prototype.$MercuryChannelHandler10=function(l,m){'use strict';if(c('MercuryConfig').WWWSyncDeleteMessage)return;if(!this.$MercuryChannelHandler6(l)||!m.obj||!m.obj.thread_fbids&&!m.obj.other_user_fbids||!m.obj.mids)return;var n=m.obj.thread_fbids.length?m.obj.thread_fbids[0]:null,o=m.obj.other_user_fbids.length?m.obj.other_user_fbids[0]:null,p={action_type:c('MercuryActionType').DELETE_MESSAGES,thread_fbid:n,other_user_fbid:o,message_ids:m.obj.mids};if(c('MercuryConfig').MessengerGlobalDeleteGK){if(m.obj.updated_thread)return;this.__payloadPreprocessor.handleUpdate({actions:[p],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});return;}this.__payloadPreprocessor.handleUpdate({actions:[p],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};k.prototype.$MercuryChannelHandler11=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj||!m.obj.folder)return;if(c('MercuryConfig').WWWSyncMarkRead)return;var n={action_type:c('MercuryGlobalActionType').MARK_ALL_READ,folder:m.obj.folder};this.__payloadPreprocessor.handleUpdate({global_actions:[n]});};k.prototype.$MercuryChannelHandler12=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj.thread_fbids&&!m.obj.other_user_fbids)return;var n=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;(m.obj.thread_fbids||[]).forEach(function(o){var p={action_type:c('MercuryActionType').CHANGE_ARCHIVED_STATUS,thread_fbid:o.toString(),other_user_fbid:null,archived:m.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},p)],payload_source:n},o.toString());},this);(m.obj.other_user_fbids||[]).forEach(function(o){var p={action_type:c('MercuryActionType').CHANGE_ARCHIVED_STATUS,thread_fbid:null,other_user_fbid:o.toString(),archived:m.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},p)],payload_source:n},o.toString());},this);};k.prototype.$MercuryChannelHandler13=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj.thread_fbids&&!m.obj.other_user_fbids)return;var n=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE,o;(m.obj.thread_fbids||[]).forEach(function(p){if(m.obj.event==c('MessagingEvent').TAG){o=m.obj.tag;}else o=m.obj.marked_as_spam?c('MessagingTag').SPAM:c('MessagingTag').INBOX;var q={action_type:c('MercuryActionType').CHANGE_FOLDER,thread_fbid:p.toString(),other_user_fbid:null,new_folder:o};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},q)],payload_source:n},p.toString());},this);(m.obj.other_user_fbids||[]).forEach(function(p){if(m.obj.event==c('MessagingEvent').TAG){o=m.obj.tag;}else o=m.obj.marked_as_spam?c('MessagingTag').SPAM:c('MessagingTag').INBOX;var q={action_type:c('MercuryActionType').CHANGE_FOLDER,other_user_fbid:p.toString(),thread_fbid:null,new_folder:o};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},q)],payload_source:n},p.toString());},this);};k.prototype.$MercuryChannelHandler14=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj.tag)return;switch(m.obj.tag){case c('MessagingTag').ACTION_ARCHIVED:this.$MercuryChannelHandler12(l,m);break;case c('MessagingTag').INBOX:case c('MessagingTag').OTHER:this.$MercuryChannelHandler13(l,m);break;}};k.prototype.__markAsSeen=function(l,m){'use strict';if(!this.$MercuryChannelHandler15(l)||!m.obj||!m.obj.seen_timestamp)return;this.__payloadPreprocessor.handleUpdate({message_counts:[{seen_timestamp:m.obj.seen_timestamp,folder:c('MessagingTag').INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:c('MessagingTag').INBOX}],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};k.prototype.__updateModelsFromMercuryPayload=function(l,m){'use strict';if(!this.$MercuryChannelHandler16(l)||!m.obj)return;this.$MercuryChannelHandler2.synchronizeInforms(function(){var n=m.obj,o=[];(n.actions||[]).forEach(function(p){var q=c('MercuryActionType').USER_GENERATED_MESSAGE;if(p.action_type==c('MercuryActionType').LOG_MESSAGE){if(this.__shouldDropLogMessageBecauseOfSync(p))return;var r=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE,s;s=p.other_user_fbid||p.thread_fbid;this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},p)],payload_source:r},s);}else if(p.action_type!=q)o.push(p);},this);n.actions=o;n.payload_source=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;this.__payloadPreprocessor.handleUpdate(n);}.bind(this));};k.prototype.$MercuryChannelHandler17=function(l,m){var n,o;'use strict';if(c('MercuryConfig').WWWSyncReadReceipt)return;var p=m.obj.time,q=m.obj.reader,r=m.obj.thread_fbid||'';this.__payloadPreprocessor.handleUpdate({roger:(o={},o[r]=(n={},n[q]=p,n),o)});};k.prototype.$MercuryChannelHandler18=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj||m.obj.message_blocked===undefined||!m.obj.thread_fbid)return;var n=c('MercuryActionType').UPDATE_BLOCKER_STATUS,o=[{action_type:n,thread_fbid:m.obj.thread_fbid,message_blocked:m.obj.message_blocked,is_blocked_by_recipient:m.obj.is_blocked_by_recipient}];this.__payloadPreprocessor.handleUpdate({actions:o,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};k.prototype.$MercuryChannelHandler19=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj||m.obj.got_blocked===undefined||!m.obj.thread_fbid)return;var n=c('MercuryActionType').UPDATE_BLOCKEE_STATUS,o=[{action_type:n,thread_fbid:m.obj.thread_fbid,got_blocked:m.obj.got_blocked}];this.__payloadPreprocessor.handleUpdate({actions:o,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};k.prototype.$MercuryChannelHandler20=function(l,m){'use strict';if(!this.$MercuryChannelHandler6(l)||!m.obj||m.obj.mute_settings===undefined||!m.obj.thread_fbid&&!m.obj.other_user_fbid)return;var n=c('MercuryActionType').CHANGE_MUTE_SETTINGS,o=[{action_type:n,thread_fbid:m.obj.thread_fbid,other_user_fbid:m.obj.other_user_fbid,mute_settings:m.obj.mute_settings}];this.__payloadPreprocessor.handleUpdate({actions:o,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};k.prototype.__handleMessagingPayload=function(l,m){'use strict';switch(m.obj.event){case c('MessagingEvent').DELIVER:this.$MercuryChannelHandler5(l,m);break;case c('MessagingEvent').DELIVERY_RECEIPT:this.$MercuryChannelHandler7(l,m);break;case c('MessagingEvent').READ:case c('MessagingEvent').UNREAD:this.$MercuryChannelHandler8(l,m);break;case c('MessagingEvent').READ_ALL:this.$MercuryChannelHandler11(l,m);break;case c('MessagingEvent').DELETE:this.$MercuryChannelHandler9(l,m);break;case c('MessagingEvent').DELETE_MESSAGES:this.$MercuryChannelHandler10(l,m);break;case c('MessagingEvent').TAG:this.$MercuryChannelHandler14(l,m);break;case c('MessagingEvent').REPORT_SPAM:this.$MercuryChannelHandler13(l,m);break;case c('MessagingEvent').READ_RECEIPT:this.$MercuryChannelHandler17(l,m);break;case c('MessagingEvent').CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandler20(l,m);break;case c('MessagingEvent').UPDATE_BLOCKER_STATUS:this.$MercuryChannelHandler18(l,m);break;case c('MessagingEvent').UPDATE_BLOCKEE_STATUS:this.$MercuryChannelHandler19(l,m);break;}};k.prototype.getRouting=function(){'use strict';return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};k.prototype.__getMessagingPayloadType=function(){'use strict';return c('ChannelConstants').getArbiterType('messaging');};k.prototype.__getMercuryPayloadType=function(){'use strict';return c('ChannelConstants').getArbiterType('mercury');};k.prototype.__getInboxPayloadType=function(){'use strict';return c('ChannelConstants').getArbiterType('inbox');};k.prototype.$MercuryChannelHandler6=function(l){'use strict';return l==this.__getMessagingPayloadType();};k.prototype.$MercuryChannelHandler16=function(l){'use strict';return l==this.__getMercuryPayloadType();};k.prototype.$MercuryChannelHandler15=function(l){'use strict';return l==this.__getInboxPayloadType();};k.prototype.turnOn=function(){'use strict';if(!this.$MercuryChannelHandler4.length){var l=this.getRouting();for(var m in l)this.$MercuryChannelHandler4.push(c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(m),l[m].bind(this)));}return this;};k.prototype.turnOff=function(){'use strict';if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(c('Arbiter').unsubscribe);this.$MercuryChannelHandler4=[];}return this;};k.prototype.__shouldDropMessageBecauseOfSync=function(l){'use strict';if(!l.has_attachment&&c('MercuryConfig').WWWSyncMsgText){return true;}else if(l.has_attachment&&c('MercuryConfig').WWWSyncMsgAttach)return true;return false;};k.prototype.__shouldDropLogMessageBecauseOfSync=function(l){'use strict';if(c('MercuryConfig').WWWSyncMsgLog)switch(l.log_message_type){case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').THREAD_NAME:case c('MercuryLogMessageType').VIDEO_CALL:case c('MercuryLogMessageType').PHONE_CALL:case c('MercuryLogMessageType').THREAD_IMAGE:case c('MercuryLogMessageType').ORION:case c('MercuryLogMessageType').PAGE_REPLY:case c('MercuryLogMessageType').GENERIC_ADMIN_TEXT:return true;case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:case c('MercuryLogMessageType').SWITCH_TO_WORK:case c('MercuryLogMessageType').WALLPAPER:default:break;}return false;};Object.assign(k,c('MercurySingletonMixin'));f.exports=k;},null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(l){'use strict';i.constructor.call(this);this.$MercuryDeliveryReceipts2=l;this.$MercuryDeliveryReceipts3=new (c('Map'))();this.$MercuryDeliveryReceipts1=c('MercuryDispatcher').getForFBID(this.$MercuryDeliveryReceipts2);this.$MercuryDeliveryReceipts1.subscribe('update-delivery',function(m,n){if(n.delivery_receipts)for(var o in n.delivery_receipts){var p=n.delivery_receipts[o],q=this.$MercuryDeliveryReceipts3.get(o)||0;if(p>q){this.$MercuryDeliveryReceipts3.set(o,p);this.informDeliveryStatusChanged(o);}}}.bind(this));}j.getForFBID=function(l){'use strict';return k.getForFBID(l);};j.get=function(){'use strict';return k.get();};j.prototype.informDeliveryStatusChanged=function(l){'use strict';var m=new (c('Map'))();m.set(l,true);this.inform('change',m);};j.prototype.getDeliveryTime=function(l){'use strict';return this.$MercuryDeliveryReceipts3.get(l)||0;};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;},null);
__d('MercurySyncDeltaHolder',['Map'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.$MercurySyncDeltaHolder1=new (c('Map'))();this.$MercurySyncDeltaHolder2=[];}h.prototype.peek=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(i,j){return i-j;});return this.$MercurySyncDeltaHolder2[0];};h.prototype.pop=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(k,l){return k-l;});if(this.$MercurySyncDeltaHolder2.length===0)return undefined;var i=this.$MercurySyncDeltaHolder2.shift(),j=this.$MercurySyncDeltaHolder1.get(i);this.$MercurySyncDeltaHolder1['delete'](i);return {seqID:i,delta:j};};h.prototype.push=function(i,j){if(this.$MercurySyncDeltaHolder1.has(i))return;this.$MercurySyncDeltaHolder1.set(i,j);this.$MercurySyncDeltaHolder2.push(i);};f.exports=h;},null);
__d('MercurySyncNewMessageTransformer',['IrisProtocolMessageLifetime','MercuryActionType','MercuryIDs','MercuryTimestamp','MessagingTag'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=parseInt(j.messageMetadata.timestamp,10),l=c('MercuryTimestamp').getFormatedTimestamp(k),m=[];if(j.attachments)m=j.attachments.map(function(o){return o.mercury;});var n=j.messageMetadata.tags?j.messageMetadata.tags[0]:undefined;return {message_id:j.messageMetadata.messageId,threading_id:null,offline_threading_id:j.messageMetadata.offlineThreadingId,author:c('MercuryIDs').getParticipantIDFromUserID(j.messageMetadata.actorFbId),author_email:j.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:j.ttl?c('IrisProtocolMessageLifetime')[j.ttl]:0,timestamp:k,timestamp_absolute:l.absolute,timestamp_relative:l.relative,timestamp_datetime:l.relative,timestamp_time_passed:c('MercuryTimestamp').getTimeBucket(k),is_unread:i!==j.messageMetadata.actorFbId,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,forward_count:0,forward_message_ids:[],source:n,tags:j.messageMetadata.tags,is_spoof_warning:false,folder:c('MessagingTag').INBOX,thread_fbid:j.messageMetadata.threadKey.threadFbId,other_user_fbid:j.messageMetadata.threadKey.otherUserFbId,body:j.body!==undefined?j.body:'',html_body:null,subject:null,has_attachment:m.length>0,attachments:m,ranges:undefined,thread_id:null,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(j.data&&j.data.is_sponsored&&j.data.is_sponsored==='true')};}f.exports={transform:h};},null);
__d('MercurySyncAdminTextMessageTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={message_type:j.type,untypedData:j.untypedData};k.log_message_type=c('MercuryLogMessageType').GENERIC_ADMIN_TEXT;return k;}f.exports={transform:h};},null);
__d('MercurySyncDeliveryReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};},null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MercuryGlobalActionType','MessagingTag'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){if(i.folders&&i.folders.length>0)return i.folders.map(function(j){return {action_type:c('MercuryGlobalActionType').MARK_ALL_READ,action_id:null,folder:j,timestamp:parseInt(i.watermarkTimestamp,10)};});return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:true,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};},null);
__d('MercurySyncMessageDeleteTransformer',['MercuryActionType'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').DELETE_MESSAGES,message_ids:i.messageIds,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};}f.exports={transform:h};},null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={removed_participants:[c('MercuryIDs').getParticipantIDFromUserID(j.leftParticipantFbId)]};k.log_message_type=c('MercuryLogMessageType').UNSUBSCRIBE;return k;}f.exports={transform:h};},null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={added_participants:j.addedParticipants.map(function(l){return (c('MercuryIDs').getParticipantIDFromUserID(l.userFbId));})};k.log_message_type=c('MercuryLogMessageType').SUBSCRIBE;return k;}f.exports={transform:h};},null);
__d('MercurySyncRTCEventLogTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j),l=j.messageMetadata.actorFbId,m=l===i?j.messageMetadata.threadKey.otherUserFbId:i;k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={answered:j.duration>0,callee:c('MercuryIDs').getParticipantIDFromUserID(m),caller:c('MercuryIDs').getParticipantIDFromUserID(l)};k.log_message_type=c('MercuryLogMessageType').VIDEO_CALL;return k;}f.exports={transform:h};},null);
__d('MercurySyncReadReceiptTransformer',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=parseInt(i.actionTimestampMs,10),k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};},null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){j=Object.assign({},j.newMessage,j);return Object.assign(c('MercurySyncNewMessageTransformer').transform(i,j),{action_type:c('MercuryActionType').REPLACE_MESSAGE,replaced_message_id:j.replacedMessageId});}f.exports={transform:h};},null);
__d('MercurySyncThreadAdminsAddToGroupTransformer',['MercuryActionType','MercuryIDs'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').ADD_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,added_admin_ids:i.addedAdmins.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j.userFbId);})};}f.exports={transform:h};},null);
__d('MercurySyncThreadAdminsRemovedFromGroupTransformer',['MercuryActionType','MercuryIDs'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_admin_ids:i.removedAdminFbIds.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j);})};}f.exports={transform:h};},null);
__d('MercurySyncThreadDeleteTransformer',['MercuryActionType'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').DELETE_THREAD,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId};});}f.exports={transform:h};},null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={name:j.name};k.log_message_type=c('MercuryLogMessageType').THREAD_NAME;return k;}f.exports={transform:h};},null);
__d('MercurySyncDispatcher',['MercuryConfig','MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncThreadAdminsAddToGroupTransformer','MercurySyncThreadAdminsRemovedFromGroupTransformer','MercurySyncAdminTextMessageTransformer','MercurySyncDeliveryReceiptTransformer','MercurySyncMarkReadTransformer','MercurySyncMessageDeleteTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncRTCEventLogTransformer','MercurySyncThreadDeleteTransformer','MercurySyncThreadNameTransformer','MercurySyncReplaceMessageTransformer','MercurySyncDeltaTypes','MercurySingletonProvider'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercurySyncDispatcher1=j;this.$MercurySyncDispatcher2=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDispatcher1);}h.prototype.process=function(j){var k;switch(j['class']){case c('MercurySyncDeltaTypes').NewMessage:if(!this.$MercurySyncDispatcher4(j))break;k=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').ReplaceMessage:if(!this.$MercurySyncDispatcher4(j))break;k=c('MercurySyncReplaceMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').DeliveryReceipt:if(!c('MercuryConfig').WWWSyncDeliveryReceipt)break;k=c('MercurySyncDeliveryReceiptTransformer').transform(j);this.$MercurySyncDispatcher3.handleUpdate(k);break;case c('MercurySyncDeltaTypes').MarkRead:if(!c('MercuryConfig').WWWSyncMarkRead)break;k=c('MercurySyncMarkReadTransformer').transform(j);var l=false;for(var m=0;m<k.length;m++){var n=k[m];if(n.action_type===c('MercuryGlobalActionType').MARK_ALL_READ)l=true;}if(l)return;this.$MercurySyncDispatcher6(k);break;case c('MercurySyncDeltaTypes').ParticipantLeftGroupThread:if(!c('MercuryConfig').WWWSyncMsgLog)break;k=c('MercurySyncParticipantLeftGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').ParticipantsAddedToGroupThread:if(!c('MercuryConfig').WWWSyncMsgLog)break;k=c('MercurySyncParticipantsAddedToGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').RTCEventLog:if(!c('MercuryConfig').WWWSyncMsgLog)break;k=c('MercurySyncRTCEventLogTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').ThreadName:if(!c('MercuryConfig').WWWSyncMsgLog)break;k=c('MercurySyncThreadNameTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').ReadReceipt:if(!c('MercuryConfig').WWWSyncReadReceipt)break;k=c('MercurySyncReadReceiptTransformer').transform(j);this.$MercurySyncDispatcher3.handleUpdate(k);break;case c('MercurySyncDeltaTypes').AdminTextMessage:if(!c('MercuryConfig').WWWSyncMsgLog)break;k=c('MercurySyncAdminTextMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').MessageDelete:if(!c('MercuryConfig').WWWSyncDeleteMessage)break;k=c('MercurySyncMessageDeleteTransformer').transform(j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').ThreadDelete:if(!c('MercuryConfig').WWWSyncThreadDelete)break;k=c('MercurySyncThreadDeleteTransformer').transform(j);this.$MercurySyncDispatcher6(k);break;case c('MercurySyncDeltaTypes').AdminAddedToGroupThread:k=c('MercurySyncThreadAdminsAddToGroupTransformer').transform(j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').AdminRemovedFromGroupThread:k=c('MercurySyncThreadAdminsRemovedFromGroupTransformer').transform(j);this.$MercurySyncDispatcher5(k);break;default:break;}};h.prototype.$MercurySyncDispatcher4=function(j){var k=!!j.stickerId||j.attachments&&!!j.attachments.length;if(!k&&!c('MercuryConfig').WWWSyncMsgText){return false;}else if(k&&!c('MercuryConfig').WWWSyncMsgAttach)return false;return true;};h.prototype.$MercurySyncDispatcher5=function(j){var k=j.other_user_fbid||j.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[j],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE},k);};h.prototype.$MercurySyncDispatcher6=function(j){this.$MercurySyncDispatcher3.handleUpdate({actions:j,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d('MercurySyncDataFetcherImpl',['Promise','AsyncRequest','MessagingConfig','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MessagingConfig').syncFetchRequestTimeoutMs;function i(k){return new (c('Promise'))(function(l,m){j(k,l,m,0);});}function j(k,l,m,n){if(n>c('MessagingConfig').syncFetchRetries){m();return;}var o=n===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,n);c('setTimeoutAcrossTransitions')(function(){var p=false,q=function(){if(p)return;p=true;j(k,l,m,n+1);};new (c('AsyncRequest'))().setURI(k).setHandler(function(r){p=true;l(r);}).setErrorHandler(q).setTimeoutHandler(h,q).setAllowCrossPageTransition(true).send();},o);}f.exports={fetch:i};},null);
__d('MercurySyncDataFetcher',['Promise','MessagingConfig','MercurySyncDataFetcherImpl','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=500;function i(){var l=0;for(var m=0;m<c('MessagingConfig').syncFetchRetries;m++){var n=m===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,m);l+=n+h;}return l;}var j=i();function k(l){return new (c('Promise'))(function(m,n){c('MercurySyncDataFetcherImpl').fetch(l).done(m,n);c('setTimeoutAcrossTransitions')(n,j);});}f.exports={fetch:k};},null);
__d("XMercuryFetchMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/fetch_message\/",{other_user_or_thread_fbid:{type:"Int",required:true},mid:{type:"String",required:true}});},null);
__d("XMercuryInvalidateGlobalStateController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_global_state\/",{});},null);
__d("XMercuryInvalidateThreadStateController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_thread_state\/",{other_user_or_thread_fbid:{type:"Int",required:true},num_messages:{type:"Int",required:true}});},null);
__d('MercurySyncDFFDataFetcher',['Promise','ActorURI','AsyncRequest','MercuryMessages','MercuryThreads','MercuryThreadIDMap','MercurySingletonProvider','MercurySyncDataFetcher','XMercuryFetchMessageController','XMercuryInvalidateGlobalStateController','XMercuryInvalidateThreadStateController'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercurySyncDFFDataFetcher1=j;this.__messages=c('MercuryMessages').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=c('MercuryThreads').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncDFFDataFetcher1);}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.fetchInvalidateGlobalState=function(){var j=c('XMercuryInvalidateGlobalStateController').getURIBuilder().getURI(),k=c('ActorURI').create(j,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(k);};h.prototype.fetchInvalidateThreadState=function(j,k){var l=3,m=j||k,n=this.__threadIDMap.getClientIDFromServerIDNow(m);if(!n)return c('Promise').resolve({getPayload:function(){return {};}});var o=this.__messages.getCurrentlyLoadedMessages(n).length,p=c('XMercuryInvalidateThreadStateController').getURIBuilder().setInt('other_user_or_thread_fbid',m).setInt('num_messages',o+l).getURI(),q=c('ActorURI').create(p,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(q);};h.prototype.fetchInvalidateMessage=function(j,k,l){var m=c('XMercuryFetchMessageController').getURIBuilder().setInt('other_user_or_thread_fbid',j||k).setString('mid',l).getURI(),n=c('ActorURI').create(m,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(n);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;},null);
__d('MercurySyncForcedFetchHandler',['Promise','MercurySingletonProvider','MercurySyncDFFDataFetcher','MercuryMessages','MercuryThreadIDMap'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(k){return {getPayload:function(){return {sequence_id:k};}};}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncForcedFetchHandler1=k;this.$MercurySyncForcedFetchHandler2=c('MercuryMessages').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=c('MercurySyncDFFDataFetcher').getForFBID(this.$MercurySyncForcedFetchHandler1);}i.prototype.processMessageDFF=function(k,l,m,n){if(n){var o=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),p=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(o);if(p===undefined)return c('Promise').resolve(h(k));var q=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([m]);if(q.length===0)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(l.otherUserFbId,l.threadFbId,m);};i.prototype.processThreadDFF=function(k,l,m){if(m){var n=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),o=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(n);if(o===undefined)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(l.otherUserFbId,l.threadFbId);};i.prototype.processGlobalDFF=function(){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalState();};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;},null);
__d('MercurySyncHolesTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MercurySyncHolesTypedLogger1=babelHelpers['extends']({},this.$MercurySyncHolesTypedLogger1,j);return this;};h.prototype.setDifference=function(j){this.$MercurySyncHolesTypedLogger1.difference=j;return this;};h.prototype.setSeqID=function(j){this.$MercurySyncHolesTypedLogger1.seq_id=j;return this;};h.prototype.setTopicType=function(j){this.$MercurySyncHolesTypedLogger1.topic_type=j;return this;};h.prototype.setVC=function(j){this.$MercurySyncHolesTypedLogger1.vc=j;return this;};var i={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=h;},null);
__d('MercurySyncDeltaHandler',['invariant','Arbiter','ChannelConstants','LogHistory','MercuryConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercurySyncDeltaHolder','MercurySyncDeltaTypes','MercurySyncDispatcher','MercurySyncForcedFetchHandler','MercurySyncHolesTypedLogger','MercuryServerPayloadPreprocessor','MercurySyncTopicType','MercurySingletonProvider'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('LogHistory').getInstance('mercury_sync_delta_handler');j.getForFBID=function(l){return k.getForFBID(l);};j.get=function(){return k.get();};function j(l){this.$MercurySyncDeltaHandler1=l;this.$MercurySyncDeltaHandler2=c('MercurySyncDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=c('MercurySyncForcedFetchHandler').getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler5=new (c('MercurySyncDeltaHolder'))();this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler7=[];this.$MercurySyncDeltaHandler3=0;c('Arbiter').subscribe('MercurySyncDeltaHandler/initSeqID',function(m,n){var o=n&&n.seqID,p=n&&n.fbid;if(!o||!p)return;if(p!==this.$MercurySyncDeltaHandler1)return;this.$MercurySyncDeltaHandler3=o;this.$MercurySyncDeltaHandler8();}.bind(this));}j.prototype.$MercurySyncDeltaHandler8=function(){c('Arbiter').subscribe('channel/message:delta',function(l,m){var n=m&&m.obj&&m.obj.queue;if(n)if(n.toString()!==this.$MercurySyncDeltaHandler1)return;var o=m&&m.obj&&m.obj.delta,p=m&&m.obj&&m.obj.iseq;if(!o||!p)return;this.$MercurySyncDeltaHandler9(p,c('MercurySyncTopicType').DELTA);this.$MercurySyncDeltaHandler10(p,o);if(c('MercuryConfig').WWWSyncRaceConditionImprovements){this.$MercurySyncDeltaHandler5.push(p,o);this.$MercurySyncDeltaHandler11();}else this.$MercurySyncDeltaHandler12(p,o);}.bind(this));c('Arbiter').subscribe('channel/message:deltaflow',function(l,m){var n=m&&m.obj&&m.obj.queue;if(n)if(n.toString()!==this.$MercurySyncDeltaHandler1)return;var o=m&&m.obj&&parseInt(m.obj.sequencer,10);this.$MercurySyncDeltaHandler9(o,c('MercurySyncTopicType').DELTAFLOW);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF),function(l,m){var n=m&&m.obj&&m.obj.queue;if(n&&n.toString()!==this.$MercurySyncDeltaHandler1)return;var o=m&&m.obj&&m.obj.delta;if(!o)return;this.$MercurySyncDeltaHandler7.push(o);this.$MercurySyncDeltaHandler11();}.bind(this));};j.prototype.$MercurySyncDeltaHandler11=function(){if(this.$MercurySyncDeltaHandler6)return;if(this.$MercurySyncDeltaHandler7.length>0){var l=this.$MercurySyncDeltaHandler7.shift();this.$MercurySyncDeltaHandler12(this.$MercurySyncDeltaHandler3,l);this.$MercurySyncDeltaHandler11();}var m=this.$MercurySyncDeltaHandler5.peek();if(!m)return;var n=m-this.$MercurySyncDeltaHandler3;if(n===1){var o=this.$MercurySyncDeltaHandler5.pop();if(!o)return;var p=o.seqID,q=o.delta;this.$MercurySyncDeltaHandler12(p,q);this.$MercurySyncDeltaHandler11();}else if(n>1){this.$MercurySyncDeltaHandler13();}else{this.$MercurySyncDeltaHandler5.pop();this.$MercurySyncDeltaHandler11();}};j.prototype.$MercurySyncDeltaHandler12=function(l,m){this.$MercurySyncDeltaHandler3=l;if(m['class']===c('MercurySyncDeltaTypes').ForcedFetch){if(!c('MercuryConfig').WWWSyncForcedFetch)return;i.debug('DFF',JSON.stringify(m));if(m.threadKey!==undefined&&m.messageId===undefined){this.$MercurySyncDeltaHandler14(l,m);}else if(m.threadKey!==undefined&&m.messageId!==undefined){this.$MercurySyncDeltaHandler15(l,m);}else this.$MercurySyncDeltaHandler16(l);}else this.$MercurySyncDeltaHandler2.process(m);};j.prototype.$MercurySyncDeltaHandler13=function(){i.debug('hole',JSON.stringify({$MercurySyncDeltaHandler3:this.$MercurySyncDeltaHandler3,nextSeqID:this.$MercurySyncDeltaHandler5.peek()}));var l=this.$MercurySyncDeltaHandler5.peek();!!!l?h(0):undefined;var m=l-1;this.$MercurySyncDeltaHandler16(m);};j.prototype.$MercurySyncDeltaHandler17=function(l,m,n,o){if(c('MercuryConfig').WWWSyncRaceConditionImprovements)!!this.$MercurySyncDeltaHandler6?h(0):undefined;this.$MercurySyncDeltaHandler6=true;i.debug('_scheduleDataFetch:start',JSON.stringify({seqID:l}));m().done(function(p){i.debug('_scheduleDataFetch:success',JSON.stringify({seqID:l}));n(l,p);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler11();}.bind(this),function(){i.debug('_scheduleDataFetch:failure',JSON.stringify({seqID:l}));o(l);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler11();}.bind(this));};j.prototype.$MercurySyncDeltaHandler16=function(l){this.$MercurySyncDeltaHandler17(undefined,function(){return this.$MercurySyncDeltaHandler4.processGlobalDFF();}.bind(this),function(m,n){var o=n.getPayload();this.__payloadPreprocessor.handleUpdate(o);if(o.sequence_id)this.$MercurySyncDeltaHandler3=o.sequence_id;}.bind(this),function(){this.$MercurySyncDeltaHandler3=l;}.bind(this));};j.prototype.$MercurySyncDeltaHandler14=function(l,m){this.$MercurySyncDeltaHandler17(l,function(){return this.$MercurySyncDeltaHandler4.processThreadDFF(l,m.threadKey,m.isLazy);}.bind(this),function(n,o){this.__payloadPreprocessor.handleUpdate(o.getPayload());this.$MercurySyncDeltaHandler3=n;}.bind(this),function(){var n=babelHelpers['extends']({},m);delete n.threadKey;this.$MercurySyncDeltaHandler3=l-1;this.$MercurySyncDeltaHandler5.push(l,n);}.bind(this));};j.prototype.$MercurySyncDeltaHandler15=function(l,m){this.$MercurySyncDeltaHandler17(l,function(){return this.$MercurySyncDeltaHandler4.processMessageDFF(l,m.threadKey,m.messageId,m.isLazy);}.bind(this),function(n,o){var p=o.getPayload(),q=p.other_user_fbid?p.other_user_fbid:p.thread_fbid,r=[babelHelpers['extends']({},p)],s=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:r,payload_source:s},q);this.$MercurySyncDeltaHandler3=n;}.bind(this),function(){var n=babelHelpers['extends']({},m);delete n.messageId;this.$MercurySyncDeltaHandler3=l-1;this.$MercurySyncDeltaHandler5.push(l,n);}.bind(this));};j.prototype.$MercurySyncDeltaHandler9=function(l,m){var n=l-this.$MercurySyncDeltaHandler3;if(n!==1&&n!==0){if(!c('MercuryConfig').WWWSyncHolesLogging)return;new (c('MercurySyncHolesTypedLogger'))().setSeqID(l).setDifference(n).setTopicType(m).log();}};j.prototype.$MercurySyncDeltaHandler10=function(l,m){if(m['class']===c('MercurySyncDeltaTypes').NewMessage){var n={seqID:l,threadKey:m.messageMetadata.threadKey,messageId:m.messageMetadata.messageId};i.debug('message_delta_received',JSON.stringify(n));}};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;},null);
__d('MercurySyncEnvironment',['Arbiter','ChannelInitialData','CurrentUser','MercurySyncDeltaHandler'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){if(!c('ChannelInitialData').channelConfig)return;c('MercurySyncDeltaHandler').get();c('Arbiter').inform('MercurySyncDeltaHandler/initSeqID',{fbid:c('CurrentUser').getAccountID(),seqID:c('ChannelInitialData').channelConfig.sequenceId});}f.exports={setUp:h};},null);
__d('P2PDialogStore',['EventEmitter','P2PActionConstants','P2PDispatcher'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j,k={};h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;function l(){i.constructor.call(this);j=c('P2PDispatcher').register(this.onEventDispatched.bind(this));k={dialogClass:null,dialogProps:null};}l.prototype.getState=function(){return k;};l.prototype.onEventDispatched=function(m){var n=m.type,o=m.data;switch(n){case c('P2PActionConstants').DIALOG_SHOWN:k.dialogClass=o.dialogClass;k.dialogProps=o.dialogProps;this.emit('change');break;case c('P2PActionConstants').DIALOG_CLOSED:k.dialogClass=null;k.dialogProps=null;this.emit('change');break;}};f.exports=new l();},null);
__d('P2PDialogContainer.react',['P2PDialogStore','React','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').createClass({displayName:'P2PDialogContainer',mixins:[c('ReactLayeredComponentMixin')],getInitialState:function(){return c('P2PDialogStore').getState();},componentDidMount:function(){this.dialogStoreSub=c('P2PDialogStore').addListener('change',this.onDialogStoreChange);},componentWillUnmount:function(){if(this.dialogStoreSub){this.dialogStoreSub.remove();this.dialogStoreSub=null;}},onDialogStoreChange:function(){this.setState(c('P2PDialogStore').getState());},renderLayers:function(){if(!this.state.dialogClass)return {};var i=this.state.dialogClass;return {dialog:c('React').createElement(i,this.state.dialogProps)};},render:function(){return null;}});f.exports=h;},null);
__d('TabsViewport',['csx','Arbiter','ArbiterMixin','ChatTabModel','Dock','DOM','Event','Parent','Vector','ViewportBounds','areJSONRepresentationsEqual','getViewportDimensions'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=175,j=269,k=0;function l(){return i;}function m(){return j;}function n(o){this._root=o;var p=this._recalculateWidth.bind(this);c('Event').listen(window,'resize',p);c('Dock').subscribe('resize',p);c('Arbiter').subscribeOnce('sidebar/initialized',p,c('Arbiter').SUBSCRIBE_NEW);c('ChatTabModel').addListener(function(){return this._recalculateTabs(true);}.bind(this));this._recalculateWidth();this._initialized=true;}Object.assign(n.prototype,c('ArbiterMixin'),{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var o=n._getAvailableDockWidth(this._root),p=Math.max(1,Math.floor(o/m())),q=p!=this._maxShown;if(!this._viewState||q||o<=this._viewState.usedWidth||o>this._viewState.widthToShowNext){this._availableWidth=o;this._maxShown=p;this._viewState=null;this._recalculateTabs(q);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(o){var p=n._getTabsToShow(c('ChatTabModel').get(),this._availableWidth);if(o||!c('areJSONRepresentationsEqual')(this._viewState,p)){this._viewState=p;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>m();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var o=c('ChatTabModel').get(),p=this._viewState.tabsToShow;return o.tabs.filter(function(q){return p[q.id];});},getRightmostHiddenTab:function(){var o=c('ChatTabModel').get(),p=this._viewState.tabsToShow,q=o.tabs.filter(function(s){return !p[s.id];}),r=q.shift();return r?r.id:null;},getLeftmostVisibleTab:function(){var o=this.getShowingTabsOrder(),p=o.pop();return p?p.id:null;},getRaisedVisibleTabs:function(){var o=[],p=this.getShowingTabsOrder(),q=p.length;for(var r=0;r<q;r++)if(c('ChatTabModel').getTab(p[r].id).raised)o.push(p[r].id);return o;},shouldPromoteOnRaise:function(o){if(!this._viewState.tabsToShow[o])return true;if(this._viewState.nextToHide!=o)return false;var p=c('ChatTabModel').getTab(o),q=p&&p.raised;return !q&&this._availableWidth-this._viewState.usedWidth<m()-l();}});Object.assign(n,{_getAvailableDockWidth:function(o){var p=c('getViewportDimensions').withoutScrollbars().width;p-=c('ViewportBounds').getLeft()+c('ViewportBounds').getRight();p-=50;var q=c('Parent').byClass(o,'fbDock'),r=c('DOM').find(q,"._56ox"),s=r?c('Vector').getElementDimensions(r).x:0;p-=s;var t=c('DOM').scry(q,"._56oy");s+=c('Vector').getElementDimensions(t.pop()).x;var u=c('Vector').getElementDimensions(q),v=u.x-s;if(v>k)k=v;p-=k;p-=15;return Math.max(p,0);},_getTabsToShow:function(o,p){p=Math.max(p,m()+1);function q(ga,ha){return ga.raised||!ha?m():l();}var r=JSON.parse(JSON.stringify(o.tabs)),s=-1,t=null;if(o.promoted)r.forEach(function(ga,ha){if(ga.id===o.promoted){s=ha;t=ga;}});var u=0,v=false,w=0,x=!t;r.forEach(function(ga,ha){var ia=q(ga,v);v=v||!ga.raised;ga.leftmostOffset=u+ia;u+=ia;if(ga.leftmostOffset<p)w++;x|=ha==s;ga.alreadyPlacedPromoted=x;});function y(ga,ha,ia){var ja={};for(var ka=0;ka<ha;ka++){var la=ga[ka];if(!la.alreadyPlacedPromoted&&ka==ha-1){ja[ia]=true;}else ja[la.id]=true;}return ja;}var z=y(r,w,o.promoted),aa=y(r,w-1,o.promoted),ba=null;for(var ca in z)if(!aa[ca])ba=ca;var da=r[w-1],ea=da?da.leftmostOffset:0,fa=Infinity;if(w<r.length)fa=r[w].leftmostOffset;return {nextToHide:ba,tabsToShow:z,usedWidth:ea,widthToShowNext:fa};}});f.exports=n;},null);
__d('ChatApp',['csx','Promise','CSS','ChatPerfInstrumentation','DOM','JSLogger','React','ReactDOM','TimeSlice'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={chatOpenTabImpl:undefined,tabsViewport:undefined,tabViewCoordinator:undefined,tabController:undefined,init:function(n,o,p){if(this._isInitialized){c('JSLogger').create('chat_app').error('repeated_init');return;}this._rootElem=n;c('Promise').resolve().then(function(){return c('ChatPerfInstrumentation').init();}).then(c('TimeSlice').guard(function(){return j();},'ChatApp stores')).then(c('TimeSlice').guard(function(){return k(p);},'ChatApp data')).then(c('TimeSlice').guard(function(){return l(o,n);},'ChatApp UI')).then(c('TimeSlice').guard(function(){return m();},'ChatApp Hotlike sound')).done(function(){this._isInitialized=this._isLoaded=true;c('ChatPerfInstrumentation').logTTI();}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !!(!this._isInitialized||this._isHidden);},hide:function(){if(this.isHidden())return;c('CSS').hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){c('CSS').show(this._rootElem);this.tabsViewport.checkWidth();e(['Dock'],function(n){n.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){e(['UIPagelet'],function(n){n.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');n.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function j(){return new (c('Promise'))(function(n){e(['MercuryBlockedParticipants','MercuryChannelHandler','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryStateCheck','MercuryThreads','MercuryUnreadState','MercuryUnseenState','MercurySyncEnvironment','P2PSendMoneyDialogStore'],function(o,p,q,r,s,t,u,v,w,x,y,z){o.get();p.get().turnOn();q;r.get();s.get();t;v.get();x.get();w.get();u.get();y.setUp();c('ChatPerfInstrumentation').logInitStores();n();});});}function k(n){return new (c('Promise'))(function(o){e(['MercuryServerPayloadPreprocessor'],function(p){p.get().handleUpdate(n);c('ChatPerfInstrumentation').logInitData();o();});});}function l(n,o){return new (c('Promise'))(function(p){e(['ChatDispatcher','ChatTabController','ChatTabModel','ChatTabViewCoordinator','TabsViewport','MNCommerceDialogContainer.react','P2PDialogContainer.react','FBRTCMessageHandler','ChatOpenTabImpl'],function(q,r,s,t,u,v,w,x,y){q.explicitlyRegisterStore(s);i.tabsViewport=new u(n);i.tabViewCoordinator=new t(n,i.tabsViewport);i.tabController=new r(i.tabsViewport);x.init();var z=c('DOM').find(o,"._26-x");c('ReactDOM').render(c('React').createElement(v,null),z);var aa=c('DOM').find(o,"._26-y");c('ReactDOM').render(c('React').createElement(w,null),aa);i.chatOpenTabImpl=y;c('ChatPerfInstrumentation').logInitUI();p();});});}function m(){return new (c('Promise'))(function(n){e(['HotLikeSound','ChatOptions'],function(o,p){o.setCheckSoundEnabledFunc(function(){return p.getSetting('sound');});c('ChatPerfInstrumentation').logInitSound();n();});});}f.exports=i;},null);