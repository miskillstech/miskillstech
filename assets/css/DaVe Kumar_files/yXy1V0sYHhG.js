/*!CK:3923512887!*//*1456138382,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["YI6R+"]); }

__d('PluginSend',['Arbiter','CSS','DOM','DOMEvent','DOMEventListener','Focus','Plugin','PluginOptin','PluginResize'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(i,j,k,l,m,n){if(m)new (c('PluginResize'))(function(){return i.offsetWidth;},function(){return i.offsetHeight;}).resize().auto();if(!l){var o=new (c('PluginOptin'))('send').addReturnParams({act:'send'});c('DOMEventListener').add(j,'click',o.start.bind(o));return;}var p=false,q=false;function r(){q=!q;c('CSS').toggle(j);c('CSS').toggle(k);c('CSS').toggle(l);if(q){setTimeout(function(){var u=c('DOM').find(l,'.textInput');c('Focus').set(u);},500);}else{var s=c('DOM').find(j,'button');c('Focus').set(s);}if(!p){var t=window.ServerJSAsyncLoader;t&&t.ondemandjs&&t.run(t.ondemandjs);p=true;}new (c('PluginResize'))(function(){return Math.max(i.offsetWidth,l.offsetWidth);},function(){return Math.max(i.offsetHeight,l.offsetHeight+l.offsetTop);},'resize.iframe',true).resize().auto();}c('DOMEventListener').add(j,'click',r);c('DOMEventListener').add(k,'click',r);c('DOMEventListener').add(i.parentNode,'click',function(s){s=new (c('DOMEvent'))(s);if(s.target===i.parentNode){s.kill();r();}});c('Arbiter').subscribe(h.CLOSE,r);c('Arbiter').subscribe(c('Plugin').ERROR,function(event,s){c('DOM').setContent(i,s.content);r();});if(n)r();};Object.assign(h,{SUCCESS:'platform/plugins/send/success',CLOSE:'platform/plugins/send/close',success:function(){c('Arbiter').inform(this.SUCCESS);}});f.exports=h;},null);
__d('PluginUITypeahead',['DOMDimensions','DOMQuery','Tokenizer','getElementPosition'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){return c('DOMQuery').scry(document.body,'.uiTokenizer').map(function(j){var k=c('Tokenizer').getInstance(j);if(!k)return {x:0,y:0};var l=k.getTypeahead().getView(),m=c('getElementPosition')(l.getElement()),n=c('DOMDimensions').getElementDimensions(l.getElement());return {x:m.x+n.width,y:m.y+n.height};});}var i={width:function(){return Math.max.apply(null,h().map(function(j){return j.x;}));},height:function(){return Math.max.apply(null,h().map(function(j){return j.y;}));}};f.exports=i;},null);
__d('PluginSendFlyout',['Arbiter','Button','DOMEvent','DOMEventListener','DOMQuery','Focus','FormSubmit','PluginResize','PluginSend','PluginUITypeahead','Tokenizer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){}Object.assign(h,{init:function(i){var j=c('DOMQuery').find(i,'.uiTokenizer'),k=c('Tokenizer').getInstance(j),l=c('DOMQuery').find(i,'.textInput'),m=c('DOMQuery').find(i,'.pluginSendFlyoutTextarea'),n=c('DOMQuery').find(i,'form'),o=c('DOMQuery').find(document.body,'.pluginSend'),p=c('DOMQuery').find(n,'.pluginSendFlyoutCancelButton'),q=c('DOMQuery').find(n,'.pluginSendFlyoutSendButton');c('Arbiter').subscribe('Form/change',function(s,t){if(t.node!==j)return;c('Button').setEnabled(q,k.getTokens().length>0);});function r(){k.reset();m.value='';c('Button').setEnabled(q,false);c('Focus').setWithoutOutline(o);c('Arbiter').inform(c('PluginSend').CLOSE);}c('DOMEventListener').add(n,'submit',function(s){new (c('DOMEvent'))(s).kill();c('FormSubmit').send(n);});c('DOMEventListener').add(p,'click',function(s){new (c('DOMEvent'))(s).kill();r();});c('DOMEventListener').add(p,'keydown',function(s){s=new (c('DOMEvent'))(s);var t=s.event.keyCode||s.event.which;if(t==9&&!s.event.shiftKey){s.preventDefault();c('Focus').set(l);}});c('DOMEventListener').add(l,'keydown',function(s){s=new (c('DOMEvent'))(s);var t=s.event.keyCode||s.event.which;if(t==9&&s.event.shiftKey){s.preventDefault();if(l.getAttribute('aria-expanded')=='true'){l.setAttribute('aria-expanded','false');}else c('Focus').set(p);}});c('DOMEventListener').add(n,'keyup',function(s){s=new (c('DOMEvent'))(s);var t=s.event.keyCode||s.event.which;if(t==27)r();});c('Arbiter').subscribe(c('PluginSend').SUCCESS,r);new (c('PluginResize'))(function(){return Math.max(o.offsetWidth,i.offsetWidth,c('PluginUITypeahead').width());},function(){return Math.max(o.offsetHeight,i.offsetHeight+i.offsetTop,c('PluginUITypeahead').height());},'resize.iframe',false).resize().auto();}});f.exports=h;},null);
__d('TypeaheadPreventSubmitOnEnter',['Event','Keys'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._typeahead=i;}h.prototype.enable=function(){'use strict';var i=this._typeahead.getCore().getElement();this._listener=c('Event').listen(i,'keypress',function(j){if(c('Event').getKeyCode(j)==c('Keys').RETURN)j.kill();});};h.prototype.disable=function(){'use strict';this._listener.remove();this._listener=null;};Object.assign(h.prototype,{_listener:null});f.exports=h;},null);
__d('TypeaheadShowResultsOnFocus',['Event','Keys'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._typeahead=i;}h.prototype.enable=function(){'use strict';this._typeahead.getCore().resetOnKeyup=false;this._subscription=this._typeahead.subscribe('bootstrap',function(i,j){this.firstFetch(j,this._typeahead.getCore(),this._typeahead.getData());}.bind(this));this._keyUpListener=c('Event').listen(this._typeahead.getCore().getElement(),'keyup',function(event){if(c('Event').getKeyCode(event)==c('Keys').BACKSPACE||c('Event').getKeyCode(event)==c('Keys').DELETE)this.respond(this._typeahead.getCore(),this._typeahead.getData());}.bind(this));this._focusListener=c('Event').listen(this._typeahead.getCore().getElement(),'focus',function(event){this.respond(this._typeahead.getCore(),this._typeahead.getData());}.bind(this));};h.prototype.disable=function(){'use strict';this._typeahead.unsubscribe(this._subscription);this._subscription=null;this._keyUpListener.remove();this._keyUpListener=null;this._focusListener.remove();this._focusListener=null;};h.prototype.firstFetch=function(i,j,k){'use strict';!i.bootstrapping&&this.respond(j,k);};h.prototype.respond=function(i,j){'use strict';if(!i.getValue())this.refreshAndShowNeededResults(i,j);};h.prototype.refreshAndShowNeededResults=function(i,j){'use strict';var k=this.getUidsFromData(j);i.setValue('');var l=j.buildUids(' ',k);j.respond('',l);};h.prototype.getUidsFromData=function(i){'use strict';var j=i.getAllEntries(),k=[];for(var l in j)k.push({uid:j[l].uid,index:j[l].index});k.sort(function(m,n){return m.index-n.index;});return k.map(function(m){return m.uid;});};Object.assign(h.prototype,{_subscription:null,_keyUpListener:null,_focusListener:null});f.exports=h;},null);